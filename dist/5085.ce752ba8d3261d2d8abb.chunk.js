(self.webpackChunkmapstore2=self.webpackChunkmapstore2||[]).push([[5085],{221389:(e,t,o)=>{"use strict";o.d(t,{Z:()=>M});var r=o(45697),i=o.n(r),a=o(124852),n=o.n(a),s=o(610928),p=o.n(s),l=o(414293),d=o.n(l),c=o(845243),h=o.n(c),u=(o(921787),o(451172),o(835516));function f(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var r=o.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}h().Draw.Polygon.prototype._calculateFinishDistance=function(e){if(this._markers.length>0){const t=this._map.latLngToContainerPoint(this._markers[0].getLatLng()),o=this._map.latLngToContainerPoint(this._markers[this._markers.length-1].getLatLng()),r=new(h().Marker)(e,{icon:this.options.icon,zIndexOffset:2*this.options.zIndexOffset}),i=this._map.latLngToContainerPoint(r.getLatLng());return Math.min(t.distanceTo(i),o.distanceTo(i))}return 1/0};const y=o(727418),{reproject:m,reprojectBbox:w,calculateCircleCoordinates:g,reprojectGeoJson:v}=o(351546),{pointToLayer:P}=o(247012),L=Math.PI/180,C=function(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"EPSG:4326";if("EPSG:4326"===o||void 0===e)return{center:t,projection:o,radius:e};const r=m({x:t.lng,y:t.lat},o,"EPSG:4326");if(void 0===e)return{center:r,projection:o,radius:e};const i=m([t.lng+e,t.lat],o,"EPSG:4326");return{center:r,projection:"EPSG:4326",radius:Math.sqrt(Math.pow(r.x-i.x,2)+Math.pow(r.y-i.y,2))*Math.cos(L*r.y)*40075017/360}};class S extends n().Component{constructor(){super(...arguments),f(this,"onDrawStart",(()=>{this.drawing=!0})),f(this,"onDrawCreated",(e=>{this.drawing=!1;const t=e.layer;let o,r=t.toGeoJSON();"marker"===e.layerType?o=h().latLngBounds(r.geometry.coordinates,r.geometry.coordinates):(t._map||(t._map=this.props.map,t._renderer=this.props.map.getRenderer(t),t._project()),o=t.getBounds());let i=(e=>[e.getWest(),e.getSouth(),e.getEast(),e.getNorth()])(o),a=o.getCenter();a=[a.lng,a.lat];let n=r.geometry.coordinates,s="EPSG:4326",p=r.geometry.type,l=t.getRadius?t.getRadius():0;if("circle"===e.layerType){r.projection="EPSG:4326",s="EPSG:3857",i=w(i,"EPSG:4326",s);const e=((e,t,o)=>{if("EPSG:4326"===o)return{center:t,srs:o,radius:e};const r=e/40075017*360/Math.cos(L*t[1]),i=m(t,"EPSG:4326",o);if(r){const e=m([t[0]+r,t[1]],"EPSG:4326",o);return{center:i,srs:o,radius:Math.sqrt(Math.pow(i.x-e.x,2)+Math.pow(i.y-e.y,2))}}return{center:i,srs:o,radius:e}})(t._mRadius,a,s);a=e.center,l=e.radius,n=g(a,l,100),r.radius=t.getRadius?t.getRadius():0,a=[a.x,a.y],p="Polygon"}this.drawLayer.addData(r);let d={type:p,extent:i,center:a,coordinates:n,radius:l,projection:s};this.props.options&&this.props.options.stopAfterDrawing&&this.props.onChangeDrawingStatus("stop",this.props.drawMethod,this.props.drawOwner);const c=this.convertFeaturesToGeoJson(e.layer,this.props);this.props.onEndDrawing(d,this.props.drawOwner),this.props.onGeometryChanged([c],this.props.drawOwner,this.props.options&&this.props.options.stopAfterDrawing?"enterEditMode":"")})),f(this,"onUpdateGeom",((e,t)=>{const o=this.convertFeaturesToGeoJson(e,t);t.onGeometryChanged([o],t.drawOwner)})),f(this,"addLayer",(e=>{this.clean();const t=h().geoJson(null,{pointToLayer:function(e,t){const{center:o,radius:r}=C(e.radius,t,e.projection);return h().circle(o,r||5)},style:t=>e.style&&e.style[t.geometry.type]||{color:"#ffcc33",opacity:1,weight:3,fillColor:"#ffffff",fillOpacity:.2,clickable:!1}});this.props.map.addLayer(t),e.features&&e.features.length>0&&t.addData(this.convertFeaturesPolygonToPoint(e.features,this.props.drawMethod)),this.drawLayer=t})),f(this,"addGeojsonLayer",(e=>{let{features:t,projection:o,style:r}=e;this.clean();let i=h().geoJson(t,{style:e=>e.style||r,pointToLayer:(e,t)=>{let i=m({x:t.lng,y:t.lat},o,"EPSG:4326");return P(h().latLng(i.y,i.x),e,r)}});this.drawLayer=i.addTo(this.props.map)})),f(this,"replaceFeatures",(e=>{this.drawLayer?(this.drawLayer.clearLayers(),"Circle"===this.props.drawMethod?(this.drawLayer.options.pointToLayer=(e,t)=>{const{center:o,radius:r}=C(e.radius,t,e.projection);return h().circle(o,r||5)},this.drawLayer.options.style={color:"#ffcc33",opacity:1,weight:3,fillColor:"#ffffff",fillOpacity:.2,clickable:!1}):this.drawLayer.options.pointToLayer=(t,o)=>{let r=m({x:o.lng,y:o.lat},e.options&&e.options.featureProjection||"EPSG:4326","EPSG:4326");return P(h().latLng(r.y,r.x),t,e.style)},this.drawLayer.addData(this.convertFeaturesPolygonToPoint(e.features,this.props.drawMethod))):this.addGeojsonLayer({features:e.features,projection:e.options&&e.options.featureProjection||"EPSG:4326",style:e.style&&e.style[e.drawMethod]||e.style})})),f(this,"endDrawing",(e=>{this.replaceFeatures(e);const t=p()(e.features);"Circle"!==this.props.drawMethod||!t||d()(t.center)||d()(t.radius)?t&&this.props.onEndDrawing(t,this.props.drawOwner):this.props.onEndDrawing({...t,coordinates:g(t.center,t.radius,100)},this.props.drawOwner)})),f(this,"addDrawInteraction",(e=>{this.removeAllInteractions(),"Point"===e.drawMethod||"MultiPoint"===e.drawMethod?this.addGeojsonLayer({features:e.features,projection:e.options&&e.options.featureProjection||"EPSG:4326",style:e.style&&e.style[e.drawMethod]||e.style}):this.addLayer(e),this.props.map.on("draw:created",this.onDrawCreated,this),this.props.map.on("draw:drawstart",this.onDrawStart,this),"LineString"===e.drawMethod||"Bearing"===e.drawMethod||"MultiLineString"===e.drawMethod?this.drawControl=new(h().Draw.Polyline)(this.props.map,{shapeOptions:{color:"#000000",weight:2,fillColor:"#ffffff",fillOpacity:.2},showLength:!1,repeatMode:!0,icon:new(h().DivIcon)({iconSize:new(h().Point)(8,8),className:"leaflet-div-icon leaflet-editing-icon"}),touchIcon:new(h().DivIcon)({iconSize:new(h().Point)(8,8),className:"leaflet-div-icon leaflet-editing-icon leaflet-touch-icon"})}):"Polygon"===e.drawMethod||"MultiPolygon"===e.drawMethod?this.drawControl=new(h().Draw.Polygon)(this.props.map,{shapeOptions:{color:"#000000",weight:2,fillColor:"#ffffff",fillOpacity:.2,dashArray:[5,5],guidelineDistance:5},allowIntersection:!1,showLength:!1,showArea:!1,repeatMode:!0,icon:new(h().DivIcon)({iconSize:new(h().Point)(8,8),className:"leaflet-div-icon leaflet-editing-icon"}),touchIcon:new(h().DivIcon)({iconSize:new(h().Point)(8,8),className:"leaflet-div-icon leaflet-editing-icon leaflet-touch-icon"})}):"BBOX"===e.drawMethod?this.drawControl=new(h().Draw.Rectangle)(this.props.map,{draw:!1,shapeOptions:{color:"#000000",weight:2,fillColor:"#ffffff",fillOpacity:.2,dashArray:[5,5]},repeatMode:!0,icon:new(h().DivIcon)({iconSize:new(h().Point)(8,8),className:"leaflet-div-icon leaflet-editing-icon"}),touchIcon:new(h().DivIcon)({iconSize:new(h().Point)(8,8),className:"leaflet-div-icon leaflet-editing-icon leaflet-touch-icon"})}):"Circle"===e.drawMethod?this.drawControl=new(h().Draw.Circle)(this.props.map,{shapeOptions:{color:"#000000",weight:2,fillColor:"#ffffff",fillOpacity:.2,dashArray:[5,5]},showRadius:!1,repeatMode:!0}):"Point"!==e.drawMethod&&"MultiPoint"!==e.drawMethod||(this.drawControl=new(h().Draw.Marker)(this.props.map,{shapeOptions:{color:"#000000",weight:2,fillColor:"#ffffff",fillOpacity:.2},repeatMode:!0})),this.props.map.doubleClickZoom&&this.props.map.doubleClickZoom.disable(),this.drawControl.enable()})),f(this,"addDrawOrEditInteractions",(e=>{let t=[];e.features.map((e=>{let o;e&&e.geometry&&e.geometry.type&&!(0,u.isSimpleGeomType)(e.geometry.type)&&("GeometryCollection"===e.geometry.type?(o=e.geometry.geometries.map((t=>t.coordinates.map(((o,r)=>({type:"Feature",properties:{...e.properties},id:t.type+r,geometry:{coordinates:o,type:(0,u.getSimpleGeomType)(t.type)}}))))),t.push({type:"FeatureCollection",features:o})):(o=e.geometry.coordinates.map(((t,o)=>({type:"Feature",properties:{...e.properties},id:e.geometry.type+o,geometry:{coordinates:t,type:(0,u.getSimpleGeomType)(e.geometry.type)}}))),t.push({type:"FeatureCollection",features:o})))}));const o=y({},e,{features:t.length>0?t:[{}]});this.drawLayer?(this.drawLayer.clearLayers(),this.drawLayer.addData(this.convertFeaturesPolygonToPoint(o.features,o.drawMethod))):this.addGeojsonLayer({features:e.features&&e.options.featureProjection&&"EPSG:4326"!==e.options.featureProjection?e.features.map((t=>v(t,e.options.featureProjection,"EPSG:4326"))):e.features,projection:e.options&&e.options.featureProjection||"EPSG:4326",style:e.style&&e.style[e.drawMethod]||e.style}),e.options.editEnabled&&this.addEditInteraction(o),e.options.drawEnabled&&this.addDrawInteraction(o)})),f(this,"addEditInteraction",(e=>{this.clean(),this.addGeojsonLayer({features:e.features,projection:e.options&&e.options.featureProjection||"EPSG:4326",style:y({},e.style,{poly:{icon:new(h().DivIcon)({iconSize:new(h().Point)(8,8),className:"leaflet-div-icon leaflet-editing-icon"}),touchIcon:new(h().DivIcon)({iconSize:new(h().Point)(8,8),className:"leaflet-div-icon leaflet-editing-icon leaflet-touch-icon"})}})});let t=this.drawLayer.getLayers();setTimeout((()=>{t.forEach((t=>{t.getLayers&&t.getLayers()&&t.getLayers().length?t.getLayers().forEach((t=>{t.on("edit",(t=>this.onUpdateGeom(t.target,e))),t.on("moveend",(t=>this.onUpdateGeom(t.target,e))),t.editing&&t.editing.enable()})):(t.on("edit",(t=>this.onUpdateGeom(t.target,e))),t.on("moveend",(t=>this.onUpdateGeom(t.target,e))),t.editing&&t.editing.enable())}))}),0),this.editControl=new(h().Control.Draw)({edit:{featureGroup:this.drawLayer,poly:{allowIntersection:!1},edit:!0},draw:{polygon:{allowIntersection:!1,showArea:!0}}}),this.props.map.doubleClickZoom&&this.props.map.doubleClickZoom.disable()})),f(this,"removeAllInteractions",(()=>{this.removeEditInteraction(),this.removeDrawInteraction()})),f(this,"removeDrawInteraction",(()=>{null!==this.drawControl&&void 0!==this.drawControl&&(this.props.options&&this.props.options.stopAfterDrawing&&(this.drawControl.setOptions({repeatMode:!1}),this.props.onDrawStopped()),this.drawControl.disable(),this.drawControl=null,this.props.map.off("draw:created",this.onDrawCreated,this),this.props.map.off("draw:drawstart",this.onDrawStart,this),this.props.map.doubleClickZoom&&this.props.map.doubleClickZoom.enable())})),f(this,"removeEditInteraction",(()=>{this.drawLayer&&(this.drawLayer.getLayers().forEach((e=>{e.getLayers&&e.getLayers()&&e.getLayers().length?e.getLayers().forEach((e=>{e.off("edit"),e.off("moveend"),e.editing&&e.editing.disable()})):(e.off("edit"),e.off("moveend"),e.editing&&e.editing.disable())})),this.editControl=null),this.props.map.doubleClickZoom&&this.props.map.doubleClickZoom.enable()})),f(this,"cleanAndStop",(()=>{this.removeAllInteractions(),this.drawLayer&&(this.drawLayer.clearLayers(),this.props.map.removeLayer(this.drawLayer),this.drawLayer=null)})),f(this,"clean",(()=>{this.removeEditInteraction(),this.removeDrawInteraction(),this.drawLayer&&(this.drawLayer.clearLayers(),this.props.map.removeLayer(this.drawLayer),this.drawLayer=null)})),f(this,"convertFeaturesPolygonToPoint",((e,t)=>"Circle"===t?e.map((e=>{const{center:t,projection:o,radius:r}=void 0!==e.center&&void 0!==e.radius?C(e.radius,{lat:e.center.y,lng:e.center.x},e.projection):e;return{...e,coordinates:t?[t.x,t.y]:e.coordinates,center:t||e.center,projection:o||e.projection,radius:void 0!==r?r:e.radius,type:"Point"}})):e)),f(this,"convertFeaturesToGeoJson",((e,t)=>{let o;if((0,u.isSimpleGeomType)(t.drawMethod))o=e.toGeoJSON().geometry;else{if("GeometryCollection"===t.drawMethod)return{type:"GeometryCollection",geometries:this.drawLayer.getLayers().map((e=>e.toGeoJSON())).map((e=>"FeatureCollection"===e.type?{type:"Multi"+e.features[0].geometry.type,coordinates:e.features.map((e=>e.geometry.coordinates))}:{type:e.geometry.type,coordinates:e.geometry.coordinates}))};let e=this.drawLayer.getLayers().map((e=>e.toGeoJSON()));o={type:t.drawMethod,coordinates:e.reduce(((e,t)=>e.concat([t.geometry.coordinates])),[])}}return y({},e.toGeoJSON(),{geometry:o})}))}UNSAFE_componentWillReceiveProps(e){let t=!(!this.props.messages&&!this.context.messages)&&this.context.messages.drawLocal;if(t&&(h().drawLocal=t),this.props.drawStatus!==e.drawStatus||"replace"===e.drawStatus||this.props.drawMethod!==e.drawMethod||this.props.features!==e.features)switch(e.drawStatus){case"create":this.addGeojsonLayer({features:e.features,projection:e.options&&e.options.featureProjection||"EPSG:4326",style:e.style&&e.style[e.drawMethod]||e.style});break;case"start":this.addDrawInteraction(e);break;case"drawOrEdit":this.addDrawOrEditInteractions(e);break;case"stop":this.removeAllInteractions();break;case"replace":this.replaceFeatures(e);break;case"clean":this.cleanAndStop();break;case"endDrawing":this.endDrawing(e);break;default:return}}render(){return null}}f(S,"displayName","DrawSupport"),f(S,"propTypes",{map:i().object,drawOwner:i().string,drawStatus:i().string,drawMethod:i().string,options:i().object,features:i().array,onChangeDrawingStatus:i().func,onGeometryChanged:i().func,onDrawStopped:i().func,onEndDrawing:i().func,messages:i().object,style:i().object}),f(S,"defaultProps",{map:null,drawOwner:null,drawStatus:null,drawMethod:null,features:null,options:{stopAfterDrawing:!0},onChangeDrawingStatus:()=>{},onGeometryChanged:()=>{},onDrawStopped:()=>{},onEndDrawing:()=>{},style:{color:"#ffcc33",opacity:1,weight:3,fillColor:"#ffffff",fillOpacity:.2,clickable:!1,editing:{fill:1}}});const M=S},795141:(e,t,o)=>{"use strict";o.d(t,{Z:()=>m});var r=o(124852),i=o.n(r),a=o(180307),n=o.n(a),s=o(45697),p=o.n(s),l=o(845243),d=o.n(l),c=o(747037),h=o.n(c),u=o(39600),f=o(492619);function y(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var r=o.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}class m extends i().Component{constructor(){var e;super(...arguments),e=this,y(this,"updatePopup",(()=>{(this._popups||[]).map((e=>{let{popup:t}=e;return t.update()}))})),y(this,"popupClose",(function(){let{target:{options:{id:t}={}}={}}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t&&e.props.onPopupClose(t)})),y(this,"preparePopups",(()=>{const{popups:t=[],map:o}=this.props,r=this.props.map.getSize();return(this._popups||[]).forEach((e=>{let{popup:t}=e;t.off("remove",this.popupClose),t&&this.props.map.removeLayer(t)})),this._popups=t.map((function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const i=.9*r.x,a=.9*r.y,{id:n,position:{coordinates:s},component:p,content:l,className:c,maxWidth:h=i,maxHeight:f=a,autoPan:y=!0,offset:m=[0,7]}=t,w=h>i?i:h,g=f>a?a:f,v=u.fH(n,c);v.setAttribute("style",`max-width: ${w}px; max-height: ${g}px`),u.R3(v,l);const P=d().popup({id:n,autoClose:!1,closeOnClick:!1,autoPan:y,autoPanPadding:d().point(70,70),maxWidth:w,maxHeight:g,className:"ms-leaflet-popup",offset:m}).setContent(v);return P.once("remove",e.popupClose),p&&((e,t)=>{let o=new MutationObserver((()=>{e.update()}));e.once("remove",(()=>{o&&o.disconnect(),o=null})),o.observe(t,{attributes:!0,childList:!0,subtree:!0})})(P,v),P.setLatLng(s),o.addLayer(P),{popup:P,...t}})),this._popups})),y(this,"stopPropagationOnMouseMove",(e=>{e.stopPropagation()})),y(this,"fireMouseOutEvent",(()=>{this.props.map.fireEvent("mouseout")}))}UNSAFE_componentWillMount(){this.props.map&&(this.props.map.getContainer().querySelector(".leaflet-popup-pane").addEventListener("mousemove",this.stopPropagationOnMouseMove),this.props.map.getContainer().querySelector(".leaflet-popup-pane").addEventListener("mouseenter",this.fireMouseOutEvent))}componentDidMount(){this.props.map&&this.props.map.on("resize",this.updatePopup)}shouldComponentUpdate(e){let{popups:t}=e;return t!==this.props.popups}componentWillUnmount(){(this._popups||[]).forEach((e=>{let{popup:t}=e;t.off("remove",this.popupClose),t&&this.props.map?.removeLayer?.(t)})),this.props.map&&(this.props.map.off("resize",this.updatePopup),this.props.map.getContainer().removeEventListener("mousemove",this.stopPropagationOnMouseMove),this.props.map.getContainer().removeEventListener("mouseenter",this.fireMouseOutEvent))}renderPopups(){return this.preparePopups().filter((e=>{let{component:t}=e;return!!t})).map((e=>{let{popup:t,props:o={},component:r,id:a}=e;const s=t.getContent(),p=h()(r)&&f.default[r]||r,l=i().isValidElement(p)&&p||i().createElement(p,o);return s?n().createPortal(l,s,a):null}))}render(){return i().createElement("div",null,this.renderPopups())}}y(m,"propTypes",{map:p().object,popups:p().arrayOf(p().object),onPopupClose:p().func}),y(m,"defaultProps",{popups:[],onPopupClose:()=>{}})},39600:(e,t,o)=>{"use strict";o.d(t,{fH:()=>a,FP:()=>n,R3:()=>s});var r=o(455877),i=o.n(r);const a=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i()(),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"ms-map-popup";const o=document.createElement("div");return o.setAttribute("id",e+"-map-popup"),o.setAttribute("class",t),o},n=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").startsWith("<")},s=(e,t)=>{if(!t)return e;if(t instanceof Node){const o=document.createDocumentFragment();o.appendChild(t),e.appendChild(o)}else n(t)?e.innerHTML=t:e.append(document.createTextNode(String(t)));return e}},823493:(e,t,o)=>{var r=o(23279),i=o(513218);e.exports=function(e,t,o){var a=!0,n=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return i(o)&&(a="leading"in o?!!o.leading:a,n="trailing"in o?!!o.trailing:n),r(e,t,{leading:a,maxWait:t,trailing:n})}}}]);