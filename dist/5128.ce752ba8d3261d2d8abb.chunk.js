(self.webpackChunkmapstore2=self.webpackChunkmapstore2||[]).push([[5128],{75128:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>q});var i=n(124852),o=n.n(i),s=n(630294),a=n(455877),l=n.n(a),r=n(606162),c=n.n(r),m=n(21090),u=n(406557),d=n.n(u),p=n(590937),g=n(23888),v=n(36549);const h=(0,v.Z)(g.Z),y=e=>e.replace(/\./g,"-"),w=(0,p.Ej)("option",{beginDrag:e=>{let{id:t,index:n}=e;return{id:t,index:n}}},((e,t)=>({connectDragSource:e.dragSource(),connectDragPreview:e.dragPreview(),isDragging:t.isDragging()})))((0,p.GR)("option",{drop:e=>{const{onMoveEnd:t=(()=>{})}=e;t()},hover:(e,t)=>{const n=t.getItem(),{id:i,index:o,onMove:s=(()=>{})}=e,a=document.querySelector(`[data-id=item-${y(i)}]`);if(!a?.getBoundingClientRect)return null;const l=n.index,r=o;if(l===r)return null;const c=a.getBoundingClientRect(),m=(c.bottom-c.top)/2,u=t.getClientOffset().y-c.top;return l<r&&u<m||l>r&&u>m||(s(l,r),n.index=r),null}},((e,t)=>({connectDropTarget:e.dropTarget(),isOver:t.isOver()})))((function(e){let{id:t,title:n,selected:a,onSelect:l,onRemove:r,isDragging:c,connectDragPreview:m,connectDropTarget:u,connectDragSource:d,isSortable:p}=e;const g=(0,i.useRef)(),[v,w]=(0,i.useState)(!1),b=c?0:1,E=p?d(o().createElement("div",{className:"grab-handle",onClick:e=>e.stopPropagation()},o().createElement(s.Glyphicon,{glyph:"grab-handle"}))):null,f=o().createElement("li",{"data-id":`item-${y(t)}`,className:`ms-map-views-item${a?" selected":""}${v?" focus":""}`,style:{opacity:b},onClick:()=>g?.current?.click(),tabIndex:0},E,o().createElement("div",{className:"ms-map-views-item-title"},n),o().createElement("div",{onClick:e=>e.stopPropagation()},o().createElement("button",{ref:g,style:{left:0,visibility:"hidden",position:"absolute",width:0,height:0,overflow:"hidden"},onClick:l,onFocus:()=>w(!0),onBlur:()=>w(!1)},"select ",n," item"),r&&o().createElement(h,{className:"square-button-md",bsStyle:a?"primary":"default",onClick:r,tooltipId:"mapViews.removeView"},o().createElement(s.Glyphicon,{glyph:"trash"}))));return p?m(u(f)):f}))),b=function(e){let{views:t,selectedId:n,onSelect:i,onRemove:s,onMove:a,onMoveEnd:l,options:r,edit:c}=e;return o().createElement("div",{className:"ms-map-views-list"},o().createElement("div",{className:"ms-map-views-list-header"},r),o().createElement("div",{className:"ms-map-views-list-body"},o().createElement("ul",null,t.map(((e,t)=>o().createElement(w,{key:e.id,id:e.id,selected:n===e.id,index:t,title:e.title,onSelect:()=>i(e),onRemove:c?()=>s(e):void 0,isSortable:!!c,onMove:a,onMoveEnd:l}))))))},E=function(e){let{progress:t,segments:n,totalLength:i}=e;return o().createElement("div",{className:"ms-map-view-progress-container"},o().createElement("div",{className:"ms-map-view-progress-bar",style:{width:`${t}%`}}),n?.map(((e,t)=>o().createElement("div",{key:t,className:"ms-map-view-progress-tick",style:{left:`${Math.round(e/i*100)}%`}}))))};var f=n(694149),S=n(883953),V=n(804504),C=n(89518);function N(){return N=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},N.apply(this,arguments)}const T=(0,v.Z)(g.Z),k={leaflet:(0,i.lazy)((()=>n.e(3004).then(n.bind(n,291952)))),openlayers:(0,i.lazy)((()=>n.e(3336).then(n.bind(n,671524)))),cesium:(0,i.lazy)((()=>Promise.all([n.e(6212),n.e(949),n.e(854),n.e(8384)]).then(n.bind(n,809438))))},I=(0,i.lazy)((()=>Promise.all([n.e(5369),n.e(2515),n.e(4998),n.e(5886)]).then(n.bind(n,245886)))),P="UPDATE_VIEWS_STATE",G="UNDO_VIEWS_STATE",D="REDO_VIEWS_STATE",R={[P]:(e,t)=>({...e,...t})},x=(0,m.ZP)(((e,t)=>(R[t.type]||d())(e,t.payload)),{limit:20,undoType:G,redoType:D,jumpType:"",jumpToPastType:"",jumpToFutureType:"",clearHistoryType:""}),O=e=>e?.reduce(((e,t)=>e+1e3*(t?.duration??S.Ih.DURATION)),0)??0,q=function(e){let{mapType:t,onSelectView:n=(()=>{}),onUpdateViews:a=(()=>{}),onUpdateResources:r=(()=>{}),onUpdateServices:m=(()=>{}),views:u=[],selectedId:d,defaultTitle:p="Map View",layers:g,locale:v,resources:h=[],services:y,selectedService:w,defaultServices:R,defaultSelectedService:q,edit:$,hide:M,...Z}=e;const[F,j]=(0,i.useReducer)(x,{}),B=e=>j({type:P,payload:{views:e}});(0,i.useEffect)((()=>{(e=>{let{views:t,resources:n}=e;j({type:P,payload:{views:t,resources:n}})})({views:u,resources:h})}),[]);const[L,A]=(0,i.useState)(0),[U,_]=(0,i.useState)({});function z(e){let t;e===G&&(t=F?.past[F?.past.length-1]),e===D&&(t=F?.future[F?.future.length-1]),j({type:e}),a(t.views),r(t.resources),A(L+1)}const{views:W=[],resources:H=[]}=F?.present||{},[J,K]=(0,i.useState)(""),[Q,X]=(0,i.useState)(!0),[Y,ee]=(0,i.useState)(!1),[te,ne]=(0,i.useState)(!1),ie=W.find((e=>e.id===d)),oe=W.indexOf(ie),[se,ae]=(0,i.useState)(!1),le=(0,i.useRef)();function re(e){const t=W.length>0&&c()(W.map((e=>{const t=new RegExp(`${p} \\(([0-9]+)\\)`),n=(e.title||"").match(t)?.[1];return n?parseFloat(n):void 0})).filter((e=>void 0!==e))),i=t&&!isNaN(t)?t:0,o={duration:S.Ih.DURATION,flyTo:!0,...e||le.current.getView(),title:`${p} (${i+1})`,id:l()()},s=-1===oe?[...W,o]:W.reduce(((e,t,n)=>n===oe?[...e,t,o]:[...e,t]),[]);B(s),n(o.id),a(s),y||0!==W.length||m(q)}function ce(e,t){e&&le?.current?.setView&&le.current.setView(t?e:{...e,flyTo:!1}),n(e.id)}const me=(0,i.useRef)();me.current=W;const ue=(0,i.useCallback)(((e,t)=>{let n=[...me.current];n.splice(e,1),n.splice(t,0,me.current[e]),B(n)}),[]);function de(e){W[oe+e]&&ce(W[oe+e])}const{play:pe,setPlay:ge,navigationProgress:ve,viewsTimeSegments:he,viewsTimeTotalLength:ye}=(e=>{let{currentIndex:t,views:n,onInit:o,onChangeView:s}=e;const[a,l]=(0,i.useState)(!1),[r,c]=(0,i.useState)(0),m=O(n),u=n.map(((e,t)=>O(n.filter(((e,n)=>n<t)))));return(0,i.useEffect)((()=>{a||c(Math.round((u[t]??0)/m*100))}),[t,a]),(0,i.useEffect)((()=>{function e(){"visible"!==document.visibilityState&&l(!1)}let i,r=!1;if(a){let a=Date.now(),l=-1===t?0:t,d=u[l],p=a,g=n[l>=n.length?0:l];o(g);const v=()=>{if(!r){i=requestAnimationFrame(v);const e=Date.now(),t=e-a,o=1e3*(g?.duration??S.Ih.DURATION);if(t>=o){a=Date.now();const e=l>=n.length?0:l,t=e+1>=n.length?0:e+1,i=n[t];s(i),g=i,l=t}const r=e+d-p,u=Math.round(r/m*100);Math.round(t/o*100)%5==0&&c(u),r>=m&&(p=Date.now(),d=0)}};v(l),document.addEventListener("visibilitychange",e)}return()=>{r=!0,i&&cancelAnimationFrame(i),a&&document.removeEventListener("visibilitychange",e)}}),[a]),{play:a,setPlay:l,navigationProgress:r,viewsTimeSegments:u,viewsTimeTotalLength:m}})({currentIndex:oe,views:W,onInit:e=>{ce(e),K("")},onChangeView:e=>{ce(e,!0)}}),we=(0,i.useRef)(!1);(0,i.useEffect)((()=>{se&&!we.current&&(we.current=!0,ie&&setTimeout((()=>{le.current.setView({...ie,flyTo:!1})}),500))}),[se]);const be=k[t];return!be||!$&&0===W?.length||M?null:o().createElement(o().Fragment,null,o().createElement(i.Suspense,{fallback:o().createElement("div",null)},o().createElement(be,N({},Z,{selectedId:d,views:W,apiRef:function(e){le.current=e,se||ae(!0)},showViewsGeometries:Y,resources:H,showClipGeometries:te}))),$&&0===W?.length?o().createElement("div",{className:"ms-map-views"},o().createElement("div",{className:"ms-map-views-wrapper"},o().createElement("div",{className:"ms-map-views-header"},o().createElement("div",{className:"ms-map-views-title"},o().createElement(V.Z,{msgId:"mapViews.addInitialView"})),o().createElement(s.ButtonToolbar,null,o().createElement(s.ButtonGroup,null,(F?.past?.length||0)>0&&o().createElement(T,{bsStyle:"primary",className:"square-button-md",disabled:0===(F?.past?.length||0),onClick:()=>z(G),tooltipId:"mapViews.undoChanges",tooltipPosition:"bottom"},o().createElement(s.Glyphicon,{glyph:"undo"})),o().createElement(T,{bsStyle:"primary",className:"square-button-md",onClick:re.bind(null,void 0),tooltipId:"mapViews.addNewView",tooltipPosition:"bottom"},o().createElement(s.Glyphicon,{glyph:"plus"}))))))):o().createElement("div",{className:"ms-map-views",onClick:e=>e.stopPropagation()},o().createElement("div",{className:"ms-map-views-wrapper"},o().createElement(E,{progress:ve,segments:he,totalLength:ye}),o().createElement("div",{className:"ms-map-views-header"},ie?.description&&!J?o().createElement(T,{className:"square-button-md no-border",style:{borderRadius:"50%",marginRight:4},onClick:()=>X(!Q),tooltipId:Q?"mapViews.hideDescription":"mapViews.showDescription",tooltipPosition:"bottom"},o().createElement(s.Glyphicon,{glyph:Q?"chevron-down":"chevron-right"})):null,o().createElement("div",{className:"ms-map-views-title"},"settings"===J?o().createElement(f.Z,{key:`${ie?.id}-${L}`,value:ie?.title,onChange:e=>function(e){const t=W.map((t=>t.id===ie.id?{...t,...e}:t));B(t),a(t)}({title:e})}):ie?.title),o().createElement(s.ButtonToolbar,null,!pe&&o().createElement(s.ButtonGroup,null,o().createElement(T,{bsStyle:"list"===J?"success":"primary",className:"square-button-md",active:"list"===J,onClick:()=>K("list"!==J?"list":""),tooltipId:"list"===J?"mapViews.hideViewsList":"mapViews.showViewsList",tooltipPosition:"bottom"},o().createElement(s.Glyphicon,{glyph:"list"}))),!pe&&$&&o().createElement(s.ButtonGroup,null,o().createElement(T,{bsStyle:"primary",className:"square-button-md",disabled:"settings"===J,onClick:re.bind(null,void 0),tooltipId:ie?"mapViews.addNewViewBelowSelected":"mapViews.addNewView",tooltipPosition:"bottom"},o().createElement(s.Glyphicon,{glyph:"plus"})),o().createElement(T,{bsStyle:"primary",className:"square-button-md",disabled:!ie||"settings"===J,onClick:re.bind(null,ie),tooltipId:"mapViews.copyCurrentView",tooltipPosition:"bottom"},o().createElement(s.Glyphicon,{glyph:"duplicate"})),o().createElement(T,{bsStyle:"settings"===J?"success":"primary",className:"square-button-md",active:"settings"===J,disabled:!ie,onClick:()=>K("settings"!==J?"settings":""),tooltipId:"settings"===J?"mapViews.stopEdit":"mapViews.edit",tooltipPosition:"bottom"},o().createElement(s.Glyphicon,{glyph:"pencil"})),o().createElement(T,{bsStyle:"primary",className:"square-button-md",disabled:0===(F?.past?.length||0),onClick:()=>z(G),tooltipId:"mapViews.undoChanges",tooltipPosition:"bottom"},o().createElement(s.Glyphicon,{glyph:"undo"})),o().createElement(T,{bsStyle:"primary",className:"square-button-md",disabled:0===(F?.future?.length||0),onClick:()=>z(D),tooltipId:"mapViews.redoChanges",tooltipPosition:"bottom"},o().createElement(s.Glyphicon,{glyph:"redo"}))),o().createElement(s.ButtonGroup,null,o().createElement(T,{bsStyle:"primary",className:"square-button-md",onClick:()=>ce(W[0]),disabled:0===oe||pe,tooltipId:"mapViews.gotToFirstView",tooltipPosition:"bottom"},o().createElement(s.Glyphicon,{glyph:"fast-backward"})),o().createElement(T,{bsStyle:"primary",className:"square-button-md",onClick:()=>de(-1),disabled:!W[oe-1]||pe,tooltipId:"mapViews.gotToPreviousView",tooltipPosition:"bottom"},o().createElement(s.Glyphicon,{glyph:"step-backward"})),o().createElement(T,{bsStyle:"primary",className:"square-button-md",active:!!pe,disabled:1===W?.length,onClick:()=>ge(!pe),tooltipId:pe?"mapViews.pause":"mapViews.play",tooltipPosition:"bottom"},o().createElement(s.Glyphicon,{glyph:pe?"pause":"play"})),o().createElement(T,{bsStyle:"primary",className:"square-button-md",onClick:()=>de(1),disabled:!W[oe+1]||pe,tooltipId:"mapViews.gotToNextView",tooltipPosition:"bottom"},o().createElement(s.Glyphicon,{glyph:"step-forward"})),o().createElement(T,{bsStyle:"primary",className:"square-button-md",onClick:()=>ce(W[W?.length-1]),disabled:oe===W?.length-1||pe,tooltipId:"mapViews.gotToLastView",tooltipPosition:"bottom"},o().createElement(s.Glyphicon,{glyph:"fast-forward"}))))),o().createElement("div",{className:"ms-map-views-body"},"list"===J&&o().createElement(b,{views:W,edit:$,selectedId:ie?.id,onSelect:ce,onMove:ue,onMoveEnd:function(){a(W)},onRemove:function(e){const t=W.filter((t=>t.id!==e.id));B(t),a(t)},options:o().createElement(o().Fragment,null,le.current?.options?.showClipGeometriesEnabled&&o().createElement(s.Checkbox,{checked:Y,onChange:()=>ee(!Y)},o().createElement(V.Z,{msgId:"mapViews.showViewsGeometries"})))}),"settings"===J&&ie&&o().createElement(i.Suspense,{fallback:o().createElement("div",{style:{display:"flex",justifyContent:"center",padding:8,width:"100%"}},o().createElement(C.Z,{size:30}))},o().createElement(I,{key:`${ie.id}-${L}`,expandedSections:U,onExpandSection:e=>_((t=>({...t,...e}))),view:ie,api:le.current,onChange:function(e){const t=W.map((t=>t.id===e.id?e:t));B(t),a(t)},onCaptureView:function(e){const t=W.map((t=>t.id===e.id?{...e,...le.current.getView()}:t));B(t),a(t)},layers:g,locale:v,services:y,selectedService:w,resources:H,onUpdateResource:function(e,t){const n=H.find((t=>t.id===e))?H.map((n=>n.id===e?{id:e,data:t}:n)):[...H,{id:e,data:t}];(e=>{j({type:P,payload:{resources:e}})})(n),r(n)},showClipGeometries:te,onShowClipGeometries:ne})))),!J&&Q&&ie?.description&&o().createElement("div",{className:"ms-map-views-description"},o().createElement("div",{dangerouslySetInnerHTML:{__html:ie.description}}))))}},694149:(e,t,n)=>{"use strict";n.d(t,{Z:()=>m});var i=n(124852),o=n.n(i),s=n(630294),a=n(847911),l=n(486234);function r(){return r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},r.apply(this,arguments)}const c=(0,a.Z)("onChange","value")((0,l.Z)("placeholder")((e=>{let{debounceTime:t,...n}=e;return o().createElement(s.FormControl,r({},n,{onChange:e=>n.onChange(e.target.value)}))}))),m=function(e){let{fallbackValue:t,...n}=e;const[s,a]=(0,i.useState)(n.value??t),[l,m]=(0,i.useState)(n.value??t),[u,d]=(0,i.useState)(0),p=(0,i.useRef)(!1),g=(0,i.useRef)();function v(e){const t=!isNaN(parseFloat(e));return t&&void 0!==n.min&&e<n.min?{changed:!0,value:n.min}:t&&void 0!==n.max&&e>n.max?{changed:!0,value:n.max}:{changed:!1,value:t?parseFloat(e):e}}return g.current=s,(0,i.useEffect)((()=>{g.current!==n.value&&a(n.value??t)}),[n.value]),o().createElement(c,r({},n,{key:u,value:s,onChange:function(e){if(p.current){let t=e,i=!0;if("number"===n.type){const{changed:e}=v(t);(""===t||e)&&(i=!1)}a(t),i&&n.onChange(t)}},onChangeNoDebounce:m,onBlur:function(){if("number"===n.type)if(""===l)n.onChange(void 0),a(t),d((e=>e+1));else{const{value:e}=v(l);n.onChange(e),d((e=>e+1)),a(e)}p.current=!1},onFocus:function(){p.current=!0}}))}},847911:(e,t,n)=>{"use strict";n.d(t,{Z:()=>c});var i=n(124852),o=n.n(i),s=n(45697),a=n.n(s),l=n(23279),r=n.n(l);const c=(e,t)=>n=>{function s(s){const a=(0,i.useRef)(),[l,c]=(0,i.useState)(s[t]),m=(0,i.useRef)();m.current=l,(0,i.useEffect)((()=>{if(m.current!==s[t]){c(s[t]);const n=s[`${e}NoDebounce`];n&&n(s[t])}}),[s[t]]),(0,i.useEffect)((()=>(a.current=r()((t=>{let{newProps:n,newValue:i}=t;n[e](i)}),s.debounceTime),()=>{a.current.cancel()})),[s.debounceTime]);const u={...s,[t]:l,[e]:function(t){c(t);const n=s[`${e}NoDebounce`];n&&n(t),a.current&&(a.current.cancel(),a.current({newProps:s,newValue:t}))}};return o().createElement(n,u)}return s.propTypes={debounceTime:a().number},s.defaultProps={debounceTime:300},s.displayName=n.displayName+"WithDebounceOnCallback",s}}}]);