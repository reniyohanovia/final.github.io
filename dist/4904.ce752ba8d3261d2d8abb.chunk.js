(self.webpackChunkmapstore2=self.webpackChunkmapstore2||[]).push([[4904],{405894:(e,t,r)=>{"use strict";r.d(t,{Z:()=>c});var s=r(124852),n=r.n(s),o=r(855033),a=r.n(o),l=r(630294),i=r(23888);const p=(0,r(36549).Z)(i.Z),c=e=>{let{accept:t,children:r,style:s,onRef:o=(()=>{}),onClose:i=(()=>{}),onDrop:c=(()=>{}),onDragEnter:h=(()=>{}),onDragLeave:m=(()=>{})}=e;return n().createElement(a(),{disableClick:!0,ref:o,id:"DRAGDROP_IMPORT_ZONE",style:{position:"relative",height:"100%",...s},accept:t,onDrop:c,onDragEnter:h,onDragLeave:m},n().createElement("div",{style:{position:"fixed",top:0,right:0,bottom:0,left:0,background:"rgba(0,0,0,0.75)",color:"#fff",zIndex:2e3,display:"flex",textAlign:"center"}},n().createElement(p,{style:{border:"none",background:"transparent",color:"white",fontSize:35,top:0,right:0,position:"absolute"},onClick:()=>i()},n().createElement(l.Glyphicon,{glyph:"1-close"})),n().createElement("div",{style:{margin:"auto",maxWidth:550}},r)))}},670186:(e,t,r)=>{"use strict";r.d(t,{Z:()=>d});var s=r(124852),n=r.n(s),o=r(45697),a=r.n(o),l=r(747037),i=r.n(l),p=r(366757),c=r.n(p),h=r(119950);function m(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class u extends n().Component{constructor(){super(...arguments),m(this,"paint",(e=>{e.save(),e.beginPath();const{color:t,fill:r}=this.props.shapeStyle;switch(e.fillStyle=r?i()(r)?r:`rgba(${r.r}, ${r.g}, ${r.b}, ${r.a})`:null,e.strokeStyle=t?i()(t)?t:`rgba(${t.r}, ${t.g}, ${t.b}, ${t.a})`:null,e.lineWidth=this.props.shapeStyle.width||this.props.shapeStyle.weight,this.props.shapeStyle.dashArray&&this.props.shapeStyle.dashArray.length&&e.setLineDash(this.props.shapeStyle.dashArray),this.props.geomType){case"Polygon":this.paintPolygon(e);break;case"Polyline":this.paintPolyline(e);break;case"Point":this.paintPoint(e,this.props.shapeStyle.markName);break;case"Circle":this.paintPoint(e,"circle");break;case"Marker":this.paintMarker(e);break;case"Text":this.paintText(e);break;case"Symbol":this.paintSymbol(e);break;default:return}e.restore()})),m(this,"drawSymbol",((e,t)=>{t.clearRect(0,0,600,600);let s=new Image,n=new Image;n.src=r(264372),s.src=e||this.props.shapeStyle.symbolUrl,s.onload=()=>{try{t.drawImage(s,this.props.width/2-s.width/2,this.props.height/2-s.height/2)}catch(e){return}},s.onerror=()=>{n.onload=()=>{try{t.drawImage(n,this.props.width/2-n.width/2,this.props.height/2-n.height/2)}catch(e){return}}}})),m(this,"paintSymbol",(e=>{(0,h.isSymbolStyle)(this.props.originalStyle)?this.props.originalStyle.symbolUrlCustomized&&this.props.originalStyle.symbolUrl?this.drawSymbol(this.props.originalStyle.symbolUrlCustomized,e):(0,h.createSvgUrl)(this.props.originalStyle,this.props.originalStyle.symbolUrlCustomized||this.props.originalStyle.symbolUrl).then((t=>this.drawSymbol(t,e))):this.drawSymbol(null,e)})),m(this,"paintText",(e=>{const{width:t,height:r}=this.props,{textAlign:s="center",label:n,font:o="14px Arial"}=this.props.shapeStyle;return e.textAlign=s,e.font=o,"start"===s?(e.strokeText(n||"New",t/2.5,r/2),void e.fillText(n||"New",t/2.5,r/2)):"end"===s?(e.strokeText(n||"New",t/1.5,r/2),void e.fillText(n||"New",t/1.5,r/2)):(e.strokeText(n||"New",t/2,r/2),void e.fillText(n||"New",t/2,r/2))})),m(this,"paintPolygon",(e=>{e.transform(1,0,0,1,-27.5,0),e.moveTo(55,8),e.lineTo(100,8),e.lineTo(117.5,40),e.lineTo(100,72),e.lineTo(55,72),e.lineTo(37.5,40),e.closePath(),e.fill(),e.stroke()})),m(this,"paintPolyline",(e=>{e.transform(1,0,0,1,0,0),e.moveTo(10,20),e.bezierCurveTo(40,40,70,0,90,20),e.stroke()})),m(this,"paintPoint",((e,t)=>{let r=this.props.shapeStyle.radius,s=r/2;switch(t){case"square":e.rect(50-s,48.5-s,r,r);break;case"circle":e.arc(50,48.5,s,0,2*Math.PI);break;case"triangle":{let t=Math.sqrt(3)*r/2/3;e.moveTo(50,48.5-2*t),e.lineTo(50+s,48.5+t),e.lineTo(50-s,48.5+t),e.closePath();break}case"star":this.paintStar(e,50,48.5,5,s,s/2);break;case"cross":this.paintCross(e,50,48.5,r,.23);break;case"x":e.translate(50,48.5),e.rotate(45*Math.PI/180),e.translate(-50,-48.5),this.paintCross(e,50,48.5,r,.23);break;default:e.arc(50,48.5,r,0,2*Math.PI)}e.fill(),e.stroke()})),m(this,"paintMarker",(e=>{let t=new Image;t.src=c();try{e.drawImage(t,42.5,24)}catch(e){return}})),m(this,"paintStar",(function(e,t,r){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,n=arguments.length>4?arguments[4]:void 0,o=arguments.length>5?arguments[5]:void 0,a=Math.PI/2*3,l=t,i=r;const p=Math.PI/s;e.moveTo(t,r-n);for(let c=0;c<s;c++)l=t+Math.cos(a)*n,i=r+Math.sin(a)*n,e.lineTo(l,i),a+=p,l=t+Math.cos(a)*o,i=r+Math.sin(a)*o,e.lineTo(l,i),a+=p;e.lineTo(t,r-n),e.closePath()})),m(this,"paintCross",((e,t,r,s,n)=>{const o=s*n/2,a=s/2;e.moveTo(t-o,r-a),e.lineTo(t+o,r-a),e.lineTo(t+o,r-o),e.lineTo(t+a,r-o),e.lineTo(t+a,r+o),e.lineTo(t+o,r+o),e.lineTo(t+o,r+a),e.lineTo(t-o,r+a),e.lineTo(t-o,r+o),e.lineTo(t-a,r+o),e.lineTo(t-a,r-o),e.lineTo(t-o,r-o),e.closePath()}))}componentDidMount(){let e=this.refs.styleCanvas.getContext("2d");e.clearRect(0,0,this.props.width||500,this.props.height||500),this.paint(e)}componentDidUpdate(){let e=this.refs.styleCanvas.getContext("2d");e.clearRect(0,0,this.props.width||500,this.props.height||500),this.paint(e)}render(){return n().createElement("canvas",{ref:"styleCanvas",style:this.props.style,width:this.props.width,height:this.props.height})}}m(u,"propTypes",{originalStyle:a().object,style:a().object,shapeStyle:a().object,geomType:a().oneOf(["Polygon","Polyline","Point","Marker","Text","Symbol","Circle",void 0]),width:a().number,height:a().number}),m(u,"defaultProps",{originalStyle:{},style:{},shapeStyle:{},geomType:"Polygon",width:100,height:80});const d=u},924904:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>De});var s=r(867076),n=r(22222),o=r(124852),a=r.n(o),l=r(405894),i=r(89518),p=r(804504),c=r(630294),h=r(23888),m=r(867517);const u=e=>{let{openFileDialog:t}=e;return a().createElement("div",null,a().createElement(m.Z,{msgId:"mapImport.dropZone.heading"}),t?a().createElement(h.Z,{bsStyle:"primary",onClick:t},a().createElement(p.Z,{msgId:"mapImport.dropZone.selectFiles"})):null,a().createElement("br",null),a().createElement("br",null),a().createElement(m.Z,{msgId:"mapImport.dropZone.infoSupported"}),a().createElement("hr",null),a().createElement(m.Z,{msgId:"mapImport.dropZone.note"}))},d={FILE_NOT_SUPPORTED:a().createElement(p.Z,{msgId:"mapImport.errors.fileNotSupported"}),PROJECTION_NOT_SUPPORTED:a().createElement(p.Z,{msgId:"mapImport.errors.projectionNotSupported"})},y=(0,s.compose)((0,s.branch)((e=>{let{loading:t}=e;return t}),(0,s.renderComponent)((()=>a().createElement("div",{style:{margin:"auto",maxWidth:550}},a().createElement(i.Z,{size:80,color:"#ffffff",style:{margin:"auto"}}),a().createElement("h4",null,a().createElement(p.Z,{msgId:"loading"})))))),(0,s.branch)((e=>{let{error:t}=e;return t}),(0,s.renderComponent)((e=>{let{error:t,...r}=e;return a().createElement("div",{style:{margin:"auto",maxWidth:550}},a().createElement("div",null,a().createElement(c.Glyphicon,{glyph:"exclamation-mark",style:{fontSize:80}})),a().createElement("h5",null,(e=>e?d[e.message]||d[e]||a().createElement("span",null,a().createElement(p.Z,{msgId:"mapImport.errors.unknownError"}),":",a().createElement(c.Alert,{bsStyle:"warning"},e.message)):a().createElement(p.Z,{msgId:"mapImport.errors.unknownError"}))(t)),a().createElement(u,r))}))))((e=>a().createElement("div",null,a().createElement("div",null,a().createElement(c.Glyphicon,{glyph:"upload",style:{fontSize:80}})),a().createElement(u,e))));var g=r(966085),f=r.n(g),b=r(500711),S=r.n(b),E=r(227361),v=r.n(E),x=r(359704),P=r.n(x),w=r(49977),C=r.n(w),k=r(363082),T=r(234228),M=r(685476),j=r(399790);const L=e=>new Promise(((t,r)=>{const s=(0,M.jU)(e.name),n=e.type||M.Yf[s];"application/x-zip-compressed"===n||"application/zip"===n||"application/vnd.google-earth.kml+xml"===n||"application/vnd.google-earth.kmz"===n||"application/gpx+xml"===n||"application/json"===n||"application/vnd.wmc"===n?t(e):(e=>(0,M.xp)(e).then((e=>(new(f())).loadAsync(e))))(e).then((()=>t(e))).catch((()=>r(new Error("FILE_NOT_SUPPORTED"))))})),I=(0,s.compose)((0,s.mapPropsStream)((e=>{const{handler:t,stream:r}=(0,s.createEventHandler)(),{handler:n,stream:o}=(0,s.createEventHandler)();return e.combineLatest(r.switchMap((e=>C().Observable.from(e).flatMap(L).flatMap((e=>t=>{const r=(0,M.jU)(t.name),s=t.type||M.Yf[r],n=T.ZP.getConfigProp("projectionDefs")||[],o=(n.length&&n.map((e=>{let{code:t}=e;return t}))||[]).concat(["EPSG:4326","EPSG:3857","EPSG:900913"]);return"application/vnd.google-earth.kml+xml"===s?(0,M.BP)(t).then((e=>(0,M.bf)(e))):"application/gpx+xml"===s?(0,M.BP)(t).then((e=>(0,M.cX)(e,t.name))):"application/vnd.google-earth.kmz"===s?(0,M.N)(t).then((e=>(0,M.bf)(e))):"application/x-zip-compressed"===s||"application/zip"===s?(0,M.xp)(t).then((r=>(0,M.Lz)(r).then((s=>{s.length>0&&e({type:"warning",filename:t.name,message:"shapefile.error.missingPrj"});const n=(0,M.mr)(r).map((e=>({...e,filename:t.name})));if(P()(n,(e=>!!v()(e,"map.projection")))){const e=n.filter((e=>!!v()(e,"map.projection")));if(S()(e,(e=>o.includes(e.map.projection))))return n;throw new Error("PROJECTION_NOT_SUPPORTED")}return n})))):"application/json"===s?(0,M.zr)(t).then((e=>{const r=v()(e,"map.projection");if(r){if(o.includes(r))return[{...e,fileName:t.name}];throw new Error("PROJECTION_NOT_SUPPORTED")}return[{...e,fileName:t.name}]})):"application/vnd.wmc"===s?(0,M.IN)(t).then((e=>[{...e,fileName:t.name}])):null})(n)).reduce(((e,t)=>({layers:(e.layers||[]).concat(t.filter((e=>(e=>e&&e.features&&0!==e.features.length)(e))).map((e=>(0,k.Ag)(e)?{name:"Annotations",features:e?.features||[],filename:e.filename}:{...(0,j.Rt)(e),filename:e.filename}))),maps:(e.maps||[]).concat(t.filter((e=>(e=>e&&e.version&&e.map)(e))))})),{}).map((e=>({loading:!1,files:e}))).catch((e=>C().Observable.of({error:e,loading:!1}))).startWith({loading:!0}))).startWith({}),((e,r)=>({...e,...r,onDrop:t}))).combineLatest(o.scan((function(){return[...arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],arguments.length>1?arguments[1]:void 0]}),[]).startWith(void 0),((e,t)=>({...e,warnings:t})))})));var z=r(351546);const O=(0,s.compose)((0,s.withHandlers)({useFiles:e=>{let{currentMap:t,loadMap:r=(()=>{}),loadMapInfo:s=(()=>{}),onClose:n=(()=>{}),setLayers:o=(()=>{}),annotationsLayer:a,loadAnnotations:l=(()=>{}),warning:i=(()=>{})}=e;return(e,p)=>{let{layers:c=[],maps:h=[]}=e;const m=h[0];if(m){const{zoom:e,center:o,mapId:a}=t,{fileName:l}=m;r({...m,map:{...m.map,zoom:m.map.zoom||e,center:m.map.center||o}},a||null,!m.map.zoom&&(m.map.bbox||{bounds:m.map.maxExtent})),a&&l&&s(a),n()}if(c.length>0){const e=c&&"Annotations"===c[0].name;if(!a&&e)l(c[0].features,!1),n();else{let e=[];c.forEach((t=>{"vector"!==t.type||(0,z.checkIfLayerFitsExtentForProjection)(t)?e.push(t):i({title:"notification.warning",message:"mapImport.errors.fileBeyondBoundaries",autoDismiss:6,position:"tc",values:{filename:t.name??" "}})})),o(e,p)}}}}}),(0,s.mapPropsStream)((e=>e.merge(e.distinctUntilKeyChanged("files").filter((e=>{let{files:t}=e;return t})).do((e=>{let{files:t,useFiles:r=(()=>{}),warnings:s=[]}=e;return r(t,s)})).ignoreElements())))),N=(0,s.compose)((0,s.withHandlers)((()=>{let e=null;return{onRef:()=>t=>e=t,openFileDialog:()=>()=>e.open()}}))),Z=(0,s.compose)(I,O,N)((e=>{let{onClose:t=(()=>{}),onDrop:r=(()=>{}),onRef:s=(()=>{}),...n}=e;return a().createElement(l.Z,{onClose:t,onDrop:r,onRef:s},a().createElement(y,n))}));var R=r(171703),D=r(45697),A=r.n(D),G=r(488400),F=r(588949),B=r(404462),$=r(747037),U=r.n($),W=r(200020),_=r(719648),q=r(855033),H=r.n(q),Y=r(472986),J=r.n(Y),X=r(882702);function K(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Q extends a().Component{constructor(){super(...arguments),K(this,"tryUnzip",(e=>(0,M.xp)(e).then((e=>(new(f())).loadAsync(e))))),K(this,"checkFileType",(e=>new X.Promise(((t,r)=>{const s=(0,M.jU)(e.name),n=e.type||M.Yf[s];"application/x-zip-compressed"===n||"application/zip"===n||"application/vnd.google-earth.kml+xml"===n||"application/vnd.google-earth.kmz"===n||"application/gpx+xml"===n?t():this.tryUnzip(e).then(t).catch(r)})))),K(this,"checkfile",(e=>{X.Promise.all(e.map((e=>this.checkFileType(e)))).then((()=>{this.props.error&&this.props.onShapeError(null),this.props.onShapeChoosen(e)})).catch((()=>{const e=(0,_.S$)(this.context.messages,this.props.errorMessage);this.props.onShapeError(e)}))}))}render(){return this.props.loading?a().createElement("div",{className:"btn btn-info",style:{float:"center"}}," ",a().createElement(J(),{spinnerName:"circle",noFadeIn:!0,overrideSpinnerClassName:"spinner"})):a().createElement(H(),{rejectClassName:"alert-danger",className:"alert alert-info",onDrop:this.checkfile},a().createElement("div",{className:"dropzone-content",style:{textAlign:"center"}},this.props.text))}}K(Q,"propTypes",{text:A().oneOfType([A().string,A().element]),loading:A().bool,onShapeChoosen:A().func,onShapeError:A().func,error:A().oneOfType([A().string,A().element]),errorMessage:A().string}),K(Q,"contextTypes",{messages:A().object}),K(Q,"defaultProps",{text:"Drop or click to import a local Shape",onShapeChoosen:()=>{},onShapeError:()=>{},errorMessage:"shapefile.error.select"});const V=Q;function ee(){return ee=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},ee.apply(this,arguments)}function te(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class re extends a().Component{constructor(){super(...arguments),te(this,"state",{useDefaultStyle:!1,zoomOnShapefiles:!0}),te(this,"getGeometryType",(e=>{if(e&&"GeometryCollection"===e.type)return e.geometries.reduce(((e,t)=>t&&t.type===e?e:t.type),null);if(e)switch(e.type){case"Polygon":case"MultiPolygon":return"Polygon";case"MultiLineString":case"LineString":return"LineString";case"Point":case"MultiPoint":return"Point";default:return null}return null})),te(this,"getGeomType",(e=>e&&e.features&&e.features[0].geometry?e.features.reduce(((e,t)=>{const r=this.getGeometryType(t.geometry);return e?r===e?e:"GeometryCollection":r}),null):null)),te(this,"renderError",(()=>a().createElement(c.Row,null,a().createElement("div",{style:{textAlign:"center"},className:"alert alert-danger"},a().createElement(p.Z,{msgId:this.props.error}))))),te(this,"renderSuccess",(()=>a().createElement(c.Row,null,a().createElement("div",{style:{textAlign:"center",overflowWrap:"break-word"},className:"alert alert-success"},this.props.success)))),te(this,"renderStyle",(()=>this.props.stylers[this.getGeomType(this.props.selected)])),te(this,"renderDefaultStyle",(()=>this.props.selected?a().createElement(c.Row,null,a().createElement(c.Col,{xs:2},a().createElement("input",{"aria-label":"...",type:"checkbox",defaultChecked:this.state.useDefaultStyle,onChange:e=>{this.setState({useDefaultStyle:e.target.checked})}})),a().createElement(c.Col,{style:{paddingLeft:0,paddingTop:1},xs:10},a().createElement("label",null,a().createElement(p.Z,{msgId:"shapefile.defaultStyle"}))),a().createElement(c.Col,{xs:2},a().createElement("input",{"aria-label":"...",type:"checkbox",defaultChecked:this.state.zoomOnShapefiles,onChange:e=>{this.setState({zoomOnShapefiles:e.target.checked})}})),a().createElement(c.Col,{style:{paddingLeft:0,paddingTop:1},xs:10},a().createElement("label",null,a().createElement(p.Z,{msgId:"shapefile.zoom"})))):null)),te(this,"addShape",(e=>{this.props.shapeLoading(!0);let t=this.props.readFiles(e,this.props.onShapeError);X.Promise.all(t).then((e=>{let t=e.filter((e=>e[0]&&e[0].features&&0!==e[0].features.length||"Feature"===e[0].type));t=t.reduce(((e,t)=>t?e.concat(t.map((e=>(0,j.Rt)(e,this.props.createId(e,t))))):e),[]),this.props.onShapeChoosen(t),this.props.shapeLoading(!1)})).catch((e=>{this.props.shapeLoading(!1);const t=e&&e.name||e||"";U()(t)&&"SyntaxError"===t?this.props.onShapeError("shapefile.error.shapeFileParsingError"):this.props.onShapeError("shapefile.error.genericLoadError")}))})),te(this,"addToMap",(()=>{this.props.shapeLoading(!0);let e=this.props.selected;X.Promise.resolve(this.props.addShapeLayer(e)).then((()=>{this.props.shapeLoading(!1);let e=[];this.props.layers[0].bbox&&this.props.bbox&&(e=[Math.min(this.props.bbox[0],this.props.layers[0].bbox.bounds.minx),Math.min(this.props.bbox[1],this.props.layers[0].bbox.bounds.miny),Math.max(this.props.bbox[2],this.props.layers[0].bbox.bounds.maxx),Math.max(this.props.bbox[3],this.props.layers[0].bbox.bounds.maxy)]),this.state.zoomOnShapefiles&&(this.props.updateShapeBBox(e&&e.length?e:this.props.bbox),this.props.onZoomSelected(e&&e.length?e:this.props.bbox,"EPSG:4326")),this.props.onShapeSuccess(this.props.layers[0].name+(0,_.S$)(this.context.messages,"shapefile.success")),this.props.onLayerAdded(this.props.selected)})).catch((()=>{this.props.shapeLoading(!1),this.props.onShapeError("shapefile.error.genericLoadError")}))}))}render(){return a().createElement(c.Grid,{role:"body",style:{width:"300px"},fluid:!0},this.props.error?this.renderError():null,this.props.success?this.renderSuccess():null,a().createElement(c.Row,{style:{textAlign:"center"}},this.props.selected?a().createElement(W.DropdownList,{data:this.props.layers,value:this.props.selected,onSelect:e=>this.props.onSelectLayer(e),valueField:"id",textField:"name"}):a().createElement(V,ee({},this.props.uploadOptions,{errorMessage:"shapefile.error.select",text:this.props.uploadMessage,onShapeChoosen:this.addShape,onShapeError:this.props.onShapeError}))),a().createElement(c.Row,{style:{marginBottom:10}},this.state.useDefaultStyle?null:this.renderStyle()),this.renderDefaultStyle(),this.props.selected?a().createElement(c.Row,null,a().createElement(c.Col,{xsOffset:6,xs:3}," ",a().createElement(h.Z,{bsSize:this.props.buttonSize,disabled:!this.props.selected,onClick:()=>{this.props.onShapeChoosen(null)}},this.props.cancelMessage)),a().createElement(c.Col,{xs:3}," ",a().createElement(h.Z,{bsStyle:"primary",bsSize:this.props.buttonSize,disabled:!this.props.selected,onClick:this.addToMap},this.props.addMessage))):null)}}te(re,"propTypes",{bbox:A().array,layers:A().array,selected:A().object,style:A().object,shapeStyle:A().object,readFiles:A().func,onShapeError:A().func,onShapeSuccess:A().func,onShapeChoosen:A().func,addShapeLayer:A().func,shapeLoading:A().func,onSelectLayer:A().func,onLayerAdded:A().func,onZoomSelected:A().func,updateShapeBBox:A().func,error:A().string,success:A().string,mapType:A().string,buttonSize:A().string,uploadMessage:A().object,cancelMessage:A().object,addMessage:A().object,stylers:A().object,uploadOptions:A().object,createId:A().func}),te(re,"contextTypes",{messages:A().object}),te(re,"defaultProps",{shapeLoading:()=>{},readFiles:(e,t)=>e.map((e=>{const r=(0,M.jU)(e.name),s=e.type||M.Yf[r];return"application/vnd.google-earth.kml+xml"===s?(0,M.BP)(e).then((e=>(0,M.bf)(e))):"application/gpx+xml"===s?(0,M.BP)(e).then((e=>(0,M.cX)(e))):"application/vnd.google-earth.kmz"===s?(0,M.N)(e).then((e=>(0,M.bf)(e))):"application/x-zip-compressed"===s||"application/zip"===s?(0,M.xp)(e).then((e=>(0,M.Lz)(e).then((r=>(r.length>0&&t("shapefile.error.missingPrj"),(0,M.mr)(e)))))):null})),mapType:"leaflet",stylers:{},buttonSize:"small",uploadOptions:{},createId:()=>{},bbox:null});const se=re;var ne=r(954747),oe=r(670186);function ae(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class le extends a().Component{render(){return a().createElement(W.DropdownList,{data:[{value:"circle",name:(0,_.S$)(this.context.messages,"markNameSelector.circle")||"Circle"},{value:"square",name:(0,_.S$)(this.context.messages,"markNameSelector.square")||"Square"},{value:"triangle",name:(0,_.S$)(this.context.messages,"markNameSelector.triangle")||"Triangle"},{value:"star",name:(0,_.S$)(this.context.messages,"markNameSelector.star")||"Star"},{value:"cross",name:(0,_.S$)(this.context.messages,"markNameSelector.cross")||"Cross"},{value:"x",name:(0,_.S$)(this.context.messages,"markNameSelector.x")||"X"}],valueField:"value",textField:"name",value:this.props.markName,onChange:e=>this.props.onChange("markName",e.value)})}}ae(le,"propTypes",{markName:A().string,onChange:A().func}),ae(le,"contextTypes",{messages:A().object}),ae(le,"defaultProps",{markName:"circle",onChange:()=>{}});const ie=le;var pe=r(509886),ce=r.n(pe);function he(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}ce()();class me extends a().Component{render(){return a().createElement(c.Grid,{fluid:!0},a().createElement(c.Row,null,a().createElement(c.Col,{xs:4,style:{padding:0}},a().createElement(oe.Z,{style:{padding:0,margin:"auto",display:"block"},height:97,shapeStyle:this.props.shapeStyle,geomType:this.props.shapeStyle.marker?"Marker":"Point"})),a().createElement(c.Col,{xs:7},this.props.showMarker?a().createElement(c.Row,null,a().createElement(c.Col,{xs:1},a().createElement("input",{"aria-label":"...",type:"checkbox",defaultChecked:this.props.shapeStyle.marker,onChange:e=>{this.props.setStyleParameter("marker",e.target.checked)}})),a().createElement(c.Col,{style:{paddingLeft:0,paddingTop:1},xs:4},a().createElement("label",null,"Marker"))):null,this.props.showMarkSelector?a().createElement(c.Row,{style:{marginBottom:4}},a().createElement(c.Col,{style:{paddingTop:7},xs:4},a().createElement("label",null,"Mark")),a().createElement(c.Col,{xs:8,style:{paddingRight:0,paddingLeft:30}},a().createElement(ie,{onChange:this.props.setStyleParameter,markName:this.props.shapeStyle.markName}))):null,a().createElement(c.Row,null,a().createElement(c.Col,{xs:4},a().createElement(ne.Z,{disabled:this.props.shapeStyle.marker,value:this.props.shapeStyle.color,line:!1,text:"Stroke",onChangeColor:e=>{e&&this.props.setStyleParameter("color",e)}})),a().createElement(c.Col,{xs:8,style:{paddingRight:0,paddingLeft:30}},a().createElement(W.NumberPicker,{disabled:this.props.shapeStyle.marker,min:1,max:15,step:1,value:this.props.shapeStyle.width,onChange:e=>{this.props.shapeStyle.width!==e&&this.props.setStyleParameter("width",e)}}))),a().createElement(c.Row,{style:{marginTop:4}},a().createElement(c.Col,{xs:4},a().createElement(ne.Z,{disabled:this.props.shapeStyle.marker,value:this.props.shapeStyle.fill,line:!1,text:"Fill",onChangeColor:e=>{e&&this.props.setStyleParameter("fill",e)}})),a().createElement(c.Col,{xs:8,style:{paddingRight:0,paddingLeft:30}},a().createElement(W.NumberPicker,{disabled:this.props.shapeStyle.marker,min:1,max:50,step:1,value:this.props.shapeStyle.radius,onChange:e=>{this.props.shapeStyle.radius!==e&&this.props.setStyleParameter("radius",e)}}))))))}}he(me,"propTypes",{shapeStyle:A().object,setStyleParameter:A().func,showMarker:A().bool,showMarkSelector:A().bool}),he(me,"defaultProps",{shapeStyle:{},showMarker:!0,showMarkSelector:!1,setStyleParameter:()=>{}});const ue=me;function de(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}ce()();class ye extends a().Component{render(){return a().createElement(c.Grid,{fluid:!0},a().createElement(c.Row,null,a().createElement(c.Col,{xs:4,style:{padding:0}},a().createElement(oe.Z,{style:{padding:0,margin:"auto",display:"block"},shapeStyle:this.props.shapeStyle,geomType:"Polygon"})),a().createElement(c.Col,{xs:7},a().createElement(c.Row,{style:{marginTop:7}},a().createElement(c.Col,{xs:4},a().createElement(ne.Z,{value:this.props.shapeStyle.color,line:!1,text:"Stroke",onChangeColor:e=>{e&&this.props.setStyleParameter("color",e)}})),a().createElement(c.Col,{xs:8,style:{paddingRight:0,paddingLeft:30}},a().createElement(W.NumberPicker,{min:1,max:15,step:1,value:this.props.shapeStyle.width,onChange:e=>{e!==this.props.shapeStyle.width&&this.props.setStyleParameter("width",e)}}))),a().createElement(c.Row,{style:{marginTop:4}},a().createElement(c.Col,{xs:6},a().createElement(ne.Z,{value:this.props.shapeStyle.fill,line:!1,text:"Fill",onChangeColor:e=>{e&&this.props.setStyleParameter("fill",e)}}))))))}}de(ye,"propTypes",{shapeStyle:A().object,setStyleParameter:A().func}),de(ye,"defaultProps",{shapeStyle:{},setStyleParameter:()=>{}});const ge=ye;function fe(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}ce()();class be extends a().Component{render(){return a().createElement(c.Grid,{fluid:!0},a().createElement(c.Row,null,a().createElement(c.Col,{xs:4,style:{padding:0}},a().createElement(oe.Z,{style:{padding:0,margin:"auto",display:"block"},shapeStyle:this.props.shapeStyle,geomType:"Polyline",height:40})),a().createElement(c.Col,{xs:7},a().createElement(c.Row,{style:{marginTop:7}},a().createElement(c.Col,{xs:4},a().createElement(ne.Z,{value:this.props.shapeStyle.color,line:!1,text:"Stroke",onChangeColor:e=>{e&&this.props.setStyleParameter("color",e)}})),a().createElement(c.Col,{xs:8,style:{paddingRight:0,paddingLeft:30}},a().createElement(W.NumberPicker,{onChange:e=>{this.props.setStyleParameter("width",e)},min:1,max:15,step:1,value:this.props.shapeStyle.width}))))))}}fe(be,"propTypes",{shapeStyle:A().object,setStyleParameter:A().func}),fe(be,"defaultProps",{shapeStyle:{},setStyleParameter:()=>{}});const Se=be,Ee=((0,R.connect)((e=>({uploadOptions:{error:e.mapimport&&e.mapimport.error||null,loading:e.mapimport&&e.mapimport.loading||!1}})),{onShapeError:F.bM})(se),(0,R.connect)((e=>({shapeStyle:e.style||{}})),{setStyleParameter:B.q})(ge)),ve=(0,R.connect)((e=>({shapeStyle:e.style||{}})),{setStyleParameter:B.q})(ue),xe=(0,R.connect)((e=>({shapeStyle:e.style||{}})),{setStyleParameter:B.q})(Se);var Pe=r(727418),we=r.n(Pe);const Ce=function(e){return`rgba(${e.r}, ${e.g}, ${e.b}, ${e.a})`},ke={r:255,g:0,b:0,a:1};function Te(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Me extends a().Component{constructor(){super(...arguments),Te(this,"state",{useDefaultStyle:!1,zoomOnShapefiles:!0,overrideAnnotation:!1,initialLayers:[]}),Te(this,"getGeometryType",(e=>{if(e&&"GeometryCollection"===e.type)return e.geometries.reduce(((e,t)=>t&&t.type===e?e:t.type),null);if(e)switch(e.type){case"Polygon":case"MultiPolygon":return"Polygon";case"MultiLineString":case"LineString":return"LineString";case"Point":case"MultiPoint":return"Point";default:return null}return null})),Te(this,"getGeomType",(e=>e&&e.features&&e.features[0].geometry?e.features.reduce(((e,t)=>{const r=this.getGeometryType(t.geometry);return e?r===e?e:"GeometryCollection":r}),null):null)),Te(this,"renderError",(()=>this.props.errors&&this.props.errors.filter((e=>(e.filename||e.name)&&this.props.layers&&this.props.layers[0]&&(this.props.layers[0].filename===e.filename||this.props.layers[0].name===e.name))).map((e=>a().createElement(c.Row,{key:e&&e.name+e.message},a().createElement(c.Alert,{bsStyle:e.type,style:{textAlign:"center"}},a().createElement(p.Z,{msgId:e.message}))))))),Te(this,"renderSuccess",(()=>a().createElement(c.Row,null,a().createElement("div",{style:{textAlign:"center",overflowWrap:"break-word"},className:"alert alert-success"},this.props.success)))),Te(this,"renderDisableStyleCustomization",(e=>e?a().createElement("div",{className:"alert alert-info mb-2 style-customisation-disabled-container"},a().createElement(p.Z,{msgId:"shapefile.styleCustomizationDisabled"})):null)),Te(this,"findLayerSerialNumber",(e=>{let{name:t}=e;const{initialLayers:r}=this.state;return r.findIndex((e=>e.name===t))+1})),Te(this,"addToMap",(()=>{let e=this.props.selected;this.state.useDefaultStyle||(e=function(e,t){let r=we()({},e),s=function(e){return e.features&&e.features[0]?e.features[0].geometry&&e.features[0].geometry.type:void 0}(e);!t.marker||"Point"!==s&&"MultiPoint"!==s||(r.styleName="marker",r.handleClickOnLayer=!0);const{color:n=ke,fill:o=ke}=t||{};return r.style={weight:t.width,radius:t.radius,opacity:n.a,fillOpacity:o.a,color:Ce(n),fillColor:Ce(o)},r}(e,this.props.shapeStyle));const t=(0,k.Ag)(e);X.Promise.resolve(t?this.props.loadAnnotations(e.features,this.state.overrideAnnotation):this.props.addLayer(e)).then((()=>{if(!t){let e=[];this.props.layers[0].bbox&&this.props.bbox&&(e=[Math.min(this.props.bbox[0],this.props.layers[0].bbox.bounds.minx),Math.min(this.props.bbox[1],this.props.layers[0].bbox.bounds.miny),Math.max(this.props.bbox[2],this.props.layers[0].bbox.bounds.maxx),Math.max(this.props.bbox[3],this.props.layers[0].bbox.bounds.maxy)]),this.state.zoomOnShapefiles&&(this.props.updateBBox(e&&e.length?e:this.props.bbox),this.props.onZoomSelected(e&&e.length?e:this.props.bbox,"EPSG:4326"))}this.props.onSuccess(this.props.layers.length>1?t?"Annotation":this.props.layers[0].name+(0,_.S$)(this.context.messages,"shapefile.success"):void 0),this.props.onLayerAdded(this.props.selected)})).catch((e=>{this.props.onError({type:"error",name:t?"Annotation":this.props.layers[0].name,error:e,message:"shapefile.error.genericLoadError"})}))})),Te(this,"annotationOptions",(()=>a().createElement(a().Fragment,null,a().createElement(c.Col,{xs:2},a().createElement("input",{type:"radio",checked:!this.state.overrideAnnotation,onChange:()=>{this.setState({overrideAnnotation:!1})}})),a().createElement(c.Col,{style:{paddingLeft:0,paddingTop:1},xs:10},a().createElement("label",null,a().createElement(p.Z,{msgId:"shapefile.merge"}))),a().createElement(c.Col,{xs:2},a().createElement("input",{type:"radio",checked:this.state.overrideAnnotation,onChange:()=>{this.setState({overrideAnnotation:!0})}})),a().createElement(c.Col,{style:{paddingLeft:0,paddingTop:1},xs:10},a().createElement("label",null,a().createElement(p.Z,{msgId:"shapefile.replace"}))))))}componentDidMount(){this.setState({initialLayers:[...this.props.layers]})}render(){const e=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return!(!e||!e.features.length)&&e.features.reduce(((e,t)=>{const r=t.style&&Array.isArray(t.style)&&t.style.length||Object.keys(t.style||{}).length;return e||!!r}),!1)}(this.props.selected);return a().createElement(c.Grid,{role:"body",style:{width:"400px"},fluid:!0},this.props.errors?this.renderError():null,this.props.success?this.renderSuccess():null,a().createElement(c.Row,null,a().createElement("h4",null,a().createElement("span",{style:{fontWeight:"bold"}},a().createElement(p.Z,{msgId:"shapefile.layerOf",msgParams:{count:this.findLayerSerialNumber(this.props.selected),total:this.state.initialLayers.length}}))," ",this.props.selected.name)),a().createElement(c.Row,{key:"styler",style:{marginBottom:10}},this.state.useDefaultStyle||e?null:this.props.stylers[this.getGeomType(this.props.selected)]),this.renderDisableStyleCustomization(e),a().createElement(c.Row,{key:"options"},(0,k.Ag)(this.props.selected)?this.annotationOptions():a().createElement(a().Fragment,null,a().createElement(c.Col,{xs:2},a().createElement("input",{"aria-label":"...",type:"checkbox",disabled:e,checked:e||this.state.useDefaultStyle,defaultChecked:e||this.state.useDefaultStyle,onChange:e=>{this.setState({useDefaultStyle:e.target.checked})}})),a().createElement(c.Col,{style:{paddingLeft:0,paddingTop:1},xs:10},a().createElement("label",null,a().createElement(p.Z,{msgId:"shapefile.defaultStyle"}))),a().createElement(c.Col,{xs:2},a().createElement("input",{"aria-label":"...",type:"checkbox",defaultChecked:this.state.zoomOnShapefiles,onChange:e=>{this.setState({zoomOnShapefiles:e.target.checked})}})),a().createElement(c.Col,{style:{paddingLeft:0,paddingTop:1},xs:10},a().createElement("label",null,a().createElement(p.Z,{msgId:"shapefile.zoom"}))))),a().createElement(c.Row,null,a().createElement(c.ButtonToolbar,{style:{display:"flex",justifyContent:"flex-end"}},a().createElement(h.Z,{bsSize:this.props.buttonSize,disabled:!this.props.selected,onClick:()=>{this.props.setLayers(null)}},this.props.cancelMessage),a().createElement(h.Z,{bsStyle:"primary",bsSize:this.props.buttonSize,disabled:!this.props.selected,onClick:()=>this.props.onLayerSkipped(this.props.selected)},this.props.skipMessage),a().createElement(h.Z,{bsStyle:"primary",bsSize:this.props.buttonSize,disabled:!this.props.selected,onClick:this.addToMap},1===this.props.layers.length?this.props.finishMessage:this.props.nextMessage))))}}Te(Me,"propTypes",{bbox:A().array,layers:A().array,selected:A().object,style:A().object,shapeStyle:A().object,onError:A().func,onSuccess:A().func,setLayers:A().func,addLayer:A().func,loadAnnotations:A().func,onSelectLayer:A().func,onLayerAdded:A().func,onLayerSkipped:A().func,onZoomSelected:A().func,updateBBox:A().func,errors:A().array,success:A().string,mapType:A().string,buttonSize:A().string,cancelMessage:A().object,addMessage:A().object,stylers:A().object,nextMessage:A().object,finishMessage:A().object,skipMessage:A().object}),Te(Me,"contextTypes",{messages:A().object}),Te(Me,"defaultProps",{mapType:"leaflet",buttonSize:"small",setLayers:()=>{},addLayer:()=>{},loadAnnotations:()=>{},updateBBox:()=>{},onZoomSelected:()=>{},stylers:{},bbox:null});const je=Me;var Le=r(503874);function Ie(){return Ie=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},Ie.apply(this,arguments)}function ze(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Oe extends a().Component{render(){const e={Polygon:a().createElement(Ee,null),MultiPolygon:a().createElement(Ee,null),GeometryCollection:a().createElement(Ee,null),LineString:a().createElement(xe,null),MultiLineString:a().createElement(xe,null),MultiPoint:a().createElement(ve,null),Point:a().createElement(ve,null)},t=a().createElement(je,Ie({},this.props,{setLayers:this.props.setLayers,stylers:e,uploadMessage:a().createElement(G.Z,{msgId:this.props.uploadMessage}),cancelMessage:a().createElement(G.Z,{msgId:"shapefile.cancel"}),nextMessage:a().createElement(G.Z,{msgId:"shapefile.next"}),finishMessage:a().createElement(G.Z,{msgId:"shapefile.finish"}),skipMessage:a().createElement(G.Z,{msgId:"shapefile.skip"})}));return this.props.layers?a().createElement(Le.Z,{id:"import-style-dialog",onClose:this.props.onClose,modal:this.props.modal,show:!0,header:a().createElement(G.Z,{msgId:"shapefile.title"})},t):t}}ze(Oe,"propTypes",{id:A().string,layers:A().array,selected:A().object,style:A().object,shapeStyle:A().object,onError:A().func,setLayers:A().func,addShapeLayer:A().func,onSelectLayer:A().func,onLayerAdded:A().func,error:A().string,mapType:A().string,wrap:A().bool,wrapWithPanel:A().bool,panelStyle:A().object,panelClassName:A().string,visible:A().bool,modal:A().bool,onClose:A().func,closeGlyph:A().string,uploadMessage:A().string,buttonSize:A().string}),ze(Oe,"defaultProps",{id:"mapstore-shapefile-upload",uploadMessage:"shapefile.placeholder",wrap:!0,modal:!0,wrapWithPanel:!1,panelStyle:{minWidth:"360px",zIndex:1995,position:"absolute",overflow:"visible",top:"30px",left:"calc(50% - 150px)"},panelClassName:"toolbar-panel",visible:!1,onClose:()=>{},closeGlyph:"1-close",buttonSize:"small"});const Ne=Oe;var Ze=r(926854),Re=r(274363);const De=(0,s.compose)((0,s.mapPropsStream)((e=>e.merge(e.filter((e=>{let{layers:t}=e;return t&&t.length>0})).exhaustMap((()=>e.filter((e=>{let{layers:t}=e;return!t||0===t.length})).take(1).do((e=>{let{onClose:t=(()=>{})}=e;return t&&t()})).ignoreElements()))))),(0,s.branch)((e=>{let{enabled:t}=e;return!t}),s.renderNothing),(0,s.branch)((e=>{let{layers:t}=e;return!t||0===t.length}),(0,s.compose)((0,R.connect)((0,n.zB)({currentMap:Re.Od}),{loadMap:Ze.H0,loadMapInfo:Ze.I6}),(0,s.renderComponent)(Z))))(Ne)},105076:(e,t,r)=>{var s=r(989881);e.exports=function(e,t){var r;return s(e,(function(e,s,n){return!(r=t(e,s,n))})),!!r}},359704:(e,t,r)=>{var s=r(282908),n=r(267206),o=r(105076),a=r(701469),l=r(816612);e.exports=function(e,t,r){var i=a(e)?s:o;return r&&l(e,t,r)&&(t=void 0),i(e,n(t,3))}},264372:(e,t,r)=>{e.exports=r.p+"web/client/components/style/vector/iconNotFound.png"}}]);