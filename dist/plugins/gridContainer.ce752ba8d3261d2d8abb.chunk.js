(self.webpackChunkmapstore2=self.webpackChunkmapstore2||[]).push([[794],{956611:(e,t,r)=>{"use strict";r.d(t,{Z:()=>d});var n=r(747037),o=r.n(n),a=r(45697),s=r.n(a),l=r(124852),i=r.n(l),p=r(630294),u=r(719648);function m(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class c extends i().Component{constructor(){super(...arguments),m(this,"onMouseOver",(()=>{const e=o()(this.props.helpText)?this.props.helpText:(0,u.S$)(this.context.messages,this.props.helpText.props.msgId);this.props.changeHelpText(e),this.props.changeHelpwinVisibility(!0)}))}render(){return i().createElement(p.Badge,{id:this.props.id,onMouseOver:this.onMouseOver,className:(this.props.isVisible?"":"hidden ")+(this.props.className?this.props.className:"")},"?")}}m(c,"propTypes",{id:s().string,helpText:s().oneOfType([s().string,s().element]),isVisible:s().bool,changeHelpText:s().func,changeHelpwinVisibility:s().func,className:s().string}),m(c,"contextTypes",{messages:s().object}),m(c,"defaultProps",{helpText:"",isVisible:!1});const d=c},270415:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});var n=r(124852),o=r.n(n),a=r(630294);const s=function(e){let{children:t,info:r,onClose:n}=e;return o().createElement("div",{className:"ms-measure-toolbar"},o().createElement("div",{className:"ms-measure-icon"},o().createElement(a.Glyphicon,{glyph:"1-ruler"})),t,o().createElement("div",{className:"ms-measure-info"},r),n?o().createElement(a.Button,{className:"square-button-md no-border",onClick:e=>{e.stopPropagation(),n()}},o().createElement(a.Glyphicon,{glyph:"1-close"})):null)}},303028:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>m});var n=r(45697),o=r.n(n),a=r(124852),s=r.n(a),l=r(630294),i=r(638510);function p(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class u extends s().Component{constructor(){super(...arguments),p(this,"getPanels",(()=>this.props.items.filter((e=>e.tools)).reduce(((e,t)=>e.concat(t.tools.map(((e,r)=>({name:t.name+r,panel:e,cfg:t.cfg.toolsCfg?t.cfg.toolsCfg[r]:{}}))))),[]))),p(this,"getTools",(()=>this.props.items.sort(((e,t)=>e.position-t.position))))}render(){return s().createElement(i.Z,{id:this.props.id,style:this.props.style,className:this.props.className,mapType:this.props.mapType,container:e=>s().createElement(l.Grid,{fluid:!0},s().createElement(l.Row,null,e.children.map(((e,t)=>s().createElement(l.Col,{key:t,xs:12,xsOffset:0,sm:6,smOffset:3},e))))),toolStyle:"primary",activeStyle:"default",stateSelector:"omnibar",tool:e=>s().createElement("div",null,e.children),tools:this.getTools(),panels:this.getPanels()})}}p(u,"propTypes",{className:o().string,style:o().object,items:o().array,id:o().string,mapType:o().string}),p(u,"defaultProps",{items:[],className:"grid-home-container",style:{},id:"mapstore-grid-home",mapType:"leaflet"});const m={GridContainerPlugin:u,reducers:{}}},486814:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>Fe});var n=r(124852),o=r.n(n),a=r(630294),s=r(171703),l=r(22222),i=r(152543),p=r(172768),u=r(687753),m=r(976719),c=r(119008),d=r(101092),g=r(521923),h=r(556233),b=r(227361),y=r.n(b);const f=e=>y()(e,"controls.measure.enabled"),E=e=>(0,c.Iz)(e)&&!e.measurement.isDrawing&&(0,d.m6)(e),v=e=>e&&e.measurement&&e.measurement.showAddAsAnnotation,T=e=>e&&e.measurement&&e.measurement.trueBearing&&e.measurement.trueBearing.measureTrueBearing,C=e=>{let t=e.measurement.feature||{};return t.geometry&&(t=(0,g.t8)("geometry.coordinates",(0,h.L0)(t.geometry||{}),t)),t};var M=r(234228),w=r(488400),S=r(843624),L=r.n(S),P=r(618446),x=r.n(P),A=r(59854),O=r.n(A),k=r(45697),B=r.n(k),Z=r(200020),F=r(423570),j=r.n(F),I=r(685476),N=r(719648),G=r(454295),D=r(804504),R=r(913186),U=r(756435),V=r(8204),q=r(100845),H=r(270415);function z(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}r.e(6510).then(r.bind(r,735604));class X extends o().Component{constructor(){var e;super(...arguments),e=this,z(this,"onGeomClick",(e=>{this.props.geomType!==e&&this.props.toggleMeasure({geomType:e})})),z(this,"onResetClick",(()=>{this.props.toggleMeasure({geomType:null})})),z(this,"getToolTips",(()=>({lineToolTip:o().createElement(a.Tooltip,{id:"tooltip-button.line"},this.props.lengthLabel),areaToolTip:o().createElement(a.Tooltip,{id:"tooltip-button.area"},this.props.areaLabel),bearingToolTip:o().createElement(a.Tooltip,{id:"tooltip-button.bearing"},this.isTrueBearing()?this.props.trueBearingLabel:this.props.bearingLabel)}))),z(this,"renderMeasurements",(function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r={style:"decimal",minimumIntegerDigits:1,maximumFractionDigits:2,minimumFractionDigits:2};return o().createElement(o().Fragment,null,e.props.lineMeasureEnabled&&o().createElement(o().Fragment,null,e.props.lineMeasureValueEnabled&&o().createElement(o().Fragment,null,o().createElement("div",null,e.props.lengthLabel,": "," "),o().createElement("div",{id:"measure-len-res",className:"measure-value"},o().createElement(R.Z,{key:"len",numberParams:r,value:e.props.formatLength(e.props.uom.length.unit,e.props.measurement.len)})," ",e.props.uom.length.label)),o().createElement(Z.DropdownList,{disabled:t,value:e.props.uom.length.label,onChange:t=>{e.props.onChangeUom("length",t,e.props.uom)},data:e.props.uomLengthValues,textField:"label",valueField:"value"})),e.props.areaMeasureEnabled&&o().createElement(o().Fragment,null,e.props.areaMeasureValueEnabled&&o().createElement(o().Fragment,null,o().createElement("div",null,e.props.areaLabel,": "," "),o().createElement("div",{id:"measure-area-res",className:"measure-value"},o().createElement(R.Z,{key:"area",numberParams:r,value:e.props.formatArea(e.props.uom.area.unit,e.props.measurement.area)})," ",e.props.uom.area.label)),o().createElement(Z.DropdownList,{disabled:t,value:e.props.uom.area.label,onChange:t=>{e.props.onChangeUom("area",t,e.props.uom)},data:e.props.uomAreaValues,textField:"label",valueField:"value"})),e.props.bearingMeasureEnabled&&e.props.bearingMeasureValueEnabled&&o().createElement(o().Fragment,null,o().createElement("div",null,e.isTrueBearing()?e.props.trueBearingLabel:e.props.bearingLabel,": "," "),o().createElement("div",{id:"measure-bearing-res",className:"measure-value"},e.props.formatBearing(e.props.measurement.bearing||0,e.isTrueBearing()&&e.props.measurement.trueBearing))))})),z(this,"renderPanel",(e=>this.props.showResults?this.renderMeasurements(e):null)),z(this,"renderLabel",(e=>this.props.showButtonsLabels?o().createElement("span",{className:"option-text"},(0,N.S$)(this.context.messages,e)):null)),z(this,"renderText",((e,t)=>e?o().createElement("span",null,o().createElement("span",{className:"option-icon"},o().createElement(a.Glyphicon,{glyph:e})),this.renderLabel(t)):this.renderLabel(t))),z(this,"isTrueBearing",(()=>this.props.measurement&&this.props.measurement.trueBearing&&this.props.measurement.trueBearing.measureTrueBearing))}UNSAFE_componentWillReceiveProps(e){e.geomType||this.props.toggleMeasure({geomType:"LineString"})}shouldComponentUpdate(e){return!x()(e,this.props)}render(){let e,t;const r=!!(this.props.bearingMeasureEnabled||this.props.areaMeasureEnabled||this.props.lineMeasureEnabled),n=y()(this.props.measurement,"features",[])[this.props.measurement.currentFeature||0],s=n?.properties?.disabled||!1,l=0===(this.props.measurement.features||[]).length||s;this.props.useSingleFeature?(e=(y()(this.props.measurement,"feature.geometry.type")||"").toLowerCase(),t=(y()(this.props.measurement,-1!==e.indexOf("polygon")?"feature.geometry.coordinates[0]":"feature.geometry.coordinates")||[]).map((e=>({lon:e[0],lat:e[1]})))):(e=y()(n,"geometry.type","").toLowerCase(),t=(y()(n,-1!==e.indexOf("polygon")?"geometry.coordinates[0]":"geometry.coordinates")||[]).map((e=>({lon:e[0],lat:e[1]}))));const{exportToAnnotation:i=!1}=this.props.measurement||{};return o().createElement(U.Z,{id:this.props.id,style:{overflow:"visible",...!this.props.showCoordinateEditor&&{display:"block",width:"auto",height:"auto"}},header:o().createElement(H.Z,{info:this.renderPanel(s),onClose:this.props.onClose},o().createElement(a.ButtonToolbar,null,o().createElement(V.Z,{btnDefaultProps:{className:"square-button-md",bsStyle:"primary"},buttons:[{glyph:this.props.lineGlyph,active:!!this.props.lineMeasureEnabled,bsStyle:this.props.lineMeasureEnabled?"success":"primary",tooltip:this.renderText(this.props.inlineGlyph&&this.props.lineGlyph,"measureComponent.MeasureLength"),onClick:()=>this.onGeomClick("LineString"),disabled:!this.props.lineMeasureEnabled&&s},{active:!!this.props.areaMeasureEnabled,bsStyle:this.props.areaMeasureEnabled?"success":"primary",glyph:this.props.areaGlyph,tooltip:this.renderText(this.props.inlineGlyph&&this.props.areaGlyph,"measureComponent.MeasureArea"),onClick:()=>this.onGeomClick("Polygon"),disabled:!this.props.areaMeasureEnabled&&s},{visible:!this.props.disableBearing,active:!!this.props.bearingMeasureEnabled,bsStyle:this.props.bearingMeasureEnabled?"success":"primary",glyph:this.props.bearingGlyph,tooltip:this.renderText(this.props.inlineGlyph&&this.props.bearingGlyph,this.isTrueBearing()?"measureComponent.MeasureTrueBearing":"measureComponent.MeasureBearing"),onClick:()=>this.onGeomClick("Bearing"),disabled:!this.props.bearingMeasureEnabled&&s}]}),o().createElement(V.Z,{btnDefaultProps:{className:"square-button-md",bsStyle:"primary"},buttons:[{glyph:"trash",visible:!!this.props.withReset,tooltip:o().createElement(D.Z,{msgId:"measureComponent.resetTooltip"}),onClick:()=>this.onResetClick()}]}),o().createElement(V.Z,{btnDefaultProps:{className:"square-button-md",bsStyle:"primary"},buttons:[{glyph:"ext-json",disabled:!r||l,visible:this.props.showExportToGeoJSON,tooltip:o().createElement(D.Z,{msgId:"measureComponent.exportToGeoJSON"}),onClick:()=>{(0,I.LR)(JSON.stringify((0,G.tL)(this.props.measurement.features,this.props.measurement.textLabels,this.props.uom,j()(),"MapStore Measurements")),"measurements.json","application/geo+json")}},{glyph:"1-layer",visible:this.props.showAddAsLayer,disabled:!r||l||i,tooltip:o().createElement(D.Z,{msgId:"measureComponent.addAsLayer"}),onClick:()=>this.props.onAddAsLayer(this.props.measurement.features,this.props.measurement.textLabels,this.props.uom)},{glyph:i?"floppy-disk":"comment",tooltip:o().createElement(D.Z,{msgId:i?"measureComponent.saveMeasure":"measureComponent.addAsAnnotation"}),onClick:()=>{this.props.onAddAnnotation(this.props.measurement.features,this.props.measurement.textLabels,this.props.uom,!i,{id:this.props.measurement.id,visibility:this.props.measurement.visibility})},disabled:!r||l,visible:this.props.showAddAsAnnotation}]})))},this.props.showCoordinateEditor&&o().createElement(a.Grid,{fluid:!0,style:{maxHeight:400,borderTop:"1px solid #ddd"}},this.props.bearingMeasureEnabled||this.props.areaMeasureEnabled||this.props.lineMeasureEnabled?o().createElement(a.Row,{style:this.props.isCoordinateEditorEnabled?{}:{pointerEvents:"none",opacity:.5}},o().createElement(q.Z,{key:"measureEditor",isMouseEnterEnabled:!0,isMouseLeaveEnabled:!0,format:this.props.format,currentFeature:this.props.measurement.currentFeature,features:this.props.measurement.features,mapProjection:this.props.mapProjection,onChangeFormat:this.props.onChangeFormat,onHighlightPoint:this.props.onHighlightPoint,onChange:this.props.onChangeCoordinates,onChangeCurrentFeature:this.props.onChangeCurrentFeature,showFeatureSelector:this.props.showFeatureSelector,items:[],isDraggable:!0,type:this.props.geomType,showLengthAndBearingLabel:this.props.showLengthAndBearingLabel,components:this.props.useSingleFeature||-1===e.indexOf("polygon")?t:L()(t),properties:n?.properties||{}})):o().createElement(a.Row,null,o().createElement(a.Col,{xs:12,className:"text-center",style:{padding:15}},o().createElement("i",null,o().createElement(D.Z,{msgId:"measureComponent.selectTool"}))))))}}z(X,"propTypes",{id:B().string,name:B().string,columnProperties:B().object,propertiesChangeHandler:B().func,lengthButtonText:B().oneOfType([B().string,B().element]),areaButtonText:B().oneOfType([B().string,B().element]),resetButtonText:B().oneOfType([B().string,B().element]),lengthLabel:B().oneOfType([B().string,B().element]),areaLabel:B().oneOfType([B().string,B().element]),bearingLabel:B().oneOfType([B().string,B().element]),trueBearingLabel:B().oneOfType([B().string,B().element]),uom:B().shape({length:B().shape({unit:B().string.isRequired,label:B().string.isRequired}),area:B().shape({unit:B().string.isRequired,label:B().string.isRequired})}),toggleMeasure:B().func,measurement:B().object,lineMeasureEnabled:B().bool,lineMeasureValueEnabled:B().bool,areaMeasureEnabled:B().bool,areaMeasureValueEnabled:B().bool,bearingMeasureEnabled:B().bool,bearingMeasureValueEnabled:B().bool,showButtons:B().bool,showResults:B().bool,mapProjection:B().string,lineGlyph:B().string,areaGlyph:B().string,bearingGlyph:B().string,withReset:B().bool,showButtonsLabels:B().bool,inlineGlyph:B().bool,formatLength:B().func,formatArea:B().func,formatBearing:B().func,onChangeUom:B().func,uomLengthValues:B().array,uomAreaValues:B().array,format:B().string,onChangeFormat:B().func,onChangeCoordinates:B().func,onChangeCurrentFeature:B().func,onAddAsLayer:B().func,onHighlightPoint:B().func,geomType:B().string,defaultOptions:B().object,onAddAnnotation:B().func,showAddAsAnnotation:B().bool,showLengthAndBearingLabel:B().bool,showAddAsLayer:B().bool,showFeatureSelector:B().bool,useSingleFeature:B().bool,showExportToGeoJSON:B().bool,disableBearing:B().bool,trueBearing:B().object,onMount:B().func,onUpdateOptions:B().func,showCoordinateEditor:B().bool,isCoordinateEditorEnabled:B().bool,onClose:B().func}),z(X,"contextTypes",{messages:B().object}),z(X,"defaultProps",{mapProjection:"EPSG:3857",columnProperties:{xs:4,sm:4,md:4},uomLengthValues:[{value:"ft",label:"ft"},{value:"m",label:"m"},{value:"km",label:"km"},{value:"mi",label:"mi"},{value:"nm",label:"nm"}],uomAreaValues:[{value:"sqft",label:"ft²"},{value:"sqm",label:"m²"},{value:"sqkm",label:"km²"},{value:"sqmi",label:"mi²"},{value:"sqnm",label:"nm²"}],id:"measure-result-panel",uom:{length:{unit:"m",label:"m"},area:{unit:"sqm",label:"m²"}},geomType:"LineString",defaultOptions:{geomType:"LineString"},showResults:!0,showAddAsAnnotation:!1,showAddAsLayer:!0,showExportToGeoJSON:!0,showCoordinateEditor:!1,isCoordinateEditorEnabled:!0,showLengthAndBearingLabel:!1,withReset:!0,lineGlyph:"1-measure-length",areaGlyph:"1-measure-area",bearingGlyph:"1-measure-bearing",showButtonsLabels:!0,lengthLabel:o().createElement(D.Z,{msgId:"measureComponent.lengthLabel"}),areaLabel:o().createElement(D.Z,{msgId:"measureComponent.areaLabel"}),bearingLabel:o().createElement(D.Z,{msgId:"measureComponent.bearingLabel"}),trueBearingLabel:o().createElement(D.Z,{msgId:"measureComponent.trueBearingLabel"}),formatLength:(e,t)=>(0,h.Ov)(t,"m",e),formatArea:(e,t)=>(0,h.Ov)(t,"sqm",e),formatBearing:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,h.rp)(O()(e||0,6),t)},onChangeUom:()=>{},onChangeFormat:()=>{},onMount:()=>{},onUpdateOptions:()=>{},onAddAsLayer:()=>{}});const $=X;var W=r(908316);function J(){return J=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},J.apply(this,arguments)}function _(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Q extends o().Component{constructor(){super(...arguments),_(this,"onClose",(()=>{this.props.onClose(!1)})),_(this,"initDefaultOptions",(e=>{const{showCoordinateEditor:t,...r}=e;this.props.onMount(t||this.props.showCoordinateEditor),this.props.toggleMeasure({geomType:r.geomType||"LineString"})}))}UNSAFE_componentWillMount(){this.initDefaultOptions(this.props.defaultOptions)}componentDidUpdate(e){x()(e.defaultOptions,this.props.defaultOptions)||this.initDefaultOptions(this.props.defaultOptions)}render(){return this.props.show?this.props.showCoordinateEditor?o().createElement(W.Z,{dock:!0,containerId:"measure-container",containerStyle:this.props.dockStyle,bsStyle:"primary",position:"right",title:o().createElement(D.Z,{key:"title",msgId:"measureComponent.Measure"}),glyph:"1-ruler",size:this.props.size,open:this.props.show,onClose:this.onClose,style:this.props.dockStyle},o().createElement($,J({id:"measure-panel"},this.props))):o().createElement($,J({id:"measure-panel",style:{minWidth:"500px"}},this.props)):null}}_(Q,"propTypes",{show:B().bool,closeGlyph:B().string,onClose:B().func,onMount:B().func,onInit:B().func,showCoordinateEditor:B().bool,defaultOptions:B().object,style:B().object,dockStyle:B().object,size:B().number}),_(Q,"contextTypes",{messages:B().object}),_(Q,"defaultProps",{show:!1,defaultOptions:{},onMount:()=>{},toggleMeasure:()=>{},showCoordinateEditor:!1,showAddAsAnnotation:!1,closeGlyph:"1-close",dockStyle:{},size:550});const K=Q;var Y=r(868195),ee=r(957557),te=r.n(ee),re=r(867076);const ne={locale:navigator&&navigator.language,formats:{},messages:{},defaultLocale:"en",defaultFormats:{},formatDate:e=>e,formatTime:e=>e,formatRelative:e=>e,formatNumber:e=>e,formatPlural:e=>e,formatMessage:e=>e,formatHTMLMessage:e=>e,now:()=>new Date};var oe=r(89518);function ae(){return ae=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ae.apply(this,arguments)}const se=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return(0,re.compose)((0,re.getContext)({intl:B().object}),(0,re.branch)((e=>{let{intl:t}=e;return!!t}),Y.injectIntl,(0,re.withProps)({intl:ne})),(0,re.withPropsOnChange)(["intl"],(t=>{let{intl:r={}}=t;return e.reduce((function(){let e=arguments.length>1?arguments[1]:void 0;return{...arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[e]:r[e]}}),{})})),(t=["intl"],(0,re.mapProps)((e=>te()(e,t)))));var t}(["formatNumber"]),le=K,ie={leaflet:(0,n.lazy)((()=>Promise.all([r.e(5243),r.e(2201),r.e(3436)]).then(r.bind(r,876504)))),openlayers:(0,n.lazy)((()=>Promise.all([r.e(6624),r.e(6385)]).then(r.bind(r,36624)))),cesium:(0,n.lazy)((()=>Promise.all([r.e(6212),r.e(949),r.e(854),r.e(9099),r.e(8175)]).then(r.bind(r,887853))))},pe=se((e=>{let{mapType:t,defaultOptions:r,onInit:a,...s}=e;const l=ie[t];return l?o().createElement(n.Suspense,{fallback:o().createElement(H.Z,{onClose:s.onClose},o().createElement(oe.Z,{size:20}))},o().createElement(l,ae({},s,r,{unitsOfMeasure:Object.keys(s.uom).reduce(((e,t)=>({...e,[t]:{...s.uom[t],value:s.uom[t].unit||s.uom[t].value}})),{}),defaultMeasureType:r?.geomType||h.sW.POLYLINE_DISTANCE_3D,hideInfoLabel:void 0!==r?.showLabel&&!r?.showLabel,hideSegmentsLengthLabels:void 0!==r?.showSegmentLengths&&!r?.showSegmentLengths}))):null})),ue=(0,s.connect)((0,l.P1)([f,e=>e?.controls?.measure?.enabled||!1,e=>e?.measurement?.geomType,e=>e.measurement&&{...e.measurement,feature:C(e)}||{}],((e,t,r,n)=>({active:e,enabled:t,measureType:r,measurement:n,useTreshold:n?.useTreshold||null,uom:n?.uom||h.z$}))),{onChangeMeasureType:e=>(0,m.tV)({geomType:e}),onUpdateFeatures:m.$3,onInit:m.S1,changeMeasurementState:m.nl,updateMeasures:m.Y_,resetGeometry:m.wB,changeGeometry:m.$3,setTextLabels:m.CG,changeMeasurement:m.Bd,onChangeUnitOfMeasure:m.Gd,onClose:u.Xg.bind(null,"measure","enabled",!1)})((function(e){let{onInit:t,...r}=e;return(0,n.useEffect)((()=>{t(r.defaultOptions)}),[r.defaultOptions]),(0,n.useEffect)((()=>{r.onChangeMeasureType(null)}),[r.mapType]),r.enabled?o().createElement(pe,r):null}));var me=r(350126),ce=r(782527),de=r(441609),ge=r.n(de),he=r(630998),be=r.n(he),ye=r(281763),fe=r.n(ye),Ee=r(727418),ve=r.n(Ee);const Te={lineMeasureEnabled:!0,geomType:"LineString",areaMeasureEnabled:!1,bearingMeasureEnabled:!1,customStartEndPoint:{startPointOptions:{radius:3,fillColor:"green"},endPointOptions:{radius:3,fillColor:"red"}},uom:h.z$,lengthFormula:"haversine",showLabel:!0,showSegmentLengths:!0,currentFeature:0,features:[]};var Ce=r(49977),Me=r.n(Ce),we=r(333101),Se=r(363082),Le=r(917450),Pe=r(859518),xe=r(789683),Ae=r(502422);const Oe={addAnnotationFromMeasureEpic:(e,t)=>e.ofType(m.XX).switchMap((e=>{const{features:r,textLabels:n,uom:o,save:a,properties:s}=e,{id:l=j()(),visibility:i=!0}=s||{},d={...(0,G.tL)(r,n,o,l,"Annotations created from measurements",Se.Eo),newFeature:a,visibility:i};return Me().Observable.from([...(0,c.Yq)("annotations")(t.getState())?[]:[(0,u.Xg)("annotations","enabled",!0)],(0,p.A9)(),(0,m.el)("exportToAnnotation",!1),(0,p.yg)(d)])})),addAsLayerEpic:e=>e.ofType(m.Wt).switchMap((e=>{let{features:t,textLabels:r,uom:n}=e;const o=(0,G.tL)(t,r,n,j()());return Me().Observable.of((0,we.A4)({type:"vector",id:j()(),name:"Measurements",hideLoading:!0,features:[o],visibility:!0}))})),openMeasureEpic:(e,t)=>e.ofType(u.At,u.kM).filter((e=>"measure"===e.control&&f(t.getState()))).switchMap((()=>{const e=[(0,Le.g)(),(0,Le.aN)(),(0,Pe.H0)("click","measure")],{showCoordinateEditor:r}=t.getState()?.controls?.measure||{};return r&&e.push((0,xe.Vd)("measure","add","right")),Me().Observable.from(e)})),closeMeasureEpics:(e,t)=>e.ofType(u.At,u.kM).filter((e=>"measure"===e.control&&!(0,c.QF)(t.getState()))).switchMap((()=>{const e=[(0,m.Bd)({lineMeasureEnabled:!1,areaMeasureEnabled:!1,bearingMeasureEnabled:!1,geomType:null,len:0,area:0,bearing:0}),(0,p.Rx)(),(0,Pe.$X)("click","measure")],{showCoordinateEditor:r}=t.getState()?.controls?.measure||{};return r&&e.push((0,xe.Vd)("measure","remove","right")),Me().Observable.from(e)})),setMeasureStateFromAnnotationEpic:(e,t)=>e.ofType(m.ES).switchMap((e=>{let{features:r,properties:n}=e;const o=(a=t.getState(),a?.measurement?.geomType===(0,G.k2)(r)?.[0]);var a;return Me().Observable.of(!o&&(0,m.Bd)({geomType:(0,G.k2)(r)?.[0]}),(0,u.Xg)("measure","enabled",!0),(0,u.Xg)("annotations","enabled",!1),(0,p.r1)(n.id,!1))})),addCoordinatesEpic:(e,t)=>{let{getState:r=(()=>{})}=t;return e.ofType(Pe.TR).filter((()=>{const{showCoordinateEditor:e,enabled:t}=r()?.controls?.measure||{};return e&&t})).switchMap((e=>{let{point:t}=e;const{currentFeature:n,features:o=[],geomType:a}=r()?.measurement||{},{lng:s,lat:l}=t?.latlng||{};let i=o[n]?.geometry?.coordinates||[];i="Polygon"===a?i[0]:i;const p=void 0!==i?i.findIndex((e=>!(0,h.wd)(e))):-1;return-1!==p?(i=i.map((e=>({lon:e[0],lat:e[1]}))),i[p]={lon:s,lat:l},Me().Observable.of((0,m.dD)(i))):Me().Observable.empty()}))},tearDownMeasureOnDrawToolActive:(e,t)=>(0,Ae.U)(e,t,"measure")},ke=u.Xi.bind(null,"measure",null),Be=(0,s.connect)((0,l.P1)([e=>({measurement:e.measurement||{},uom:e.measurement&&e.measurement.uom||h.z$,lineMeasureEnabled:e.measurement&&e.measurement.lineMeasureEnabled,lineMeasureValueEnabled:!(0,d.m6)(e),areaMeasureEnabled:e.measurement&&e.measurement.areaMeasureEnabled,areaMeasureValueEnabled:!(0,d.m6)(e),bearingMeasureEnabled:e.measurement&&e.measurement.bearingMeasureEnabled,showLengthAndBearingLabel:e.measurement&&e.measurement.showLengthAndBearingLabel,bearingMeasureValueEnabled:!(0,d.m6)(e),isCoordinateEditorEnabled:E(e),showCoordinateEditor:(0,c.Iz)(e),showFeatureSelector:(0,d.m6)(e),useSingleFeature:!(0,d.m6)(e),withReset:(0,d.m6)(e),showExportToGeoJSON:(0,d.m6)(e),showAddAsAnnotation:v(e)&&(0,d.m6)(e),trueBearing:T(e),showAddAsLayer:(0,d.m6)(e),isCoordEditorEnabled:e.measurement&&!e.measurement.isDrawing,geomType:e.measurement&&e.measurement.geomType,format:e.measurement&&e.measurement.format,dockStyle:(0,me.ic)(e,{height:!0,right:!0},!0)}),e=>(0,c.QF)(e)],((e,t)=>({...e,show:t,format:e.format||M.ZP.getConfigProp("defaultCoordinateFormat")||"decimal"}))),{toggleMeasure:m.Bd,onAddAnnotation:m.ud,onChangeUom:m.Gd,onHighlightPoint:p.aS,onChangeFormat:m.RM,onChangeCoordinates:m.dD,onChangeCurrentFeature:m.h2,onClose:ke,onMount:e=>(0,u.Xg)("measure","showCoordinateEditor",e),onAddAsLayer:m.NR},null,{pure:!1})(le),Ze=(0,s.connect)((0,l.P1)([d.$v],(e=>({mapType:e}))))((e=>"cesium"===e.mapType?null:o().createElement(Be,e))),Fe=(0,i.rx)("Measure",{component:Ze,containers:{BurgerMenu:{name:"measurement",position:9,panel:!1,help:o().createElement(w.Z,{msgId:"helptexts.measureComponent"}),tooltip:"measureComponent.tooltip",text:o().createElement(w.Z,{msgId:"measureComponent.Measure"}),icon:o().createElement(a.Glyphicon,{glyph:"1-ruler"}),action:()=>(0,u.Xg)("measure","enabled",!0),doNotHide:!0,priority:2},SidebarMenu:{name:"measurement",position:9,panel:!1,help:o().createElement(w.Z,{msgId:"helptexts.measureComponent"}),tooltip:"measureComponent.tooltip",text:o().createElement(w.Z,{msgId:"measureComponent.Measure"}),icon:o().createElement(a.Glyphicon,{glyph:"1-ruler"}),action:u.Xi.bind(null,"measure",null),toggle:!0,toggleControl:"measure",toggleProperty:"enabled",doNotHide:!0,priority:1},Map:{name:"Measure",Tool:ue,doNotHide:!0,alwaysRender:!0}},reducers:{measurement:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Te,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case m.lD:{const r=null!==t.geomType&&be()(e.features,(e=>("bearing"===(e.properties?.values?.[0]||{}).type?"Bearing":e.geometry.type)===t.geomType));return ve()({},e,{lineMeasureEnabled:t.geomType!==e.geomType&&"LineString"===t.geomType,areaMeasureEnabled:t.geomType!==e.geomType&&"Polygon"===t.geomType,bearingMeasureEnabled:t.geomType!==e.geomType&&"Bearing"===t.geomType,geomType:t.geomType===e.geomType?null:t.geomType,features:null===t.geomType?[]:e.features,textLabels:null===t.geomType?[]:e.textLabels,feature:{properties:{disabled:!0}},currentFeature:-1!==r?r:e.features?.length||0,len:0,area:0,bearing:0})}case m.yK:{let r=t.feature;return(0,ce.oU)(r)&&(r=(0,g.t8)("geometry.coordinates[0]",L()(r.geometry.coordinates[0]),r)),ve()({},e,{lineMeasureEnabled:t.lineMeasureEnabled,areaMeasureEnabled:t.areaMeasureEnabled,bearingMeasureEnabled:t.bearingMeasureEnabled,geomType:t.geomType,values:t.values,feature:(0,g.t8)("properties.disabled",e.feature.properties.disabled,r),point:t.point,len:t.len,area:t.area,bearing:t.bearing,lenUnit:t.lenUnit,areaUnit:t.areaUnit})}case m.sc:{const{point:r,len:n,area:o,bearing:a}=t.measures;return{...e,point:r,len:n,area:o,bearing:a}}case m.Qw:return{...(0,g.t8)("feature.properties.disabled",!0,e),isDrawing:!0,updatedByUI:!1};case m.gf:{const r="length"===t.uom?"lenUnit":"lenArea",{value:n,label:o}=t.value;return ve()({},e,{...("length"===t.uom||"area"===t.uom)&&{[r]:n},uom:ve()({},t.previousUom||e.uom,{[t.uom]:{unit:n,label:o}}),updatedByUI:!0})}case m.Qr:{let{features:r=[]}=t;const n=(0,G.k2)(r),o=e.features?.length===r.length?e.currentFeature:r.length?r.length-1:0;return{...e,features:r,currentFeature:o,geomTypeSelected:n,updatedByUI:!1,isDrawing:!1,...ge()(r)&&{exportToAnnotation:!1}}}case m.Kf:{let{property:r,value:n}=t;return{...e,[r]:n}}case m.ES:{let{features:r,properties:n}=t;const o=(0,G.k2)(r);return{...e,features:r,geomTypeSelected:o,updatedByUI:!0,isDrawing:!1,exportToAnnotation:!0,id:n.id,visibility:n.visibility}}case m.Kx:return{...e,textLabels:t.textLabels};case m.V:return{...e,currentFeature:fe()(t.featureIndex)?t.featureIndex:e.features.length};case u.kM:{const{id:r,...n}=e;return"info"===t.control?{...n,len:0,area:0,bearing:0,lineMeasureEnabled:!1,areaMeasureEnabled:!1,bearingMeasureEnabled:!1,feature:{properties:{disabled:!0}},geomType:""}:"measure"===t.control?{...n,geomType:"",lineMeasureEnabled:!1,areaMeasureEnabled:!1,bearingMeasureEnabled:!1}:e}case u.At:return"measure"===t.control&&!1===t.value?{...e,geomType:"",lineMeasureEnabled:!1,areaMeasureEnabled:!1,bearingMeasureEnabled:!1}:e;case u.l:return{...e,len:0,area:0,bearing:0,lineMeasureEnabled:!1,areaMeasureEnabled:!1,bearingMeasureEnabled:!1,feature:{properties:{disabled:!0}},geomType:"",features:[]};case m.GI:return{...e,format:t.format};case m.qg:return e.init?e:{...e,...t.defaultOptions,init:!0};case m.MT:{const r=t.coordinates.map((e=>[e.lon,e.lat])),n=e.features||[],o=n[e.currentFeature]||{},a=r.filter((e=>(0,h.wd)(e))).length!==r.length;return{...e,feature:{type:"Feature",properties:{disabled:r.filter((e=>(0,h.wd)(e))).length!==r.length},geometry:{type:e.bearingMeasureEnabled?"LineString":e.geomType,coordinates:e.areaMeasureEnabled?[L()(r)]:r}},features:[...n.slice(0,e.currentFeature),{...o,type:"Feature",properties:{...o.properties||{},disabled:a||e.bearingMeasureEnabled&&r.length<2},geometry:{type:e.bearingMeasureEnabled?"LineString":e.geomType,coordinates:e.areaMeasureEnabled?[[...r,r[0]]]:r,textLabels:o?.geometry?.textLabels||[]}},...n.slice(e.currentFeature+1,n.length)],updatedByUI:!0}}default:return e}}},epics:Oe})},638510:(e,t,r)=>{"use strict";r.d(t,{Z:()=>w});var n=r(353131),o=r.n(n),a=r(727418),s=r.n(a),l=r(45697),i=r.n(l),p=r(124852),u=r.n(p),m=r(630294),c=r(171703),d=r(12838),g=r(687753),h=r(723813),b=r(956611),y=r(804504),f=r(401811),E=r(23888);function v(){return v=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},v.apply(this,arguments)}function T(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const C=(0,c.connect)((e=>({isVisible:e.controls&&e.controls.help&&e.controls.help.enabled})),{changeHelpText:h.n2,changeHelpwinVisibility:h.SA})(b.Z);class M extends u().Component{constructor(){super(...arguments),T(this,"getToolConfig",(e=>e.tool?{}:this.props.toolCfg)),T(this,"getTool",(e=>{if(e.tool)return!0===e.tool?e.plugin:e.tool;let t=()=>({});const r={};return e.exclusive?(t=t=>({active:t.controls&&t.controls[this.props.stateSelector]&&t.controls[this.props.stateSelector].active===e.name}),r[this.props.eventSelector]=g.Xg.bind(null,this.props.stateSelector,"active",e.name,!0)):e.toggle?(t=t=>({bsStyle:t.controls[e.toggleControl||e.name]&&t.controls[e.toggleControl||e.name][e.toggleProperty||"enabled"]?this.props.activeStyle:this.props.toolStyle,active:t.controls[e.toggleControl||e.name]&&t.controls[e.toggleControl||e.name][e.toggleProperty||"enabled"]||!1}),r[this.props.eventSelector]=g.Xi.bind(null,e.toggleControl||e.name,e.toggleProperty||null)):e.action&&(r[this.props.eventSelector]=o()(e.action,this.context),t=e.selector||t),(0,c.connect)(t,r,((e,t,r)=>this.mergeHandlers({...r,...e},t)))(this.props.tool)})),T(this,"renderTool",((e,t)=>{if(e.element)return e.element;const r=e.help?u().createElement(C,{className:"mapstore-helpbadge",helpText:e.help}):u().createElement("span",null),n=e.tooltip?u().createElement(y.Z,{msgId:e.tooltip}):null,o=this.getTool(e),a=this.getToolConfig(e),s=e.childTools||[];return this.addTooltip(u().createElement(o,v({},a,{pluginCfg:e.cfg,tooltip:n,style:e.style,btnSize:this.props.toolSize,bsStyle:this.props.toolStyle,help:r,key:e.name||"tool"+t,mapType:this.props.mapType},e.cfg,{items:e.items||[]}),e.cfg&&e.cfg.glyph?u().createElement(m.Glyphicon,{glyph:e.cfg.glyph}):e.icon,r," ",e.text,s.length>0&&u().createElement(M,v({},e.innerProps,{mapType:this.props.mapType,tools:s,panels:e.childPanels}))),e)})),T(this,"renderTools",(()=>this.props.tools.map(this.renderTool))),T(this,"renderPanels",(()=>this.props.panels.filter((e=>!e.panel.loadPlugin)).map((e=>{const t=e.panel,r=u().createElement(t,v({key:e.name,mapType:this.props.mapType},e.cfg,e.props||{},{items:e.items||[]})),n=e.title?u().createElement(y.Z,{msgId:e.title}):null;return e.wrap?u().createElement(m.Collapse,{key:"mapToolBar-item-collapse-"+e.name,in:this.props.activePanel===e.name},u().createElement(m.Panel,{header:n,style:this.props.panelStyle,className:this.props.panelClassName},r)):r})))),T(this,"mergeHandlers",((e,t)=>Object.keys(t).reduce(((r,n)=>s()(r,{[n]:e[n]?(0,d.qC)(e[n],t[n]):t[n]})),e))),T(this,"addTooltip",((e,t)=>{if(t.tooltip){let r=u().createElement(m.Tooltip,{id:this.props.id+"-"+t.name+"-tooltip"},u().createElement(y.Z,{msgId:t.tooltip}));return u().createElement(f.Z,{key:this.props.id+"-"+t.name+"-overlay",rootClose:!0,placement:"left",overlay:r},e)}return e}))}render(){const e=this.props.container;return u().createElement("span",{id:this.props.id,style:this.props.containerWrapperStyle},u().createElement(e,{id:this.props.id+"-container",style:this.props.style,className:this.props.className},this.renderTools()),this.renderPanels())}}T(M,"propTypes",{id:i().string.isRequired,container:i().func,containerWrapperStyle:i().object,tool:i().oneOfType([i().object,i().func]),className:i().string,style:i().object,tools:i().array,panels:i().array,mapType:i().string,toolStyle:i().string,activeStyle:i().string,toolSize:i().string,stateSelector:i().string.isRequired,eventSelector:i().string,panelStyle:i().object,panelClassName:i().string,activePanel:i().string,toolCfg:i().object}),T(M,"contextTypes",{messages:i().object,router:i().object}),T(M,"defaultProps",{container:m.Panel,className:"tools-container",style:{},toolStyle:"default",activeStyle:"primary",tools:[],panels:[],tool:E.Z,mapType:"leaflet",eventSelector:"onClick",panelStyle:{},panelClassName:"tools-container-panel",toolSize:null,toolCfg:{}});const w=M},782527:(e,t,r)=>{"use strict";r.d(t,{y7:()=>E,oU:()=>v,hH:()=>T});var n=r(573800),o=r(345801),a=r(386306),s=r(718369),l=r(878516),i=r(500052),p=r(848041),u=r(978653),m=r(497950),c=r(752043),d=r(944538),g=r(552329),h=r(525642),b=r(513987),y=r(869669),f=r(15265);const E=function(){let e,{type:t,coordinates:r,radius:n,center:o}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};switch(t){case"Point":e=new c.Z(r||[]);break;case"LineString":e=new d.Z(r||[]);break;case"MultiPoint":e=new g.Z(r||[]);break;case"MultiLineString":e=new h.Z(r||[]);break;case"MultiPolygon":e=new b.Z(r||[]);break;default:e=n&&o?(0,f.Bb)(new y.Z([o.x,o.y],n),100):new f.ZP(r||[])}return e},v=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e&&e.geometry&&"Polygon"===e.geometry.type},T={dragPan:{options:{kinetic:!1},Instance:n.Z},keyboardPan:{options:{kinetic:!1},Instance:o.Z},mouseWheelZoom:{options:{duration:0},Instance:a.Z},doubleClickZoom:{options:{duration:0},Instance:s.Z},shiftDragZoom:{options:{duration:0},Instance:l.Z},keyboardZoom:{options:{},Instance:i.Z},pinchZoom:{options:{duration:0},Instance:p.Z},pinchRotate:{options:{},Instance:u.Z},altShiftDragRotate:{options:{},Instance:m.Z}}},843624:(e,t,r)=>{var n=r(314259),o=r(640554);e.exports=function(e,t,r){var a=null==e?0:e.length;return a?(t=r||void 0===t?1:o(t),n(e,0,(t=a-t)<0?0:t)):[]}}}]);