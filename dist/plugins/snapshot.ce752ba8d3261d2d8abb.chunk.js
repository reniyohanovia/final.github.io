(self.webpackChunkmapstore2=self.webpackChunkmapstore2||[]).push([[8117],{692741:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});const s={GrabMap:null,Preview:null}},239177:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});const s={GrabMap:n(726413).Z,Preview:n(630992).Z}},726413:(e,t,n)=>{"use strict";n.d(t,{Z:()=>S});var s=n(45697),a=n.n(s),r=n(124852),o=n.n(r),i=n(234228),l=n(331655),p=n(618446),h=n.n(p),m=n(461120),u=n.n(m),c=n(459425),d=n.n(c),g=n(882702),y=n(893379),v=n.n(y),f=n(555198);function b(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}v()(f.Z,{insert:"head",singleton:!1}),f.Z.locals;class E extends o().Component{constructor(){super(...arguments),b(this,"getCanvas",(()=>this.refs.canvas)),b(this,"mapChanged",(e=>!h()(e.layers,this.props.layers)||e.active!==this.props.active||e.config!==this.props.config)),b(this,"mapIsLoading",(e=>e.some((e=>e.visibility&&e.loading)))),b(this,"triggerShooting",(e=>{this.previousTimeout&&clearTimeout(this.previousTimeout),this.previousTimeout=setTimeout((()=>{this.doSnapshot(this.props)}),e)})),b(this,"doSnapshot",(e=>{var t=window.getComputedStyle(this.mapDiv).getPropertyValue("left");t="auto"===t?0:t;let n,s,a,r,o,i=this.mapDiv.getElementsByClassName("leaflet-map-pane"),l=i&&i[0],p=l&&l.getElementsByClassName("leaflet-objects-pane"),h=p&&p[0],m=h&&h.getElementsByTagName("svg"),c=m&&m[0]&&m[0].cloneNode(!0);if(c){let e=c.style&&c.style.transform?c.style.transform.replace(/\(|\)|translate3d|translate/g,"").split("px, "):["0","0"];e=[Number.parseFloat(e[0].replace("px","")),Number.parseFloat(e[1].replace("px",""))],e=c.style.transform&&"translate3d"===c.style.transform.substr(0,11)?[0,0]:e,n=m[0]?m[0].getBoundingClientRect().left-e[0]:0,s=m[0]?m[0].getBoundingClientRect().top-e[1]:0,o=m[0].outerHTML?m[0].outerHTML:this.outerHTML(m[0]),r=c.getAttribute("width"),a=c.getAttribute("height"),c.setAttribute("style","")}let y=0;t&&(y=parseInt(t.replace("px",""),10));let v=this.mapDiv.getElementsByClassName("leaflet-map-pane"),f=v&&v[0]&&v[0].style&&v[0].style.transform?v[0].style.transform.replace(/\(|\)|translate3d|translate/g,"").split("px, "):["0","0"];f=[Number.parseFloat(f[0].replace("px","")),Number.parseFloat(f[1].replace("px",""))];let b=this.mapDiv.getElementsByClassName("leaflet-tile-pane"),E=b&&b[0].cloneNode(!0);if(E.style.zIndex=-9999,document.body.appendChild(E),E.style.overflow="hidden",E){let t=[].slice.call(E.getElementsByClassName("leaflet-layer"),0);t.sort((function(e,t){return Number.parseFloat(e.style.zIndex)-Number.parseFloat(t.style.zIndex)}));let i=this.getCanvas(),l=i&&i.getContext("2d");if(!l)return;l.clearRect(0,0,i.width,i.height);let p=function(e){for(let t=0;t<e.children.length;t++)if(e.children[t])for(let n=0;n<e.children[t].children.length;n++)e.children[t].children[n]&&"IMG"===e.children[t].children[n].tagName&&(e.children[t].children[n].style.position="absolute",e.children[t].children[n].style.left=e.children[t].children[n].getBoundingClientRect().left+y+f[0]+"px",e.children[t].children[n].style.top=e.children[t].children[n].getBoundingClientRect().top+f[1]+"px",e.children[t].children[n].style.transform="none")},h=t.map((t=>{let n=this.refs.canvas.cloneNode();return n.width=n.width+y,p(t),u()(t,{canvas:n,logging:!1,proxy:this.proxy,allowTaint:e&&e.allowTaint,useCORS:e&&e.allowTaint})}),this);h=[this.refs.canvas,...h],g.Promise.all(h).then((l=>{let p=l.reduce(((e,n,s)=>{let a=t[s-1];if(void 0===a)return e;let r=e.getContext("2d");return a.style&&!isNaN(Number.parseFloat(a.style.opacity))?r.globalAlpha=Number.parseFloat(a.style.opacity):r.globalAlpha=1,r.drawImage(n,-1*y,0),e})),h=()=>{document.body.removeChild(E);let t=this.mapDiv.getElementsByClassName("leaflet-marker-pane");if(t&&t.length>0){let n=this.refs.canvas.cloneNode();n.width=n.width+y,u()(t,{canvas:n,logging:!1,proxy:this.proxy,allowTaint:e&&e.allowTaint,useCORS:e&&e.allowTaint}).then((e=>{let t=p.getContext("2d");t.globalAlpha=1,t.drawImage(e,-1*y,0),this.props.onStatusChange("READY",this.isTainted(p)),this.props.onSnapshotReady(i,null,null,null,this.isTainted(p))}))}else this.props.onStatusChange("READY",this.isTainted(p)),this.props.onSnapshotReady(i,null,null,null,this.isTainted(p))};if(c){let e=document.createElement("canvas");n=n||0,s=s||0,e.setAttribute("width",Number.parseFloat(r)+y),e.setAttribute("height",a),d()(e,o,{ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0,ignoreClear:!0,offsetX:n,offsetY:s,renderCallback:()=>{p.getContext("2d").drawImage(e,-1*y,0),h()}})}else h()}))}})),b(this,"isTainted",(e=>{let t=(e||this.refs.canvas).getContext("2d");try{return t.getImageData(0,0,1,1),!1}catch(e){return 18===e.code}})),b(this,"exportImage",(()=>this.refs.canvas.toDataURL())),b(this,"outerHTML",(e=>{const t=document.createElement("div");return t.appendChild(e.cloneNode(!0)),t.innerHTML}))}componentDidMount(){this.mapDiv=document.getElementById(this.props.mapId),this.proxy=null;let e=(0,l.b)();e&&("object"==typeof e&&(e=e.url),this.proxy=-1!==e.indexOf("?url=")?e.replace("?url=",""):e),!this.mapIsLoading(this.props.layers)&&this.props.active&&(this.props.onStatusChange("SHOTING"),this.triggerShooting(this.props.timeout))}UNSAFE_componentWillReceiveProps(e){let t=this.mapIsLoading(e.layers),n=this.mapChanged(e);this.previousTimeout&&clearTimeout(this.previousTimeout),e.active&&!t&&n?this.props.onStatusChange("SHOTING"):e.active||(this.props.onStatusChange("DISABLED"),this.props.snapstate.error&&this.props.onSnapshotError(null))}shouldComponentUpdate(e){return this.mapChanged(e)||this.props.snapstate!==e.snapstate}componentDidUpdate(e){let t=this.mapIsLoading(this.props.layers),n=this.mapChanged(e);!this.props.active||t||!n&&"SHOTING"!==this.props.snapstate.state||this.triggerShooting(this.props.timeout)}componentWillUnmount(){this.previousTimeout&&clearTimeout(this.previousTimeout)}render(){return o().createElement("canvas",{width:this.props.config&&this.props.config.size?this.props.config.size.width:"100%",height:this.props.config&&this.props.config.size?this.props.config.size.height:"100%",style:{maxWidth:"400px",maxHeight:"400px"},ref:"canvas"})}}b(E,"propTypes",{config:i.ZP.PropTypes.config,layers:a().array,snapstate:a().object,active:a().bool,onSnapshotReady:a().func,onStatusChange:a().func,onSnapshotError:a().func,allowTaint:a().bool,browser:a().object,canvas:a().node,timeout:a().number,drawCanvas:a().bool,mapId:a().string}),b(E,"defaultProps",{config:null,layers:[],snapstate:{state:"DISABLED"},active:!1,onSnapshotReady:()=>{},onStatusChange:()=>{},onSnapshotError:()=>{},browser:{},canvas:o().createElement("canvas",null),drawCanvas:!0,mapId:"map",timeout:2e3});const S=E},630992:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});const s=n(726413).Z},446931:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>S});var s=n(893379),a=n.n(s),r=n(546290);a()(r.Z,{insert:"head",singleton:!1}),r.Z.locals,n(532454);var o=n(727418),i=n.n(o),l=n(45697),p=n.n(l),h=n(124852),m=n.n(h),u=n(234228),c=n(918141);function d(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class g extends m().Component{constructor(){super(...arguments),d(this,"renderLayers",(e=>{if(e){let t=this.props.config.projection||"EPSG:3857",n=this;return e.map(((e,s)=>{var a=i()({},e,{srs:t},"wms"===e.type?{forceProxy:!this.props.allowTaint}:{});return m().createElement(c.LLayer,{type:e.type,position:s,key:e.id||e.name,options:a},n.renderLayerContent(e))}))}return null})),d(this,"renderLayerContent",(e=>e.features&&"vector"===e.type?e.features.map((e=>m().createElement(c.Feature,{key:e.id,type:e.type,geometry:e.geometry}))):null)),d(this,"layerLoad",(()=>{if(this.toLoad--,0===this.toLoad){let e=this.refs.snapMap?this.refs.snapMap.map:null;e&&e.once("postrender",(e=>setTimeout((()=>{let t=e.map&&e.map.getTargetElement()&&e.map.getTargetElement().getElementsByTagName("canvas")[0];t&&this.createSnapshot(t)}),500)))}})),d(this,"layerLoading",(()=>{"SHOTING"!==this.props.snapstate.state&&this.props.onStatusChange("SHOTING"),this.toLoad=this.toLoad?this.toLoad:0,this.toLoad++})),d(this,"createSnapshot",(e=>{this.props.onSnapshotReady(e,null,null,null,this.isTainted(e))})),d(this,"isTainted",(e=>{if(e){let t=e.getContext("2d");try{return t.getImageData(0,0,1,1),!1}catch(e){return 18===e.code}}return!1}))}shouldComponentUpdate(e){return e.active||e.active!==this.props.active}componentDidUpdate(){this.props.active||(this.props.onStatusChange("DISABLED"),this.props.snapstate.error&&this.props.onSnapshotError(null))}render(){return this.props.active?m().createElement(c.LMap,{id:"snapshot_hidden_map-"+this.props.id,className:"snapshot_hidden_map",style:{width:this.props.config&&this.props.config.size?this.props.config.size.width:"100%",height:this.props.config&&this.props.config.size?this.props.config.size.height:"100%"},center:this.props.config.center,zoom:this.props.config.zoom,mapStateSource:this.props.config.mapStateSource,projection:this.props.config.projection||"EPSG:3857",zoomControl:!1,onLayerLoading:this.layerLoading,onLayerLoad:this.layerLoad,ref:"snapMap"},this.renderLayers(this.props.layers)):null}}d(g,"propTypes",{id:p().node,config:u.ZP.PropTypes.config,layers:p().array,snapstate:p().object,active:p().bool,onSnapshotReady:p().func,onStatusChange:p().func,onSnapshotError:p().func,allowTaint:p().bool}),d(g,"defaultProps",{config:null,layers:[],snapstate:{state:"DISABLED"},active:!1,onSnapshotReady:()=>{},onStatusChange:()=>{},onSnapshotError:()=>{}});var y=n(331655),v=n(618446),f=n.n(v);function b(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class E extends m().Component{constructor(){super(...arguments),b(this,"getCanvas",(()=>this.refs.canvas)),b(this,"mapChanged",(e=>!f()(e.layers,this.props.layers)||e.active!==this.props.active||e.config!==this.props.config)),b(this,"mapIsLoading",(e=>e.some((e=>e.visibility&&e.loading)))),b(this,"triggerShooting",(e=>{this.previousTimeout&&clearTimeout(this.previousTimeout),this.previousTimeout=setTimeout((()=>{this.doSnapshot()}),e)})),b(this,"doSnapshot",(()=>{var e=document.getElementById(this.props.mapId);let t=e&&e.getElementsByTagName("canvas")[0];if(t&&this.getCanvas()){let e=this.getCanvas(),n=e.getContext("2d");n.clearRect(0,0,e.width,e.height),n.drawImage(t,0,0),this.props.onSnapshotReady(t),this.props.onStatusChange("READY",this.isTainted(t))}})),b(this,"isTainted",(e=>{let t=(e||this.refs.canvas).getContext("2d");try{return t.getImageData(0,0,1,1),!1}catch(e){return 18===e.code}})),b(this,"exportImage",(()=>this.refs.canvas.toDataURL()))}componentDidMount(){this.proxy=null;let e=(0,y.b)();e&&("object"==typeof e&&(e=e.url),this.proxy=-1!==e.indexOf("?url=")?e.replace("?url=",""):e),!this.mapIsLoading(this.props.layers)&&this.props.active&&(this.props.onStatusChange("SHOTING"),this.triggerShooting(this.props.timeout))}UNSAFE_componentWillReceiveProps(e){this.previousTimeout&&clearTimeout(this.previousTimeout),e.active||(this.props.onStatusChange("DISABLED"),this.props.snapstate.error&&this.props.onSnapshotError(null))}shouldComponentUpdate(e){return this.mapChanged(e)||this.props.snapstate!==e.snapstate}componentDidUpdate(e){let t=this.mapIsLoading(this.props.layers),n=this.mapChanged(e);t||!this.props.active||!n&&"SHOTING"!==this.props.snapstate.state||("SHOTING"!==this.props.snapstate.state&&this.props.onStatusChange("SHOTING"),this.triggerShooting(this.props.timeout))}componentWillUnmount(){this.previousTimeout&&clearTimeout(this.previousTimeout)}render(){return m().createElement("canvas",{width:this.props.config&&this.props.config.size?this.props.config.size.width:"100%",height:this.props.config&&this.props.config.size?this.props.config.size.height:"100%",style:{maxWidth:"400px",maxHeight:"400px",width:"100%",visibility:this.props.active?"block":"none"},ref:"canvas"})}}b(E,"propTypes",{config:u.ZP.PropTypes.config,layers:p().array,snapstate:p().object,active:p().bool,onSnapshotReady:p().func,onStatusChange:p().func,onSnapshotError:p().func,allowTaint:p().bool,browser:p().object,canvas:p().node,timeout:p().number,drawCanvas:p().bool,mapId:p().string}),b(E,"defaultProps",{config:null,layers:[],snapstate:{state:"DISABLED"},active:!1,onSnapshotReady:()=>{},onStatusChange:()=>{},onSnapshotError:()=>{},browser:{},canvas:m().createElement("canvas",null),drawCanvas:!0,mapId:"map",timeout:0});const S={GrabMap:g,Preview:E}},918141:(e,t,n)=>{"use strict";n.r(t),n.d(t,{Feature:()=>p,LLayer:()=>h,LMap:()=>m,MeasurementSupport:()=>u,Overview:()=>c,ScaleBar:()=>d,default:()=>g});var s=n(278426),a=n(877758),r=n(323113),o=n(36624),i=n(904101),l=n(37525);const p=s.Z,h=a.Z,m=r.Z,u=o.default,c=i.Z,d=l.Z,g={LLayer:h,LMap:m,MeasurementSupport:u,Overview:c,ScaleBar:d,Feature:p}},291635:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>ne});var s=n(124852),a=n.n(s),r=n(630294),o=n(171703),i=n(22222),l=n(152543),p=n(687753),h=n(685476);const m="CHANGE_SNAPSHOT_STATE",u="SNAPSHOT_ERROR",c="SNAPSHOT_ADD_QUEUE",d="SNAPSHOT_REMOVE_QUEUE";function g(e){return(0,h.RP)(e,"snapshot.png","image/png"),{type:"SAVE_IMAGE",dataURL:e}}var y=n(893379),v=n.n(y),f=n(150737);v()(f.Z,{insert:"head",singleton:!1}),f.Z.locals;var b=n(618446),E=n.n(b),S=n(45697),T=n.n(S),w=n(234228),C=n(23888),I=n(131400),N=n(804504),P=n(590504),x=n(466737);function L(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.e(5716).then(n.bind(n,365716));class O extends a().Component{render(){return a().createElement("div",{className:"spinner"},a().createElement("div",{className:"spinner-card "+this.props.sSize},a().createElement("div",{className:"spinner-bg spinner-loader"},"Loading.."),a().createElement("div",{className:"spinner-fg"},this.props.value)))}}L(O,"propTypes",{id:T().string,value:T().number,sSize:T().string}),L(O,"defaultProps",{id:"mapstore-basicspinner",value:null,sSize:null});const R=O;var A=n(805025),q=n.n(A),D=n(936817),_=n.n(D);const M=e=>{const t=n(792806)("./"+e+"/SnapshotSupport").default;return t.default||t};var k=n(442553);function G(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let B;class j extends a().Component{constructor(){super(...arguments),G(this,"renderLayers",(()=>this.props.layers.map(((e,t)=>e.visibility?a().createElement("li",{key:t},e.title):null)))),G(this,"renderButton",(e=>a().createElement(C.Z,{bsStyle:this.props.buttonStyle,bsSize:"xs",disabled:!e,onClick:this.onClick},a().createElement(r.Glyphicon,{glyph:"floppy-save",disabled:{}})," ",a().createElement(N.Z,{msgId:this.props.saveBtnText})))),G(this,"renderError",(()=>this.props.snapshot.error?a().createElement(r.Row,{className:"text-center",style:{marginTop:"5px"}},a().createElement("h4",null,a().createElement("span",{className:"label label-danger"}," ",this.props.snapshot.error))):this.isBingOrGoogle()?a().createElement(r.Row,{className:"text-center",style:{marginTop:"5px"}},a().createElement("h4",null,a().createElement("span",{className:"label label-danger"},this.getgoogleBingError()))):null)),G(this,"mapIsLoading",(e=>e.some((e=>e.loading)))),G(this,"renderPreview",(()=>{if(!B.Preview)return a().createElement("div",{className:"snapshot-notsupported"},a().createElement(N.Z,{msgId:"snapshot.notsupported"}));let e,t=this.isBingOrGoogle(),n=this.isSnapshotReady();return e=t?q():_(),[a().createElement("div",{style:{display:n&&!t?"block":"none"},key:"snapshotPreviewContainer"},t?null:a().createElement(B.Preview,{ref:"snapshotPreview",timeout:this.props.timeout,config:this.props.map,layers:this.props.layers.filter((e=>e.visibility)),snapstate:this.props.snapshot,onStatusChange:this.props.onStatusChange,active:this.props.active&&!t,allowTaint:!0,drawCanvas:n&&!t,browser:this.props.browser})),a().createElement(r.Image,{key:"snapshotLoader",src:e,style:{margin:"0 auto",display:n&&!t?"none":"block"},responsive:!0})]})),G(this,"renderSize",(()=>{const e=this.props.map&&this.props.map.size||{width:100,height:100};return e.width+" X "+e.height})),G(this,"renderSnapshotQueue",(()=>this.props.snapshot.queue&&this.props.snapshot.queue.length>0?a().createElement("div",{key:"counter",style:{margin:"20px"}},this.renderDownloadMessage(),a().createElement(R,{value:this.props.snapshot.queue.length})," "):null)),G(this,"renderDownloadMessage",(()=>a().createElement(N.Z,{msgId:this.props.downloadingMsg}))),G(this,"wrap",(e=>this.props.floatingPanel?a().createElement(x.Z,null,a().createElement(P.Z,{id:"mapstore-snapshot-panel",style:this.props.panelStyle,bounds:this.props.bounds},a().createElement("span",{role:"header"},a().createElement("span",{className:"snapshot-panel-title"},a().createElement(N.Z,{msgId:"snapshot.title"})),a().createElement("button",{onClick:this.props.toggleControl,className:"print-panel-close close"},this.props.closeGlyph?a().createElement(r.Glyphicon,{glyph:this.props.closeGlyph}):a().createElement("span",null,"×"))),e)):a().createElement(r.Panel,{id:this.props.id,header:a().createElement(k.Z,{position:"right",bsStyle:"primary",title:a().createElement(N.Z,{msgId:"snapshot.title"}),glyph:"camera",onClose:this.props.toggleControl}),style:this.props.panelStyle,className:this.props.panelClassName},e))),G(this,"renderTaintedMessage",(()=>this.props.snapshot&&this.props.snapshot&&this.props.snapshot.tainted?a().createElement(r.Alert,{bsStyle:"warning"},a().createElement(N.Z,{msgId:"snapshot.taintedMessage"})):null)),G(this,"onClick",(()=>{if(this.refs.snapshotPreview.isTainted())this.createSnapshot();else{let e=this.refs.snapshotPreview.exportImage();this.props.downloadImg(e)}})),G(this,"createSnapshot",(()=>{this.props.onCreateSnapshot({key:(new Date).getTime(),config:this.props.map,layers:this.props.layers.filter((e=>e.visibility)),snapstate:this.props.snapshot,active:this.props.active,allowTaint:!1,drawCanvas:!0,browser:this.props.browser})})),G(this,"isBingOrGoogle",(()=>this.props.layers.some((e=>"google"===e.type&&e.visibility||"bing"===e.type&&e.visibility)))),G(this,"getgoogleBingError",(()=>a().createElement(N.Z,{msgId:this.props.googleBingErrorMsg}))),G(this,"isSnapshotReady",(()=>"READY"===this.props.snapshot.state&&!this.mapIsLoading(this.props.layers)&&this.props.map&&this.props.map.size))}UNSAFE_componentWillMount(){B=M(this.props.mapType)}UNSAFE_componentWillReceiveProps(e){e.mapType!==this.props.mapType&&(B=M(e.mapType))}shouldComponentUpdate(e){return!E()(e.layers,this.props.layers)||e.active!==this.props.active||e.map!==this.props.map||this.props.snapshot!==e.snapshot}render(){let e=this.isBingOrGoogle(),t=this.isSnapshotReady();return this.props.active?this.wrap(a().createElement(r.Grid,{role:"body",className:"snapshot-inner-panel",fluid:!0},a().createElement(r.Row,{key:"main"},a().createElement(r.Col,{key:"previewCol",xs:7,sm:7,md:7},this.renderPreview()),a().createElement(r.Col,{key:"dataCol",xs:5,sm:5,md:5},a().createElement(r.Table,{responsive:!0},a().createElement("tbody",null,a().createElement("tr",null,a().createElement("td",null,a().createElement(N.Z,{msgId:"snapshot.date"})),a().createElement("td",null," ",a().createElement(I.t6,{dateParams:this.props.dateFormat}))),a().createElement("tr",null,a().createElement("td",null,a().createElement(N.Z,{msgId:"snapshot.layers"})),a().createElement("td",null,a().createElement("ul",null,this.renderLayers()))),a().createElement("tr",null,a().createElement("td",null,a().createElement(N.Z,{msgId:"snapshot.size"})),a().createElement("td",null,this.renderSize())))))),this.renderError(),a().createElement(r.Row,{key:"buttons",htopclassName:"pull-right",style:{marginTop:"5px"}},this.renderButton(!e&&t),this.renderTaintedMessage(),this.renderSnapshotQueue()))):null}}G(j,"propTypes",{id:T().string,name:T().oneOfType([T().string,T().element]),saveBtnText:T().oneOfType([T().string,T().element]),map:w.ZP.PropTypes.config,layers:T().array,img:T().object,snapshot:T().object,active:T().bool,status:T().string,browser:T().object,onStatusChange:T().func,onCreateSnapshot:T().func,downloadImg:T().func,serviceBoxUrl:T().string,dateFormat:T().object,googleBingErrorMsg:T().node,downloadingMsg:T().node,timeout:T().number,mapType:T().string,floatingPanel:T().bool,panelStyle:T().object,panelClassName:T().string,toggleControl:T().func,style:T().object,closeGlyph:T().string,buttonStyle:T().string}),G(j,"defaultProps",{id:"snapshot_panel",layers:[],snapshot:{state:"DISABLED",img:{}},browser:{},icon:a().createElement(r.Glyphicon,{glyph:"camera"}),onStatusChange:()=>{},onCreateSnapshot:()=>{},toggleControl:()=>{},downloadImg:()=>{},saveBtnText:"snapshot.save",serviceBoxUrl:null,dateFormat:{day:"numeric",month:"long",year:"numeric"},googleBingErrorMsg:"snapshot.googleBingError",downloadingMsg:"snapshot.downloadingSnapshots",timeout:1e3,mapType:"leaflet",floatingPanel:!0,panelStyle:{minWidth:"600px",maxWidth:"100%",zIndex:100,position:"absolute",overflow:"auto",top:"60px",right:"100px"},panelClassName:"snapshot-panel ms-side-panel",closeGlyph:"1-close",buttonStyle:"primary",bounds:"#container"});const Z=j;function H(){return H=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},H.apply(this,arguments)}function z(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let F;class U extends a().Component{constructor(){super(...arguments),z(this,"renderGrabMaps",(e=>e.map((e=>a().createElement(F.GrabMap,H({id:e.key,active:!0,snapstate:"SHOOTING",timeout:0,onSnapshotReady:t=>{this.saveImage(t,e)}},e)))))),z(this,"saveImage",((e,t)=>{try{this.props.onSnapshotError();let n=e.toDataURL();this.props.onRemoveSnapshot(t),setTimeout((()=>{this.props.downloadImg(n)}),0)}catch(e){this.props.onSnapshotError("Error saving snapshot"),this.props.onRemoveSnapshot(t)}}))}UNSAFE_componentWillMount(){F=M(this.props.mapType)}UNSAFE_componentWillReceiveProps(e){e.mapType!==this.props.mapType&&(F=M(e.mapType))}render(){return void 0!==this.props.queue&&this.props.queue.length>0?a().createElement("div",{className:"snapshot_hidden_map"},a().createElement("div",{key:"hiddenGrabMaps",style:{zIndex:-9999}},this.renderGrabMaps(this.props.queue))):a().createElement("noscript",null)}}z(U,"propTypes",{queue:T().array,browser:T().string,onRemoveSnapshot:T().func,onSnapshotError:T().func,downloadImg:T().func,mapType:T().string}),z(U,"contextTypes",{messages:T().object}),z(U,"defaultProps",{onRemoveSnapshot:()=>{},onSnapshotError:()=>{},mapType:"leaflet"});const W=U;var Y=n(727418),X=n.n(Y);var Q=n(612912),V=n(274363),$=n(101092),J=n(488400);const K=(0,i.P1)([V.Od,$.$v,Q.l2,e=>e.controls&&e.controls.toolbar&&"snapshot"===e.controls.toolbar.active||e.controls.snapshot&&e.controls.snapshot.enabled,e=>e.browser,e=>e.snapshot||{queue:[]}],((e,t,n,s,a,r)=>({map:e,mapType:t,layers:n,active:s,browser:a,snapshot:r}))),ee=(0,o.connect)(K,{onCreateSnapshot:function(e){return{type:c,options:e}},onStatusChange:function(e,t){return{type:m,state:e,tainted:t}},downloadImg:g,toggleControl:p.Xi.bind(null,"snapshot",null)})(Z),te=(0,o.connect)((e=>({queue:e.snapshot&&e.snapshot.queue||[]})),{downloadImg:g,onSnapshotError:function(e){return{type:u,error:e}},onRemoveSnapshot:function(e){return{type:d,options:e}}})(W),ne=(0,l.rx)("SnapshotPlugin",{component:e=>a().createElement(a().Fragment,null,a().createElement(ee,e),a().createElement(te,e)),containers:{Toolbar:{name:"snapshot",position:8,help:a().createElement(J.Z,{msgId:"helptexts.snapshot"}),tooltip:"snapshot.tooltip",icon:a().createElement(r.Glyphicon,{glyph:"camera"}),toggle:!0,doNotHide:!0,title:"snapshot.title",priority:1},BurgerMenu:{name:"snapshot",position:3,text:a().createElement(J.Z,{msgId:"snapshot.title"}),icon:a().createElement(r.Glyphicon,{glyph:"camera"}),action:p.Xi.bind(null,"snapshot",null),priority:3},SidebarMenu:{name:"snapshot",position:3,text:a().createElement(J.Z,{msgId:"snapshot.title"}),icon:a().createElement(r.Glyphicon,{glyph:"camera"}),tooltip:"snapshot.tooltip",action:p.Xi.bind(null,"snapshot",null),doNotHide:!0,toggle:!0,priority:2}},reducers:{snapshot:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case m:return X()({},e,{state:t.state,tainted:t.tainted});case"SNAPSHOT_READY":return X()({},e,{img:{data:t.imgData,width:t.width,height:t.height,size:t.size}});case u:return X()({},e,{error:t.error});case c:{let n=[];return n=e&&void 0!==e.queue?[...e.queue,t.options]:[t.options],X()({},e,{queue:n})}case d:{let n=e.queue||[];return n=n.filter((e=>e.key!==t.options.key)),X()({},e,{queue:n})}default:return e}}}})},556233:(e,t,n)=>{"use strict";n.d(t,{sW:()=>i,z$:()=>l,r2:()=>p,O$:()=>h,vq:()=>m,rp:()=>c,Ov:()=>y,wd:()=>v,L0:()=>f}),n(701469);var s=n(91175),a=n.n(s),r=n(807654),o=n.n(r);const i={LENGTH:"length",AREA:"area",POINT_COORDINATES:"POINT_COORDINATES",HEIGHT_FROM_TERRAIN:"HEIGHT_FROM_TERRAIN",POLYLINE_DISTANCE_3D:"POLYLINE_DISTANCE_3D",AREA_3D:"AREA_3D",SLOPE:"SLOPE",ANGLE_3D:"ANGLE_3D"},l={[i.LENGTH]:{unit:"m",label:"m",value:"m"},[i.AREA]:{unit:"sqm",label:"m²",value:"sqm"},[i.POLYLINE_DISTANCE_3D]:{unit:"m",label:"m",value:"m"},[i.AREA_3D]:{unit:"sqm",label:"m²",value:"sqm"},[i.POINT_COORDINATES]:{unit:"m",label:"m",value:"m"},[i.HEIGHT_FROM_TERRAIN]:{unit:"m",label:"m",value:"m"},[i.SLOPE]:{unit:"deg",label:"°",value:"deg"},[i.ANGLE_3D]:{unit:"deg",label:"°",value:"deg"}},p={[i.POLYLINE_DISTANCE_3D]:"polyline-3d",[i.AREA_3D]:"polygon-3d",[i.POINT_COORDINATES]:"point-coordinates",[i.HEIGHT_FROM_TERRAIN]:"height-from-terrain",[i.ANGLE_3D]:"angle",[i.SLOPE]:"slope"},h={[i.POLYLINE_DISTANCE_3D]:[{value:"ft",label:"ft"},{value:"m",label:"m"},{value:"km",label:"km"},{value:"mi",label:"mi"},{value:"nm",label:"nm"}],[i.AREA_3D]:[{value:"sqft",label:"ft²"},{value:"sqm",label:"m²"},{value:"sqkm",label:"km²"},{value:"sqmi",label:"mi²"},{value:"sqnm",label:"nm²"}],[i.HEIGHT_FROM_TERRAIN]:[{value:"ft",label:"ft"},{value:"m",label:"m"}],[i.ANGLE_3D]:[{value:"deg",label:"°"},{value:"rad",label:"rad"}],[i.SLOPE]:[{value:"deg",label:"°"},{value:"percentage",label:"%"}],[i.POINT_COORDINATES]:[{value:"ft",label:"ft"},{value:"m",label:"m"}]},m={sqft:{value:"ft",label:"ft"},sqm:{value:"m",label:"m"},sqkm:{value:"km",label:"km"},sqmi:{value:"mi",label:"mi"},sqnm:{value:"nm",label:"nm"}};function u(e){var t=Math.floor(e),n=60*(e-t),s=Math.floor(n),a=60*(n-s);return t+"° "+s+"' "+Math.floor(a)+"'' "}function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,{measureTrueBearing:t=!1,fractionDigits:n=0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s="";if(t){let t="";e>=0&&e<10?t="00":e>10&&e<100&&(t="0"),s=t+(n>0?e.toFixed(n):Math.floor(e))+"°"}else e>=0&&e<90?s="N "+u(e)+"E":e>90&&e<=180?s="S "+u(180-e)+"E":e>180&&e<270?s="S "+u(e-180)+"W":e>=270&&e<=360&&(s="N "+u(360-e)+"W");return s}const d={yd:{ft:3,m:.9144,km:9144e-7,yd:1,mi:.00056818181818,nm:.00049373650107},ft:{ft:1,m:.3048,km:3048e-7,yd:.33333333333334,mi:.0001893932,nm:164579e-9},m:{ft:3.28084,m:1,km:.001,yd:1.0936132983377,mi:621371e-9,nm:.000539956803},km:{ft:3280.84,m:1e3,km:1,yd:1093.6132983377,mi:.62137121212121,nm:.5399568207343395},mi:{ft:5280.000168959982,m:1609.3440514990027,km:1.6093440514990027,yd:1760,mi:1,nm:.8689762697078849},nm:{ft:6076.115679999979,m:1852.0000592639938,km:1.8520000592639938,yd:2025.3718285214,mi:1.150779484848481,nm:1},sqft:{sqft:1,sqm:.09290304,sqkm:9.2903043596611e-8,sqmi:3.587e-8,sqnm:2.7051601137505e-8},sqyd:{sqft:8.9999247491639,sqm:.83612040133779,sqkm:8.3612040133779e-7,sqyd:1,sqmi:3.228278917579e-7,sqnm:2.4346237458194e-7},sqm:{sqft:10.76391,sqm:1,sqkm:1e-6,sqyd:1.196,sqmi:3.8610215854245e-7,sqnm:2.91181e-7},sqkm:{sqft:10763910,sqm:1e6,sqkm:1,sqyd:1196e3,sqmi:.38610215854245,sqnm:.291181},sqmi:{sqft:27878398.920726,sqm:2589988.110336,sqkm:2.589988110336,sqyd:27878398.920726,sqmi:1,sqnm:.75415532795574},sqnm:{sqft:36966388.603652,sqm:3434290.0120544,sqkm:3.4342900120544,sqyd:36966388.603652,sqmi:1.325986786715,sqnm:1}},g={deg:{rad:e=>e*Math.PI/180,percentage:e=>Math.round(100*Math.tan(e*Math.PI/180))},rad:{deg:e=>180*e/Math.PI,percentage:e=>Math.round(100*Math.tan(e))},percentage:{deg:e=>180*Math.atan(e/100)/Math.PI,rad:e=>Math.atan(e/100)}};function y(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"m",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"m";return g[t]&&g[t][n]?g[t][n](e):d[t]&&d[t][n]?e*d[t][n]:e}const v=e=>!o()(parseFloat(e[0]))&&!o()(parseFloat(e[1])),f=function(){let{coordinates:e,type:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e;if("LineString"===t){if(n=e.filter(v),n.length<2)return[]}else if("Polygon"===t){if(n=a()(e).filter(v),n.length<3)return[[]];n=[n.concat([a()(n)])]}return n}},555198:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});var s=n(923645),a=n.n(s)()((function(e){return e[1]}));a.push([e.id,"  .ms2 .snapshot_hidden_map{\n            position:absolute;\n            width: 100%;\n            height: 100%;\n            margin: 0;\n            padding: 0;\n            visibility: hidden;\n            overflow: hidden;\n            z-index:-1000;\n        }\n",""]);const r=a},546290:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});var s=n(923645),a=n.n(s)()((function(e){return e[1]}));a.push([e.id,"  .ms2 .snapshot_hidden_map{\n            position:absolute;\n            width: 100%;\n            height: 100%;\n            margin: 0;\n            padding: 0;\n            visibility: hidden;\n            overflow: hidden;\n            z-index:-1000;\n        }\n",""]);const r=a},150737:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});var s=n(923645),a=n.n(s)()((function(e){return e[1]}));a.push([e.id,".ms2 .snapshot-inner-panel{\n    width: 100%;\n}\n.ms2 .snapshot-inner-panel ul {\n    list-style:none;\n    padding-left:0;\n}\n\n.ms2 #mapstore-snapshot-panel {\n    position: absolute;\n    right: 200px;\n    min-width: 725px;\n}\n\n.ms2 .snapshot-panel .panel-heading {\n    padding: 0;\n}\n",""]);const r=a},805025:(e,t,n)=>{e.exports=n.p+"web/client/components/mapcontrols/Snapshot/not-available.png"},936817:(e,t,n)=>{e.exports=n.p+"web/client/components/mapcontrols/Snapshot/shoting.gif"},792806:(e,t,n)=>{var s={"./cesium/SnapshotSupport":692741,"./leaflet/SnapshotSupport":239177,"./openlayers/SnapshotSupport":446931};function a(e){var t=r(e);return n(t)}function r(e){if(!n.o(s,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return s[e]}a.keys=function(){return Object.keys(s)},a.resolve=r,e.exports=a,a.id=792806}}]);