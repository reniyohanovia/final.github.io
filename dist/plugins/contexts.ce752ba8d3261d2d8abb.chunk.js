(self.webpackChunkmapstore2=self.webpackChunkmapstore2||[]).push([[7056],{99866:(e,t,o)=>{"use strict";o.r(t),o.d(t,{contextManagerSearchContextsEpic:()=>h,editContext:()=>x,contextManagerDeleteContextEpic:()=>g,resetContextSearch:()=>b,contextManagerReloadOnContexts:()=>v});var a=o(49977),s=o.n(a),r=o(275982),n=o(288287),i=o(426529),c=o(504518),l=o(679426),p=o(853),u=o(371714),d=o(622901),m=o(372492);const h=e=>e.ofType(m.Ut).map((e=>{let{text:t,options:o}=e;return{text:t,options:o||{params:{start:0,limit:12}}}})).switchMap((e=>{let{text:t,options:o}=e;return s().Observable.defer((()=>n.Z.getResourcesByCategory("CONTEXT",t,o))).map((e=>(0,m.g_)(e,t,o))).let((0,i.hP)((0,m.as)(!0,"loading"),(0,m.as)(!1,"loading"),(()=>s().Observable.of((0,c.vU)({title:"notification.error",message:"resources.contexts.errorLoadingContexts",autoDismiss:6,position:"tc"})))))})),x=e=>e.ofType(m.y8).switchMap((e=>{let{resource:t}=e;return t?s().Observable.of((0,d.kb)(),(0,r.VF)(`/context-creator/${t.id}`)):s().Observable.empty()})),g=e=>e.ofType(m.v8).switchMap((e=>(0,l.fg)(e).map((()=>(0,m.zr)(e))))).let((0,i.hP)((0,m.as)(!0,"loading"),(0,m.as)(!1,"loading"),(()=>s().Observable.of((0,c.vU)({title:"notification.error",message:"resources.contexts.deleteError",autoDismiss:6,position:"tc"}))))),b=e=>e.ofType(m.x_).switchMap((()=>s().Observable.of((0,m.H6)("",{params:{start:0,limit:12}})))),v=(e,t)=>e.ofType(m.Ej,m.fJ,u.vY,d.Ps).delay(1e3).switchMap((()=>s().Observable.of((0,m.H6)((0,p.e8)(t.getState()),(e=>{const t=(0,p._y)(e),o=(0,p.bA)(e)||{},{start:a,limit:s,...r}=o.params;return a===t-1?{start:Math.max(0,a-s),limit:s}:{...o,params:{...r,start:a,limit:s}}})(t.getState())))))},940670:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>re});var a={};o.r(a),o.d(a,{reloadOnContexts:()=>B,searchContextsEpic:()=>z,searchContextsOnMapSearch:()=>V});var s=o(124852),r=o.n(s),n=o(45697),i=o.n(n),c=o(171703),l=o(867076),p=o(22222),u=o(804504),d=o(152543),m=o(510644),h=o(522073);const x=e=>e&&e.contexts&&e.contexts.searchText,g=e=>e&&e.contexts&&e.contexts.options,b=(0,p.P1)(g,(e=>e&&e.params)),v=e=>e&&e.contexts&&e.contexts.results,T=e=>e&&e.contexts&&e.contexts.totalCount,f=e=>e&&e.contexts&&e.contexts.loading,C="CONTEXTS:SET_CONTEXTS_AVAILABLE",E="CONTEXTS:SEARCH_CONTEXTS",O="CONTEXTS:CONTEXTS_LIST_LOADED",S="CONTEXTS:LOADING",y=(e,t)=>({type:E,searchText:e,params:t}),M=function(e){return{type:S,name:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"loading",value:e}};var w=o(706558);const D=(0,l.compose)((0,c.connect)((0,p.P1)(x,b,v,T,f,(()=>!1),(function(e){let{start:t=0,limit:o=12}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0;const n=Math.min(s||0,o||0);return{page:a&&n&&Math.ceil(t/n)||0,pageSize:o,items:a,total:s,searchText:e,loading:r}})),{searchContexts:y}),(0,l.renameProp)("searchContexts","loadPage"),(0,l.withHandlers)({onSelect:e=>{let{loadPage:t=(()=>{}),searchText:o,pageSize:a}=e;return e=>{t(o,{start:a*e,limit:a})}}}))(w.Z);var P=o(505261),N=o(372492),A=o(371714),X=o(504518);const F=(0,l.compose)((0,c.connect)((0,p.zB)({user:m.np}),{onEditData:N.ix,onDelete:N.D0,onUpdateAttribute:A.tC,reloadContexts:N.mE,invalidateFeaturedMaps:A.DG,onShowSuccessNotification:()=>(0,X.Vp)({title:"success",message:"resources.successSaved"})}))(P.Z);var Z=o(101092),R=o(970218),U=o(141919),_=o(49977),L=o.n(_),j=o(288287),k=o(426529),I=o(412961),H=o(622901);const V=(e,t)=>e.ofType(A.hU,C).switchMap((e=>{let{searchText:o}=e;const a=t.getState();return a.contexts?.available?L().Observable.of(y(o)):L().Observable.empty()})),z=(e,t)=>{let{getState:o=(()=>{})}=t;return e.ofType(E).map((e=>{let{params:t,searchText:a,geoStoreUrl:s}=e;return{searchText:a,options:{params:t||b(o())||{start:0,limit:12},...s?{baseURL:s}:{}}}})).switchMap((e=>{let{searchText:t,options:o}=e;return L().Observable.defer((()=>j.Z.getResourcesByCategory("CONTEXT",t,o))).map((e=>((e,t)=>{let{results:o,success:a,totalCount:s}=e,{searchText:r,options:n}=t;return{type:O,results:o,success:a,totalCount:s,searchText:r,options:n}})(e,{searchText:t,options:o}))).let((0,k.hP)(M(!0,"loading"),M(!1,"loading"),(()=>L().Observable.of((0,X.vU)({title:"notification.error",message:"resources.contexts.errorLoadingContexts",autoDismiss:6,position:"tc"})))))}))},B=(e,t)=>e.ofType("CONTEXTS:CONTEXT_DELETED","CONTEXTS:RELOAD_CONTEXTS",A.vY,H.Ps,I.XP,I.Nv).delay(1e3).switchMap((()=>t.getState().contexts.available?L().Observable.of(y(x(t.getState()),(e=>{const t=T(e),{start:o,limit:a,...s}=b(e)||{};return o===t-1?{start:Math.max(0,o-a),limit:a}:{start:o,limit:a,...s}})(t.getState()))):L().Observable.empty()));var $=o(99866),G=o(980153),Y=o(275982),q=o(521923),J=o(984596),Q=o.n(J);var K=o(260817);function W(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var a=o.call(e,"string");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}const ee=(0,p.P1)(T,(e=>e&&e.contexts&&e.contexts.available),((e,t)=>({count:e,available:t})));class te extends r().Component{render(){return r().createElement(F,{resources:this.props.resources,fluid:this.props.fluid,title:this.props.title,colProps:this.props.colProps,viewerUrl:e=>this.context.router.history.push(`/context/${e.name}`),getShareUrl:e=>`context/${e.name}`,editDataEnabled:this.props.editDataEnabled,onEditData:this.props.onEditData,nameFieldFilter:e=>e.replace(/[^a-zA-Z0-9\-_]/,""),cardTooltips:{deleteResource:"resources.resource.deleteResource",editResource:"resources.resource.editResource",editResourceData:"contextManager.editContextTooltip",shareResource:"share.title",addToFeatured:"resources.resource.addToFeatured",showDetails:"resources.resource.showDetails",removeFromFeatured:"resources.resource.removeFromFeatured"},shareToolEnabled:this.props.shareToolEnabled,shareOptions:this.props.shareOptions,bottom:r().createElement(D,null)})}}W(te,"propTypes",{className:i().string,splitTools:i().bool,showOptions:i().bool,searchOptions:i().object,isSearchClickable:i().bool,hideOnBlur:i().bool,placeholderMsgId:i().string,typeAhead:i().bool,searchText:i().string,onSearch:i().func,onSearchReset:i().func,onSearchTextChange:i().func,onEditData:i().func,onMount:i().func,onUnmount:i().func,resources:i().array,colProps:i().object,fluid:i().bool,title:i().string,shareOptions:i().object,shareToolEnabled:i().bool,editDataEnabled:i().bool,emptyView:i().object}),W(te,"contextTypes",{router:i().object}),W(te,"defaultProps",{className:"user-search",hideOnBlur:!1,isSearchClickable:!0,showOptions:!1,splitTools:!1,placeholderMsgId:"contextManager.searchPlaceholder",title:r().createElement("h3",null,r().createElement(u.Z,{msgId:"resources.contexts.titleNoCount"})),typeAhead:!1,searchText:"",searchOptions:{params:{start:0,limit:12}},resources:[],colProps:{xs:12,sm:6,lg:3,md:4,className:"ms-map-card-col"},fluid:!0,editDataEnabled:!0,shareOptions:K.H4,shareToolEnabled:!0,emptyView:{},onEditData:()=>{}});const oe=(0,c.connect)(ee,{setContextsAvailable:function(){return{type:C,available:!(arguments.length>0&&void 0!==arguments[0])||arguments[0]}}})((e=>{let{setContextsAvailable:t,count:o="",available:a}=e;return(0,s.useEffect)((()=>{!a&&t(!0)}),[]),r().createElement(u.Z,{msgId:"resources.contexts.title",msgParams:{count:o+""}})})),ae=(0,p.P1)([Z.$v,x,g,v,f,R.fE,m.L3,h.versionSelector],(function(e,t,o){let a=arguments.length>4?arguments[4]:void 0,s=arguments.length>5?arguments[5]:void 0,r=arguments.length>6?arguments[6]:void 0;return{mapType:e,searchText:t,version:arguments.length>7?arguments[7]:void 0,resources:(arguments.length>3&&void 0!==arguments[3]?arguments[3]:[]).map((e=>({...e,featuredEnabled:s&&"ADMIN"===r}))),loading:a}})),se=(0,l.compose)((0,c.connect)(ae,{loadMaps:A.MT}),(0,U.Z)((e=>{let{resources:t=[],loading:o}=e;return!o&&0===t.length}),(e=>({glyph:"map-context",title:r().createElement(u.Z,{msgId:"resources.contexts.noContextAvailable"}),iconFit:!0,imageStyle:{height:e?.iconHeight??"200px"}}))))(te),re=(0,d.rx)("Contexts",{component:(0,c.connect)(ae)(se),containers:{ContentTabs:{name:"contexts",key:"contexts",TitleComponent:oe,position:4,tool:!0,priority:1}},reducers:{maps:G.Z,contexts:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{enabled:!1,start:0,limit:12,errors:[],searchText:"",available:!1},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case C:return(0,q.t8)("available",t.available,e);case Y.nk:return(0,q.t8)("showModal",{},e);case O:return{...e,results:""!==t.results?Q()(t.results):[],success:t.success,totalCount:t.totalCount,start:t.params&&t.params.start,limit:t.params&&t.params.limit,searchText:t.searchText,options:t.options};case A.hU:return{...e,start:t.params&&t.params.start,limit:t.params&&t.params.limit,searchText:t.searchText};case S:return(0,q.t8)("loading"===t.name?"loading":`loadFlags.${t.name}`,t.value,(0,q.t8)("loading",t.value,e));default:return e}}},epics:{...a,...$}})},505261:(e,t,o)=>{"use strict";o.d(t,{Z:()=>i});var a=o(867076),s=o(328062),r=o(770165),n=o(249461);const i=(0,a.compose)((0,a.withHandlers)({onSaveSuccess:e=>()=>{e.reloadContexts&&e.reloadContexts(),e.invalidateFeaturedMaps&&e.invalidateFeaturedMaps(),e.onShowSuccessNotification&&e.onShowSuccessNotification()}}),(0,a.defaultProps)({category:"CONTEXT"}),s.Z,(0,a.compose)((0,a.defaultProps)({shareOptions:{embedOptions:{showTOCToggle:!1},advancedSettingsVisibility:{bbox:!0}}}),r.Z))(n.Z)},853:(e,t,o)=>{"use strict";o.d(t,{e8:()=>s,bA:()=>r,Qq:()=>n,Mz:()=>i,_y:()=>c,VO:()=>l});var a=o(22222);const s=e=>e&&e.contextmanager&&e.contextmanager.searchText,r=e=>e&&e.contextmanager&&e.contextmanager.searchOptions,n=(0,a.P1)(r,(e=>e&&e.params)),i=e=>e&&e.contextmanager&&e.contextmanager.results,c=e=>e&&e.contextmanager&&e.contextmanager.totalCount,l=e=>e&&e.contextmanager&&e.contextmanager.loading}}]);