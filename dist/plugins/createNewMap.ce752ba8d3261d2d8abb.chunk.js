(self.webpackChunkmapstore2=self.webpackChunkmapstore2||[]).push([[7756],{890032:(e,t,o)=>{"use strict";o.d(t,{Z:()=>n});var r=o(867076);const s=o(49977),n=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:()=>s.Observable.empty(),t=arguments.length>1?arguments[1]:void 0;return(0,r.mapPropsStream)((o=>{const{handler:n,stream:a}=(0,r.createEventHandler)(),{handler:l,stream:i}=(0,r.createEventHandler)();return o.combineLatest(function(e,t,o){let{dataProp:r="items",initialStreamDebounce:n=0,throttleTime:a=500}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return e.take(1).concat(e.debounceTime(n)).switchMap((e=>o(e,0).startWith({loading:!0}).concat(s.Observable.of({loading:!1})).concat(t.throttleTime(a).distinct().exhaustMap((t=>o(e,t).startWith({loading:!0}).concat(s.Observable.of({loading:!1}))))).scan(((e,t)=>{let{[r]:o,...s}=e,{[r]:n,...a}=t;return{[r]:n?[...o||[],...n]:o||[],...s,...a}})).map((e=>({...e}))))).catch((e=>s.Observable.of({loading:!1,error:e})))}(i,a,e,t).startWith({}),((e,t)=>({...e,...t,onLoadMore:n,loadFirst:l})))}))}},185936:(e,t,o)=>{"use strict";o.d(t,{Z:()=>a});var r=o(890032),s=o(867076),n=o(274335);const a=e=>{let{loadPage:t,scrollSpyOptions:o,loadStreamOptions:a,loadMoreStreamOptions:l,hasMore:i,isScrolled:c}=e;return(0,s.compose)((0,r.Z)(t,l),(0,s.defaultProps)({hasMore:i,isScrolled:c}),(0,n.Z)(o,a))}},274335:(e,t,o)=>{"use strict";o.d(t,{Z:()=>p});var r=o(124852),s=o.n(r),n=o(45697),a=o.n(n),l=o(180307),i=o.n(l);function c(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var r=o.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}o(49977);const p=function(){let{dataProp:e="items",querySelector:t,closest:o=!1,loadingProp:r="loading",skip:n=0,pageSize:l=10,offsetSize:p=200}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return d=>{var h;return h=class extends s().Component{constructor(){super(...arguments),c(this,"findScrollDomNode",(()=>{if(!this.isMounded)return null;let e=i().findDOMNode(this);return e&&o&&t?e.closest(t||"*"):e&&(t?e.querySelector(t):e)})),c(this,"onScroll",(()=>{const t={skip:n,pageSize:l,offsetSize:p,...this.props.scrollOptions},o=this.findScrollDomNode();o&&this.props.isScrolled({div:o,offset:t.offsetSize})&&(!e||this.props[e]&&this.props[e].length)&&(!r||!this.props[r])&&this.props.hasMore(this.props)&&this.props.onLoadMore(e?Math.ceil((this.props[e].length-t.skip)/t.pageSize):null)}))}componentDidMount(){this.isMounded=!0;const e=this.findScrollDomNode();e&&(this.listenerAdded=!0,e.addEventListener("scroll",this.onScroll,!1),this.onScroll())}componentDidUpdate(t){const o=this.findScrollDomNode();o&&!this.listenerAdded&&(o.addEventListener("scroll",this.onScroll,!1),this.listenerAdded=!0),!o||e&&this.props[e]&&this.props[e]===t[e]||setTimeout((()=>this.onScroll()),300)}componentWillUnmount(){this.isMounded=!1,this.listenerAdded=!1;const e=this.findScrollDomNode();e&&e.removeEventListener("scroll",this.onScroll,!1)}render(){return s().createElement(d,this.props)}},c(h,"propTypes",{hasMore:a().func,onLoadMore:a().func,isScrolled:a().func,scrollOptions:a().object}),c(h,"defaultProps",{onLoadMore:()=>{},hasMore:()=>!0,isScrolled:e=>{let{div:t,offset:o}=e;return t.scrollTop+t.clientHeight>=t.scrollHeight-o}}),h}}},477065:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>U});var r={};o.r(r),o.d(r,{checkContextsOnMapLoad:()=>_,createNewMapEpic:()=>z});var s=o(124852),n=o.n(s),a=o(45697),l=o.n(a),i=o(171703),c=o(804504),p=o(49977),d=o.n(p),h=o(252628),m=o.n(h),u=o(867076),g=o(630294),w=o(679426),y=o(185936),b=o(603754),f=o(283604),E=o(63101),v=o(89518),M=o(719648);const S=(e,t)=>({title:t.name,description:t.description,preview:n().createElement("div",{className:"new-map-preview"},t.thumbnail&&"NODATA"!==t.thumbnail?n().createElement("img",{src:t.thumbnail}):n().createElement(g.Glyphicon,{glyph:"1-map"})),onClick:()=>e(t)}),N=(0,u.branch)((e=>{let{show:t}=e;return t}),(0,u.compose)((0,u.withState)("filterText","setFilterText",""),(0,u.getContext)({messages:l().object}),(0,y.Z)({loadPage:function(){let{searchText:e="",limit:t=12}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(e=>{let{searchText:t,opts:o}=e;return(0,w.jh)({query:t||"*",category:"CONTEXT",options:o}).switchMap((e=>d().Observable.of({items:1===e.totalCount?[e.results]:m()(e.results),total:e.totalCount,loading:!1})))})({searchText:e,opts:{params:{start:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:0)*t,limit:t}}})},loadMoreStreamOptions:{initialStreamDebounce:300},scrollSpyOptions:{querySelector:".new-map-dialog-list-container",pageSize:12},hasMore:e=>{let{items:t=[],total:o=0}=e;return t.length<o}}),(0,u.lifecycle)({componentDidMount(){this.props.loadFirst&&this.props.loadFirst()}})))((e=>{let{loading:t,show:o,filterText:r="",loadFirst:s=(()=>{}),setFilterText:a=(()=>{}),onClose:l=(()=>{}),onSelect:i=(()=>{}),items:p=[],messages:d={}}=e;return n().createElement(f.Z,{show:o,loading:t&&p.length>0,title:n().createElement(c.Z,{msgId:"newMapDialog.title"}),fade:!0,clickOutEnabled:!1,buttons:[{text:n().createElement(c.Z,{msgId:"cancel"}),bsStyle:"primary",onClick:()=>l()}],onClose:l},n().createElement("div",{className:"new-map-dialog"},n().createElement("div",{className:"new-map-dialog-filter-container"},n().createElement(b.Z,{filterText:r,onFilter:e=>{a(e),s({searchText:e})},filterPlaceholder:(0,M.S$)(d,"newMapDialog.filterPlaceholder")})),n().createElement("div",{className:"new-map-dialog-list-container"},t&&0===p.length?n().createElement("div",{className:"new-map-loader"},n().createElement(v.Z,{size:100})):n().createElement(E.Z,{items:p.map(S.bind(null,i)),emptyStateProps:{glyph:"1-map",title:n().createElement(c.Z,{msgId:"newMapDialog.noContexts"})}}))))}));var C=o(23888),T=o(36549);const x="CREATENEWMAP:SHOW_NEW_MAP_DIALOG",D="CREATENEWMAP:CREATE_NEW_MAP",P="CREATENEWMAP:HAS_CONTEXTS",O="CREATENEWMAP:LOADING",A=e=>({type:x,show:e}),k=function(e){return{type:O,name:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"loading",value:e}},I=e=>e.createnewmap&&e.createnewmap.showNewMapDialog,Z=e=>e.createnewmap&&e.createnewmap.hasContexts,L=e=>e.createnewmap&&e.createnewmap.loading,j=e=>e.createnewmap&&e.createnewmap.loadFlags;var F=o(101092),W=o(521923),G=o(275982),R=o(371714),q=o(426529);const _=e=>e.ofType(R.qy).switchMap((()=>(0,w.jh)({category:"CONTEXT",options:{params:{start:0,limit:1}}}).map((e=>e.totalCount)).switchMap((function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return d().Observable.of({type:P,value:e>0})})).let((0,q.hP)(k(!0,"newMapDialog"),k(!1,"newMapDialog"),(()=>d().Observable.empty()))))),z=(e,t)=>e.ofType(D).switchMap((e=>{let{context:o}=e;const r=t.getState(),s=(0,F.$v)(r);return d().Observable.of(A(!1),(0,G.VF)("/viewer/"+s+"/new"+(o?`/context/${o.id}`:"")))}));function H(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var r=o.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}const $=(0,T.Z)(C.Z),X=(0,T.Z)(g.SplitButton);class B extends n().Component{constructor(){super(...arguments),H(this,"createNewEmptyMap",(()=>{this.context.router.history.push("/viewer/"+this.props.mapType+"/new")})),H(this,"isAllowed",(()=>this.props.isLoggedIn&&this.props.allowedRoles.indexOf(this.props.user&&this.props.user.role)>=0))}render(){const e=this.isAllowed()?null:"none";return n().createElement("div",{className:"create-new-map-container"},n().createElement(g.Grid,{fluid:this.props.fluid,style:{marginBottom:"30px",padding:0,display:e}},n().createElement(g.Col,this.props.colProps,n().createElement(g.ButtonToolbar,null,this.props.hasContexts&&n().createElement(X,{id:"split-button",tooltipId:"newMap",className:"square-button",bsStyle:"primary",title:n().createElement(g.Glyphicon,{glyph:"add-map"}),onClick:()=>this.createNewEmptyMap()},n().createElement(g.MenuItem,{onClick:()=>this.createNewEmptyMap()},n().createElement(c.Z,{msgId:"newMapEmpty"})),n().createElement(g.MenuItem,{onClick:()=>this.props.onShowNewMapDialog(!0)},n().createElement(c.Z,{msgId:"newMapContext"}))),!this.props.hasContexts&&n().createElement($,{tooltipId:"newMap",className:"square-button",bsStyle:"primary",onClick:()=>this.createNewEmptyMap()},n().createElement(g.Glyphicon,{glyph:"add-map"})),this.props.showNewDashboard?n().createElement($,{tooltipId:"resources.dashboards.newDashboard",className:"square-button",bsStyle:"primary",onClick:()=>{this.context.router.history.push("/dashboard")}},n().createElement(g.Glyphicon,{glyph:"add-dashboard"})):null,this.props.showNewGeostory?n().createElement($,{tooltipId:"resources.geostories.newGeostory",className:"square-button",bsStyle:"primary",onClick:()=>{this.context.router.history.push("/geostory/newgeostory/")}},n().createElement(g.Glyphicon,{glyph:"add-geostory"})):null))),n().createElement(N,{show:this.props.showNewMapDialog,onClose:()=>this.props.onShowNewMapDialog(!1),onSelect:this.props.onNewMap}))}}H(B,"propTypes",{loading:l().bool,loadFlags:l().object,mapType:l().string,showNewDashboard:l().bool,showNewGeostory:l().bool,colProps:l().object,isLoggedIn:l().bool,allowedRoles:l().array,user:l().object,fluid:l().bool,hasContexts:l().bool,showNewMapDialog:l().bool,onShowNewMapDialog:l().func,onNewMap:l().func}),H(B,"contextTypes",{router:l().object}),H(B,"defaultProps",{loading:!1,loadFlags:{},mapType:"leaflet",showNewDashboard:!0,showNewGeostory:!0,isLoggedIn:!1,allowedRoles:["ADMIN","USER"],colProps:{xs:12,sm:12,lg:12,md:12},fluid:!1,hasContexts:!1,showNewMapDialog:!1,onShowNewMapDialog:()=>{},onNewMap:()=>{}});const U={CreateNewMapPlugin:(0,i.connect)((e=>({loading:L(e),loadFlags:j(e),mapType:(0,F.$v)(e),isLoggedIn:!(!(e&&e.security&&e.security.user&&e.security.user.enabled)||e.browser&&e.browser.mobile),user:e&&e.security&&e.security.user,hasContexts:Z(e),showNewMapDialog:I(e)})),{onShowNewMapDialog:A,onNewMap:e=>({type:D,context:e})})(B),reducers:{createnewmap:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case x:return(0,W.t8)("showNewMapDialog",t.show,e);case"CREATENEWMAP:SET_NEW_MAP_CONTEXT":return(0,W.t8)("newMapContext",t.context,e);case P:return(0,W.t8)("hasContexts",t.value,e);case O:return(0,W.t8)("loading"===t.name?"loading":`loadFlags.${t.name}`,t.value,(0,W.t8)("loading",t.value,e));default:return e}}},epics:r}}}]);