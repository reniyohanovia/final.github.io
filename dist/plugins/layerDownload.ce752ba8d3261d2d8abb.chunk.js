(self.webpackChunkmapstore2=self.webpackChunkmapstore2||[]).push([[3513],{994345:(e,t,a)=>{"use strict";a.d(t,{Z:()=>s});var o=a(867076),r=a(36549),l=a(832979);const s=(0,o.compose)((0,o.withProps)((e=>{let{renderPopover:t,popoverOptions:a,...o}=e;return t?{renderPopover:t,popoverOptions:a,...o}:{...o}})),(0,o.branch)((function(){let{renderPopover:e,popoverOptions:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e&&!!t}),l.Z,r.Z))},832979:(e,t,a)=>{"use strict";a.d(t,{Z:()=>m});var o=a(124852),r=a.n(o),l=a(118438),s=a(630294),n=a(957557),i=a.n(n),p=a(180307),c=a.n(p);function d(){return d=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},d.apply(this,arguments)}const m=e=>class extends r().Component{render(){let t=null;const{popoverOptions:a,keyProp:o,...n}=this.props;return r().createElement("span",{className:"mapstore-info-popover"},r().createElement(e,d({},i()(n,["renderPopover","tooltipId"]),{key:o,ref:e=>{t=e}})),r().createElement(l.Z,{placement:a.placement,shouldUpdatePosition:!0,show:!0,target:()=>c().findDOMNode(t)},r().createElement(s.Popover,a.props,a.content)))}}},712845:(e,t,a)=>{"use strict";a.d(t,{Z:()=>d});var o=a(124852),r=a.n(o),l=a(630294),s=a(23888);function n(){return n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},n.apply(this,arguments)}const i={width:0,padding:0,borderWidth:0},p={},c=e=>e?p:i,d=(0,o.forwardRef)(((e,t)=>{let{disabled:a,id:o,visible:i,onClick:p,glyph:d,active:m,className:u="square-button-md",...y}=e;return r().createElement(s.Z,n({ref:t},y,{bsStyle:m?"success":"primary",disabled:a,id:`fg-${o}`,style:c(i),className:u,onClick:()=>!a&&p()}),r().createElement(l.Glyphicon,{glyph:d}))}))},81674:(e,t,a)=>{"use strict";a.d(t,{l:()=>i});var o=a(49977),r=a(470509),l=a.n(r),s=a(510810),n=a(474810);const i=(e,t)=>o.Observable.defer((()=>l().get((0,n.Jy)(e,{version:"1.0.0",REQUEST:"DescribeProcess",IDENTIFIER:t}),{timeout:5e3,headers:{Accept:"application/json","Content-Type":"application/xml"}}))).let(s.oB)},372236:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>Ut});var o={};a.r(o),a.d(o,{checkExportDataEntriesEpic:()=>jt,checkWPSAvailabilityEpic:()=>Wt,closeExportDownload:()=>_t,fetchFormatsWFSDownload:()=>Mt,openDownloadTool:()=>Gt,resetExportDataResultsOnLogout:()=>Xt,serializeCookieOnExportDataChange:()=>qt,setExportDataResultsOnLoginSuccessAndMapConfigLoaded:()=>Vt,showInfoBubbleMessageEpic:()=>Bt,startFeatureExportDownload:()=>Zt});var r=a(171703),l=a(22222);const s="LAYERDOWNLOAD:CHECK_WPS_AVAILABILITY",n="LAYERDOWNLOAD:CHECKING_WPS_AVAILABILITY",i="LAYERDOWNLOAD:DOWNLOAD_FEATURES",p="LAYERDOWNLOAD:DOWNLOAD_FINISHED",c="LAYERDOWNLOAD:FORMAT_SELECTED",d="LAYERDOWNLOAD:CLEAR_DOWNLOAD_OPTIONS",m="LAYERDOWNLOAD:FORMAT_FETCH",u="LAYERDOWNLOAD:FORMAT_UPDATE",y="LAYERDOWNLOAD:SET_WPS_AVAILABLE",w="LAYERDOWNLOAD:SET_SERVICE",g="LAYERDOWNLOAD:SET_EXPORT_DATA_RESULTS",h="LAYERDOWNLOAD:ADD_EXPORT_DATA_RESULT",b="LAYERDOWNLOAD:UPDATE_EXPORT_DATA_RESULT",f="LAYERDOWNLOAD:REMOVE_EXPORT_DATA_RESULT",v="LAYERDOWNLOAD:REMOVE_EXPORT_DATA_RESULTS",E="LAYERDOWNLOAD:CHECK_EXPORT_DATA_ENTRIES",O="LAYERDOWNLOAD:CHECKING_EXPORT_DATA_ENTRIES",S="LAYERDOWNLOAD:SERIALIZE_COOKIE",A="LAYERDOWNLOAD:SHOW_INFO_BUBBLE_MESSAGE",D="LAYERDOWNLOAD:SHOW_INFO_BUBBLE",R="LAYERDOWNLOAD:SET_INFO_BUBBLE_MESSAGE",N=e=>({type:n,checking:e}),C=(e,t)=>({type:c,key:e,value:t}),P=()=>({type:p}),T=e=>({type:y,value:e}),x=e=>({type:w,service:e}),F=e=>({type:g,results:e}),L=(e,t)=>({type:b,id:e,newProps:t}),I=e=>({type:O,checking:e}),k=(e,t,a,o)=>({type:A,msgId:e,msgParams:t,level:a,duration:o}),W=e=>({type:D,show:e});var G=a(687753),M=a(820709),Z=a(612912),_=a(254020);const B=e=>e?.layerdownload?.service,j=(0,l.P1)(M.Rd,_.X1,Z.Iz,((e,t,a)=>e?t:a?.name?{featureTypeName:a.name,filterType:"OGC",ogcVersion:"1.1.0"}:null)),q=e=>e?.layerdownload?.results;var X=a(707366),V=a(124852),U=a.n(V),H=a(45697),Y=a.n(H),z=a(630998),$=a.n(z),K=a(727418),J=a.n(K),Q=a(630294),ee=a(472986),te=a.n(ee),ae=a(89518),oe=a(590504),re=a(466737),le=a(804504),se=a(747119),ne=a(743129),ie=a(227361),pe=a.n(ie),ce=a(91175),de=a.n(ce),me=a(747037),ue=a.n(me),ye=a(594239);const we=e=>{let{cropDataSetVisible:t=!1,cropDataSetEnabled:a=!1,donwloadFilteredVisible:o=!1,downloadFilteredEnabled:r=!1,advancedOptionsVisible:l=!1,compressionOptions:s=["CCITT RLE","LZW","JPEG","ZLib","PackBits","Deflate"],selectedCompression:n,tileWidth:i,tileHeight:p,quality:c,onChange:d=(()=>{})}=e;const[m,u]=U().useState(!1);return U().createElement(U().Fragment,null,t&&U().createElement("div",{className:"mapstore-downloadwpsoptions-menuitem"},U().createElement(ye.Z,{checked:a,onClick:e=>d("cropDataSet",e)}),U().createElement(le.Z,{msgId:"layerdownload.cropDataSet"})),o&&U().createElement("div",{className:"mapstore-downloadwpsoptions-menuitem"},U().createElement(ye.Z,{checked:r,onClick:e=>d("downloadFilteredDataSet",e)}),U().createElement(le.Z,{msgId:"layerdownload.downloadFilteredDataSet"})),l&&U().createElement("div",{className:"mapstore-downloadwpsoptions-advanced-options"},U().createElement(Q.Button,{className:"no-border",onClick:()=>u(!m)},U().createElement(Q.Glyphicon,{glyph:"chevron-"+(m?"down":"right")})),U().createElement(le.Z,{msgId:"layerdownload.advancedOptions"})),m&&l&&U().createElement("div",{className:"mapstore-downloadwpsoptions-advanced"},U().createElement("div",{className:"mapstore-downloadwpsoptions-advanced-menuitem"},U().createElement(le.Z,{msgId:"layerdownload.compression"}),U().createElement(ne.ZP,{clearable:!0,value:n,options:s.map((e=>ue()(e)?{value:e,label:e}:e)),onChange:e=>d("compression",e?.value)})),U().createElement("div",{className:"mapstore-downloadwpsoptions-advanced-menuitem"},U().createElement(le.Z,{msgId:"layerdownload.quality"}),U().createElement("div",{className:"mapstore-downloadwpsoptions-advanced-menuitem-control"},U().createElement(Q.FormControl,{placeholder:"0.75",type:"number",min:"0",max:"1",value:c||"",onChange:e=>d("quality",e.target.value)}))),U().createElement("div",{className:"mapstore-downloadwpsoptions-advanced-menuitem"},U().createElement(le.Z,{msgId:"layerdownload.tileWidth"}),U().createElement("div",{className:"mapstore-downloadwpsoptions-advanced-menuitem-control"},U().createElement(Q.FormControl,{placeholder:"256",type:"number",min:"0",value:i||"",onChange:e=>d("tileWidth",e.target.value&&e.target.value.length>0?`${parseInt(e.target.value,10)}`:"")}),U().createElement("span",null,"px"))),U().createElement("div",{className:"mapstore-downloadwpsoptions-advanced-menuitem"},U().createElement(le.Z,{msgId:"layerdownload.tileHeight"}),U().createElement("div",{className:"mapstore-downloadwpsoptions-advanced-menuitem-control"},U().createElement(Q.FormControl,{placeholder:"256",type:"number",min:"0",value:p||"",onChange:e=>d("tileHeight",e.target.value&&e.target.value.length>0?`${parseInt(e.target.value,10)}`:"")}),U().createElement("span",null,"px")))))};function ge(e,t,a){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var o=a.call(e,"string");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class he extends U().Component{constructor(e){super(e),ge(this,"getSelectedFormat",(()=>pe()(this.props,"downloadOptions.selectedFormat"))),ge(this,"getSelectedSRS",(()=>pe()(this.props,"downloadOptions.selectedSrs")||this.props.defaultSrs||pe()(de()(this.props.srsList),"name")))}render(){return U().createElement("form",null,!this.props.hideServiceSelector&&this.props.wpsAvailable&&this.props.wfsAvailable&&U().createElement(U().Fragment,null,U().createElement("label",null,U().createElement(le.Z,{msgId:"layerdownload.service"})),U().createElement(ne.ZP,{clearable:!1,value:this.props.service,onChange:e=>this.props.setService(e.value),options:this.props.services})),U().createElement("label",null,U().createElement(le.Z,{msgId:"layerdownload.format"})),U().createElement(ne.ZP,{clearable:!1,isLoading:this.props.formatsLoading,onOpen:()=>this.props.formatOptionsFetch(this.props.layer),value:this.props.downloadOptions?.selectedFormat,noResultsText:U().createElement(le.Z,{msgId:"layerdownload.format"}),onChange:e=>this.props.onChange("selectedFormat",e.value),options:this.props.formats.map((e=>({value:e.name,label:e.label||e.name})))}),U().createElement("label",null,U().createElement(le.Z,{msgId:"layerdownload.srs"})),U().createElement(ne.ZP,{clearable:!1,value:this.getSelectedSRS(),onChange:e=>this.props.onChange("selectedSrs",e.value),options:this.props.srsList.map((e=>({value:e.name,label:e.label||e.name})))}),this.props.wpsOptionsVisible&&U().createElement(we,{cropDataSetVisible:!0,donwloadFilteredVisible:this.props.downloadFilteredVisible,advancedOptionsVisible:this.props.wpsAdvancedOptionsVisible,cropDataSetEnabled:this.props.downloadOptions.cropDataSet,downloadFilteredEnabled:this.props.downloadOptions.downloadFilteredDataSet,selectedCompression:this.props.downloadOptions.compression,quality:this.props.downloadOptions.quality,tileWidth:this.props.downloadOptions.tileWidth,tileHeight:this.props.downloadOptions.tileHeight,onChange:this.props.onChange}),this.props.virtualScroll?null:U().createElement(Q.Checkbox,{checked:this.props.downloadOptions.singlePage,onChange:()=>this.props.onChange("singlePage",!this.props.downloadOptions.singlePage)},U().createElement(le.Z,{msgId:"layerdownload.downloadonlycurrentpage"})))}}ge(he,"propTypes",{wpsAvailable:Y().bool,wfsAvailable:Y().bool,service:Y().string,downloadOptions:Y().object,formatOptionsFetch:Y().func,formats:Y().array,srsList:Y().array,setService:Y().func,onChange:Y().func,defaultSrs:Y().string,wpsOptionsVisible:Y().bool,wpsAdvancedOptionsVisible:Y().bool,downloadFilteredVisible:Y().bool,layer:Y().object,formatsLoading:Y().bool,virtualScroll:Y().bool,services:Y().arrayOf(Y().object),hideServiceSelector:Y().bool}),ge(he,"defaultProps",{wpsAvailable:!1,wfsAvailable:!0,service:"wps",downloadOptions:{},formatsLoading:!1,formats:[],srsList:[],wpsOptionsVisible:!1,wpsAdvancedOptionsVisible:!1,downloadFilteredVisible:!1,virtualScroll:!0,services:[{value:"wps",label:"WPS"},{value:"wfs",label:"WFS"}],hideServiceSelector:!1});const be=he;var fe=a(23888),ve=a(112008);function Ee(e,t,a){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var o=a.call(e,"string");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Oe extends U().Component{constructor(){super(...arguments),Ee(this,"onClose",(()=>{this.props.onClose()})),Ee(this,"renderIcon",(()=>this.props.loading?U().createElement("div",{style:{float:"left"}},U().createElement(te(),{spinnerName:"circle",noFadeIn:!0})):U().createElement(Q.Glyphicon,{glyph:"download"}))),Ee(this,"handleExport",(()=>{const{url:e,filterObj:t,downloadOptions:a,defaultSrs:o,srsList:r,onExport:l,layer:s,attributes:n,customAttributeSettings:i}=this.props,p=a&&a.selectedSrs||o||(r[0]||{}).name,c=(0,ve.Pf)(n,i);l(e||s.url,t,J()({},a,{selectedSrs:p},{propertyName:c}))}))}componentDidUpdate(e){this.props.enabled!==e.enabled&&this.props.enabled&&(this.props.onClearDownloadOptions(),"wms"===this.props.layer.type&&this.props.onCheckWPSAvailability(this.props.url||this.props.layer.url,this.props.defaultSelectedService))}render(){const e=e=>this.props.formats.filter((t=>{let{validServices:a,type:o="vector"}=t;return(!a||$()(a,(t=>t===e))>-1)&&("vector"===o&&this.props.layer.search?.url||"raster"===o&&!this.props.layer.search?.url)})),t=e("wfs"),a=e("wps"),o=t.length>0?t.filter((e=>this.props.wfsFormats.find((t=>t.name.toLowerCase()===e.name.toLowerCase())))):this.props.wfsFormats,r=Boolean(this.props.layer.search?.url);return this.props.enabled?U().createElement(re.Z,null,U().createElement(oe.Z,{id:"mapstore-export",draggable:!1,modal:!0},U().createElement("span",{role:"header"},U().createElement("span",{className:"about-panel-title"},U().createElement(le.Z,{msgId:"layerdownload.title"})),U().createElement("button",{onClick:this.onClose,className:"settings-panel-close close"},this.props.closeGlyph?U().createElement(Q.Glyphicon,{glyph:this.props.closeGlyph}):U().createElement("span",null,"×"))),U().createElement("div",{role:"body"},this.props.checkingWPSAvailability?U().createElement(ae.Z,{size:100,style:{margin:"0 auto"}}):this.props.wpsAvailable||r?U().createElement(be,{wpsAvailable:this.props.wpsAvailable,wfsAvailable:r,service:this.props.service,downloadOptions:this.props.downloadOptions,setService:this.props.setService,onChange:this.props.onDownloadOptionChange,formatOptionsFetch:"wfs"===this.props.service?this.props.onFormatOptionsFetch:()=>{},formatsLoading:this.props.formatsLoading,formats:"wfs"===this.props.service?o:a,srsList:this.props.srsList,defaultSrs:this.props.defaultSrs,wpsOptionsVisible:"wps"===this.props.service,wpsAdvancedOptionsVisible:!this.props.layer.search?.url,downloadFilteredVisible:!!this.props.layer.search?.url,layer:this.props.layer,virtualScroll:this.props.virtualScroll,customAttributesSettings:this.props.customAttributeSettings,attributes:this.props.attributes,hideServiceSelector:this.props.hideServiceSelector}):U().createElement(se.Z,{title:U().createElement(le.Z,{msgId:"layerdownload.noSupportedServiceFound"})})),!this.props.checkingWPSAvailability&&U().createElement("div",{role:"footer"},U().createElement(fe.Z,{bsStyle:"primary",className:"download-button",disabled:!this.props.downloadOptions.selectedFormat||this.props.loading,onClick:this.handleExport},this.renderIcon()," ",U().createElement(le.Z,{msgId:"layerdownload.export"}))))):null}}Ee(Oe,"propTypes",{filterObj:Y().object,closeGlyph:Y().string,url:Y().string,wpsAvailable:Y().bool,service:Y().string,defaultSelectedService:Y().string,enabled:Y().bool,loading:Y().bool,checkingWPSAvailability:Y().bool,onClose:Y().func,onExport:Y().func,onCheckWPSAvailability:Y().func,setService:Y().func,onDownloadOptionChange:Y().func,onClearDownloadOptions:Y().func,onFormatOptionsFetch:Y().func,downloadOptions:Y().object,wfsFormats:Y().array,formats:Y().array,srsList:Y().array,defaultSrs:Y().string,layer:Y().object,formatsLoading:Y().bool,virtualScroll:Y().bool,customAttributeSettings:Y().object,attributes:Y().array,hideServiceSelector:Y().bool}),Ee(Oe,"defaultProps",{onExport:()=>{},onClose:()=>{},onCheckWPSAvailability:()=>{},setService:()=>{},onDownloadOptionChange:()=>{},onClearDownloadOptions:()=>{},onFormatOptionsFetch:()=>{},checkingWPSAvailability:!1,layer:{},closeGlyph:"1-close",wpsAvailable:!1,service:"wfs",defaultSelectedService:"wps",wfsFormats:[],formats:[{name:"application/json",label:"GeoJSON",type:"vector",validServices:["wps"]},{name:"application/arcgrid",label:"ArcGrid",type:"raster",validServices:["wps"]},{name:"image/tiff",label:"TIFF",type:"raster",validServices:["wps"]},{name:"application/wfs-collection-1.0",label:"wfs-collection-1.0",type:"vector",validServices:["wps"]},{name:"application/wfs-collection-1.1",label:"wfs-collection-1.1",type:"vector",validServices:["wps"]},{name:"application/zip",label:"Shapefile",type:"vector",validServices:["wps"]},{name:"text/csv",label:"CSV",type:"vector",validServices:["wps"]}],formatsLoading:!1,srsList:[{name:"native",label:"Native"},{name:"EPSG:4326",label:"WGS84"}],virtualScroll:!0,downloadOptions:{},hideServiceSelector:!1});const Se=Oe;var Ae=a(141919),De=a(401811),Re=a(399790);const Ne=U().createElement(Q.Button,{bsStyle:"primary",bsSize:"small",className:"mapstore-exportdataresults-item-failed"},U().createElement(Q.Glyphicon,{glyph:"exclamation-sign"})),Ce=(0,Ae.Z)((e=>{let{results:t=[]}=e;return!t.length}),{title:U().createElement(le.Z,{msgId:"exportDataResults.emptyStateMessage"})})((e=>{let{loading:t=!1,results:a=[],currentLocale:o,onRemoveResult:r=(()=>{})}=e;return t?U().createElement(ae.Z,{size:100,style:{margin:"0 auto",padding:"10px"}}):U().createElement("div",{className:"mapstore-exportdataresults-container"},a.map((e=>{let{id:t,layerName:a,layerTitle:l,startTime:s,status:n,result:i}=e;const p=(0,Re.in)({name:a,title:l},o),c=new Date(s),d=e=>e<10?`0${e}`:`${e}`,m=`${d(c.getDate())}/${d(c.getMonth()+1)}/${c.getFullYear()} ${d(c.getHours())}:${d(c.getMinutes())}`;return U().createElement("div",{key:t,className:"mapstore-exportdataresults-item"},U().createElement("div",{className:"mapstore-exportdataresults-item-name"},p),U().createElement("div",{className:"mapstore-exportdataresults-item-date"},m),U().createElement("div",{className:"mapstore-exportdataresults-item-buttons"},"pending"===n&&U().createElement(ae.Z,{size:22,style:{marginLeft:"2px"}}),"failed"===n&&i&&i.msgId?U().createElement(De.Z,{placement:"top",overlay:U().createElement(Q.Tooltip,{id:"exportresults-failure-tooltip"},U().createElement(le.Z,{msgId:i.msgId,msgParams:i.msgParams}))},Ne):null,"failed"!==n||i&&i.msgId?null:Ne,"completed"===n&&U().createElement("a",{href:i,target:"_blank",rel:"noopener noreferrer"},U().createElement(Q.Button,{bsStyle:"primary",bsSize:"small"},U().createElement(Q.Glyphicon,{glyph:"floppy-disk"}))),U().createElement(Q.Button,{bsStyle:"primary",bsSize:"small",onClick:()=>r(t)},U().createElement(Q.Glyphicon,{glyph:"trash"}))))})))}));var Pe=a(294184),Te=a.n(Pe);const xe=e=>{let{show:t,arrowDirection:a="bottom",className:o,containerClassName:r,children:l}=e;return U().createElement("div",{className:Te()("mapstore-info-bubble",...t?["mapstore-info-bubble-visible"]:[],o)},U().createElement("div",{className:Te()("mapstore-info-bubble-container",r)},U().createElement("div",{className:Te()("mapstore-info-bubble-arrow-container",`arrow-${a}`)},U().createElement("div",{className:"mapstore-info-bubble-arrow"})),U().createElement("div",{className:"mapstore-info-bubble-inner"},l)))},Fe=e=>{let{msgId:t,msgParams:a,level:o="normal",className:r}=e;return U().createElement("div",{className:Te()("mapstore-info-bubble-default-inner",`mapstore-info-bubble-default-inner-level-${o}`,r)},t?U().createElement(le.Z,{msgId:t,msgParams:a}):null)};var Le=a(994345),Ie=a(712845);const ke=(0,Le.Z)(Ie.Z);var We=a(49977),Ge=a.n(We),Me=a(313311),Ze=a.n(Me),_e=a(478718),Be=a.n(_e),je=a(493220),qe=a.n(je),Xe=a(984596),Ve=a.n(Xe),Ue=a(178598),He=a(505055),Ye=a(507526),ze=a(423570),$e=a.n(ze),Ke=a(275982),Je=a(333101),Qe=a(612132),et=a(504518),tt=a(412961),at=a(926854),ot=a(119008),rt=a(274363),lt=a(510644),st=a(141520),nt=a(81674),it=a(3674),pt=a.n(it),ct=a(957557),dt=a.n(ct),mt=a(474810),ut=a(735075);const yt=e=>{let{type:t,data:a}=e;return"TEXT"===t?(0,mt.XA)((0,mt.p5)((0,mt.Rr)(a.data),a.mimeType)):(0,mt.fA)(a.mimeType,a.href,a.method,(0,mt.Rr)(a.requestBodyData))},wt=e=>{let{layerName:t,ROI:a,roiCRS:o,dataFilter:r,targetCRS:l}=e;return(0,ut.Uh)("gs:DownloadEstimator",[(0,mt.qP)("layerName",(0,mt.XA)((0,mt.gN)(t))),...a?[(0,mt.qP)("ROI",yt(a))]:[],...o?[(0,mt.qP)("RoiCRS",(0,mt.XA)((0,mt.gN)(o)))]:[],...r?[(0,mt.qP)("filter",yt(r))]:[],...l?[(0,mt.qP)("targetCRS",(0,mt.XA)((0,mt.gN)(l)))]:[]])},gt=e=>{let{layerName:t,dataFilter:a,outputFormat:o,targetCRS:r,roiCRS:l,ROI:s,cropToROI:n,asynchronous:i,outputAsReference:p,resultOutput:c,writeParameters:d}=e;return(0,ut.Uh)("gs:Download",[(0,mt.qP)("layerName",(0,mt.XA)((0,mt.gN)(t))),(0,mt.qP)("outputFormat",(0,mt.XA)((0,mt.gN)(o))),...s?[(0,mt.qP)("ROI",yt(s))]:[],...a?[(0,mt.qP)("filter",yt(a))]:[],...r?[(0,mt.qP)("targetCRS",(0,mt.XA)((0,mt.gN)(r)))]:[],...l?[(0,mt.qP)("RoiCRS",(0,mt.XA)((0,mt.gN)(l)))]:[],(0,mt.qP)("cropToROI",(0,mt.XA)((0,mt.gN)(n?"true":"false"))),...d&&pt()(d).length>0?[(0,mt.XJ)(qe()(d).map((e=>{let[t,a]=e;return(0,mt.Dx)(t,a)})).join(""))]:[]],(0,mt.DK)(i?(0,mt.Tr)(!0,!0,p?(0,mt.t$)(c,!0,"result"):(0,mt.En)("result",c)):(0,mt.En)("result",c)))},ht=(e,t,a)=>{if(e&&t){const o=(0,ut.mG)(e,wt({layerName:t.layerName,ROI:t.ROI,roiCRS:t.roiCRS,dataFilter:t.dataFilter,targetCRS:t.targetCRS}),{outputsExtractor:(0,ut.dr)(ut.ai)}),r=t.resultOutput||t.outputFormat||"application/zip",l=(0,ut.mG)(e,gt({...dt()(t,"notifyDownloadEstimatorSuccess","attribute"),outputAsReference:!!t.asynchronous&&t.outputAsReference,resultOutput:r}),a,{headers:{"Content-Type":"application/xml",Accept:`application/xml, ${r}`}});return o.catch((()=>{throw new Error("DownloadEstimatorException")})).mergeMap((function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(e.length>0&&"result"===e[0].identifier&&"true"===e[0].data)return t.notifyDownloadEstimatorSuccess?We.Observable.of("DownloadEstimatorSuccess").concat(l):l;throw new Error("DownloadEstimatorFailed")}))}return We.Observable.empty()},bt=(e,t,a)=>{if(e&&t){const o=(0,ut.mG)(e,wt({layerName:t.layerName,ROI:t.ROI,roiCRS:t.roiCRS,dataFilter:t.dataFilter,targetCRS:t.targetCRS}),{outputsExtractor:(0,ut.dr)(ut.ai)}),r=t.resultOutput||t.outputFormat||"application/zip",l=(0,ut.mG)(e,gt({...dt()(t,"notifyDownloadEstimatorSuccess","attribute","asynchronous","outputFormat"),asynchronous:!0,outputAsReference:!0,resultOutput:"application/wfs-collection-1.0",outputFormat:"application/wfs-collection-1.0"}),a,{headers:{"Content-Type":"application/xml",Accept:"application/xml, application/wfs-collection-1.0"}});return o.catch((()=>{throw new Error("DownloadEstimatorException")})).mergeMap((function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(e.length>0&&"result"===e[0].identifier&&"true"===e[0].data)return t.notifyDownloadEstimatorSuccess?We.Observable.of("DownloadEstimatorSuccess").concat(l):l;throw new Error("DownloadEstimatorFailed")})).mergeMap((o=>{if("DownloadEstimatorSuccess"===o)return We.Observable.of("DownloadEstimatorSuccess");if(o&&1===o?.length)return(0,ut.mG)(e,(e=>{let{input:t,attribute:a,filter:o,asynchronous:r,outputAsReference:l,resultOutput:s}=e;return(0,ut.Uh)("vec:Query",[(0,mt.qP)("features",(0,mt.fA)(t.mimeType,t.href.replace(/&/g,"&amp;"),"GET")),...a?a.map((e=>(0,mt.qP)("attribute",(0,mt.XA)((0,mt.gN)(e))))):[],...o?[(0,mt.qP)("filter",yt(o))]:[]],(0,mt.DK)(r?(0,mt.Tr)(!0,!0,l?(0,mt.t$)(s,!0,"result"):(0,mt.En)("result",s)):(0,mt.En)("result",s)))})({...dt()(t,"notifyDownloadEstimatorSuccess"),input:o[0],filter:null,outputAsReference:!!t.asynchronous&&t.outputAsReference,resultOutput:r}),a,{headers:{"Content-Type":"application/xml",Accept:`application/xml, ${r}`}});throw new Error("DownloadFailed")}))}return We.Observable.empty()};var ft=a(738839),vt=a(475897),Et=a(351546),Ot=a(510810),St=a(388826),At=a.n(St),Dt=a(988594);const Rt={gml3:"GML3.1",GML2:"GML2","DXF-ZIP":"DXF-ZIP","application/vnd.google-earth.kml+xml":"KML","OGR-CSV":"OGR-CSV","OGR-FileGDB":"OGR-GeoDatabase","OGR-GPKG":"OGR-GeoPackage","OGR-KML":"OGR-KML","OGR-MIF":"OGR-MIF","OGR-TAB":"OGR-TAB","SHAPE-ZIP":"Shapefile",gml32:"GML3.2","application/json":"GeoJSON",csv:"CSV","application/x-gpkg":"GeoPackage",excel:"excel",excel2007:"excel2007"},{getFeature:Nt,query:Ct,sortBy:Pt,propertyName:Tt}=At()({wfsVersion:"1.1.0"}),xt=function(){let{url:e,filterObj:t={},layerFilter:a,downloadOptions:o={},options:r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{sortOptions:l,propertyNames:s}=r,n=(0,ft.mergeFiltersToOGC)({ogcVersion:"1.1.0",addXmlnsToRoot:!0,xmlnsToAdd:['xmlns:ogc="http://www.opengis.net/ogc"','xmlns:gml="http://www.opengis.net/gml"']},a,t);return(0,st.V6)(e,Nt(Ct(t.featureTypeName,[...l?[Pt(l.sortBy,l.sortOrder)]:[],...s?[Tt(s)]:[],...n?Ve()(n):[]],{srsName:o.selectedSrs})),r,o.selectedFormat)},Ft=e=>{const t=pe()(e,"filterObj.featureTypeName"),a=(0,vt.y7)(pe()(e,"downloadOptions.selectedFormat"));return a&&a.extension?t+"."+a.extension:t},Lt=e=>e.query&&e.query.featureTypes&&e.query.featureTypes[e.query.typeName]&&e.query.featureTypes[e.query.typeName].attributes&&e.query.featureTypes[e.query.typeName].attributes[0]&&e.query.featureTypes[e.query.typeName].attributes[0].attribute||null,It=e=>{switch(e.code){case"ProcessFailed":return{msgId:"layerdownload.wpsExecuteError.processFailed",msgParams:{exceptionReport:e.message}};case"NoStatusLocation":case"NoExecutionId":case"UnexpectedProcessStatus":return{msgId:"layerdownload.wpsExecuteError.badResponse",msgParams:{eCode:e.code}};case"ExecuteProcessXHRFailed":return{msgId:"layerdownload.wpsExecuteError.executeProcessXhrFailed"};case"GetExecutionStatusXHRFailed":return{msgId:"layerdonwload.wpsExecuteError.getExecutionStatusXhrFailed"};default:return{msgId:"layerdownload.wpsExecuteError.unexpectedError"}}},kt=e=>{const t=(0,lt.np)(e);if(t?.id){const e=document.cookie.split(";").filter((e=>e.indexOf(`exportDataResults_${t.id}=`)>-1))[0];if(e){const{results:t}=JSON.parse(decodeURIComponent(e.split("=")[1]));return Ge().Observable.of(F(t.filter((e=>{let{status:t}=e;return"pending"!==t}))))}}return Ge().Observable.empty()},Wt=(e,t)=>e.ofType(s).switchMap((e=>{let{url:a,selectedService:o}=e;return(0,nt.l)(a,"gs:DownloadEstimator,gs:Download").switchMap((e=>Ge().Observable.defer((()=>new Promise(((t,a)=>(0,He.parseString)(e.data,{tagNameProcessors:[Ye.stripPrefix]},((e,o)=>e?a(e):t(o))))))))).flatMap((e=>{const a=t.getState(),r=(0,Z.Iz)(a),l=[e?.ProcessDescriptions?.ProcessDescription?.[0]?.Identifier?.[0],e?.ProcessDescriptions?.ProcessDescription?.[1]?.Identifier?.[0]],s=$()(l,(e=>"gs:DownloadEstimator"===e))>-1&&$()(l,(e=>"gs:Download"===e))>-1,n=r.search?.url,i=s&&("wps"===o||!n);return Ge().Observable.of(x(i?"wps":"wfs"),T(s),N(!1))})).catch((()=>Ge().Observable.of(x("wfs"),T(!1),N(!1)))).startWith(N(!0))})),Gt=e=>e.ofType(Je.HN).switchMap((e=>Ge().Observable.from([(0,G.Xi)("layerdownload"),C("singlePage",!1),...e.layer.search?.url?[(0,Qe.rP)(e.layer.url,{featureTypeName:e.layer.name})]:[]]))),Mt=e=>e.ofType(m).switchMap((e=>(0,st.ED)(e).map((e=>{return t=(e=>{const t=pe()(e,"WFS_Capabilities.OperationsMetadata.Operation"),a=Ze()(t,(function(e){return"GetFeature"===e.name})),o=pe()(a,"Parameter"),r=Ze()(o,(function(e){return"outputFormat"===e.name})).Value,l=Be()(Rt,r);return qe()(l).map((e=>{let[t,a]=e;return{name:t,label:a}}))})(e),{type:u,wfsFormats:t};var t})))),Zt=(e,t)=>e.ofType(i).switchMap((a=>{const o=t.getState(),{virtualScroll:r=!1}=o.featuregrid||{},l=B(o),s=(0,Z.Iz)(o),n=(0,rt.pQ)(o),i=(0,X.Pz)(o),p=a.downloadOptions.propertyName?[(0,Dt.dm)((0,_.qj)(o,s.name)),...a.downloadOptions.propertyName]:null,{layerFilter:c}=s;return"wps"===l?(()=>{const t=!!s.search?.url,o=a.downloadOptions.cropDataSet&&!!n&&!!n.bounds,r={layerName:s.name,outputFormat:a.downloadOptions.selectedFormat,asynchronous:!0,outputAsReference:!0,targetCRS:a.downloadOptions.selectedSrs&&"native"!==a.downloadOptions.selectedSrs?a.downloadOptions.selectedSrs:void 0,cropToROI:o,dataFilter:a.downloadOptions.downloadFilteredDataSet?{type:"TEXT",data:{mimeType:"text/xml; subtype=filter/1.1",data:(0,ft.mergeFiltersToOGC)({ogcVersion:"1.1.0",addXmlnsToRoot:!0,xmlnsToAdd:['xmlns:ogc="http://www.opengis.net/ogc"','xmlns:gml="http://www.opengis.net/gml"']},s.layerFilter,a.filterObj)}}:void 0,ROI:o?{type:"TEXT",data:{mimeType:"application/json",data:JSON.stringify((0,Et.bboxToFeatureGeometry)(n.bounds))}}:void 0,roiCRS:o?n.crs||"EPSG:4326":void 0,writeParameters:{...a.downloadOptions.tileWidth?{tilewidth:a.downloadOptions.tileWidth}:{},...a.downloadOptions.tileHeight?{tileheight:a.downloadOptions.tileHeight}:{},...a.downloadOptions.compression?{compression:a.downloadOptions.compression,...a.downloadOptions.quality?{quality:a.downloadOptions.quality}:{}}:{}},notifyDownloadEstimatorSuccess:!0,attribute:p},l={id:$e()(),layerName:s.name,layerTitle:s.title,status:"pending"},c={outputsExtractor:(0,ut.dr)(ut.RW)};return(t&&p?bt:ht)(a.url,r,c).takeUntil(e.ofType(f).filter((e=>{let{id:t}=e;return t===l.id})).take(1)).flatMap((e=>{return"DownloadEstimatorSuccess"===e?Ge().Observable.of((t={...l,startTime:(new Date).getTime()},{type:h,result:t}),k("layerdownload.exportResultsMessages.newExport"),P(),(0,G.Xi)("layerdownload","enabled")):Ge().Observable.of(...e&&e.length>0&&e[0].href?[L(l.id,{status:"completed",result:e[0].href}),k("layerdownload.exportResultsMessages.exportSuccess",{layerTitle:(0,Re.in)(s,i)},"success")]:[L(l.id,{status:"failed",result:{msgId:"layerdonwload.exportResultsMessages.invalidHref"}}),k("layerdownload.exportResultsMessages.exportFailure",{layerTitle:(0,Re.in)(s,i)},"danger")]);var t})).catch((e=>Ge().Observable.of(...e.message&&e.message.indexOf("DownloadEstimator")>-1?[(0,et.vU)({error:e,title:"layerdownload.error.downloadEstimatorTitle",message:"layerdownload.error.downloadEstimatorFailed"}),P()]:[L(l.id,{status:"failed",result:It(e)}),k("layerdownload.exportResultsMessages.exportFailure",{layerTitle:(0,Re.in)(s,i)},"danger")])))})():xt({url:a.url,downloadOptions:a.downloadOptions,filterObj:a.filterObj,layerFilter:c,options:{pagination:!r&&pe()(a,"downloadOptions.singlePage")?a.filterObj&&a.filterObj.pagination:null,propertyNames:p}}).do((e=>{let{data:t,headers:a}=e;if("application/xml"===a["content-type"]){let e=String.fromCharCode.apply(null,new Uint8Array(t));if(0===e.indexOf("<ows:ExceptionReport"))throw e}})).catch((()=>{return xt({url:a.url,downloadOptions:a.downloadOptions,filterObj:a.filterObj,layerFilter:c,options:{pagination:!r&&pe()(a,"downloadOptions.singlePage")?a.filterObj&&a.filterObj.pagination:null,sortOptions:(e=Lt(t.getState()),e?{sortBy:e,sortOrder:"A"}:{}),propertyNames:a.downloadOptions.propertyName?[...a.downloadOptions.propertyName,(0,Dt.dm)((0,_.qj)(o,s.name))]:null}}).do((e=>{let{data:t,headers:o}=e;if("application/xml"===o["content-type"]){let e=String.fromCharCode.apply(null,new Uint8Array(t));if(0===e.indexOf("<ows:ExceptionReport"))throw e}(0,Ue.saveAs)(new Blob([t],{type:o&&o["content-type"]}),Ft(a))}));var e})).do((e=>{let{data:t,headers:o}=e;(0,Ue.saveAs)(new Blob([t],{type:o&&o["content-type"]}),Ft(a))})).map((()=>P())).catch((e=>Ge().Observable.of((0,et.vU)({error:e,title:"layerdownload.error.title",message:"layerdownload.error.invalidOutputFormat",autoDismiss:5,position:"tr"}),P())))})),_t=(e,t)=>e.ofType(G.kM).filter((e=>"queryPanel"===e.control&&!(0,ot._d)(t.getState())&&(0,ot.lI)(t.getState()))).switchMap((()=>Ge().Observable.of((0,G.Xi)("layerdownload")))),Bt=e=>e.ofType(A).concatMap((function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Ge().Observable.of((t=e.msgId,a=e.msgParams,o=e.level,{type:R,msgId:t,msgParams:a,level:o}),W(!0)).delay(10).concat(Ge().Observable.of(W(!1)).delay(e.duration||3e3)).concat(Ge().Observable.empty().delay(1e3));var t,a,o})),jt=(e,t)=>e.ofType(E).exhaustMap((()=>{const e=t.getState(),a=(q(e)||[]).filter((e=>{let{status:t}=e;return"completed"===t}));return a.length>0?Ge().Observable.forkJoin(a.map((e=>{const{result:t}=e,a=t.indexOf("executionId="),o=t.slice(a),r=o.indexOf("&"),l=(r>-1?o.slice(0,r):o).slice(12),s=t.indexOf("?"),n=t.slice(0,s);return(0,ut.W5)(n,l).let(Ot.oB).catch((()=>Ge().Observable.of(null))).map((t=>t?null:e.id))}))).flatMap((e=>{return Ge().Observable.of((t=e.filter((e=>!!e)),{type:v,ids:t}),{type:S},I(!1));var t})).startWith(I(!0)):Ge().Observable.empty()})),qt=(e,t)=>e.ofType(h,f,b,S).filter((()=>(0,lt.jl)(t.getState()))).do((()=>{const e=t.getState(),a=q(e),{id:o}=(0,lt.np)(e),r=JSON.stringify({results:a});document.cookie=`exportDataResults_${o}=${encodeURIComponent(r)}`})).flatMap((()=>Ge().Observable.empty())),Xt=e=>e.ofType(at.ok).switchMap((()=>e.ofType(tt.Nv).switchMap((()=>Ge().Observable.of(F([])))).takeUntil(e.ofType(Ke.nk)))),Vt=(e,t)=>e.ofType(at.ok).switchMap((()=>kt(t.getState()).concat(e.ofType(tt.XP).switchMap((()=>kt(t.getState()))).takeUntil(e.ofType(Ke.nk))))),Ut=(0,a(152543).rx)("LayerDownload",{component:(0,r.connect)((0,l.zB)({url:_.Bu,filterObj:j,enabled:e=>e?.controls?.layerdownload?.enabled,downloadOptions:e=>e?.layerdownload?.downloadOptions,loading:e=>e?.layerdownload?.loading,wfsFormats:e=>e?.layerdownload?.wfsFormats,formatsLoading:e=>e?.layerdownload?.formatsLoading,layer:Z.Iz,wpsAvailable:e=>e?.layerdownload?.wpsAvailable,service:B,checkingWPSAvailability:e=>e?.layerdownload?.checkingWPSAvailability,virtualScroll:e=>e&&e.featuregrid&&e.featuregrid.virtualScroll,customAttributeSettings:M.Xh,attributes:_.L}),{onExport:(e,t,a)=>({type:i,url:e,filterObj:t,downloadOptions:a}),setService:x,onDownloadOptionChange:C,onClearDownloadOptions:()=>({type:d}),onFormatOptionsFetch:e=>({type:m,layer:e}),onCheckWPSAvailability:(e,t)=>({type:s,url:e,selectedService:t}),onClose:()=>(0,G.Xi)("layerdownload")})(Se),containers:{TOC:{doNotHide:!0,name:"LayerDownload"},FeatureEditor:{doNotHide:!0,name:"LayerDownload",position:20,target:"toolbar",Component:(0,r.connect)((0,l.zB)({isDownloadOpen:e=>e?.controls?.layerdownload?.enabled}),{onClick:()=>(0,G.Xi)("layerdownload")})((e=>{let{disabled:t,results:a=[],mode:o,isDownloadOpen:r,onClick:l=(()=>{})}=e;return U().createElement(ke,{id:"download-grid",keyProp:"download-grid",tooltipId:"featuregrid.toolbar.downloadGridData",disabled:t||0===a.length,active:r,visible:"VIEW"===o,onClick:l,glyph:"download"})}))},MapFooter:{doNotHide:!0,name:"LayerDownload",position:1,tool:(0,r.connect)((0,l.zB)({active:e=>e?.controls?.exportDataResults?.enabled,showInfoBubble:e=>e?.layerdownload?.showInfoBubble,infoBubbleMessage:e=>e?.layerdownload?.infoBubbleMessage,checkingExportDataEntries:e=>e?.layerdownload?.checkingExportDataEntries,results:q,currentLocale:X.Pz}),{onToggle:G.Xi.bind(null,"exportDataResults","enabled"),onActive:()=>({type:E}),onRemoveResult:e=>({type:f,id:e})})((e=>{let{active:t=!1,showInfoBubble:a=!1,infoBubbleMessage:o={},checkingExportDataEntries:r,results:l=[],currentLocale:s,onToggle:n=(()=>{}),onActive:i=(()=>{}),onRemoveResult:p}=e;return U().useEffect((()=>{t&&i()}),[t]),U().createElement(U().Fragment,null,l.length>0?U().createElement("div",{id:"mapstore-export-data-results-button-container"},U().createElement(De.Z,{placement:"left",overlay:U().createElement(Q.Tooltip,{id:"mapstore-export-data-results-tooltip"},U().createElement(le.Z,{msgId:"exportDataResults.title"}))},U().createElement(Q.Button,{bsStyle:"primary",bsSize:"small",onClick:()=>n()},U().createElement(Q.Glyphicon,{glyph:"download"}))),U().createElement(xe,{show:a,className:"mapstore-export"},U().createElement(Fe,o))):null,U().createElement("div",null,t&&U().createElement(re.Z,null,U().createElement(oe.Z,{id:"mapstore-export-data-results",draggable:!1,modal:!0},U().createElement("span",{role:"header"},U().createElement("span",{className:"about-panel-title"},U().createElement(le.Z,{msgId:"exportDataResults.title"})),U().createElement("button",{onClick:()=>n(),className:"settings-panel-close close"},U().createElement(Q.Glyphicon,{glyph:"1-close"}))),U().createElement("div",{role:"body"},U().createElement(Ce,{loading:r,results:l,currentLocale:s,onRemoveResult:p}))))))}))}},epics:o,reducers:{layerdownload:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{downloadOptions:{singlePage:!0}},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case i:return{...e,loading:!0};case c:return{...e,downloadOptions:{...e.downloadOptions,[t.key]:t.value}};case d:return{...e,downloadOptions:{singlePage:!0}};case m:return{...e,layer:t.layer,wfsFormats:[],formatsLoading:!0};case p:return{...e,loading:!1};case u:return{...e,wfsFormats:t.wfsFormats,formatsLoading:!1};case w:return{...e,service:t.service};case y:return{...e,wpsAvailable:t.value};case n:return{...e,checkingWPSAvailability:t.checking};case g:return{...e,results:t.results};case h:return{...e,results:[...e.results||[],t.result]};case b:{const a=$()(e.results||[],{id:t.id});return{...e,results:a>-1?[...e.results.slice(0,a),{...e.results[a],...t.newProps||{}},...e.results.slice(a+1)]:e.results}}case f:return{...e,results:(e.results||[]).filter((e=>e.id!==t.id))};case v:return{...e,results:(e.results||[]).filter((e=>-1===$()(t.ids,(t=>t===e.id))))};case D:return{...e,showInfoBubble:t.show};case R:return{...e,infoBubbleMessage:{msgId:t.msgId,msgParams:t.msgParams,level:t.level}};case O:return{...e,checkingExportDataEntries:t.checking};default:return e}}}})}}]);