(self.webpackChunkmapstore2=self.webpackChunkmapstore2||[]).push([[6235],{801387:(e,t,r)=>{"use strict";r.r(t),r.d(t,{Support:()=>U,default:()=>K});var n=r(124852),s=r.n(n),o=r(171703),i=r(22222),a=r(612912),c=r(744448),l=r(727418),p=r.n(l);const u="SWIPE:SET_ACTIVE",m="SWIPE:SET_MODE",d="SWIPE:SET_SWIPE_TOOL_DIRECTION",g="SWIPE:SET_SPY_TOOL_RADIUS";function y(e){return{type:u,active:e,prop:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"active"}}var v=r(49977),w=r.n(v),E=r(333101),S=r(275982);const h={resetLayerSwipeSettingsEpic:(e,t)=>e.ofType(E.c7).switchMap((e=>{let{nodeType:r}=e;const n=t.getState();return(0,c.yn)(n).active&&"group"===r?w().Observable.of(y(!1)):w().Observable.empty()})),deactivateSwipeToolOnSwitchMaps:(e,t)=>e.ofType(S.nk).switchMap((()=>(0,c.yn)(t.getState()).active?w().Observable.of(y(!1)):w().Observable.empty()))};var f=r(152543),b=r(743129),P=r(185552),M=r.n(P),I=r(313311),T=r.n(I),x=r(804504),C=r(688472);const z=[{label:"Horizontal",value:"cut-horizontal"},{label:"Vertical",value:"cut-vertical"}],R=e=>{let{spyModeSettings:t,onSetSpyToolRadius:r}=e;return s().createElement("div",{className:"mapstore-swipe-settings-spy"},s().createElement("h4",null,s().createElement(x.Z,{msgId:"toc.radius"})),s().createElement("div",{className:"mapstore-slider with-tooltip"},s().createElement(M(),{tooltips:!0,step:10,start:[t.radius],range:{min:[20],max:[100]},onChange:e=>r(e[0])})))},k=e=>{let{swipeModeSettings:t,onSetSwipeToolDirection:r}=e;return s().createElement("div",{className:"mapstore-swipe-settings-slider"},s().createElement("h4",null,s().createElement(x.Z,{msgId:"toc.direction"})),s().createElement(b.ZP,{styles:{menuPortal:e=>({...e,zIndex:3100})},onChange:e=>{let{value:t}=e;return r(t)},clearable:!1,value:T()(z,["value",t.direction]),options:z}))},L=(0,i.P1)([c.yn,c.wQ,c.IY],((e,t,r)=>({configuring:e?.configuring||!1,toolMode:e?.mode||"swipe",swipeModeSettings:t,spyModeSettings:r}))),N=(0,o.connect)(L,{onSetConfigurationActive:y,onSetSwipeToolDirection:function(e){return{type:d,direction:e}},onSetSpyToolRadius:function(e){return{type:g,radius:e}}})((e=>{let{configuring:t,toolMode:r,swipeModeSettings:n,spyModeSettings:o,onSetConfigurationActive:i=(()=>{}),onSetSpyToolRadius:a=(()=>{}),onSetSwipeToolDirection:c=(()=>{})}=e;return s().createElement("div",{className:"mapstore-swipe-settings"},s().createElement(C.Z,{title:"spy"===r?s().createElement(x.Z,{msgId:"toc.spyconfiguration"}):s().createElement(x.Z,{msgId:"toc.swipeconfiguration"}),open:t,onClose:()=>i(!1,"configuring"),enableFooter:!1,draggable:!0,size:"xs",bodyClassName:"mapstore-swipe-setiings-modal-body",dialogClassName:" mapstore-swipe-settings-modal",glyph:"transfer"},"spy"===r?s().createElement(R,{spyModeSettings:o,onSetSpyToolRadius:a}):s().createElement(k,{swipeModeSettings:n,onSetSwipeToolDirection:c})))}));var O=r(630294),A=r(485294),Z=r.n(A);const _=e=>{let{map:t,layer:r,type:s,getWidth:o,getHeight:i,circleCutProp:a}=e;const c=(0,n.useCallback)((e=>{let r=e.context;const n=o()*t.pixelRatio_;r.save(),r.beginPath(),r.rect(n,0,r.canvas.width-n,r.canvas.height),r.strokeStyle="rgba(0,0,0,0.5)",r.clip()}),[r,s]),l=(0,n.useCallback)((e=>{e.context.restore()}),[r,s]),p=(0,n.useCallback)((e=>{let r=e.context;const n=i()*t.pixelRatio_;r.save(),r.beginPath(),r.rect(0,n,r.canvas.width,r.canvas.height-n),r.clip()}),[r,s]),u=(0,n.useCallback)((e=>{let t=e.context,r=e.frameState.pixelRatio;t.save(),t.beginPath();const n=a.getMousePosition();n&&(t.arc(n[0]*r,n[1]*r,a.radius*r,0,2*Math.PI),t.lineWidth=5*r,t.strokeStyle="rgba(0,0,0,0.5)",t.stroke()),t.clip()}),[r,s,a]);return(0,n.useEffect)((()=>{const e=t.getLayers().getArray().filter((e=>e.get("msId")===r))[0];if(e){switch(s){case"cut-vertical":((e,t,r)=>{e.on("precompose",t),e.on("postcompose",r)})(e,c,l);break;case"cut-horizontal":((e,t,r)=>{e.on("precompose",t),e.on("postcompose",r)})(e,p,l);break;case"circle":((e,t,r)=>{e.on("precompose",t),e.on("postcompose",r)})(e,u,l)}return t.render(),()=>{e.un("precompose",c),e.un("precompose",p),e.un("precompose",u),e.un("postcompose",l),t.render()}}return()=>t.render()}),[r,s,a]),null},D=e=>{let{type:t,map:r,widthRef:o}=e;const[i,a]=(0,n.useState)(),[c,l]=(0,n.useState)(!0),p=()=>{a({x:0,y:0}),o.current=r.getProperties().size[0]/2};return(0,n.useEffect)((()=>(window.addEventListener("resize",p),()=>{window.removeEventListener("resize",p)})),[t]),(0,n.useEffect)((()=>{o.current=r.getProperties().size[0]/2}),[t]),s().createElement(Z(),{position:i,bounds:"parent",onStart:()=>l(!1),onDrag:(e,t)=>((e,t)=>{o.current+=t.deltaX,a({x:t.x,y:t.y}),r.render()})(0,t),onStop:()=>l(!0)},s().createElement("div",{className:"mapstore-swipe-slider",style:{height:"100%",top:"0px",left:r.getProperties().size[0]/2+"px",width:"8px",cursor:"col-resize"}},c&&s().createElement("div",{className:"ms-vertical-swipe-slider-arrows",style:{top:r.getProperties().size[1]/2-26+"px"}},s().createElement("div",{className:"ms-slider-arrows"},s().createElement(O.Glyphicon,{glyph:"chevron-left"})),s().createElement("div",{className:"ms-slider-arrows"},s().createElement(O.Glyphicon,{glyph:"chevron-right"})))))},G=e=>{let{type:t,map:r,heightRef:o}=e;const[i,a]=(0,n.useState)(),[c,l]=(0,n.useState)(!0),p=()=>{a({x:0,y:0}),o.current=r.getProperties().size[1]/2};return(0,n.useEffect)((()=>(window.addEventListener("resize",p),()=>{window.removeEventListener("resize",p)})),[t]),(0,n.useEffect)((()=>{o.current=r.getProperties().size[1]/2}),[t]),s().createElement(Z(),{position:i,bounds:"parent",onStart:()=>l(!1),onDrag:(e,t)=>((e,t)=>{o.current+=t.deltaY,a({x:t.x,y:t.y}),r.render()})(0,t),onStop:()=>l(!0)},s().createElement("div",{className:"mapstore-swipe-slider",style:{height:"8px",top:r.getProperties().size[1]/2+"px",left:"0px",width:"100%",cursor:"row-resize"}},c&&s().createElement("div",{className:"ms-horizontal-swipe-slider-arrows",style:{left:r.getProperties().size[0]/2-26+"px"}},s().createElement("div",{className:"ms-slider-arrows"},s().createElement(O.Glyphicon,{glyph:"chevron-up"})),s().createElement("div",{className:"ms-slider-arrows"},s().createElement(O.Glyphicon,{glyph:"chevron-down"})))))},Y=e=>{let{map:t,layer:r,type:o="cut-vertical",active:i}=e;const a=(0,n.useRef)(),c=(0,n.useRef)();return r&&i?s().createElement(s().Fragment,null,"cut-vertical"===o&&s().createElement(D,{widthRef:c,map:t,type:o}),"cut-horizontal"===o&&s().createElement(G,{heightRef:a,map:t,type:o}),s().createElement(_,{map:t,layer:r,type:o,getWidth:()=>c.current,getHeight:()=>a.current})):null},W=e=>{let{layer:t,map:r,active:o,radius:i}=e;const a=(0,n.useRef)(),c=(0,n.useCallback)((e=>{a.current=r.getEventPixel(e),r.render()}),[t,i]),l=(0,n.useCallback)((()=>{a.current=null,r.render()}),[t,i]);(0,n.useEffect)((()=>{const e=r.getTargetElement();return e.addEventListener("mousemove",c),e.addEventListener("mouseout",l),()=>{e.removeEventListener("mousemove",c),e.removeEventListener("mouseout",l)}}),[]);const p={radius:i,getMousePosition:()=>a.current};return t&&o?s().createElement(_,{map:r,layer:t,type:"circle",circleCutProp:p}):null};var j=r(45697),H=r.n(j);function Q(){return Q=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Q.apply(this,arguments)}const F=(0,r(36549).Z)(O.SplitButton),V={title:s().createElement(O.Glyphicon,{glyph:"transfer"}),tooltipId:"toc.compareTool",tooltipPosition:"top",className:"square-button-md no-border",pullRight:!0},q=e=>{const{swipeSettings:t,onSetActive:r,onSetSwipeMode:n,status:o}=e;return s().createElement(F,Q({onClick:()=>{t.active||"LAYER"!==o?r(!1):r(!0)},bsStyle:t?.active?"success":"primary"},V),s().createElement(O.MenuItem,{active:"swipe"===t?.mode,onClick:()=>{n("swipe"),r(!0)}},s().createElement(O.Glyphicon,{glyph:"vert-dashed"}),s().createElement(x.Z,{msgId:"toc.swipe"})),s().createElement(O.MenuItem,{active:"spy"===t?.mode,onClick:()=>{n("spy"),r(!0)}},s().createElement(O.Glyphicon,{glyph:"search"}),s().createElement(x.Z,{msgId:"toc.spyGlass"})),s().createElement(O.MenuItem,{onClick:()=>{t.configuring||"LAYER"!==o?r(!1,"configuring"):r(!0,"configuring")}},s().createElement(O.Glyphicon,{glyph:"cog"}),s().createElement(x.Z,{msgId:"toc.configureTool"})))};q.propTypes={swipeSettings:H().object,status:H().string,onSetActive:H().func,onSetSwipeMode:H().func},q.defaultProps={status:"LAYER",onSetSwipeMode:()=>{},onSetActive:()=>{}};const B=q,U=e=>{let{mode:t,map:r,layer:n,active:o,swipeModeSettings:i,spyModeSettings:a}=e;return"spy"===t?s().createElement(W,{map:r,layer:n,active:o,radius:a.radius}):s().createElement(Y,{map:r,layer:n,active:o,type:i.direction})},X=(0,i.P1)([a.Iz,c.yn,c.wQ,c.IY],((e,t,r,n)=>({layer:e?.id,active:t.active||!1,swipeModeSettings:r,spyModeSettings:n,mode:t?.mode||"swipe"}))),J=(0,o.connect)(X,null)(U),K=(0,f.rx)("Swipe",{options:{disablePluginIf:"{state('mapType') === 'leaflet' || state('mapType') === 'cesium'}"},component:N,containers:{TOC:{name:"Swipe",target:"toolbar",selector:e=>{let{status:t}=e;return"LAYER"===t},Component:(0,o.connect)((0,i.P1)(c.yn,(e=>({swipeSettings:e}))),{onSetActive:y,onSetSwipeMode:function(){return{type:m,mode:arguments.length>0&&void 0!==arguments[0]?arguments[0]:"swipe"}}})(B)},Map:{name:"Swipe",Tool:J}},reducers:{swipe:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case u:return p()({},e,{[t.prop]:t.active});case m:return p()({},e,{mode:t.mode});case d:{const r={...e.swipe,direction:t.direction};return p()({},e,{swipe:r})}case g:{const r={...e.spy,radius:t.radius};return p()({},e,{spy:r})}default:return e}}},epics:h})},744448:(e,t,r)=>{"use strict";r.d(t,{yn:()=>n,IY:()=>s,wQ:()=>o});const n=e=>e.swipe&&e.swipe||{active:!1},s=e=>e?.swipe?.spy||{radius:80},o=e=>e?.swipe?.swipe||{direction:"cut-vertical"}}}]);