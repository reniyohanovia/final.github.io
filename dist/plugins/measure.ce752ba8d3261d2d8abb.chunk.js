(self.webpackChunkmapstore2=self.webpackChunkmapstore2||[]).push([[7706],{768977:(e,t,a)=>{"use strict";a.d(t,{Z:()=>d});var l=a(45697),r=a.n(l),o=a(124852),n=a.n(o),s=a(630294),m=a(222777);function p(){return p=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},p.apply(this,arguments)}function i(e,t,a){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var l=a.call(e,"string");if("object"!=typeof l)return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class c extends n().Component{render(){const{cardComponent:e,items:t,colProps:a,onItemClick:l,size:r}=this.props,o=e||m.Z;return n().createElement("div",{className:"msSideGrid"+(this.props.className?" "+this.props.className:"")},n().createElement(s.Row,{className:"items-list"},t.map(((e,t)=>n().createElement(s.Col,p({key:e.id||t},a),n().createElement(o,p({onClick:function(){for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return l(e,...a)},size:r},e)))))))}}i(c,"propTypes",{size:r().string,onItemClick:r().func,colProps:r().object,items:r().array,cardComponent:r().oneOfType([r().string,r().func]),className:r().string}),i(c,"defaultProps",{size:"",onItemClick:()=>{},colProps:{xs:12},className:"",items:[]});const d=c},51427:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>ye});var l={};a.r(l),a.d(l,{clearMapTemplatesEpic:()=>se,mergeTemplateEpic:()=>ie,openMapTemplatesEpic:()=>de,openMapTemplatesPanelEpic:()=>me,replaceTemplateEpic:()=>ce,setAllowedTemplatesEpic:()=>pe});var r=a(124852),o=a.n(r),n=a(227361),s=a.n(n),m=a(171703),p=a(630294),i=a(22222),c=a(152543),d=a(687753),u=a(27908);const f=e=>e.maptemplates&&e.maptemplates.templates,g=(0,i.P1)((e=>e.maptemplates&&e.maptemplates.allowedTemplates),u.zU,((e,t)=>e&&e.length>0?e:t||[]));var b=a(203842),v=a(804504),T=a(89518),h=a(756435),y=a(768977),E=a(8204),w=a(603754),S=a(16246),O=a(141919),C=a(486234),M=a(475897);const Z=(0,C.Z)("filterPlaceholder")(w.Z),P=(0,O.Z)((e=>{let{items:t=[]}=e;return 0===t.length}),(e=>{let{totalTemplateCount:t}=e;return{glyph:t?"filter":"ban-circle",title:o().createElement(v.Z,{msgId:t?"mapTemplates.emptyTitle":"mapTemplates.noTemplatesTitle"}),description:o().createElement(v.Z,{msgId:t?"mapTemplates.emptyDescription":"mapTemplates.noTemplatesDescription"})}}))((e=>{let{items:t=[],favouriteItems:a=[]}=e;const l=o().createElement("div",{className:"map-templates-favourites"},o().createElement("h4",null,o().createElement(v.Z,{msgId:"mapTemplates.favouritesTitle"})),o().createElement(y.Z,{size:"sm",items:a}),o().createElement("hr",null));return o().createElement(o().Fragment,null,a.length>0?l:null,o().createElement("div",{className:"map-templates-all"},a.length>0?o().createElement("h4",null,o().createElement(v.Z,{msgId:"mapTemplates.allTitle"})):null,o().createElement(y.Z,{items:t})))})),I=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return["name","description"].map((e=>t[e])).map((function(){return-1!==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").toLowerCase().indexOf(e.toLowerCase())})).reduce(((e,t)=>e||t),!1)},k=e=>{let{templates:t=[],onMergeTemplate:a=(()=>{}),onReplaceTemplate:l=(()=>{}),onToggleFavourite:n=(()=>{})}=e;const[s,m]=(0,r.useState)(""),[i,c]=(0,r.useState)(),[d,u]=(0,r.useState)(!1),f=(e,t)=>({template:e,title:e.name,description:e.description,loading:e.loading,style:{pointerEvents:"none"},preview:o().createElement("div",{className:"map-templates-preview"},e.thumbnail&&"NODATA"!==e.thumbnail?o().createElement("img",{src:decodeURIComponent(e.thumbnail)}):o().createElement(p.Glyphicon,{glyph:"1-map"})),infoExtra:e.format&&o().createElement("div",{className:"map-templates-formaticon"+(t?" map-templates-favourite":"")},o().createElement(p.Glyphicon,{glyph:M.Th[e.format]}),o().createElement("span",null,M.Nk[e.format])),tools:o().createElement(E.Z,{btnDefaultProps:{className:"square-button-md"},buttons:[{glyph:"transfer",bsStyle:"primary",tooltipId:"mapTemplates.transfer",onClick:t=>{t.stopPropagation(),c(e),u(!0)}},{glyph:"plus",bsStyle:"primary",tooltipId:"mapTemplates.merge",onClick:t=>{t.stopPropagation(),a(e.id,e.data)}},{glyph:e.favourite?"star":"star-empty",className:"square-button-md no-border",tooltipId:e.favourite?"mapTemplates.favouriteRemove":"mapTemplates.favouriteAdd",onClick:t=>{t.stopPropagation(),n(e.id)}}]})}),g=t.slice().sort(((e,t)=>e.name>t.name?1:e.name===t.name?0:-1)).filter(I.bind(null,s)),b=g.map((e=>f(e,!1))),T=g.filter((e=>e.favourite)).map((e=>f(e,!0)));return o().createElement(o().Fragment,null,o().createElement(h.Z,{className:"map-templates-panel",header:o().createElement("div",{style:{padding:"8px 15px"}},o().createElement(Z,{filterPlaceholder:"mapTemplates.filterPlaceholder",filterText:s,onFilter:m}))},o().createElement(P,{totalTemplateCount:t.length,items:b,favouriteItems:T})),o().createElement(S.Z,{modal:!0,show:d,title:o().createElement(v.Z,{msgId:"mapTemplates.confirmReplaceTitle"}),onClose:()=>{c(),u(!1)},onConfirm:()=>{l(i.id,i.data),c(),u(!1)},confirmButtonBSStyle:"default",confirmButtonContent:o().createElement(v.Z,{msgId:"mapTemplates.confirmReplaceConfirmButton"}),closeText:o().createElement(v.Z,{msgId:"cancel"}),closeGlyph:"1-close"},o().createElement(v.Z,{msgId:"mapTemplates.confirmReplaceMessage"})))};var x=a(521923),L=a(49977),N=a(478718),z=a.n(N),R=a(957557),A=a.n(R),D=a(513218),j=a.n(D),F=a(747037),B=a.n(F),G=a(701469),H=a.n(G),U=a(313311),X=a.n(U),$=a(150361),_=a.n($),q=a(835516),V=a(288287),J=a(504518),Q=a(510644),K=a(274363),W=a(612912),Y=a(4143),ee=a(57677),te=a(945395),ae=a(926854),le=a(426529),re=a(501797),oe=a(917450);const ne=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>{},a="context.errors.template.unknownError";return 403===e.status&&(a="context.errors.template.pleaseLogin",(0,Q.jl)(t())&&(a="context.errors.template.notAccessible")),404===e.status&&(a="context.errors.template.notFound"),a},se=e=>e.ofType(b.Ef).switchMap((()=>L.Observable.of((0,d.Xg)("mapTemplates","enabled",!1,!1)))),me=e=>e.ofType(b.pu).switchMap((()=>L.Observable.of((0,d.Xg)("mapTemplates","enabled",!0,!0)))),pe=(e,t)=>e.ofType(b.b9).switchMap((()=>{const e=t.getState(),a=g(e),l=e=>{const t=s()(e,"Attributes.attribute",{});return(H()(t)?t:[t]).reduce(((e,t)=>({...e,[t.name]:t.value})),{})};return a.length>0?L.Observable.defer((()=>V.Z.searchListByAttributes({OR:{FIELD:a.map((e=>({field:["ID"],operator:["EQUAL_TO"],value:[e.id]})))}},{params:{includeAttributes:!0}},"/resources/search/list"))).switchMap((e=>{const t=s()(e,"ResourceList.Resource",[]),a=(H()(t)?t:[t]).map((e=>({...z()(e,"id","name","description"),...l(e),dataLoaded:!1,loading:!1})));return L.Observable.of((0,b.T3)(a),(0,b.Sy)(!0))})).catch((e=>L.Observable.of((0,b.Sy)(!0,e)))):L.Observable.of((0,b.T3)([]),(0,b.Sy)(!0))})),ie=(e,t)=>e.ofType(b.JV).switchMap((e=>{let{id:a}=e;const l=t.getState(),r=f(l),o=X()(r,(e=>e.id===a));return(o.dataLoaded?L.Observable.of(o.data):L.Observable.defer((()=>V.Z.getData(a)))).switchMap((e=>{if(j()(e)&&void 0!==e.map||B()(e)){const t=(0,K.Od)(l),r=(0,W.l2)(l),n=(0,W.Bt)(l),s=(0,Y.Mz)(l),m=(0,ee.I)(l),p=(0,ee._)(l),i=(0,te.UC)(l),c=q.default.saveMapConfiguration(t,r,n,s,m,p,i);return(B()(e)?L.Observable.defer((()=>(0,re.H)(e,!1))):L.Observable.of(e)).switchMap((t=>L.Observable.of(...o.dataLoaded?[]:[(0,b.mS)(a,e)],(0,ae.H0)(_()(A()(q.default.mergeMapConfigs(c,q.default.addRootParentGroup(t,o.name)),"widgetsConfig")),null))))}return o.dataLoaded?L.Observable.empty():L.Observable.of((0,b.mS)(a,e))})).let((0,le.hP)((0,b.D$)(a,!0),(0,b.D$)(a,!1),(e=>{const a=ne(e.originalError||e,t.getState);return L.Observable.of((0,J.vU)({title:"context.errors.template.title",message:a,position:"tc",autoDismiss:5}))})))})),ce=(e,t)=>e.ofType(b.ef).switchMap((e=>{let{id:a}=e;const l=t.getState(),r=f(l),o=X()(r,(e=>e.id===a)),{zoom:n,center:s}=(0,K.Od)(l);return(o.dataLoaded?L.Observable.of(o.data):L.Observable.defer((()=>V.Z.getData(a)))).switchMap((e=>(B()(e)?L.Observable.defer((()=>(0,re.H)(e))):L.Observable.of(j()(e)&&void 0!==e.map?e:null)).switchMap((t=>L.Observable.of(...o.dataLoaded?[]:[(0,b.mS)(a,e)],...t?[(0,ae.H0)(_()({...t,map:{...t.map,zoom:t.map.zoom||n,center:t.map.center||s}}),null,!t.map.zoom&&(t.map.bbox||t.map.maxExtent))]:[]))))).let((0,le.hP)((0,b.D$)(a,!0),(0,b.D$)(a,!1),(e=>{const a=ne(e.originalError||e,t.getState);return L.Observable.of((0,J.vU)({title:"context.errors.template.title",message:a,position:"tc",autoDismiss:5}))})))})),de=(e,t)=>e.ofType(d.At,d.kM).filter((e=>{return"mapTemplates"===e.control&&(a=t.getState(),s()(a,"controls.mapTemplates.enabled"));var a})).switchMap((()=>L.Observable.of((0,oe.g)(),(0,oe.aN)())));var ue=a(350126),fe=a(45697),ge=a.n(fe),be=a(908316);function ve(e,t,a){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var l=a.call(e,"string");if("object"!=typeof l)return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Te extends o().Component{componentDidUpdate(e){const{active:t,allowedTemplates:a,onSetAllowedTemplates:l}=this.props,{active:r}=e;t!==r&&t&&l(a)}render(){const{active:e,templates:t,templatesLoaded:a,onToggleControl:l,onMergeTemplate:r,onReplaceTemplate:n,onToggleFavourite:s,dockStyle:m,size:p}=this.props;return o().createElement(be.Z,{containerStyle:m,containerId:"map-templates-container",containerClassName:"dock-container",className:"map-templates-dock-panel",open:e,position:"right",size:p,bsStyle:"primary",title:o().createElement(v.Z,{msgId:"mapTemplates.title"}),style:m,onClose:l},!a&&o().createElement("div",{className:"map-templates-loader"},o().createElement(T.Z,{size:352})),a&&o().createElement(k,{templates:t,onMergeTemplate:r,onReplaceTemplate:n,onToggleFavourite:s}))}}ve(Te,"propTypes",{active:ge().bool,templatesLoaded:ge().bool,templates:ge().array,allowedTemplates:ge().array,dockStyle:ge().object,onToggleControl:ge().func,onMergeTemplate:ge().func,onReplaceTemplate:ge().func,onToggleFavourite:ge().func,onSetAllowedTemplates:ge().func,size:ge().number}),ve(Te,"defaultProps",{active:!1,templatesLoaded:!1,templates:[],allowedTemplates:[],dockStyle:{},onToggleControl:()=>{},onMergeTemplate:()=>{},onReplaceTemplate:()=>{},onToggleFavourite:()=>{},onSetAllowedTemplates:()=>{},size:550});const he=(0,m.connect)((0,i.P1)((e=>(0,ue.ic)(e,{height:!0,right:!0},!0)),(e=>s()(e,"controls.mapTemplates.enabled")),f,(e=>e.maptemplates&&e.maptemplates.mapTemplatesLoaded),((e,t,a,l)=>({active:t,templates:a,templatesLoaded:l,dockStyle:e}))),{onToggleControl:d.Xi.bind(null,"mapTemplates","enabled"),onMergeTemplate:b.jl,onReplaceTemplate:b.xt,onToggleFavourite:b.pL,onSetAllowedTemplates:b.B7})(Te),ye=(0,c.rx)("MapTemplates",{component:he,containers:{BurgerMenu:{name:"MapTemplates",position:998,text:o().createElement(v.Z,{msgId:"mapTemplates.title"}),icon:o().createElement(p.Glyphicon,{glyph:"1-map"}),action:b.nF,priority:2,doNotHide:!0,tooltip:o().createElement(v.Z,{msgId:"mapTemplates.tooltip"})},SidebarMenu:{name:"mapTemplates",position:998,text:o().createElement(v.Z,{msgId:"mapTemplates.title"}),icon:o().createElement(p.Glyphicon,{glyph:"1-map"}),action:d.Xg.bind(null,"mapTemplates","enabled",!0,!0),toggle:!0,priority:1,doNotHide:!0,tooltip:"mapTemplates.tooltip"}},reducers:{maptemplates:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case b.Ef:return{};case b.N_:return(0,x.t8)("templates",t.templates,e);case b.b9:return(0,x.t8)("allowedTemplates",t.templates,e);case b.ip:{const a=s()(e,"templates",[]).map((e=>e.id===t.id?{...e,favourite:!e.favourite}:e));return(0,x.t8)("templates",a,e)}case b.kP:{const a=s()(e,"templates",[]).map((e=>e.id===t.id?{...e,data:t.data,dataLoaded:!0}:e));return(0,x.t8)("templates",a,e)}case b.iF:{const a=s()(e,"templates",[]).map((e=>e.id===t.id?{...e,loading:t.loadingValue}:e));return(0,x.t8)("templates",a,e)}case b.cH:return(0,x.t8)("mapTeplatesLoadError",t.error,(0,x.t8)("mapTemplatesLoaded",t.loaded,e));default:return e}}},epics:l})}}]);