(self.webpackChunkmapstore2=self.webpackChunkmapstore2||[]).push([[8098],{52855:(e,t,a)=>{"use strict";a.d(t,{Z:()=>i});var o=a(124852),r=a.n(o),l=a(630294);const n=(0,a(486234).Z)("placeholder")(l.FormControl),i=e=>{let{onSearchTextChange:t=(()=>{}),searchText:a,title:o,subTitle:i=null}=e;return r().createElement(l.Grid,{className:"catalog-form",fluid:!0},r().createElement(l.Row,null,r().createElement(l.Col,{xs:12},o&&r().createElement("h4",{className:"text-center"},o),i,r().createElement(l.FormGroup,{controlId:"catalog-form"},r().createElement(n,{type:"text",placeholder:"catalog.textSearchPlaceholder",value:a,onChange:e=>t(e.currentTarget.value)})))))}},768977:(e,t,a)=>{"use strict";a.d(t,{Z:()=>d});var o=a(45697),r=a.n(o),l=a(124852),n=a.n(l),i=a(630294),s=a(222777);function c(){return c=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},c.apply(this,arguments)}function p(e,t,a){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var o=a.call(e,"string");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class m extends n().Component{render(){const{cardComponent:e,items:t,colProps:a,onItemClick:o,size:r}=this.props,l=e||s.Z;return n().createElement("div",{className:"msSideGrid"+(this.props.className?" "+this.props.className:"")},n().createElement(i.Row,{className:"items-list"},t.map(((e,t)=>n().createElement(i.Col,c({key:e.id||t},a),n().createElement(l,c({onClick:function(){for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return o(e,...a)},size:r},e)))))))}}p(m,"propTypes",{size:r().string,onItemClick:r().func,colProps:r().object,items:r().array,cardComponent:r().oneOfType([r().string,r().func]),className:r().string}),p(m,"defaultProps",{size:"",onItemClick:()=>{},colProps:{xs:12},className:"",items:[]});const d=m},890032:(e,t,a)=>{"use strict";a.d(t,{Z:()=>l});var o=a(867076);const r=a(49977),l=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:()=>r.Observable.empty(),t=arguments.length>1?arguments[1]:void 0;return(0,o.mapPropsStream)((a=>{const{handler:l,stream:n}=(0,o.createEventHandler)(),{handler:i,stream:s}=(0,o.createEventHandler)();return a.combineLatest(function(e,t,a){let{dataProp:o="items",initialStreamDebounce:l=0,throttleTime:n=500}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return e.take(1).concat(e.debounceTime(l)).switchMap((e=>a(e,0).startWith({loading:!0}).concat(r.Observable.of({loading:!1})).concat(t.throttleTime(n).distinct().exhaustMap((t=>a(e,t).startWith({loading:!0}).concat(r.Observable.of({loading:!1}))))).scan(((e,t)=>{let{[o]:a,...r}=e,{[o]:l,...n}=t;return{[o]:l?[...a||[],...l]:a||[],...r,...n}})).map((e=>({...e}))))).catch((e=>r.Observable.of({loading:!1,error:e})))}(s,n,e,t).startWith({}),((e,t)=>({...e,...t,onLoadMore:l,loadFirst:i})))}))}},185936:(e,t,a)=>{"use strict";a.d(t,{Z:()=>n});var o=a(890032),r=a(867076),l=a(274335);const n=e=>{let{loadPage:t,scrollSpyOptions:a,loadStreamOptions:n,loadMoreStreamOptions:i,hasMore:s,isScrolled:c}=e;return(0,r.compose)((0,o.Z)(t,i),(0,r.defaultProps)({hasMore:s,isScrolled:c}),(0,l.Z)(a,n))}},274335:(e,t,a)=>{"use strict";a.d(t,{Z:()=>p});var o=a(124852),r=a.n(o),l=a(45697),n=a.n(l),i=a(180307),s=a.n(i);function c(e,t,a){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var o=a.call(e,"string");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}a(49977);const p=function(){let{dataProp:e="items",querySelector:t,closest:a=!1,loadingProp:o="loading",skip:l=0,pageSize:i=10,offsetSize:p=200}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return m=>{var d;return d=class extends r().Component{constructor(){super(...arguments),c(this,"findScrollDomNode",(()=>{if(!this.isMounded)return null;let e=s().findDOMNode(this);return e&&a&&t?e.closest(t||"*"):e&&(t?e.querySelector(t):e)})),c(this,"onScroll",(()=>{const t={skip:l,pageSize:i,offsetSize:p,...this.props.scrollOptions},a=this.findScrollDomNode();a&&this.props.isScrolled({div:a,offset:t.offsetSize})&&(!e||this.props[e]&&this.props[e].length)&&(!o||!this.props[o])&&this.props.hasMore(this.props)&&this.props.onLoadMore(e?Math.ceil((this.props[e].length-t.skip)/t.pageSize):null)}))}componentDidMount(){this.isMounded=!0;const e=this.findScrollDomNode();e&&(this.listenerAdded=!0,e.addEventListener("scroll",this.onScroll,!1),this.onScroll())}componentDidUpdate(t){const a=this.findScrollDomNode();a&&!this.listenerAdded&&(a.addEventListener("scroll",this.onScroll,!1),this.listenerAdded=!0),!a||e&&this.props[e]&&this.props[e]===t[e]||setTimeout((()=>this.onScroll()),300)}componentWillUnmount(){this.isMounded=!1,this.listenerAdded=!1;const e=this.findScrollDomNode();e&&e.removeEventListener("scroll",this.onScroll,!1)}render(){return r().createElement(m,this.props)}},c(d,"propTypes",{hasMore:n().func,onLoadMore:n().func,isScrolled:n().func,scrollOptions:n().object}),c(d,"defaultProps",{onLoadMore:()=>{},hasMore:()=>!0,isScrolled:e=>{let{div:t,offset:a}=e;return t.scrollTop+t.clientHeight>=t.scrollHeight-a}}),d}}},994074:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>ge});var o={};a.r(o),a.d(o,{deleteMapEpic:()=>ie,openMapCatalogEpic:()=>ce,saveMapEpic:()=>se});var r=a(124852),l=a.n(r),n=a(630294),i=a(171703),s=a(22222),c=a(687753);const p="MAPCATALOG:DELETE_MAP",m="MAPCATALOG:SAVE_MAP",d="MAPCATALOG:SET_FILTER_RELOAD_DELAY",u="MAPCATALOG:TRIGGER_RELOAD",g=e=>({type:d,delay:e}),h=()=>({type:u});var f=a(510644),b=a(101092),v=a(227361),y=a.n(v),S=a(45697),E=a.n(S),C=a(49977),T=a.n(C),O=a(701469),M=a.n(O),P=a(604788),w=a.n(P),D=a(471640),x=a.n(D),R=a(414293),N=a.n(R),Z=a(838169),A=a.n(Z),k=a(867076),j=a(679426),I=a(288287),L=a(185936),z=a(770165);function F(){return F=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},F.apply(this,arguments)}var G=a(804504),V=a(16246);function H(){return H=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},H.apply(this,arguments)}var B=a(130609);function $(){return $=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},$.apply(this,arguments)}const _=(0,a(626365).Z)(B.Z);var q=a(719648),U=a(8204),W=a(603754),X=a(756435),Y=a(141919),J=a(554155),K=a(52713),Q=a(52855);const ee=(0,k.compose)((0,J.Z)((e=>{let{loading:t,items:a=[]}=e;return 0===a.length&&t})),(0,Y.Z)((e=>{let{loading:t,items:a=[]}=e;return 0===a.length&&!t}),{title:l().createElement(G.Z,{msgId:"catalog.noRecordsMatched"}),style:{transform:"translateY(50%)"}}))(a(768977).Z),te=e=>{let{setSearchText:t=(()=>{}),selected:a,skip:o=0,onSelected:r,loading:n,searchText:i,items:s=[],loaderProps:c={},total:p,header:m,title:d=l().createElement(G.Z,{msgId:"maps.title"})}=e;return l().createElement(X.Z,{className:"map-catalog",header:m||l().createElement(Q.Z,{title:d,searchText:i,onSearchTextChange:t}),footer:l().createElement("div",{className:"catalog-footer"},n&&s.length>0?l().createElement(K.Z,null):null,N()(p)?null:l().createElement("span",{className:"res-info"},l().createElement(G.Z,{msgId:"catalog.pageInfoInfinite",msgParams:{loaded:s.length-o,total:p}})))},l().createElement(ee,{loaderProps:c,items:s.map((e=>e===a||a&&e&&e.map&&a.id===e.map.id?{...e,selected:!0}:e)),loading:n,onItemClick:function(){let{map:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r(e)}}))},ae=(0,k.compose)((0,k.getContext)({messages:E().object,router:E().object}),(0,L.Z)({loadPage:function(){let{searchText:e="",limit:t=12}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(e=>{let{searchText:t,opts:a}=e;return T().Observable.defer((()=>I.Z.getResourcesByCategory("MAP",t||"*",a))).switchMap((e=>(e=>{let{results:t,...a}=e;const o=M()(t)?t:""===t?[]:[t];return 0===o.length?T().Observable.of({results:t,...a}):T().Observable.forkJoin(o.map((e=>{let{context:t}=e;return t?(0,j.RX)(t,{includeAttributes:!1,withData:!1,withPermissions:!1}).switchMap((e=>T().Observable.of(e.name))).catch((()=>T().Observable.of(null))):T().Observable.of(null)}))).map((e=>({results:w()(o,e).map((e=>{let[t,a]=e;return{...t,contextName:a}})),...a})))})(e))).map((e=>({items:e.results,total:e.totalCount,loading:!1}))).catch((()=>T().Observable.of({items:[],total:0,loading:!1})))})({searchText:e,opts:{params:{includeAttributes:!0,start:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:0)*t,limit:t}}})},loadMoreStreamOptions:{initialStreamDebounce:300},scrollSpyOptions:{querySelector:".map-catalog-panel > .map-catalog > .ms2-border-layout-body",pageSize:12},hasMore:e=>{let{items:t=[],total:a=0}=e;return t.length<a}}),(e=>t=>{let{triggerReloadValue:a=!1,filterReloadDelay:o=0,setFilterReloadDelay:r=(()=>{}),onTriggerReload:n=(()=>{}),loadFirst:i=(()=>{}),...s}=t;const[c,p]=l().useState("");return l().useEffect((()=>{setTimeout((()=>{i({searchText:c})}),o||0)}),[c,a,i]),l().createElement(e,F({},s,{filterText:c,onFilter:(e,t)=>{r(t),p(e)},onReloadFilter:e=>{r(e),n()}}))}),(e=>t=>{let{onDelete:a=(()=>{}),...o}=t;const[r,n]=l().useState(!1),[i,s]=l().useState();return l().createElement(l().Fragment,null,l().createElement(e,H({},o,{onDelete:e=>{s(e),n(!0)}})),l().createElement(V.Z,{draggable:!1,modal:!0,show:r,onClose:()=>{s(),n(!1)},onConfirm:()=>{n(!1),a(i),s()},confirmButtonBSStyle:"default",confirmButtonContent:l().createElement(G.Z,{msgId:"confirm"}),closeText:l().createElement(G.Z,{msgId:"cancel"}),closeGlyph:"1-close"},l().createElement(G.Z,{msgId:"mapCatalog.deleteConfirmContent",msgParams:{mapName:i?.name}})))}),(e=>t=>{let{user:a,saveDialogTitle:o="resources.resource.editResource",onSave:r=(()=>{}),...n}=t;const[i,s]=l().useState(!1),[c,p]=l().useState();return l().createElement(l().Fragment,null,l().createElement(e,$({},n,{onEdit:e=>{p(e),s(!0)}})),l().createElement(_,{show:i,user:a,resource:c&&{...c,...c.thumbnail?{attributes:{...c.attributes||{},thumbnail:c.thumbnail,context:c.context}}:{}},clickOutEnabled:!1,category:"MAP",title:o,onSave:e=>{r(e),p(),s(!1)},onClose:()=>{p(),s(!1)}}))}),z.Z)((e=>{let{loading:t,mapType:a,items:o=[],filterText:r,onFilter:i=(()=>{}),onDelete:s=(()=>{}),onEdit:c=(()=>{}),onShare:p=(()=>{}),messages:m={},router:d={},toggleCatalog:u=(()=>{}),reloadFunction:g=A()(window.location.reload,window.location)}=e;return l().createElement("div",{className:"map-catalog-panel"},l().createElement(te,{loading:t,loaderProps:{width:480,height:480},header:l().createElement(W.Z,{filterText:r,filterPlaceholder:(0,q.S$)(m,"mapCatalog.filterPlaceholder"),onFilter:i}),items:o.map((e=>({title:e.name,description:e.description,tools:l().createElement(U.Z,{btnDefaultProps:{className:"square-button-md"},buttons:[{glyph:"trash",bsStyle:"primary",tooltipId:"mapCatalog.tooltips.delete",visible:e.canDelete,onClick:t=>{t.stopPropagation(),s(e)}},{glyph:"wrench",bsStyle:"primary",tooltipId:"mapCatalog.tooltips.edit",visible:e.canEdit,onClick:t=>{t.stopPropagation(),c(e)}},{glyph:"share-alt",bsStyle:"primary",className:"square-button-md",tooltipId:"mapCatalog.tooltips.share",onClick:t=>{t.stopPropagation(),p(e)}}]}),preview:l().createElement("div",{className:"map-catalog-preview"},e.thumbnail&&"NODATA"!==e.thumbnail?l().createElement("img",{src:decodeURIComponent(e.thumbnail)}):l().createElement(n.Glyphicon,{glyph:"1-map"})),onClick:()=>((e,t,a,o,r)=>{o();const{location:l}=t.history;N()(l.pathname)||e.contextName!==x()(l.pathname,"/")[2]||e.id!==Number(x()(l.pathname,"/")[3])?t.history.push(e.contextName?"/context/"+e.contextName+"/"+e.id:"/viewer/"+a+"/"+e.id):r()})(e,d,a,u,g)})))}))}));var oe=a(152543),re=a(521923),le=a(425589),ne=a(917450);const ie=e=>e.ofType(p).switchMap((e=>{let{resource:t}=e;return(0,j.fg)(t).switchMap((()=>T().Observable.of((0,le.c)({title:"mapCatalog.deletedMap.title",message:"mapCatalog.deletedMap.message",autoDismiss:6,position:"tc"}),g(700),h()))).catch((()=>T().Observable.of((0,le.d)({message:"mapCatalog.deleteError"}))))})),se=e=>e.ofType(m).switchMap((e=>{let{resource:t}=e;return(0,j.id)(t).switchMap((()=>T().Observable.of((0,le.c)({title:"mapCatalog.updatedMap.title",message:"mapCatalog.updatedMap.message",autoDismiss:6,position:"tc"}),g(700),h()))).catch((()=>T().Observable.of((0,le.d)({message:"mapCatalog.updateError"}))))})),ce=(e,t)=>e.ofType(c.At,c.kM).filter((e=>{return"mapCatalog"===e.control&&(a=t.getState(),y()(a,"controls.mapCatalog.enabled"));var a})).switchMap((()=>T().Observable.of((0,ne.g)(),(0,ne.aN)())));var pe=a(350126),me=a(908316);function de(e,t,a){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var o=a.call(e,"string");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class ue extends l().Component{render(){const{allow3d:e,active:t,mapType:a,user:o,triggerReloadValue:r,filterReloadDelay:n,onToggleControl:i,onTriggerReload:s,onDelete:c,onSave:p,dockStyle:m,size:d,...u}=this.props;return l().createElement(me.Z,{containerStyle:m,containerId:"map-catalog-container",containerClassName:"dock-container",className:"map-catalog-dock-panel",open:t,position:"right",size:d,bsStyle:"primary",glyph:"maps-catalog",title:l().createElement(G.Z,{msgId:"mapCatalog.title"}),onClose:()=>i(),style:m},l().createElement(ae,{mapType:a,user:o,triggerReloadValue:r,filterReloadDelay:n,setFilterReloadDelay:u.setFilterReloadDelay,onTriggerReload:s,onDelete:c,onSave:p,getShareUrl:e=>e.contextName?`context/${e.contextName}/${e.id}`:`viewer/${a}/${e.id}`,toggleCatalog:()=>i(),shareApi:!0}))}}de(ue,"propTypes",{allow3d:S.any,active:S.any,mapType:S.any,user:S.any,triggerReloadValue:S.any,filterReloadDelay:S.any,onToggleControl:S.func,onTriggerReload:S.func,onDelete:S.func,onSave:S.func,dockStyle:S.object,size:S.number}),de(ue,"defaultProps",{onToggleControl:()=>{},onTriggerReload:()=>{},onDelete:()=>{},onSave:()=>{},dockStyle:{},size:550});const ge=(0,oe.rx)("MapCatalog",{component:(0,i.connect)((0,s.zB)({active:e=>e.controls&&e.controls.mapCatalog&&e.controls.mapCatalog.enabled,mapType:e=>(0,b.c0)(e)?(0,b.tH)(e):(0,b.$v)(e),user:f.np,triggerReloadValue:e=>e.mapcatalog?.triggerReloadValue,filterReloadDelay:e=>e.mapcatalog?.filterReloadDelay,dockStyle:e=>(0,pe.ic)(e,{height:!0,right:!0},!0)}),{setFilterReloadDelay:g,onToggleControl:c.Xi.bind(null,"mapCatalog","enabled"),onTriggerReload:h,onDelete:e=>({type:p,resource:e}),onSave:e=>({type:m,resource:e})})(ue),containers:{BurgerMenu:{name:"mapCatalog",position:6,text:l().createElement(G.Z,{msgId:"mapCatalog.title"}),icon:l().createElement(n.Glyphicon,{glyph:"maps-catalog"}),tooltip:"mapCatalog.tooltip",action:()=>(0,c.Xi)("mapCatalog","enabled"),priority:2,doNotHide:!0},SidebarMenu:{name:"mapCatalog",position:6,icon:l().createElement(n.Glyphicon,{glyph:"maps-catalog"}),text:l().createElement(G.Z,{msgId:"mapCatalog.title"}),tooltip:"mapCatalog.tooltip",action:()=>(0,c.Xi)("mapCatalog","enabled"),toggle:!0,priority:1,doNotHide:!0}},reducers:{mapcatalog:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case d:return(0,re.t8)("filterReloadDelay",t.delay,e);case u:return(0,re.t8)("triggerReloadValue",!e.triggerReloadValue,e);default:return e}}},epics:o})},838169:(e,t,a)=>{var o=a(105976),r=a(497727),l=a(720893),n=a(846460),i=o((function(e,t,a){var o=1;if(a.length){var s=n(a,l(i));o|=32}return r(e,o,t,a,s)}));i.placeholder={},e.exports=i}}]);