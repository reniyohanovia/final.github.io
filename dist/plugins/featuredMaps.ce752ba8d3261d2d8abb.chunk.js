(self.webpackChunkmapstore2=self.webpackChunkmapstore2||[]).push([[5075],{890032:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});var o=r(867076);const n=r(49977),s=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:()=>n.Observable.empty(),t=arguments.length>1?arguments[1]:void 0;return(0,o.mapPropsStream)((r=>{const{handler:s,stream:a}=(0,o.createEventHandler)(),{handler:i,stream:l}=(0,o.createEventHandler)();return r.combineLatest(function(e,t,r){let{dataProp:o="items",initialStreamDebounce:s=0,throttleTime:a=500}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return e.take(1).concat(e.debounceTime(s)).switchMap((e=>r(e,0).startWith({loading:!0}).concat(n.Observable.of({loading:!1})).concat(t.throttleTime(a).distinct().exhaustMap((t=>r(e,t).startWith({loading:!0}).concat(n.Observable.of({loading:!1}))))).scan(((e,t)=>{let{[o]:r,...n}=e,{[o]:s,...a}=t;return{[o]:s?[...r||[],...s]:r||[],...n,...a}})).map((e=>({...e}))))).catch((e=>n.Observable.of({loading:!1,error:e})))}(l,a,e,t).startWith({}),((e,t)=>({...e,...t,onLoadMore:s,loadFirst:i})))}))}},185936:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});var o=r(890032),n=r(867076),s=r(274335);const a=e=>{let{loadPage:t,scrollSpyOptions:r,loadStreamOptions:a,loadMoreStreamOptions:i,hasMore:l,isScrolled:c}=e;return(0,n.compose)((0,o.Z)(t,i),(0,n.defaultProps)({hasMore:l,isScrolled:c}),(0,s.Z)(r,a))}},274335:(e,t,r)=>{"use strict";r.d(t,{Z:()=>p});var o=r(124852),n=r.n(o),s=r(45697),a=r.n(s),i=r(180307),l=r.n(i);function c(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,"string");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}r(49977);const p=function(){let{dataProp:e="items",querySelector:t,closest:r=!1,loadingProp:o="loading",skip:s=0,pageSize:i=10,offsetSize:p=200}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return m=>{var d;return d=class extends n().Component{constructor(){super(...arguments),c(this,"findScrollDomNode",(()=>{if(!this.isMounded)return null;let e=l().findDOMNode(this);return e&&r&&t?e.closest(t||"*"):e&&(t?e.querySelector(t):e)})),c(this,"onScroll",(()=>{const t={skip:s,pageSize:i,offsetSize:p,...this.props.scrollOptions},r=this.findScrollDomNode();r&&this.props.isScrolled({div:r,offset:t.offsetSize})&&(!e||this.props[e]&&this.props[e].length)&&(!o||!this.props[o])&&this.props.hasMore(this.props)&&this.props.onLoadMore(e?Math.ceil((this.props[e].length-t.skip)/t.pageSize):null)}))}componentDidMount(){this.isMounded=!0;const e=this.findScrollDomNode();e&&(this.listenerAdded=!0,e.addEventListener("scroll",this.onScroll,!1),this.onScroll())}componentDidUpdate(t){const r=this.findScrollDomNode();r&&!this.listenerAdded&&(r.addEventListener("scroll",this.onScroll,!1),this.listenerAdded=!0),!r||e&&this.props[e]&&this.props[e]===t[e]||setTimeout((()=>this.onScroll()),300)}componentWillUnmount(){this.isMounded=!1,this.listenerAdded=!1;const e=this.findScrollDomNode();e&&e.removeEventListener("scroll",this.onScroll,!1)}render(){return n().createElement(m,this.props)}},c(d,"propTypes",{hasMore:a().func,onLoadMore:a().func,isScrolled:a().func,scrollOptions:a().object}),c(d,"defaultProps",{onLoadMore:()=>{},hasMore:()=>!0,isScrolled:e=>{let{div:t,offset:r}=e;return t.scrollTop+t.clientHeight>=t.scrollHeight-r}}),d}}},897038:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>se});var o=r(124852),n=r.n(o),s=r(45697),a=r.n(s),i=r(727418),l=r.n(i),c=r(867076),p=r(22222),m=r(171703),d=r(630294),u=r(371714),h=r(804504),g=r(865029),f=r(510644),v=r(522073),b=r(101092),S=r(970218),E=r(227361),y=r.n(E),T=r(701469),w=r.n(T),O=r(618446),M=r.n(O),P=r(513218),x=r.n(P),N=r(604788),z=r.n(N),I=r(49977),A=r.n(I),D=r(288287),C=r(679426);const k=e=>{const t=y()(e,"Attributes.attribute"),r=w()(t)&&t||x()(t)&&[t];return r&&r.reduce(((e,t)=>({...e,[t.name]:t.value})),{})||{}},Z=e=>{switch(y()(e,"category.name")){case"MAP":return"1-map";case"DASHBOARD":return"dashboard";case"GEOSTORY":return"geostory";case"CONTEXT":return"map-context";default:return null}},L=e=>{let{result:t={},permission:r}=e;return{items:(t.Resource||[]).map((function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{id:e.id,name:e.name,category:e.category,icon:Z(e),canCopy:r,canDelete:r,canEdit:r,creation:e.creation,description:e.description,lastUpdate:e.lastUpdate,...k(e),contextName:e.contextName,owner:e.owner,featured:"added",featuredEnabled:!0}})),total:t&&t.ResourceCount?t.ResourceCount:0,loading:!1}},R=(0,c.compose)((0,c.withState)("viewSize","onChangeSize",4),(0,c.withState)("previousItems","onUpdatePreviousItems",[]),(0,c.lifecycle)({componentWillUpdate(e){const{items:t=[],pageSize:r=4,onChangeSize:o=(()=>{}),previousItems:n,onUpdatePreviousItems:s=(()=>{})}=this.props;M()(e.items,t)?n&&1===n.length&&0===e.items.length&&s(null):(s(t),e.items.length>0?o(Math.ceil(e.items.length/r)*r):0===e.items.length&&"*"!==e.searchText&&e.searchText&&s(null))}}));var U=r(185936),j=r(890032),F=r(89518),W=r(23888);const H=e=>{let{items:t=[],total:r=0,loading:o,skip:s=0,pageSize:a=4,onLoadMore:i=(()=>{})}=e;return n().createElement(d.Row,{className:"ms-show-more"},n().createElement(d.Col,{xs:12,className:"text-center"},o?n().createElement(F.Z,{size:26,style:{margin:"8px auto"}}):n().createElement("div",{style:{height:26,width:26,margin:"8px auto"}}),r>0&&t.length<r&&n().createElement(W.Z,{bsSize:"sm",bsStyle:"primary",disabled:o,onClick:()=>i(Math.ceil((t.length-s)/a))},o?n().createElement(h.Z,{msgId:"loading"}):n().createElement(h.Z,{msgId:"showMore"}))),n().createElement(d.Col,{xs:12},n().createElement("h5",null,o?n().createElement(h.Z,{msgId:"loading"}):n().createElement(h.Z,{msgId:"pageInfoShowMore",msgParams:{count:t.length+"",total:r+""}}))))};function B(){return B=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},B.apply(this,arguments)}var G=r(36549),X=r(770154),$=r(59787),_=r(521923);var q=r(962565),V=r(260817),Y=r(372492);function Q(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,"string");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const J=(0,G.Z)(d.NavItem);class K extends n().Component{constructor(){super(...arguments),Q(this,"getShareOptions",(e=>{const t=e.category?.name,r=this.props.shareOptions&&t&&this.props.shareOptions[t.toLowerCase()];return"GEOSTORY"===t?r||V.LQ:"MAP"===t?r||{embedPanel:!0}:"DASHBOARD"===t?r||V.Wk:"CONTEXT"===t?r||V.H4:{embedPanel:!1}})),Q(this,"makeShareUrl",(e=>e.category&&"DASHBOARD"===e.category.name?{url:`dashboard/${e.id}`,shareApi:!1}:e.category&&"GEOSTORY"===e.category.name?{url:`geostory/${e.id}`,shareApi:!1}:e.category&&"CONTEXT"===e.category.name?{url:`context/${e.name}`,shareApi:!1}:{url:e.contextName?"context/"+e.contextName+"/"+e.id:"viewer/"+this.props.mapType+"/"+e.id,shareApi:this.props.showAPIShare}))}UNSAFE_componentWillMount(){this.props.enableFeaturedMaps(!0)}render(){const e=this.props.items.length>0&&this.props.items||this.props.previousItems||[];return n().createElement(X.Z,{id:"ms-featured-maps",fluid:this.props.fluid,className:this.props.className,title:n().createElement("h3",null,n().createElement(h.Z,{msgId:"manager.featuredMaps"})),resources:e,colProps:this.props.colProps,version:this.props.version,viewerUrl:e=>this.context.router.history.push("/"+this.makeShareUrl(e).url),getShareUrl:this.makeShareUrl,shareOptions:this.getShareOptions,shareToolEnabled:this.props.shareToolEnabled,editDataEnabled:e=>"CONTEXT"===e?.category?.name,onEditData:this.props.onEditData,bottom:this.props.bottom,style:0===e.length?{display:"none"}:{}})}}Q(K,"propTypes",{mapType:a().string,items:a().array,colProps:a().object,fluid:a().bool,bottom:a().node,className:a().string,previousItems:a().array,enableFeaturedMaps:a().func,version:a().string,showAPIShare:a().bool,shareOptions:a().object,shareToolEnabled:a().bool,onEditData:a().func}),Q(K,"contextTypes",{router:a().object}),Q(K,"defaultProps",{shareToolEnabled:!0,onEditData:()=>{}});const ee=(0,p.P1)([b.$v,f.L3,e=>e.browser&&e.browser.mobile,S.e8,S.hW,S.fE,v.versionSelector],((e,t,r,o,n,s,a)=>({mapType:e,role:t,permission:"ADMIN"===t,pagination:r?"virtual-scroll-horizontal":"show-more",searchText:o,invalidate:n,isFeaturedEnabled:s,version:a}))),te=(0,c.mapPropsStream)((e=>e.merge(e.take(1).switchMap((t=>{let{searchText:r="",permission:o,viewSize:n,pageSize:s,loadFirst:a=(()=>{})}=t;return e.startWith({searchText:r,permission:o,viewSize:n,pageSize:s,loading:!0}).distinctUntilChanged(((e,t)=>e.invalidate===t.invalidate&&e.searchText===t.searchText&&e.permission===t.permission&&e.role===t.role)).do((function(){let{permission:e,viewSize:t,searchText:r,pageSize:o}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a({permission:e,viewSize:t,searchText:r,pageSize:o})})).ignoreElements()}))))),re=(0,c.compose)((0,m.connect)(ee,{enableFeaturedMaps:u.g6,onEditData:e=>"CONTEXT"===e?.category?.name?(0,Y.ix)(e):()=>{}}),(0,c.defaultProps)({mapType:"leaflet",onGoToMap:()=>{},fluid:!1,mapsOptions:{start:0,limit:12},colProps:{xs:12,sm:6,lg:3,md:4,className:"ms-map-card-col"},showAPIShare:!0,items:[],pageSize:4,skip:0,total:0,viewSize:4,onChangeSize:()=>{},onLoadMore:()=>{},loading:!1,className:"",previousItems:[],searchText:""}),(e=>{let{loadPage:t,pageSize:r,scrollSpyOptions:o={querySelector:".ms-grid"}}=e;return(0,c.compose)((0,c.branch)((function(){let{pagination:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return"show-more"===e}),(e=>(0,j.Z)(t)((t=>n().createElement(e,B({},t,{bottom:n().createElement(H,t)})))))),(0,c.branch)((function(){let{pagination:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return"virtual-scroll-horizontal"===e}),(e=>(0,U.Z)({loadPage:t,scrollSpyOptions:{...o,pageSize:r},isScrolled:e=>{let{div:t,offset:r}=e;return t.scrollLeft+t.clientWidth>=t.scrollWidth-r},hasMore:e=>{let{total:t,items:r}=e;return r.length<t}})((t=>n().createElement(e,B({},t,{className:(t.className||"")+" ms-grid-horizontal",bottom:n().createElement(d.Row,null,n().createElement(d.Col,{xs:12},n().createElement("h5",null,t.loading?n().createElement(h.Z,{msgId:"loading"}):n().createElement(h.Z,{msgId:"pageInfoShowMore",msgParams:{count:t.items&&t.items.length,total:t.total}}))))})))))))})({loadPage:function(){let{permission:e,viewSize:t=4,searchText:r="",pageSize:o=4}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const o=r&&"*"!==r?{FIELD:[{field:["NAME"],operator:["ILIKE"],value:["%"+r+"%"]}]}:{},n=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2?arguments[2]:void 0;return{...e,ExtResourceList:{...e.ExtResourceList,Resource:r?z()(t,r).map((e=>{let[t,r]=e;return{...t,contextName:r}})):t}}};return A().Observable.fromPromise(D.Z.searchListByAttributes({AND:{...o,ATTRIBUTE:[{name:["featured"],operator:["EQUAL_TO"],type:["STRING"],value:[!0]}]}},{params:{includeAttributes:!0,start:e,limit:t}}).then((e=>e))).switchMap((e=>(e=>{const t=y()(e,"ExtResourceList.Resource",[]),r=(w()(t)?t:[t]).map((e=>({...e,...k(e)})));return 0===r.length?A().Observable.of(n(e,r)):A().Observable.forkJoin(r.map((e=>{let{context:t}=e;return t?(0,C.RX)(t,{includeAttributes:!1,withData:!1,withPermissions:!1}).switchMap((e=>A().Observable.of(e.name))).catch((()=>A().Observable.of(null))):A().Observable.of(null)}))).map((t=>n(e,r,t)))})(e))).catch((()=>A().Observable.of(null)))}(n*o,0===n?t:o,r).map((t=>({permission:e,result:t&&t.ExtResourceList||[]}))).map(L)},pageSize:4}),R,te)(K),oe=(0,m.connect)(ee)((e=>{let{isFeaturedEnabled:t}=e;return t?n().createElement(d.NavItem,{target:"_blank",onClick:()=>(0,$.m)("ms-featured-maps")},n().createElement(h.Z,{msgId:"manager.featuredMaps"})):null})),ne=(0,m.connect)(ee)((e=>{let{isFeaturedEnabled:t}=e;return t?n().createElement(J,{target:"_blank",tooltip:n().createElement(h.Z,{msgId:"manager.featuredMaps"}),tooltipPosition:"bottom",onClick:()=>(0,$.m)("ms-featured-maps")},n().createElement(d.Glyphicon,{glyph:"star"})):null})),se={FeaturedMapsPlugin:l()(re,{NavMenu:{position:1,labelComponent:n().createElement(oe,{key:"featured-maps-label"}),iconComponent:n().createElement(ne,{key:"featured-maps-icon"})}}),epics:{...g.ZP},reducers:{featuredmaps:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case u.hU:return{...e,searchText:t.searchText};case u.VZ:return(0,_.t8)("enabled",t.enabled,e);case u.dL:return(0,_.t8)("invalidate",!e.invalidate,e);default:return e}},maptype:q.Z}}},59787:(e,t,r)=>{"use strict";r.d(t,{m:()=>o});const o=e=>{const t=document.getElementById(e);t&&t.scrollIntoView&&t.scrollIntoView({behavior:"smooth",block:"start"})}}}]);