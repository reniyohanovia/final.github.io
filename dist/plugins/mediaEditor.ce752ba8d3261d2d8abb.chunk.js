(self.webpackChunkmapstore2=self.webpackChunkmapstore2||[]).push([[8249],{768977:(e,t,r)=>{"use strict";r.d(t,{Z:()=>p});var i=r(45697),a=r.n(i),o=r(124852),d=r.n(o),n=r(630294),s=r(222777);function l(){return l=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},l.apply(this,arguments)}function c(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class m extends d().Component{render(){const{cardComponent:e,items:t,colProps:r,onItemClick:i,size:a}=this.props,o=e||s.Z;return d().createElement("div",{className:"msSideGrid"+(this.props.className?" "+this.props.className:"")},d().createElement(n.Row,{className:"items-list"},t.map(((e,t)=>d().createElement(n.Col,l({key:e.id||t},r),d().createElement(o,l({onClick:function(){for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return i(e,...r)},size:a},e)))))))}}c(m,"propTypes",{size:a().string,onItemClick:a().func,colProps:a().object,items:a().array,cardComponent:a().oneOfType([a().string,a().func]),className:a().string}),c(m,"defaultProps",{size:"",onItemClick:()=>{},colProps:{xs:12},className:"",items:[]});const p=m},274335:(e,t,r)=>{"use strict";r.d(t,{Z:()=>c});var i=r(124852),a=r.n(i),o=r(45697),d=r.n(o),n=r(180307),s=r.n(n);function l(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}r(49977);const c=function(){let{dataProp:e="items",querySelector:t,closest:r=!1,loadingProp:i="loading",skip:o=0,pageSize:n=10,offsetSize:c=200}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return m=>{var p;return p=class extends a().Component{constructor(){super(...arguments),l(this,"findScrollDomNode",(()=>{if(!this.isMounded)return null;let e=s().findDOMNode(this);return e&&r&&t?e.closest(t||"*"):e&&(t?e.querySelector(t):e)})),l(this,"onScroll",(()=>{const t={skip:o,pageSize:n,offsetSize:c,...this.props.scrollOptions},r=this.findScrollDomNode();r&&this.props.isScrolled({div:r,offset:t.offsetSize})&&(!e||this.props[e]&&this.props[e].length)&&(!i||!this.props[i])&&this.props.hasMore(this.props)&&this.props.onLoadMore(e?Math.ceil((this.props[e].length-t.skip)/t.pageSize):null)}))}componentDidMount(){this.isMounded=!0;const e=this.findScrollDomNode();e&&(this.listenerAdded=!0,e.addEventListener("scroll",this.onScroll,!1),this.onScroll())}componentDidUpdate(t){const r=this.findScrollDomNode();r&&!this.listenerAdded&&(r.addEventListener("scroll",this.onScroll,!1),this.listenerAdded=!0),!r||e&&this.props[e]&&this.props[e]===t[e]||setTimeout((()=>this.onScroll()),300)}componentWillUnmount(){this.isMounded=!1,this.listenerAdded=!1;const e=this.findScrollDomNode();e&&e.removeEventListener("scroll",this.onScroll,!1)}render(){return a().createElement(m,this.props)}},l(p,"propTypes",{hasMore:d().func,onLoadMore:d().func,isScrolled:d().func,scrollOptions:d().object}),l(p,"defaultProps",{onLoadMore:()=>{},hasMore:()=>!0,isScrolled:e=>{let{div:t,offset:r}=e;return t.scrollTop+t.clientHeight>=t.scrollHeight-r}}),p}}},847911:(e,t,r)=>{"use strict";r.d(t,{Z:()=>l});var i=r(124852),a=r.n(i),o=r(45697),d=r.n(o),n=r(23279),s=r.n(n);const l=(e,t)=>r=>{function o(o){const d=(0,i.useRef)(),[n,l]=(0,i.useState)(o[t]),c=(0,i.useRef)();c.current=n,(0,i.useEffect)((()=>{if(c.current!==o[t]){l(o[t]);const r=o[`${e}NoDebounce`];r&&r(o[t])}}),[o[t]]),(0,i.useEffect)((()=>(d.current=s()((t=>{let{newProps:r,newValue:i}=t;r[e](i)}),o.debounceTime),()=>{d.current.cancel()})),[o.debounceTime]);const m={...o,[t]:n,[e]:function(t){l(t);const r=o[`${e}NoDebounce`];r&&r(t),d.current&&(d.current.cancel(),d.current({newProps:o,newValue:t}))}};return a().createElement(r,m)}return o.propTypes={debounceTime:d().number},o.defaultProps={debounceTime:300},o.displayName=r.displayName+"WithDebounceOnCallback",o}},500023:(e,t,r)=>{"use strict";r.d(t,{Z:()=>o});var i=r(740292),a=r(867076);const o=(0,a.compose)((0,a.withHandlers)({onMapViewChanges:e=>{let{onChange:t=(()=>{})}=e;return e=>{t("maps",e),t("mapStateSource",e.mapStateSource)}}}))(i.Z)},294273:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>Et});var i={};r.r(i),r.d(i,{create:()=>C});var a={};r.r(a),r.d(a,{getData:()=>N,load:()=>A});var o={};r.r(o),r.d(o,{editRemoteMap:()=>Q,editorSaveUpdateMediaEpic:()=>H,importInLocalSource:()=>Y,loadMediaEditorDataEpic:()=>B,mediaEditorEditMap:()=>W,mediaEditorNewMap:()=>$,reloadMediaResources:()=>V,removeMediaEpic:()=>K,setMediaTypeOnDisable:()=>_,updateSelectedItem:()=>X});var d=r(171703),n=r(22222),s=r(152543),l=r(554915),c=r(49977),m=r(455877),p=r.n(m),u=r(270894),g=r.n(u),y=r(545542),E=r(694552),h=r(400043),v=r(927658),b=r(607739),f=r.n(b),T=r(219002),S=r(796205);const M=e=>{let{store:t}=e;return e=>{let{mediaType:r,source:i,data:a}=e;return c.Observable.of(p()()).do((e=>t.dispatch((0,T.rp)(e,r,a)))).map((e=>({id:e,mediaType:r,data:a,source:i})))}},I=e=>{let{store:t}=e;return e=>{let{mediaType:r,source:i,data:a}=e;const o=t.getState(),d=(0,E.jR)(o);return c.Observable.of(d).do((()=>t.dispatch((0,T.zJ)(d,r,a)))).map((()=>({id:d,mediaType:r,data:a,source:i})))}},P=e=>{let{store:t}=e;return e=>{let{mediaType:r,params:i}=e;const a=(0,S.jq)(t.getState()).length?f()((0,S.jq)(t.getState()),"type"):{},{page:o,pageSize:d}=i,n=o*d,s=i.q||"",l=(0,h.Aq)(a[r]||[],s);return c.Observable.of({resources:l.filter(((e,t)=>t>=0&&t<n)),totalCount:l.length})}},k=e=>{let{store:t}=e;return e=>{let{mediaType:r}=e;const i=t.getState(),a=(0,E.jR)(i);return c.Observable.of(a).do((()=>t.dispatch((0,T.ql)(a,r)))).map((()=>({id:a,type:r})))}},C=e=>({edit:I(e),save:M(e),load:P(e),remove:k(e)});var w=r(984596),Z=r.n(w),O=r(399790),x=r(234228),R=r(679426);const A=e=>{let{params:t}=e;const{page:r,pageSize:i}=t,a={resources:[],totalCount:0};return(0,R.jh)({category:"MAP",query:t.q||"*",options:{params:{start:(r-1)*i,limit:i}}}).switchMap((e=>{let{results:t,totalCount:r}=e;return c.Observable.of({resources:(""!==t&&Z()(t)||[]).map((function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{data:{...e,thumbnail:decodeURIComponent(e.thumbnail||"")},id:p()(),type:"map"}})),totalCount:r||0})})).catch((()=>c.Observable.of(a)))},N=e=>{let{selectedItem:t}=e;return t&&"map"===t.type&&t.data&&t.data.id&&!t.data.layers?(0,R.RX)(t.data.id).switchMap((e=>{let{id:t,data:r,attributes:i,creation:a,canCopy:o,canDelete:d,canEdit:n,name:s,description:l}=e;const m=r,p=m.version?(0,x.jS)(m.map):(0,x.pT)(m),u=(0,O.IK)(p.layers.map((e=>("background"!==e.group||"ol"!==e.type&&"OpenLayers.Layer"!==e.type||(e.type="empty"),e)))),g={...p&&p.map||{},id:t,groups:p&&p.groups||[],layers:p?.map?.sources?u.map((e=>{const t=(0,O.gv)(p.map.sources,e);return{...e,...t}})):u};return c.Observable.of({...g,...i,id:t,creation:a,canCopy:o,canDelete:d,canEdit:n,name:s,description:l,thumbnail:decodeURIComponent(i.thumbnail||""),type:"map"})})):c.Observable.of(null)};let G={geostory:i,geostore:a};const D=e=>{const t={load:()=>c.Observable.empty(),save:()=>c.Observable.empty(),edit:()=>c.Observable.empty(),remove:()=>c.Observable.empty(),getData:()=>c.Observable.of(null)},r=G[e.type];return r?.create?{...t,...r.create(e)}:{...t,...r}};var L=r(313311),j=r.n(L),z=r(264721),q=r.n(z),F=r(441609),U=r.n(F);const B=(e,t)=>e.ofType(l.nr,l.V9,l.HP,l.ri).switchMap((e=>{const r=t.getState(),i=e.sourceId||(0,E.IQ)(r),a=e.mediaType||(0,E.hb)(r),o=(0,E.Gi)(t.getState())||[],d=(0,E.jR)(r),n=e.params?.page?e.params.page:1,s={...e.params,page:n,pageSize:10},m=1===n?[]:o,p={...(0,E.dq)(r),store:t};return D(p).load({mediaType:a,sourceId:i,params:s,selectedId:d}).switchMap((e=>e?c.Observable.of((0,l.Gr)({mediaType:a,sourceId:i,params:{...s,mediaType:a},resultData:{...e,resources:[...m,...e.resources]}})):c.Observable.empty())).startWith((0,l.Yt)())})),H=(e,t)=>e.ofType(l.ww).switchMap((e=>{let{mediaType:r="image",source:i,data:a}=e;const o=(0,E.cM)(t.getState()),d={...(0,E.dq)(t.getState()),store:t},n=o?D(d).edit({mediaType:r,source:i,data:a}):D(d).save({mediaType:r,source:i,data:a}),s=o?(0,l.Az)(!1):(0,l.I5)(!1);return n.switchMap((e=>{let{id:t}=e;return c.Observable.of((0,l.oo)({mediaType:r,source:i,data:a,id:t}),s,(0,l.Gh)(t))}))})),$=(e,t)=>{let{getState:r}=t;return e.ofType(y.nr).filter((e=>{let{owner:t,map:r}=e;return"mediaEditor"===t&&!r})).switchMap((()=>{const t=e.ofType(y.LE).switchMap((e=>{let{map:t}=e;const i=(0,E.Gi)(r())||[],a=p()();return c.Observable.from([(0,l.Gr)({mediaType:h.Tr.MAP,sourceId:v.r.GEOSTORY,params:{mediaType:h.Tr.MAP},resultData:{resources:[{id:a,type:"map",data:{type:"map",id:a,...t}},...i],totalCount:i.length+1}}),(0,l.Gh)(a),(0,y.Cp)()])})).takeUntil(e.ofType(y.B8)),i=e.ofType(y.B8).map((()=>(0,l.I5)(!1))).takeUntil(e.ofType(y.LE));return c.Observable.merge(i,t)}))},W=(e,t)=>{let{getState:r}=t;return e.ofType(y.nr).filter((e=>{let{owner:t,map:r}=e;return"mediaEditor"===t&&!!r})).switchMap((()=>e.ofType(y.LE).switchMap((e=>{let{map:t}=e;const i=(0,E.B6)(r());return c.Observable.from([(0,l.$G)({...i,data:{...t}},"replace"),(0,y.Cp)()])})).takeUntil(e.ofType(y.B8))))},V=(e,t)=>{let{getState:r}=t;return e.ofType(l.Gl,l.Ai).filter((e=>{let{editing:t=!0,adding:r=!0}=e;return!1===t||!1===r})).map((()=>(0,l.pW)(void 0,(0,E.hb)(r()),v.r.GEOSTORY)))},Y=(e,t)=>e.ofType(l.GZ).switchMap((e=>{let{resource:r,sourceType:i}=e;const a=(0,E.HL)(t.getState()),o=g()(a,(e=>{let{type:t}=e;return i===t})),d={...a[o],store:t};return D(d).save({mediaType:r.type,source:a[o],data:r}).switchMap((e=>{let{id:t}=e;return c.Observable.of((0,l.d8)(o),(0,l.oo)({mediaType:r.type,source:a[o],data:r,id:t}),(0,l.pW)(void 0,r.type,o),(0,l.Gh)(t))}))})),Q=(e,t)=>e.ofType(y.nr).filter((e=>{let{owner:t,map:r}=e;return"mediaEditorEditRemote"===t&&!!r})).switchMap((function(){let{map:{data:r}={}}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.ofType(y.LE).switchMap((e=>{let{map:i}=e;const a=(0,E.HL)(t.getState()),o=g()(a,(e=>{let{type:t}=e;return v.r.GEOSTORY===t})),d={...a[o],store:t};return D(d).save({mediaType:r.type,source:a[o],data:{...r,...i}}).switchMap((e=>{let{id:t}=e;return c.Observable.of((0,l.d8)(o),(0,l.oo)({mediaType:r.type,source:a[o],data:r,id:t}),(0,l.pW)(void 0,r.type,o),(0,l.Gh)(t),(0,y.Cp)())}))})).takeUntil(e.ofType(y.B8))})),K=(e,t)=>e.ofType(l.O6).switchMap((e=>{let{mediaType:r}=e;const i={...(0,E.dq)(t.getState()),store:t};return D(i).remove({mediaType:r}).switchMap((()=>c.Observable.of((0,l.pW)(void 0,(0,E.hb)(t.getState()),v.r.GEOSTORY))))})),X=(e,t)=>e.ofType(l.gd).switchMap((()=>{const e=t.getState(),r=(0,E.B6)(e),i={...(0,E.dq)(t.getState()),store:t};return D(i).getData({selectedItem:r}).switchMap((e=>null===e?c.Observable.of((0,l.E0)(!1)):c.Observable.of((0,l.$G)({...r,data:{...e}},"replace"),(0,l.E0)(!1)))).catch((()=>c.Observable.of((0,l.E0)(!1)))).startWith((0,l.E0)(!0))})),_=e=>e.ofType(l.Wp).filter((e=>{let{mediaTypes:t}=e;return!U()(t)})).switchMap((e=>{let{mediaTypes:t}=e;const r=j()(Object.values(h.Tr),(e=>!q()(t,e)));return r?c.Observable.of((0,l.y5)(r)):c.Observable.empty()}));var J=r(227361),ee=r.n(J),te=r(630998),re=r.n(te),ie=r(682492),ae=r.n(ie),oe=r(275982),de=r(521923);const ne="geostory",se={open:!1,data:{},settings:{mediaType:h.Tr.IMAGE,sourceId:ne,mediaTypes:{image:{defaultSource:ne,sources:[ne]},video:{defaultSource:ne,sources:[ne]},map:{defaultSource:ne,sources:[ne,"geostoreMap"]}},sources:{geostory:{name:"geostory.storyResources",type:v.r.GEOSTORY,addMediaEnabled:{image:!0,video:!0,map:!0},editMediaEnabled:{image:!0,video:!0,map:!0},removeMediaEnabled:{image:!0,video:!0,map:!0}},geostoreMap:{name:"geostory.geostoreMap",type:v.r.GEOSTORE,baseURL:"rest/geostore/",category:"MAP",editMediaEnabled:{map:!0}}}}};var le=r(124852),ce=r.n(le),me=r(867076),pe=r(6760),ue=r(804504);const ge=(0,me.compose)((0,me.defaultProps)({confirmContent:ce().createElement(ue.Z,{msgId:"mediaEditor.confirmExitContent"}),confirmTitle:ce().createElement(ue.Z,{msgId:"mediaEditor.confirmExitTitle"})}),(0,me.withPropsOnChange)(["adding"],(e=>{let{adding:t}=e;return{confirmPredicate:t}})),(0,me.withHandlers)({onClick:e=>{let{hide:t,owner:r}=e;return()=>t(r)}}),pe.Z,(0,me.withHandlers)({hide:e=>{let{onClick:t}=e;return function(){return t(...arguments)}}}));var ye=r(283604),Ee=r(466737),he=r(743129),ve=r(756435),be=r(486234),fe=r(8204),Te=r(141919);const Se=(0,Te.Z)((e=>{let{mediaType:t,selectedItem:r}=e;return t===h.Tr.IMAGE&&!r}),{style:{width:"100%",height:"100%",boxShadow:"inset 0px 0px 30px -5px rgba(0,0,0,0.16)"},iconFit:!0,glyph:"picture",imageStyle:{display:"flex",flexDirection:"column",justifyContent:"center"}})((e=>{let{selectedItem:t}=e;const r=t&&t.data&&t.data.src;return r&&ce().createElement("img",{src:r,style:{objectFit:"contain",width:"100%",height:"100%"}})}));var Me=r(279143);const Ie=(0,Te.Z)((e=>{let{mediaType:t,selectedItem:r}=e;return t===h.Tr.VIDEO&&!r}),{style:{width:"100%",height:"100%",boxShadow:"inset 0px 0px 30px -5px rgba(0,0,0,0.16)"},iconFit:!0,glyph:"play",imageStyle:{display:"flex",flexDirection:"column",justifyContent:"center"}})((e=>{let{selectedItem:t}=e;const r=t?.data?.src,i=t?.data?.thumbnail;return ce().createElement("div",{key:"preview",className:"ms-video-preview",style:{width:"100%",height:"100%",boxShadow:"inset 0px 0px 30px -5px rgba(0,0,0,0.16)"}},r&&ce().createElement(Me.Z,{key:r,thumbnail:i,fit:"contain",src:r,inView:!0,mode:h.nl.VIEW}))}));var Pe=r(500023);const ke=(0,Te.Z)((e=>{let{mediaType:t,selectedItem:r}=e;return t===h.Tr.MAP&&(!r||U()(r))}),{iconFit:!0,glyph:"1-map",imageStyle:{display:"flex",flexDirection:"column",justifyContent:"center"}})((e=>{let{selectedItem:t}=e;const{layers:r=[],mapOptions:i,...a}=t.data?t.data:t;return[ce().createElement(Pe.Z,{key:a.id||a.mapId,styleMap:{height:"100%"},map:{...a,id:"map"+a.id},id:"preview"+t.id,layers:r||[v.D],options:(0,h.kn)({})})]})),Ce=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.mediaType&&ce().createElement("div",{className:"ms-media-preview",key:"preview",style:{width:"100%",height:"100%",boxShadow:"inset 0px 0px 30px -5px rgba(0,0,0,0.16)"}},e.mediaType===h.Tr.IMAGE&&ce().createElement(Se,e),e.mediaType===h.Tr.VIDEO&&ce().createElement(Ie,e),e.mediaType===h.Tr.MAP&&ce().createElement(ke,e))||null},we=(0,be.Z)(["placeholder","clearValueText","noResultsText"])(he.ZP);var Ze=r(414293),Oe=r.n(Ze);const xe=(0,me.compose)((0,d.connect)(null,{openMapEditor:y.$Z,importInLocal:l.Ul}),(0,me.withHandlers)({setAddingMedia:e=>{let{setAddingMedia:t,openMapEditor:r,mediaType:i}=e;return(e,a)=>{i===h.Tr.MAP&&r("mediaEditor",a),t(e)}},editRemoteMap:function(){let{openMapEditor:e,selectedItem:t={}}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return()=>{e("mediaEditorEditRemote",t)}}})),Re=(0,me.compose)((0,d.connect)((e=>({isUsed:(0,S._O)(e,(0,E.jR)(e))})),{removeMedia:l.TU}),(0,me.withHandlers)({onClick:e=>{let{removeMedia:t,mediaType:r}=e;return()=>{t(r)}}}),(0,me.withProps)((e=>{let{isUsed:t}=e;return{confirmTitle:ce().createElement(ue.Z,{msgId:"mediaEditor.mediaList.removeResourceTitle"}),confirmContent:ce().createElement(ue.Z,{msgId:t?"mediaEditor.mediaList.confirmRemoveUsedResource":"mediaEditor.mediaList.confirmRemoveResource"})}})),pe.Z,(0,me.renameProp)("onClick","removeMedia"));var Ae=r(603754),Ne=r(89518),Ge=r(768977),De=r(867517),Le=r(847911),je=r(274335),ze=r(281563);const qe=(0,je.Z)()(Ge.Z),Fe=(0,be.Z)("filterPlaceholder")((0,Le.Z)("onFilter","filterText")(Ae.Z)),Ue={[h.Tr.IMAGE]:{glyph:"image",emptyMessageId:"mediaEditor.imageList.emptyList",filterPlaceholderMessageId:"mediaEditor.mediaPicker.imageFilter"},[h.Tr.VIDEO]:{glyph:"play",emptyMessageId:"mediaEditor.videoList.emptyList",filterPlaceholderMessageId:"mediaEditor.mediaPicker.videoFilter"},[h.Tr.MAP]:{glyph:"1-map",emptyMessageId:"mediaEditor.mapList.emptyList",filterPlaceholderMessageId:"mediaEditor.mediaPicker.mapFilter"}},Be=(0,me.compose)(xe,Re)((e=>{let{resources:t=[],services:r=[],selectedItem:i,selectedSource:a={},selectedService:o,mediaType:d,selectItem:n=(()=>{}),setAddingMedia:s=(()=>{}),setEditingMedia:l=(()=>{}),editRemoteMap:c=(()=>{}),removeMedia:m=(()=>{}),params:p,totalCount:u,onLoad:g,loadingSelected:y,loading:E,buttons:b=[{glyph:"plus",tooltipId:"mediaEditor.mediaPicker.add",visible:!!a?.addMediaEnabled?.[d],onClick:()=>s(!0)},{glyph:"pencil",tooltipId:"mediaEditor.mediaPicker.edit",visible:!(void 0!==i?.data?.sourceId&&i?.data?.sourceId!==o||!a?.editMediaEnabled?.[d]||Oe()(i)),onClick:()=>{a.type===v.r.GEOSTORY?l(!0):a.type===v.r.GEOSTORE&&c()}},{glyph:"trash",tooltipId:"mediaEditor.mediaPicker.trash",visible:!(!a?.removeMediaEnabled?.[d]||Oe()(i)),onClick:m}]}=e;const f=p?.q||"";function T(e){g({...p,...e},d,o)}const{glyph:S,emptyMessageId:M,filterPlaceholderMessageId:I}=Ue[d]||{},P=0===t.length&&E;return ce().createElement("div",{style:{position:"relative"},className:"ms-media-list"},b.filter((e=>!!Oe()(e.visible)||e.visible)).length>0&&ce().createElement("div",{className:"ms-media-toolbar",key:"toolbar"},ce().createElement(fe.Z,{btnDefaultProps:{bsStyle:"primary",className:"square-button-md"},buttons:b})),ce().createElement(Fe,{filterPlaceholder:I,filterText:f,onFilter:e=>{T({page:1,q:e})}}),t.length>0?ce().createElement(qe,{loading:E,scrollOptions:{pageSize:p.pageSize},items:t.map((e=>{let{id:t,data:a={}}=e;const o=r?.find((e=>{let{id:t}=e;return t===a.sourceId}));return{preview:a.thumbnail||d===h.Tr.IMAGE&&a.src?ce().createElement("div",{style:{backgroundImage:`url("${a.thumbnail||a.src}")`,backgroundSize:"cover",backgroundPosition:"center",height:"100%",overflow:"hidden"}}):ce().createElement(ze.Z,{glyph:S,padding:20}),title:a.title||a.name,onClick:()=>n(t),selected:i&&i.id&&t===i.id,description:a.description,caption:o&&ce().createElement(ue.Z,{msgId:o.name})}})),hasMore:()=>u>t.length,onLoadMore:e=>{T({page:e+1})}}):!P&&ce().createElement("div",{className:"msEmptyListMessage"},ce().createElement(De.Z,{msgId:M})),ce().createElement("div",{className:"ms-media-list-pagination"},ce().createElement("div",null,t.length&&u?ce().createElement(De.Z,{msgId:"mediaEditor.mediaList.resultsCount",msgParams:{count:t.length,total:u}}):null),E&&ce().createElement(Ne.Z,{size:20})),(y||P)&&ce().createElement("div",{className:"ms-media-list-loading"},ce().createElement(Ne.Z,{size:70})))}));var He=r(630294),$e=r(719648);const We=[{placeholder:"mediaEditor.mediaPicker.sourcePlaceholder",type:"text",id:"src",label:ce().createElement(ue.Z,{msgId:"mediaEditor.mediaPicker.source"}),validation:e=>{let{src:t}=e;return void 0!==t&&""===t?"error":t?"success":void 0}},{placeholder:"mediaEditor.mediaPicker.titlePlaceholder",type:"text",id:"title",label:ce().createElement(ue.Z,{msgId:"mediaEditor.mediaPicker.title"}),validation:e=>{let{title:t}=e;return void 0!==t&&""===t?"error":t?"success":void 0}},{placeholder:"mediaEditor.mediaPicker.altTextPlaceholder",type:"text",id:"alt",label:ce().createElement(ue.Z,{msgId:"mediaEditor.mediaPicker.altText"})},{placeholder:"mediaEditor.mediaPicker.descriptionPlaceholder",type:"text",id:"description",label:ce().createElement(ue.Z,{msgId:"mediaEditor.mediaPicker.description"})},{placeholder:"mediaEditor.mediaPicker.creditsPlaceholder",type:"text",id:"credits",label:ce().createElement(ue.Z,{msgId:"mediaEditor.mediaPicker.credits"})}],Ve=(0,me.compose)((0,me.defaultProps)({confirmTitle:ce().createElement(ue.Z,{msgId:"mediaEditor.mediaform.confirmExitTitle"}),confirmContent:ce().createElement(ue.Z,{msgId:"mediaEditor.mediaform.confirmExitContent"}),getImageDimensionsFunc:function(e,t){const r=new Image;r.onload=()=>{t({imgWidth:r.naturalWidth,imgHeight:r.naturalHeight})},r.onerror=()=>{t({})},r.src=e}}),(0,me.withStateHandlers)((e=>{let{selectedItem:t={},editing:r}=e;return{properties:r?{...t.data}:{},confirmPredicate:!1}}),{setProperties:e=>t=>({properties:{...e.properties,...t},confirmPredicate:!0})}),(0,me.withHandlers)({onClick:e=>{let{setAddingMedia:t,setEditingMedia:r,editing:i}=e;return()=>{i&&r(!1)||t(!1)}}}),pe.Z,(0,me.getContext)({messages:{}}))((e=>{let{properties:t={},onClick:r=(()=>{}),setProperties:i=(()=>{}),onSave:a=(()=>{}),messages:o,getImageDimensionsFunc:d}=e;return ce().createElement(ve.Z,{className:"ms-imageForm",header:ce().createElement("div",{className:"text-center",key:"toolbar",style:{borderBottom:"1px solid #ddd",padding:8}},ce().createElement(fe.Z,{btnGroupProps:{style:{marginBottom:8}},btnDefaultProps:{bsStyle:"primary",className:"square-button-md"},buttons:[{glyph:"arrow-left",tooltipId:"mediaEditor.mediaPicker.back",onClick:r},{glyph:"floppy-disk",tooltipId:"mediaEditor.mediaPicker.save",disabled:!t.src||!t.title,onClick:()=>{d(t.src,(e=>a({...t,...e})))}}]}))},ce().createElement(He.Form,{style:{padding:8}},We.map((e=>ce().createElement(He.FormGroup,{key:e.id,validationState:e.validation&&e.validation(t)},ce().createElement(He.ControlLabel,null,e.label),ce().createElement(He.FormControl,{type:e.type,placeholder:(0,$e.S$)(o,e.placeholder),value:t[e.id]||"",onChange:r=>{i({...t,[e.id]:r.target.value})}}))))))}));var Ye=r(618446),Qe=r.n(Ye),Ke=r(59810),Xe=r(472704);function _e(){return _e=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},_e.apply(this,arguments)}const Je=(0,pe.Z)(Ke.Z),et=e=>ce().createElement(Je,_e({confirmTitle:ce().createElement(ue.Z,{msgId:"mediaEditor.mapForm.confirmMapSaveTitle"}),confirmContent:ce().createElement(ue.Z,{msgId:"mediaEditor.mapForm.confirmMapSaveContent"})},e)),tt=[{placeholder:"mediaEditor.mediaPicker.titlePlaceholder",type:"text",id:"name",label:ce().createElement(ue.Z,{msgId:"mediaEditor.mediaPicker.title"}),validation:e=>{let{name:t}=e;return void 0!==t&&""===t?"error":t?"success":void 0}},{placeholder:"mediaEditor.mediaPicker.descriptionPlaceholder",type:"text",id:"description",label:ce().createElement(ue.Z,{msgId:"mediaEditor.mediaPicker.description"})}],rt=(0,me.compose)((0,d.connect)(((e,t)=>{const{selectedItem:{id:r,type:i}={}}=t||{};return{isResourceUsed:i===h.Tr.MAP&&(0,S._O)(e,r)}}),{openMapEditor:y.$Z}),(0,me.defaultProps)({confirmTitle:ce().createElement(ue.Z,{msgId:"mediaEditor.mediaform.confirmExitTitle"}),confirmContent:ce().createElement(ue.Z,{msgId:"mediaEditor.mediaform.confirmExitContent"})}),(0,me.withState)("properties","setProperties",(e=>{let{selectedItem:{data:{name:t,thumbnail:r,description:i}={}}={}}=e;return{name:t,thumbnail:r,description:i}})),(0,me.withState)("initialResource",null,(e=>{let{properties:t,selectedItem:{data:r={}}={}}=e;return{...r,...t}})),(0,me.withHandlers)({openMapEditor:e=>{let{selectedItem:t,openMapEditor:r}=e;return()=>{const{id:e,...i}=t.data;r("mediaEditor",{data:i,id:e})}},onSave:e=>{let{onSave:t,selectedItem:{data:r={}}={},properties:i}=e;return()=>t({...r,...i})},updateThumb:e=>{let{setProperties:t,properties:r}=e;return e=>t({...r,thumbnail:e})},onClick:e=>{let{setAddingMedia:t,setEditingMedia:r,editing:i}=e;return()=>{i&&r(!1)||t(!1)}}}),(0,me.withPropsOnChange)(["selectedItem","initialResource","properties"],(e=>{let{initialResource:t,selectedItem:{data:r={}}={},properties:i}=e;return{confirmPredicate:!Qe()(t,{...r,...i})}})),pe.Z,(0,me.defaultProps)({errorMessages:{FORMAT:ce().createElement(ue.Z,{msgId:"map.errorFormat"}),SIZE:ce().createElement(ue.Z,{msgId:"map.errorCustomSize",msgParams:{maxFileSize:"50kb"}})}}),(0,me.withState)("thumbnailErrors","setErrors",(()=>[])),(0,me.getContext)({messages:{}}))((e=>{let{properties:t={},setProperties:r=(()=>{}),onSave:i=(()=>{}),updateThumb:a=(()=>{}),messages:o,openMapEditor:d,setErrors:n,thumbnailErrors:s=[],errorMessages:l,onClick:c=(()=>{}),confirmPredicate:m,isResourceUsed:p=!1}=e;return ce().createElement(ve.Z,{className:"ms-mapForm",header:ce().createElement("div",{className:"text-center",key:"toolbar",style:{borderBottom:"1px solid #ddd",padding:8}},ce().createElement(fe.Z,{btnGroupProps:{style:{marginBottom:8}},btnDefaultProps:{bsStyle:"primary",className:"square-button-md"},buttons:[{glyph:"arrow-left",tooltipId:"mediaEditor.mediaPicker.back",onClick:c},{renderButton:ce().createElement(et,{glyph:"floppy-disk",tooltipId:"mediaEditor.mediaPicker.save",disabled:!t.name||!m,onClick:i,bsStyle:"primary",className:"square-button-md",confirmPredicate:m&&p})},{glyph:"pencil",tooltipId:"mediaEditor.mediaPicker.edit",onClick:d}]}))},ce().createElement(He.Form,{style:{padding:8}},ce().createElement(Xe.Z,{thumbnail:t.thumbnail,thumbnailOptions:{width:300,height:180,type:"image/jpeg",quality:.5},message:ce().createElement(ue.Z,{msgId:"mediaEditor.mediaPicker.thumbnail"}),onUpdate:e=>{a(e),n(void 0)},onRemove:()=>{a(void 0),n(void 0)},onError:e=>n(e)}),s&&s.length>0&&ce().createElement(He.Alert,{bsStyle:"danger",className:"text-center"},ce().createElement("div",null,ce().createElement(ue.Z,{msgId:"map.error"})),s.map((e=>ce().createElement("div",null," ",l[e])))),tt.map((e=>ce().createElement(He.FormGroup,{key:e.id,validationState:e.validation&&e.validation(t)},ce().createElement(He.ControlLabel,null,e.label),ce().createElement(He.FormControl,{type:e.type,placeholder:(0,$e.S$)(o,e.placeholder),value:t[e.id]||"",onChange:i=>{r({...t,[e.id]:i.target.value})}}))))))}));var it=r(45697),at=r.n(it),ot=r(666141);function dt(){return dt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},dt.apply(this,arguments)}const nt=[{placeholder:"mediaEditor.mediaPicker.videoUrlPlaceholder",type:"text",id:"src",label:ce().createElement(ue.Z,{msgId:"mediaEditor.mediaPicker.videoUrl"}),validation:e=>{let{src:t}=e;return void 0!==t&&""===t?"error":t?"success":void 0}},{placeholder:"mediaEditor.mediaPicker.titlePlaceholder",type:"text",id:"title",label:ce().createElement(ue.Z,{msgId:"mediaEditor.mediaPicker.title"}),validation:e=>{let{title:t}=e;return void 0!==t&&""===t?"error":t?"success":void 0}},{placeholder:"mediaEditor.mediaPicker.descriptionPlaceholder",type:"text",id:"description",label:ce().createElement(ue.Z,{msgId:"mediaEditor.mediaPicker.description"})},{placeholder:"mediaEditor.mediaPicker.creditsPlaceholder",type:"text",id:"credits",label:ce().createElement(ue.Z,{msgId:"mediaEditor.mediaPicker.credits"})}],st=e=>{let{src:t,thumbnail:r,onUpdate:i}=e;const a=(0,le.useRef)();(0,le.useEffect)((()=>(a.current=!0,()=>{a.current=!1})),[]);const[o,d]=(0,le.useState)(),[n,s]=(0,le.useState)(),[l,c]=(0,le.useState)(!r);return(0,le.useEffect)((()=>{t&&l&&(d(void 0),s(!0),(0,ot.v9)(t,{width:640,height:360,type:"image/jpeg",quality:.5}).then((e=>{a.current&&(i(e),c(!1),s(!1))})).catch((()=>{a.current&&(c(!1),d(["CREATE"]),s(!1))})))}),[t,l]),ce().createElement(ce().Fragment,null,ce().createElement(Xe.Z,{thumbnail:r,thumbnailOptions:{width:640,height:360,type:"image/jpeg",quality:.5},loading:n,message:ce().createElement(ue.Z,{msgId:"mediaEditor.mediaPicker.thumbnail"}),onUpdate:e=>{i(e),d(void 0)},onError:e=>d(e),toolbarButtons:[{glyph:"refresh",tooltipId:"mediaEditor.mediaPicker.createVideoThumbnail",visible:!r,onClick:e=>{e.stopPropagation(),c(!0)}},{glyph:"trash",tooltipId:"removeThumbnail",visible:!!r,onClick:e=>{e.stopPropagation(),i(void 0),d(void 0)}}]}),o&&o.length>0&&ce().createElement(He.Alert,{bsStyle:"danger",className:"text-center"},-1===o.indexOf("CREATE")&&ce().createElement("div",null,ce().createElement(ue.Z,{msgId:"map.error"})),-1!==o.indexOf("FORMAT")&&ce().createElement("div",null,ce().createElement(ue.Z,{msgId:"map.errorFormat"})),-1!==o.indexOf("SIZE")&&ce().createElement("div",null,ce().createElement(ue.Z,{msgId:"map.errorSize"})),-1!==o.indexOf("CREATE")&&ce().createElement("div",null,ce().createElement(ue.Z,{msgId:"mediaEditor.mediaPicker.thumbnailCreateError"}))))},lt=(e,t)=>{let{properties:r,setProperties:i=(()=>{}),onSave:a=(()=>{}),onClick:o=(()=>{})}=e;const{messages:d={}}=t||{},{src:n,thumbnail:s}=r;return ce().createElement(ve.Z,{className:"ms-video-form",header:ce().createElement("div",{className:"text-center",key:"toolbar",style:{borderBottom:"1px solid #ddd",padding:8}},ce().createElement(fe.Z,{btnGroupProps:{style:{marginBottom:8}},btnDefaultProps:{bsStyle:"primary",className:"square-button-md"},buttons:[{glyph:"arrow-left",tooltipId:"mediaEditor.mediaPicker.back",onClick:o},{glyph:"floppy-disk",tooltipId:"mediaEditor.mediaPicker.save",disabled:!r.src||!r.title,onClick:()=>a(r)}]}))},ce().createElement(He.Form,{style:{padding:8}},ce().createElement(st,{src:n,thumbnail:s,onUpdate:e=>i({...r,thumbnail:e})}),nt.map((e=>ce().createElement(He.FormGroup,{key:e.id,validationState:e.validation&&e.validation(r)},ce().createElement(He.ControlLabel,null,e.label),ce().createElement(He.FormControl,{type:e.type,placeholder:(0,$e.S$)(d,e.placeholder),value:r[e.id]||"",onChange:t=>{i({...r,[e.id]:t.target.value})}}))))))};lt.contextTypes={messages:at().object};const ct=(0,pe.Z)(lt),mt={[h.Tr.IMAGE]:Ve,[h.Tr.MAP]:rt,[h.Tr.VIDEO]:e=>{const[t,r]=(0,le.useState)(!1),[i,a]=(0,le.useState)(e?.editing?{...e?.selectedItem.data}:{});return ce().createElement(ct,dt({},e,{confirmTitle:ce().createElement(ue.Z,{msgId:"mediaEditor.mediaform.confirmExitTitle"}),confirmContent:ce().createElement(ue.Z,{msgId:"mediaEditor.mediaform.confirmExitContent"}),confirmPredicate:t,properties:i,setProperties:e=>{a(e),r(!0)},onClick:()=>e?.editing&&e?.setEditingMedia(!1)||e?.setAddingMedia(!1)}))}},pt=(0,me.compose)((0,me.withHandlers)({onSave:e=>{let{mediaType:t,source:r,saveMedia:i=(()=>{})}=e;return e=>i({type:t,source:r,data:e})}}),(0,me.branch)((e=>{let{addingMedia:t}=e;return t}),(0,me.renderComponent)((e=>{const t=mt[e.mediaType||h.Tr.IMAGE];return ce().createElement(t,e)}))))(Be),ut=(0,d.connect)((0,n.P1)([E.Gi,E.B6,E.IQ,E.dq,E.cM,E.ER,E.mA,E.mD,E.XG,E.TU,E.Iy],((e,t,r,i,a,o,d,n,s,l,c)=>({resources:e,selectedItem:t,selectedService:r,selectedSource:i,editing:a,services:c,params:o,totalCount:d,loadingSelected:n,loading:s,...l}))),{selectItem:l.Gh,setAddingMedia:l.I5,setEditingMedia:l.Az,saveMedia:l.gG,onLoad:l.pW,setMediaService:l.d8})(pt),gt=(0,d.connect)((0,n.zB)({selectedItem:E.B6,selectedService:E.IQ,services:E.Iy,editing:E.cM,saveState:E.TU,disabledMediaType:E.f5}),{setMediaService:l.d8,setMediaType:l.y5})((e=>{let{mediaType:t="image",saveState:r,selectedItem:i,selectedService:a,services:o=[{name:"Currently used",id:"geostory"},{name:"Geostore",id:"geostore"}],setMediaType:d=(()=>{}),setMediaService:n=(()=>{}),mediaSelector:s,disabledMediaType:l}=e;return ce().createElement(ve.Z,{className:"ms-mediaEditor",header:ce().createElement("div",{className:"ms-border-layout-header",style:{padding:4,zIndex:2}},ce().createElement(fe.Z,{btnDefaultProps:{bsSize:"sm"},buttons:[{text:ce().createElement(ue.Z,{msgId:"mediaEditor.images"}),active:"image"===t,bsStyle:"image"===t?"primary":"default",onClick:()=>{d("image")},disabled:r&&r.addingMedia||q()(l,"image")},{text:ce().createElement(ue.Z,{msgId:"mediaEditor.videos"}),active:"video"===t,bsStyle:"video"===t?"primary":"default",onClick:()=>{d("video")},disabled:r&&r.addingMedia||q()(l,"video")},{text:ce().createElement(ue.Z,{msgId:"mediaEditor.maps"}),active:"map"===t,bsStyle:"map"===t?"primary":"default",onClick:()=>{d("map")},disabled:r&&r.addingMedia||q()(l,"map")}]}),ce().createElement("div",{className:"ms-mediaEditor-services"},ce().createElement("div",{className:"ms-mediaEditor-label"},ce().createElement("strong",null,ce().createElement(ue.Z,{msgId:"mediaEditor.mediaPicker.services"}))),ce().createElement(we,{disabled:r&&r.addingMedia,noResultsText:"mediaEditor.mediaPicker.noResults",placeholder:"mediaEditor.mediaPicker.selectService",options:o.map((e=>({label:ce().createElement(ue.Z,{msgId:e.name}),value:e.id}))),onChange:n,value:a,clearable:!1}))),columns:[ce().createElement("div",{key:"selector",className:"ms-mediaSelector"},s)]},ce().createElement(Ce,{selectedItem:i,mediaType:t}))})),yt=ge((e=>{let{open:t,mediaType:r,chooseMedia:i,selectedItem:a,editing:o,adding:d,hide:n=(()=>{}),disableAddMedia:s,disableEditMedia:l}=e;return ce().createElement(Ee.Z,null,ce().createElement(ye.Z,{title:ce().createElement(ue.Z,{msgId:"mediaEditor.modalTitle"}),show:t,clickOutEnabled:!1,onClose:n,size:"lg",modalClassName:"media-editor-modal",buttons:[{text:ce().createElement(ue.Z,{msgId:"mediaEditor.apply"}),bsSize:"sm",disabled:d||o,onClick:()=>i(a)}]},ce().createElement(gt,{mediaType:r,mediaSelector:ce().createElement(ut,{mediaType:r,disableAddMedia:s,disableEditMedia:l})})))})),Et=(0,s.rx)("MediaEditor",{component:(0,d.connect)((0,n.zB)({mediaType:E.hb,editing:e=>(0,E.cM)(e)||(0,E.gW)(e),adding:E.Qi,open:E.hp,selectedItem:E.B6}),{hide:l.Cp,chooseMedia:l.Ke})(yt),reducers:{mediaEditor:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:se,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case l.Ai:return(0,de.qC)((0,de.t8)("saveState.addingMedia",t.adding),(0,de.t8)("selected",""))(e);case l.Gl:return(0,de.qC)((0,de.t8)("saveState.addingMedia",t.editing),(0,de.t8)("saveState.editing",t.editing))(e);case l.B8:return(0,de.qC)((0,de.t8)("open",!1),(0,de.t8)("owner",void 0),(0,de.t8)("saveState.addingMedia",!1),(0,de.t8)("saveState.editing",!1),(0,de.t8)("settings",{...e.stashedSettings||se.settings,...e.settings?.mediaType&&{mediaType:e.settings.mediaType}}),(0,de.t8)("stashedSettings",void 0),(0,de.zN)("selected"),(0,de.t8)("disabledMediaType",[]))(e);case l.ih:{const{resultData:r,params:i,mediaType:a,sourceId:o}=t;return(0,de.qC)((0,de.t8)(`data["${a}"]["${o}"]`,{params:i,resultData:r}),(0,de.t8)("loadingList",!1))(e)}case l.ty:{const{item:r,mode:i}=t,a=(0,E.IQ)({mediaEditor:e}),o=(0,E.hb)({mediaEditor:e}),d=(0,E.Qd)({mediaEditor:e}).resources,n=re()(d,{id:r.id}),s=j()(d,{id:r.id}),l="merge"===i?ae()({},ae()({},s),ae()({},r)):r;return(0,de.t8)(`data["${o}"]["${a}"].resultData.resources[${n}]`,l,e)}case l.gd:return t.id===e.selected?(0,de.t8)("selected","",e):(0,de.t8)("selected",t.id,e);case l.HP:{const r=ee()(e,`settings.mediaTypes[${t.mediaType}].defaultSource`,"geostory");return(0,de.qC)((0,de.t8)("settings.sourceId",r),(0,de.t8)("settings.mediaType",t.mediaType))(e)}case l.ri:return(0,de.t8)("settings.sourceId",t.id,e);case l.nr:const r=t.settings&&{...t.settings,...e.settings.mediaType&&{mediaType:e.settings.mediaType}};return(0,de.qC)((0,de.t8)("open",!0),(0,de.t8)("owner",t.owner),(0,de.t8)("settings",r||e.settings),(0,de.t8)("stashedSettings",e.settings))(e);case oe.nk:return{...se,settings:{...e.settings,mediaType:se.settings.mediaType}};case l.Vt:return(0,de.t8)("loadingSelected",t.loading,e);case l.Ug:return(0,de.t8)("loadingList",!0,e);case l.Wp:return(0,de.t8)("disabledMediaType",t.mediaTypes||[],e);default:return e}}},epics:o})},844174:e=>{e.exports=function(e,t,r,i){for(var a=-1,o=null==e?0:e.length;++a<o;){var d=e[a];t(i,d,r(d),e)}return i}},481119:(e,t,r)=>{var i=r(989881);e.exports=function(e,t,r,a){return i(e,(function(e,i,o){t(a,e,r(e),o)})),a}},555189:(e,t,r)=>{var i=r(844174),a=r(481119),o=r(267206),d=r(701469);e.exports=function(e,t){return function(r,n){var s=d(r)?i:a,l=t?t():{};return s(r,e,o(n,2),l)}}},607739:(e,t,r)=>{var i=r(789465),a=r(555189),o=Object.prototype.hasOwnProperty,d=a((function(e,t,r){o.call(e,r)?e[r].push(t):i(e,r,[t])}));e.exports=d}}]);