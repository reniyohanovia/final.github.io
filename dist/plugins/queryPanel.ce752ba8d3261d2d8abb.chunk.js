(self.webpackChunkmapstore2=self.webpackChunkmapstore2||[]).push([[8272],{940711:(e,t,r)=>{"use strict";r.d(t,{b:()=>u});var s=r(727418),a=r.n(s);var o=r(348660),i=r(487758);const l=e=>{let{searchText:t,staticFilter:r,blacklist:s,item:a,queriableAttributes:i,predicate:l}=e;const n=(0,o.generateTemplateString)(r||"")(a);let p,u=t.split(" ").filter((e=>e)).filter((e=>s.indexOf(e.toLowerCase())<0));return 0===u.length&&(u=t?[t]:[]),u.length>0&&(p="(".concat(u.map((e=>i.map((t=>`${t} ${l} '%${e.replace("'","''")}%'`)).join(" OR "))).join(") AND (")).concat(")")),p=p?p.concat(n):n||null,p};let n={nominatim:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{returnFullData:!1};return r(61427).Z.geocode(e,t).then((e=>{return t.returnFullData?e:null===(r=e.data)?[]:r.map((e=>({properties:{...e},id:e.osm_id,type:"Feature",bbox:e.boundingbox.map((e=>parseFloat(e))).reduce(((e,t,r)=>(e[(e=>{switch(e){case 0:return 1;case 1:return 3;case 2:return 0;case 3:return 2;default:return-1}})(r)]=t,e)),[]),geometry:e.geojson||{type:"Point",coordinates:[parseFloat(e.lon),parseFloat(e.lat)]}})));var r}))},wfs:(e,t)=>{let{url:r,typeName:s,queriableAttributes:o=[],outputFormat:n="application/json",predicate:p="ILIKE",staticFilter:u="",blacklist:c=[],item:d,fromTextToFilter:h=l,returnFullData:m=!1,...y}=t;const g=h({searchText:e,staticFilter:u,blacklist:c,item:d,queriableAttributes:o,predicate:p});return i.DH(r,a()({maxFeatures:10,typeName:s,outputFormat:n,cql_filter:g},y)).then((e=>m?e:e.features))}};const p={setService:(e,t)=>{n[e]=t},getService:e=>n[e]?n[e]:null},u={Services:n,Utils:p}},556382:(e,t,r)=>{"use strict";r.d(t,{Vd:()=>v,Vj:()=>w});var s=r(472500),a=r.n(s),o=r(666654),i=r.n(o),l=r(91175),n=r.n(l),p=r(414293),u=r.n(p),c=r(727418),d=r.n(c),h=r(49977),m=r.n(h),y=r(940711),g=r(470509),f=r.n(g),b=r(69090);const F=e=>{let{searchText:t="",queriableAttributes:r=[],predicate:s="ILIKE"}=e;const a=n()(r);let o=`strToLowerCase(${a}) ${s} '%${t.toLowerCase()}%'`;return u()(a)?"":"("+o+")"},v=e=>e.distinctUntilChanged((function(e){let{value:t,currentPage:r,attribute:s}=e,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return!(a.value!==t||a.currentPage!==r||a.attribute!==s)})).throttle((e=>m().Observable.timer(e.delayDebounce||0))).merge(e.debounce((e=>m().Observable.timer(e.delayDebounce||0)))).distinctUntilChanged().switchMap((e=>{if(e.performFetch){const t=(0,b.getWpsPayload)({attribute:e.attribute,layerName:e.typeName,maxFeatures:e.maxFeatures,startIndex:(e.currentPage-1)*e.maxFeatures,value:e.value});return m().Observable.fromPromise(f().post(e.url,t,{timeout:6e4,headers:{Accept:"application/json","Content-Type":"application/xml"}}).then((e=>({fetchedData:e.data,busy:!1})))).catch((()=>m().Observable.of({fetchedData:{values:[],size:0},busy:!1}))).startWith({busy:!0})}return m().Observable.of({fetchedData:{values:[],size:0},busy:!1})})).startWith({}),w=e=>m().Observable.merge(e.distinctUntilChanged((function(){let{value:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{value:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e===t})).debounce((e=>m().Observable.timer(e.delayDebounce||0))),e.distinctUntilChanged((function(){let{filterProps:e,currentPage:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{filterProps:r,currentPage:s}=arguments.length>1?arguments[1]:void 0;return e===r&&t===s}))).switchMap((e=>{if(e.performFetch){let t=a().parse(e.url,!0),r="";(i()(t.pathname,"wfs")||i()(t.pathname,"wms")||i()(t.pathname,"ows")||i()(t.pathname,"wps"))&&(r=t.pathname.replace(/(wms|ows|wps|wfs)$/,"wfs")),t.query&&t.query.service&&delete t.query.service;const s=a().format(d()({},t,{search:null,pathname:r}));let o=d()({},{url:s,typeName:e.filterProps&&e.filterProps.typeName||"",predicate:e.filterProps&&e.filterProps.predicate||"ILIKE",blacklist:e.filterProps&&e.filterProps.blacklist||[],maxFeatures:e.filterProps&&e.filterProps.maxFeatures||3,queriableAttributes:e.filterProps&&e.filterProps.queriableAttributes||[],returnFullData:!0,startIndex:((e.currentPage||1)-1)*(e.filterProps&&e.filterProps.maxFeatures||3),outputFormat:"application/json",staticFilter:"",fromTextToFilter:F,item:{},timeout:6e4,headers:{Accept:"application/json","Content-Type":"application/xml"},srsName:e.filterProps&&e.filterProps.srsName||"EPSG:4326",...t.query});return m().Observable.fromPromise(y.b.Utils.getService("wfs")(e.value,o).then((t=>({fetchedData:{values:t.features.map((e=>e.properties)),size:t.totalFeatures,features:t.features,crs:e.filterProps&&e.filterProps.srsName||"EPSG:4326"},busy:!1})))).catch((()=>m().Observable.of({fetchedData:{values:[],size:0,features:[]},busy:!1}))).startWith({busy:!0})}return m().Observable.of({fetchedData:{values:[],size:0,features:[]},busy:!1})})).startWith({})},346231:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>kt});var s=r(618446),a=r.n(s),o=r(45697),i=r.n(o),l=r(124852),n=r.n(l),p=r(171703),u=r(506806),c=r(12838),d=r(22222),h=r(884757),m=r(687753),y=r(651493);const g=(0,p.connect)((e=>({groupLevels:e.queryform.groupLevels,groupFields:e.queryform.groupFields,filterFields:e.queryform.filterFields,attributes:e.query&&e.query.typeName&&e.query.featureTypes&&e.query.featureTypes[e.query.typeName]&&e.query.featureTypes[e.query.typeName].attributes,attributePanelExpanded:e.queryform.attributePanelExpanded,autocompleteEnabled:e.queryform.autocompleteEnabled,maxFeaturesWPS:e.queryform.maxFeaturesWPS})),(e=>({actions:(0,c.DE)({onAddGroupField:h.kQ,onAddFilterField:h.jW,onRemoveFilterField:h.JG,onUpdateFilterField:h.q$,onUpdateExceptionField:h.OZ,onUpdateLogicCombo:h.Nc,onRemoveGroupField:h.I5,onChangeCascadingValue:h.QL,toggleMenu:h.js,onExpandAttributeFilterPanel:h.I},e),controlActions:(0,c.DE)({onToggleQuery:m.Xi.bind(null,"queryPanel",null)},e)})))(y.Z);var f=r(274363),b=r(296252),F=r(313311),v=r.n(F),w=r(414293),E=r.n(w),x=r(630294),P=r(556382),C=r(719648),S=r(131400),O=r(481330),T=r(701469),q=r.n(T),N=r(867076),I=r(828878),j=r(738839),L=r(348660),D=r(91175),M=r.n(D),V=r(200020),Z=r(401811),k=r(157155);function G(){return G=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},G.apply(this,arguments)}function A(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class R extends n().Component{constructor(){super(...arguments),A(this,"state",{}),A(this,"renderWithTooltip",(e=>{if(this.props.tooltip.customizedTooltip){const t=this.props.tooltip.customizedTooltip;return n().createElement(t,null,e)}const t=n().createElement(x.Tooltip,{id:this.props.tooltip.id},"this.props.tooltip.message");return n().createElement(Z.Z,{key:this.props.tooltip.overlayTriggerKey,placement:this.props.tooltip.placement,overlay:t},e)})),A(this,"renderPagination",(()=>{const e=this.props.pagination.firstPage,t=this.props.pagination.lastPage;return n().createElement("div",{className:"autocomplete-toolbar"},!e&&n().createElement(x.Glyphicon,{className:this.props.prevPageIcon,glyph:this.props.prevPageIcon,onClick:()=>this.props.pagination.loadPrevPage()}),!t&&n().createElement(x.Glyphicon,{className:this.props.nextPageIcon,glyph:this.props.nextPageIcon,onClick:()=>this.props.pagination.loadNextPage()}))})),A(this,"renderField",(()=>{const e={emptyList:()=>this.props.busy?"Loading...":(0,C.S$)(this.context.messages,"queryform.attributefilter.autocomplete.emptyList"),open:(0,C.S$)(this.context.messages,"queryform.attributefilter.autocomplete.open"),emptyFilter:(0,C.S$)(this.context.messages,"queryform.attributefilter.autocomplete.emptyFilter")};let t=[];this.props.data&&this.props.data.length>0&&(t=this.props.data.map((e=>e))),this.props.pagination&&this.props.pagination.paginated&&t.length>0&&t.push({[this.props.textField]:"",[this.props.valueField]:"",disabled:!0,pagination:this.renderPagination()});let r=!1;const s=this.props.loading?[]:t,a=this.props.itemComponent,o=n().createElement(V.Combobox,{dropUp:this.props.dropUp,busy:this.props.busy,data:s,disabled:this.props.disabled,itemComponent:e=>n().createElement(a,G({textField:this.props.textField,valueField:this.props.valueField},e)),messages:this.props.messages||e,open:this.props.open,filter:!1,onChange:e=>{this.props.onChange(e,this.props.valueField),r=!0},onFocus:()=>this.props.onFocus(this.props.data),onSelect:e=>{const t=M()(this.props.features.filter((t=>t.properties[this.props.valueField].toLowerCase()===e[this.props.valueField].toLowerCase())));this.props.onSelect(e,t,this.props.srsName,this.props.style)},onToggle:e=>{const t=M()(this.props.features.filter((e=>e.properties[this.props.valueField].toLowerCase()===this.props.selectedValue.toLowerCase())));!e||this.props.selectedValue||this.props.selectedValue||r||this.props.onChange("",this.props.valueField),this.props.onToggle(e,t,this.props.pagination.currentPage),t&&!e&&this.props.onSelect(this.props.selectedValue,t,this.props.srsName,this.props.style),r=!1},textField:this.props.textField,valueField:this.props.valueField,value:this.props.selectedValue});return this.props.tooltip&&this.props.tooltip.enabled?this.renderWithTooltip(o):o}))}render(){let e=this.props.label?n().createElement("label",null,this.props.label):n().createElement("span",null);return n().createElement("div",{className:"autocompleteField"},e,this.renderField())}}A(R,"propTypes",{busy:i().bool,data:i().array,disabled:i().bool,dropUp:i().bool,features:i().array,filter:i().string,itemComponent:i().oneOfType([i().object,i().func]),label:i().string,loading:i().bool,messages:i().object,onChange:i().func,onFocus:i().func,onSelect:i().func,onToggle:i().func,onChangeDrawingStatus:i().func,style:i().style,open:i().bool,pagination:i().object,nextPageIcon:i().string,prevPageIcon:i().string,selectedValue:i().string,srsName:i().string,textField:i().string,tooltip:i().object,valueField:i().string}),A(R,"contextTypes",{messages:i().object}),A(R,"defaultProps",{dropUp:!1,features:[],filter:"",itemComponent:k.Z,loading:!1,label:null,pagination:{paginated:!0,firstPage:!1,lastPage:!1,loadPrevPage:()=>{},loadNextPage:()=>{}},nextPageIcon:"chevron-right",prevPageIcon:"chevron-left",onFocus:()=>{},onToggle:()=>{},onChange:()=>{},onChangeDrawingStatus:()=>{},onSelect:()=>{},srsName:"EPSG:4326",textField:"label",tooltip:{customizedTooltip:void 0,enabled:!1,id:"",message:void 0,overlayTriggerKey:"",placement:"top"},valueField:"value"});const B=R;(0,N.setObservableConfig)(I.Z);const U=(0,N.mapPropsStreamWithConfig)(I.Z)((e=>e.take(1).switchMap((t=>t.autocompleteStreamFactory(e))).combineLatest(e,((e,t)=>({...t,data:q()(e&&e.fetchedData&&e.fetchedData.values)?e.fetchedData.values:[],features:q()(e&&e.fetchedData&&e.fetchedData.features)?e.fetchedData.features:[],valuesCount:e&&e.fetchedData&&e.fetchedData.size,srsName:e&&e.fetchedData&&e.fetchedData.crs,busy:e.busy})))))((e=>{let{open:t,toggle:r,select:s,focus:a,change:o,changed:i,originalValue:l,value:p,valuesCount:u,onChangeDrawingStatus:c,loadNextPage:d,loadPrevPage:h,maxFeatures:m,currentPage:y,itemComponent:g,features:f,busy:b,data:F,loading:v=!1,valueField:w,textField:E,filter:x,srsName:P,style:C}=e;const S=Math.ceil(u/m);return n().createElement(B,{pagination:{firstPage:1===y,lastPage:S<=y,paginated:!0,loadPrevPage:h,loadNextPage:d,currentPage:y},srsName:P,busy:b,dropUp:!1,data:F,open:t,onChangeDrawingStatus:c,valueField:w,textField:E,itemComponent:g,filter:x,onFocus:a,onToggle:r,onChange:o,onSelect:s,features:f,style:C,selectedValue:i?p:l||p,loading:v})})),W=(0,N.compose)((0,N.withPropsOnChange)(["valueField"],(()=>({value:void 0}))),(0,N.withStateHandlers)((e=>({delayDebounce:0,performFetch:!1,open:!1,currentPage:1,maxFeatures:5,changed:e.value,value:e.value,onChangeDrawingStatus:e.onChangeDrawingStatus,itemComponent:e.itemComponent})),{select:()=>e=>({selected:e}),change:e=>(t,r)=>(e.selected||e.open||e.onChangeDrawingStatus("clean","","queryform",[],{}),{delayDebounce:500,selected:!1,changingPage:!1,changed:!0,performFetch:!(e.selected&&!e.changingPage),value:e.selected&&e.changingPage&&e.value||("string"==typeof t?t:t[r]),currentPage:e.changingPage?e.currentPage:1}),focus:e=>t=>t&&0===t.length&&""===e.value?{delayDebounce:0,currentPage:1,performFetch:!0,isToggled:!1,open:!0}:e,toggle:e=>()=>({open:!!e.changingPage||!e.open}),loadNextPage:e=>()=>({currentPage:e.currentPage+1,performFetch:!0,changingPage:!0,delayDebounce:0}),loadPrevPage:e=>()=>({currentPage:e.currentPage-1,performFetch:!0,changingPage:!0,delayDebounce:0})}),(0,N.withHandlers)({select:function(){let{options:e,onChangeSpatialFilterValue:t=(()=>{}),select:r=(()=>{})}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(s,a,o,i)=>{a&&t({geometry:a.geometry,value:s,feature:a,srsName:o,style:i,options:e,collectGeometries:e&&e.crossLayer?{queryCollection:{typeName:e.crossLayer.typeName,geometryName:e.crossLayer.geometryName,cqlFilter:(0,L.generateTemplateString)(e.crossLayer.cqlTemplate||"",j.escapeCQLStrings)(a)}}:void 0}),r(!0)}}})),z=W(U);var _=r(569291),Q=r(581368),H=r(267721),$=r(727418),X=r.n($),Y=r(351546);function J(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class K extends n().Component{constructor(){var e;super(...arguments),e=this,J(this,"onUpdateBBOX",(function(t,r){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"replace";"replace"===s&&(e.tempExtent[r]=!isNaN(parseFloat(t))&&parseFloat(t)||0);let a=[];for(let t in e.tempExtent)t&&a.push(e.tempExtent[t]);let o=(0,Y.reprojectBbox)(a,"EPSG:4326",e.props.projection),i={type:e.props.geometry.type,coordinates:[[[o[0],o[1]],[o[0],o[3]],[o[2],o[3]],[o[2],o[1]],[o[0],o[1]]]],projection:e.props.geometry.projection};e.props.onChangeDrawingStatus(s,void 0,"queryform",[i])})),J(this,"onUpdateCircle",(function(t,r){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"replace";"replace"===s&&(e.tempCircle[r]=parseFloat(t));let a=isNaN(parseFloat(e.tempCircle.x))||isNaN(parseFloat(e.tempCircle.y))?[e.tempCircle.x,e.tempCircle.y]:(0,Y.reproject)([e.tempCircle.x,e.tempCircle.y],"EPSG:4326",e.props.projection);a=void 0===a.x?{x:a[0],y:a[1]}:a;const o={x:isNaN(a.x)?0:a.x,y:isNaN(a.y)?0:a.y};let i={type:e.props.geometry.type,center:o,coordinates:[o.x,o.y],radius:isNaN(e.tempCircle.radius)?0:e.tempCircle.radius,projection:e.props.geometry.projection};e.props.onChangeDrawingStatus(s,void 0,"queryform",[i],{geodesic:e.props.enableGeodesic})})),J(this,"onModifyGeometry",(()=>{"BBOX"===this.props.type?this.onUpdateBBOX(null,null,"endDrawing"):"Circle"===this.props.type&&this.onUpdateCircle(null,null,"endDrawing"),this.props.onShowPanel(!1)})),J(this,"onClosePanel",(()=>{this.resetGeom(),this.props.onShowPanel(!1)})),J(this,"getStep",(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return Math.min(1/Math.pow(10,Math.ceil(Math.min(e,21)/3)-2),1)})),J(this,"getStepCircle",((e,t)=>{const r=this.getStep(e);return"radius"===t&&!this.isWGS84()&&1e4*r||r})),J(this,"getBBOXDimensions",(e=>{const t=(0,Y.reprojectBbox)(e.extent,e.projection,"EPSG:4326");return{west:t[0],sud:t[1],est:t[2],north:t[3]}})),J(this,"getCircleDimensions",(e=>{const t=(0,Y.reproject)(e.center,e.projection,"EPSG:4326"),r=(0,Y.reproject)(e.center,e.projection,this.props.projection),s=(0,Y.reproject)([e.center[0]+e.radius,e.center[1]],e.projection,this.props.projection),a=Math.sqrt((s.x-r.x)*(s.x-r.x)+(s.y-r.y)*(s.y-r.y));return{x:t.x,y:t.y,radius:a}})),J(this,"renderCoordinateField",((e,t)=>n().createElement("div",null,n().createElement("div",{className:"detail-field-title"},t),n().createElement(O.Z,{style:{minWidth:"105px",margin:"auto"},type:"number",id:"queryform_bbox_"+t,step:this.getStep(this.props.zoom),defaultValue:this.roundValue(e,1e6),onChange:e=>this.onUpdateBBOX(e,t)})))),J(this,"renderCircleField",((e,t)=>n().createElement(O.Z,{type:"number",id:"queryform_circle_"+t,defaultValue:this.roundValue(e,"radius"!==t||this.isWGS84()?1e6:100),step:this.getStepCircle(this.props.zoom,t),onChange:e=>this.onUpdateCircle(e,t)}))),J(this,"renderDetailsContent",(()=>{let e,t=this.props.geometry;if("BBOX"===this.props.type){const r=this.getBBOXDimensions(t);e=n().createElement("div",null,n().createElement("div",{className:"container-fluid"},n().createElement(x.Row,null,n().createElement(x.Col,{xs:4},n().createElement("span",null)),n().createElement(x.Col,{xs:4},this.renderCoordinateField(r.north,"north")),n().createElement(x.Col,{xs:4},n().createElement("span",null))),n().createElement(x.Row,null,n().createElement(x.Col,{xs:4},this.renderCoordinateField(r.west,"west")),n().createElement(x.Col,{xs:4},n().createElement("span",null)),n().createElement(x.Col,{xs:4},this.renderCoordinateField(r.est,"est"))),n().createElement(x.Row,null,n().createElement(x.Col,{xs:4},n().createElement("span",null)),n().createElement(x.Col,{xs:4},this.renderCoordinateField(r.sud,"sud")),n().createElement(x.Col,{xs:4},n().createElement("span",null)))),n().createElement("span",null,n().createElement("hr",{width:"90%"}),n().createElement("div",null,n().createElement("h5",null,n().createElement(S.ZP.Message,{msgId:"queryform.spatialfilter.details.details_bbox_label"})))))}else if("Circle"===this.props.type){const r=this.getCircleDimensions(t),s=(0,Y.getUnits)(this.props.projection);e=n().createElement("div",null,n().createElement("div",{className:"container-fluid"},n().createElement(x.Row,null,n().createElement(x.Col,{xs:2},n().createElement("span",null)),n().createElement(x.Col,{xs:2},n().createElement("span",{className:"details-circle-attribute-name"},"x:")),n().createElement(x.Col,{xs:4},this.renderCircleField(r.x,"x")),n().createElement(x.Col,{xs:4},n().createElement("span",null))),n().createElement(x.Row,null,n().createElement(x.Col,{xs:2},n().createElement("span",null)),n().createElement(x.Col,{xs:2},n().createElement("span",{className:"details-circle-attribute-name"},"y:")),n().createElement(x.Col,{xs:4},this.renderCircleField(r.y,"y")),n().createElement(x.Col,{xs:4},n().createElement("span",null))),n().createElement(x.Row,null,n().createElement(x.Col,{xs:2},n().createElement("span",null)),n().createElement(x.Col,{xs:2},n().createElement("span",{className:"details-circle-attribute-name"},n().createElement(S.ZP.Message,{msgId:"queryform.spatialfilter.details.radius",msgParams:{unit:"degrees"===s?"°":s}}),":")),n().createElement(x.Col,{xs:4},this.renderCircleField(r.radius,"radius")),n().createElement(x.Col,{xs:4},n().createElement("span",null)))),n().createElement("span",null,n().createElement("hr",{width:"90%"}),n().createElement("div",null,n().createElement("h5",null,n().createElement(S.ZP.Message,{msgId:"queryform.spatialfilter.details.details_circle_label"})))))}return e})),J(this,"isWGS84",(()=>"EPSG:4326"===this.props.projection)),J(this,"roundValue",(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e6;return Math.round(e*t)/t})),J(this,"resetGeom",(()=>{"BBOX"===this.props.type?this.resetBBOX():"Circle"===this.props.type&&this.resetCircle()})),J(this,"resetBBOX",(()=>{for(let e in this.extent)e&&(document.getElementById("queryform_bbox_"+e).value=this.roundValue(this.extent[e],1e6),this.onUpdateBBOX(this.extent[e],e))})),J(this,"resetCircle",(()=>{document.getElementById("queryform_circle_radius").value=this.roundValue(this.circle.radius,100),this.onUpdateCircle(this.circle.radius,"radius"),document.getElementById("queryform_circle_x").value=this.roundValue(this.circle.x,this.isWGS84()?1e6:100),this.onUpdateCircle(this.circle.x,"x"),document.getElementById("queryform_circle_y").value=this.roundValue(this.circle.y,this.isWGS84()?1e6:100),this.onUpdateCircle(this.circle.y,"y")}))}componentDidMount(){const e=this.props.geometry;"BBOX"===this.props.type?(this.extent=this.getBBOXDimensions(e),this.tempExtent=X()({},this.extent)):"Circle"===this.props.type&&(this.circle=this.getCircleDimensions(e),this.tempCircle=X()({},this.circle))}render(){return n().createElement(_.Z,{buttons:[{key:"confirm",glyph:"ok",tooltipId:"confirm",onClick:()=>this.onModifyGeometry()},{key:"reset",tooltipId:"queryform.reset",glyph:"clear-filter",onClick:()=>this.resetGeom()},{key:"close",glyph:"1-close",onClick:()=>this.onClosePanel(!1)}],title:n().createElement(S.ZP.Message,{msgId:"queryform.spatialfilter.details.details_header"}),locked:!0,expanded:!0,className:"details-panel",bsStyle:"primary"},this.renderDetailsContent())}}J(K,"propTypes",{useMapProjection:i().bool,geometry:i().object,type:i().string,onShowPanel:i().func,onChangeDrawingStatus:i().func,zoom:i().number,projection:i().string,enableGeodesic:i().bool}),J(K,"defaultProps",{useMapProjection:!0,geometry:null,type:null,onShowPanel:()=>{},onChangeDrawingStatus:()=>{}});const ee=K;function te(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class re extends n().Component{constructor(){var e;super(...arguments),e=this,te(this,"state",{open:!1}),te(this,"getFilter",(function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"*",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"=",s={filterFields:[{attribute:e.props.searchAttribute,operator:r,value:t,type:"list"}]};return e.props.dependsOn&&(s.groupFields=[{id:1,logic:"AND",index:0}],s.filterFields[0].groupId=1,e.props.multivalue?(s.groupFields.push({id:2,logic:"OR",groupId:1,index:1}),e.props.dependsOn.value instanceof Array?e.props.dependsOn.value.forEach((t=>{s.filterFields.push({attribute:e.props.dependsOn.field,operator:e.props.dependsOn.operator||"=",value:t,groupId:2,type:"list"})})):s.filterFields.push({attribute:e.props.dependsOn.field,operator:e.props.dependsOn.operator||"=",value:e.props.dependsOn.value,groupId:2,type:"list"})):s.filterFields.push({attribute:e.props.dependsOn.field,operator:e.props.dependsOn.operator||"=",value:e.props.dependsOn.value,groupId:1,type:"list"})),(0,j.toOGCFilter)(e.props.typeName,s,e.props.wfs,e.props.sort||{sortBy:e.props.searchAttribute,sortOrder:"ASC"})})),te(this,"changeZoneValue",((e,t,r)=>{let s;this.setState({open:!1}),s=this.props.multivalue?{value:r.map((e=>e.id)),feature:r.map((e=>e.feature))}:{value:[r],feature:[this.values.filter((e=>e.id===r))[0].feature]},this.props.onChange(this.props.zoneId,s)}))}UNSAFE_componentWillReceiveProps(e){e.values&&!a()(this.props.values,e.values)&&e.values.length>0&&this.setState({open:!0})}render(){this.values=[],this.props.values&&this.props.values.length>0&&(this.values=this.props.values.map((e=>{let t=e;this.props.valueField.split(".").forEach((e=>{t=t?t[e]:null}));let r=e;return this.props.textField.split(".").forEach((e=>{r=r?r[e]:null})),{id:t,name:r,feature:e}})));let e=this.props.label?n().createElement("label",null,this.props.label):n().createElement("span",null),t=this.props.error;return t&&(t="object"!=typeof t?t:t.status+" "+t.statusText+": "+t.data),n().createElement("div",{className:"zone-combo"},e,n().createElement(Q.Z,{key:(new Date).getTime(),busy:this.props.busy,disabled:this.props.disabled,fieldRowId:this.props.zoneId,valueField:"id",textField:"name",fieldOptions:this.values,fieldValue:this.props.value,fieldName:"zone",fieldException:t,options:{defaultOpen:this.state.open},groupBy:this.props.groupBy?e=>e.feature.properties[this.props.groupBy]:()=>{},multivalue:this.props.multivalue,comboFilter:this.props.comboFilter,onSelect:this.props.onSelect,onUpdateField:this.changeZoneValue,onToggle:e=>{if(e&&(!this.props.values||this.props.values.length<1)){const e=this.getFilter(this.props.searchText,this.props.searchMethod);this.props.onSearch(!0,this.props.zoneId),this.props.onFilter(this.props.url,e,this.props.zoneId)}}}))}}te(re,"propTypes",{zoneId:i().number,url:i().string,typeName:i().string,wfs:i().string,busy:i().bool,values:i().array,value:i().oneOfType([i().object,i().number,i().string,i().array]),label:i().string,searchText:i().string,searchMethod:i().string,searchAttribute:i().string,sort:i().object,error:i().oneOfType([i().object,i().string]),comboFilter:i().oneOfType([i().bool,i().string,i().func]),groupBy:i().oneOfType([i().string,i().func]),multivalue:i().bool,open:i().bool,disabled:i().bool,dependsOn:i().object,valueField:i().string,textField:i().string,onSearch:i().func,onFilter:i().func,onChange:i().func,onSelect:i().func}),te(re,"contextTypes",{messages:i().object}),te(re,"defaultProps",{open:!1,zoneId:null,url:null,typeName:null,wfs:"1.1.0",busy:!1,values:[],value:null,valueField:null,textField:null,label:null,disabled:!1,error:null,searchText:"*",searchMethod:"ilike",searchAttribute:null,comboFilter:"contains",multivalue:!0,groupBy:null,onSearch:()=>{},onFilter:()=>{},onChange:()=>{},onSelect:()=>{}});const se=re;function ae(){return ae=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},ae.apply(this,arguments)}function oe(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class ie extends n().Component{constructor(){var e;super(...arguments),e=this,oe(this,"getMethodFromId",(e=>v()(this.props.spatialMethodOptions,(t=>t&&t.id===e))||null)),oe(this,"renderHeader",(()=>{const e=(0,C.S$)(this.context.messages,"queryform.spatialfilter.spatial_filter_header");return n().createElement("span",null,n().createElement("span",{style:{cursor:"pointer"},onClick:this.props.actions.onExpandSpatialFilterPanel.bind(null,!this.props.spatialPanelExpanded)},e))})),oe(this,"renderSpatialHeader",(()=>{const e=this.getMethodFromId(this.props.spatialField.method);return n().createElement("div",null,n().createElement(x.Row,{className:"logicHeader inline-form filter-field-row filter-field-fixed-row"},n().createElement(x.Col,{xs:6},n().createElement("div",null,n().createElement(S.ZP.Message,{msgId:"queryform.spatialfilter.filterType"}))),n().createElement(x.Col,{xs:6},n().createElement(Q.Z,{itemComponent:e=>n().createElement(H.Z,ae({customItemClassName:this.getMethodFromId(e.item)&&this.getMethodFromId(e.item).customItemClassName||""},e)),fieldOptions:this.props.spatialMethodOptions.map((e=>(0,C.S$)(this.context.messages,e.name)||e.name)),placeholder:(0,C.S$)(this.context.messages,"queryform.spatialfilter.combo_placeholder"),fieldName:"method",fieldRowId:(new Date).getTime(),fieldValue:(0,C.S$)(this.context.messages,e?e.name:"")||e&&e.name||"",onUpdateField:this.updateSpatialMethod}))))})),oe(this,"renderDwithin",(()=>n().createElement(x.Row,{className:"container-fluid filter-field-fixed-row"},n().createElement(x.Col,{xs:6,className:"filter-text-desc"},n().createElement(S.ZP.Message,{msgId:"queryform.spatialfilter.dwithin_label"})),n().createElement(x.Col,{xs:6},n().createElement(O.Z,{type:"number",min:"0",defaultValue:"0",disabled:!this.props.spatialField.geometry,id:"queryform_dwithin_field",onChange:e=>this.props.actions.onChangeDwithinValue(e,name)}))))),oe(this,"renderZoneFields",(()=>this.props.spatialField.method&&"ZONE"===this.props.spatialField.method&&this.props.spatialField.zoneFields&&this.props.spatialField.zoneFields.length>0?this.props.spatialField.zoneFields.map((e=>n().createElement(se,{key:e.id,open:e.open,zoneId:e.id,url:e.url,typeName:e.typeName,wfs:e.wfs,busy:e.busy,label:e.label,values:e.values,value:e.value,valueField:e.valueField,textField:e.textField,searchText:e.searchText,searchMethod:e.searchMethod,searchAttribute:e.searchAttribute,sort:e.sort,error:e.error,disabled:e.disabled,dependsOn:e.dependson,groupBy:e.groupBy,multivalue:e.multivalue,onSearch:this.props.actions.zoneSearch,onFilter:this.props.actions.zoneFilter,onChange:this.props.actions.zoneChange}))):null)),oe(this,"renderRoiPanel",(()=>{const t=this.getMethodFromId(this.props.spatialField.method),r=t&&t.filterProps&&t.filterProps.valueField&&this.props.spatialField&&this.props.spatialField.value&&this.props.spatialField.value[t.filterProps.valueField];return n().createElement(x.Panel,null,n().createElement("div",{className:"container-fluid"},n().createElement(x.Row,{className:"filter-field-row filter-field-fixed-row"},n().createElement(x.Col,{xs:6},n().createElement("span",null,t&&t.name||t.id)),n().createElement(x.Col,{xs:6},n().createElement(z,{originalValue:r,key:this.props.spatialField.method,options:t,autocompleteStreamFactory:P.Vj,valueField:t&&t.filterProps&&t.filterProps.valueField,textField:t&&t.filterProps&&t.filterProps.valueField,url:t&&t.url,filter:"contains",onChangeSpatialFilterValue:this.props.actions.onChangeSpatialFilterValue,onChangeDrawingStatus:function(){e.props.actions.onChangeDrawingStatus(...arguments)},filterProps:t&&t.filterProps})))))})),oe(this,"renderSpatialPanel",((e,t,r)=>n().createElement(x.Panel,{className:"spatial-panel"},this.props.spatialMethodOptions.length>1?this.renderSpatialHeader():n().createElement("span",null),this.renderZoneFields(),this.props.spatialField.method&&this.getMethodFromId(this.props.spatialField.method)&&"wfsGeocoder"===this.getMethodFromId(this.props.spatialField.method).type?this.renderRoiPanel():null,this.props.spatialOperations.length>1?n().createElement(x.Panel,null,n().createElement("div",null,e),r&&"DWITHIN"===r.id?this.renderDwithin():null,n().createElement(x.Row,null,n().createElement(x.Col,{xs:12},t))):n().createElement("span",null)))),oe(this,"renderButtons",(()=>{const e=[],t=this.props.showDetailsButton&&this.props.spatialField.geometry&&(this.props.spatialField.method&&"BBOX"===this.props.spatialField.method||"Circle"===this.props.spatialField.method),r=this.props.spatialField.geometry&&this.props.spatialField.geometry.coordinates;return t&&e.push({glyph:"pencil",onClick:()=>this.props.actions.onShowSpatialSelectionDetails(!0),tooltipId:"queryform.spatialfilter.details.detail_button_label"}),r&&e.push({glyph:"clear-filter",tooltipId:"queryform.spatialfilter.remove",bsStyle:this.props.clearFilterOptions.buttonStyle,className:this.props.clearFilterOptions.className,onClick:()=>this.resetSpatialFilter()}),e})),oe(this,"updateSpatialMethod",((e,t,r)=>{this.props.actions.onShowSpatialSelectionDetails(!1);const s=this.props.spatialMethodOptions.filter((e=>r===((0,C.S$)(this.context.messages,e.name)||e.name)))[0].id,a=this.getMethodFromId(s);if(this.props.actions.onSelectSpatialMethod(s,t),"wfsGeocoder"!==this.getMethodFromId(s).type)switch(s){case"ZONE":this.changeDrawingStatus("clean","","queryform",[]);break;case"Viewport":this.changeDrawingStatus("clean","","queryform",[]),this.props.actions.onSelectViewportSpatialMethod();break;default:this.changeDrawingStatus("start",s,"queryform",[],{geodesic:!!E()(a.geodesic)||a.geodesic,stopAfterDrawing:!0})}else this.changeDrawingStatus("clean","","queryform",[])})),oe(this,"updateSpatialOperation",((e,t,r)=>{const s=this.props.spatialOperations.filter((e=>r===(0,C.S$)(this.context.messages,e.name)))[0].id;this.props.actions.onSelectSpatialOperation(s,t)})),oe(this,"resetSpatialFilter",(()=>{this.changeDrawingStatus("clean","","queryform",[]),this.props.actions.onRemoveSpatialSelection(),this.props.actions.onShowSpatialSelectionDetails(!1)})),oe(this,"changeDrawingStatus",((e,t,r,s,a)=>{this.props.actions.onChangeDrawingStatus(e,void 0!==t?t:this.props.spatialField.method,r,s,a)}))}render(){const e=this.props.spatialOperations.filter((e=>this.props.spatialField.operation===e.id))[0];let t=n().createElement("span",null);"ZONE"!==this.props.spatialField.method&&"Viewport"!==this.props.spatialField.method&&this.getMethodFromId(this.props.spatialField.method)&&"wfsGeocoder"!==this.getMethodFromId(this.props.spatialField.method).type&&(t=this.props.spatialField.geometry?null:n().createElement("span",null,n().createElement("div",{className:"m-label m-caption text-center"},n().createElement(S.ZP.Message,{msgId:"queryform.spatialfilter.draw_start_label"}))));const r=this.getMethodFromId(this.props.spatialField.method),s=this.props.showDetailsPanel?n().createElement(ee,{useMapProjection:this.props.useMapProjection,enableGeodesic:!!E()(r.geodesic)||r.geodesic,geometry:this.props.spatialField.geometry,type:this.props.spatialField.method,onShowPanel:this.props.actions.onShowSpatialSelectionDetails,onChangeDrawingStatus:this.changeDrawingStatus,zoom:this.props.zoom,projection:this.props.projection}):n().createElement("span",null),a=n().createElement(x.Row,{className:"filter-field-row inline-form filter-field-fixed-row"},n().createElement(x.Col,{xs:6},n().createElement(S.ZP.Message,{msgId:"queryform.spatialfilter.geometric_operation"})),n().createElement(x.Col,{xs:6},n().createElement(Q.Z,{fieldOptions:this.props.spatialOperations.map((e=>(0,C.S$)(this.context.messages,e.name))),fieldName:"operation",fieldRowId:(new Date).getTime(),fieldValue:(0,C.S$)(this.context.messages,e?e.name:""),onUpdateField:this.updateSpatialOperation})));return n().createElement("div",{className:"query-filter-container"},this.props.withContainer?n().createElement(_.Z,{id:"spatialFilterPanel",header:this.renderHeader(),buttons:this.renderButtons(),collapsible:!0,expanded:this.props.spatialPanelExpanded,onSwitch:e=>this.props.actions.onExpandSpatialFilterPanel(e)},this.renderSpatialPanel(a,t,e)):this.renderSpatialPanel(a,t,e),s)}}oe(ie,"propTypes",{useMapProjection:i().bool,spatialField:i().object,spatialOperations:i().array,spatialMethodOptions:i().array,spatialPanelExpanded:i().bool,showDetailsButton:i().bool,clearFilterOptions:i().object,showDetailsPanel:i().bool,withContainer:i().bool,actions:i().object,zoom:i().number,projection:i().string}),oe(ie,"contextTypes",{messages:i().object}),oe(ie,"defaultProps",{useMapProjection:!0,spatialField:{},spatialPanelExpanded:!0,showDetailsButton:!0,clearFilterOptions:{className:"square-button-sm no-border",buttonStyle:"default"},showDetailsPanel:!1,withContainer:!0,spatialMethodOptions:[],spatialOperations:[],actions:{onExpandSpatialFilterPanel:()=>{},onSelectSpatialMethod:()=>{},onSelectSpatialOperation:()=>{},onChangeSpatialFilterValue:()=>{},onChangeDrawingStatus:()=>{},onRemoveSpatialSelection:()=>{},onShowSpatialSelectionDetails:()=>{},onSelectViewportSpatialMethod:()=>{},onChangeRegion:()=>{},onChangeDwithinValue:()=>{},zoneFilter:()=>{},zoneSearch:()=>{},zoneChange:()=>{}}});const le=ie,ne=(0,p.connect)((e=>({useMapProjection:e.queryform.useMapProjection,spatialField:e.queryform.spatialField,showDetailsPanel:e.queryform.showDetailsPanel,spatialPanelExpanded:e.queryform.spatialPanelExpanded,zoom:((0,f.Od)(e)||{}).zoom,projection:((0,f.Od)(e)||{}).projection})),(e=>({actions:(0,c.DE)({onChangeSpatialFilterValue:h.uo,onExpandSpatialFilterPanel:h.ku,onSelectSpatialMethod:h.HT,onSelectViewportSpatialMethod:h.lg,onSelectSpatialOperation:h.VF,onChangeDrawingStatus:b.Yf,onRemoveSpatialSelection:h.Ry,onShowSpatialSelectionDetails:h.ZH,onChangeDwithinValue:h.AQ,zoneFilter:h.eJ,zoneSearch:h.uM,zoneChange:h.uP},e)})))(le);var pe=r(227361),ue=r.n(pe),ce=r(49977),de=r.n(ce),he=r(141520),me=r(452341);const ye={"xsd:normalizedString":"string","xsd:string":"string","xsd:date":"date","xsd:dateTime":"date","xsd:date-time":"date-time","xsd:time":"time","xsd:decimal":"number","xsd:int":"number","xsd:integer":"number","xsd:long":"number","xsd:negativeInteger":"number","xsd:nonNegativeInteger":"number","xsd:nonPositiveInteger":"number","xsd:positiveInteger":"number","xsd:short":"number","xsd:unsignedLong":"number","xsd:unsignedInt":"number","xsd:unsignedShort":"number","xsd:number":"number","xsd:boolean":"boolean","xsd:double":"number","xsd:float":"number","xsd:array":"array"},ge=e=>ue()(e,"featureTypes[0].properties").filter((e=>0!==e.type.indexOf("gml:")&&ye[e.type])).map((e=>({label:e.name,attribute:e.name,type:ye[e.type],valueId:"id",valueLabel:"name",values:[]})));var fe=r(509978);const be=(0,N.compose)((0,N.withPropsOnChange)(["crossLayerFilter"],(function(){let{crossLayerFilter:e={}}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{queryCollection:ue()(e,"collectGeometries.queryCollection"),operation:ue()(e,"operation"),distance:ue()(e,"distance")}})),(0,N.withProps)((function(){let{layers:e=[],queryCollection:t={}}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{layer:v()(e,(function(){let{name:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e===t.typeName}))}})),(0,N.withHandlers)({setQueryCollectionParameter:e=>{let{setCrossLayerFilterParameter:t=(()=>{})}=e;return(e,r)=>{t(`collectGeometries.queryCollection[${e}]`,r),"typeName"===e&&t("collectGeometries.queryCollection.filterFields",[])}},updateLogicCombo:e=>{let{setCrossLayerFilterParameter:t=(()=>{})}=e;return(e,r)=>t("collectGeometries.queryCollection.groupFields",[{id:e,logic:r,index:0}])},setOperation:e=>{let{setCrossLayerFilterParameter:t=(()=>{})}=e;return e=>t("operation",e)}}),(0,N.defaultProps)({dataStreamFactory:function(e){let{setQueryCollectionParameter:t=(()=>{})}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(e=>e.distinctUntilChanged((function(){let{searchUrl:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{searchUrl:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e===t})).switchMap((function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t.crossLayerExpanded?ce.Observable.of(t):e.filter((function(){let{crossLayerExpanded:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e})).take(1)})).switchMap((e=>{let{featureTypeName:t,searchUrl:r}=e;return(0,he.ED)({layer:{name:t,url:r,search:{type:"wfs",url:r}}}).do((e=>{if(!(e=>{const t=ue()(e,"WFS_Capabilities.Filter_Capabilities.Scalar_Capabilities.ArithmeticOperators.Functions.FunctionNames.FunctionName");return!!v()(t,(function(){let{_:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return"queryCollection"===e}))})(e))throw new Error("nocrosslayerfunctionalities")})).map((()=>({loadingCapabilities:!1}))).catch((e=>ce.Observable.of({errorObj:e,loadingAttributes:!1,loadingCapabilities:!1,featureTypeProperties:[]}))).startWith({loadingCapabilities:!0})})).startWith({}))(e).combineLatest(((e,t)=>e.distinctUntilChanged((function(){let{layer:e={}}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{layer:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t&&e.name===(t&&t.name)})).filter((function(){let{layer:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return!!e})).switchMap((function(){let{layer:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return ce.Observable.defer((()=>(0,he.v$)({layer:e}))).do((e=>{const r=ue()((0,me.findGeometryProperty)(e.data||{}),"name");r&&t("geometryName",r)})).map((function(){let{data:e={}}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return ge(e)})).map((e=>({attributes:e,loadingAttributes:!1}))).startWith({loadingAttributes:!0}).catch((e=>ce.Observable.of({errorObj:e,loadingAttributes:!1,featureTypeProperties:[]})))})).catch((e=>ce.Observable.of({errorObj:e,loadingAttributes:!1,loadingCapabilities:!1,featureTypeProperties:[]}))).startWith({}))(e,t),(function(){return{...arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},...arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}}})).startWith({})}}),fe.Z);var Fe=r(127608),ve=r(804504),we=r(743129);const Ee=function(){let{item:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n().createElement("span",null,e&&e.name?n().createElement(ve.Z,{msgId:e.name}):null)},xe=function(){let{spatialOperations:e=[],onChange:t=(()=>{}),value:r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n().createElement(V.DropdownList,{valueField:"id",className:"geometry-operation-selector",onChange:t,data:e,valueComponent:Ee,value:r,itemComponent:Ee})};var Pe=r(959956),Ce=r(423214);const Se=function(e){let{search:t,url:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,Pe.w0)(e,r)||(0,Pe.w0)(e,t&&t.url)},Oe=e=>(e||[]).filter((function(){let{id:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return"BBOX"!==e})),Te={start:[],attributes:[{id:"attributeFilter",plugin:g,cfg:{},position:1}],afterAttributes:[],spatial:[{id:"spatialFilter",plugin:ne,cfg:{},position:1}],afterSpatial:[],layers:[{id:"crossLayer",plugin:(0,N.compose)((0,p.connect)((e=>({attributes:e.query&&e.query.typeName&&e.query.featureTypes&&e.query.featureTypes[e.query.typeName]&&e.query.featureTypes[e.query.typeName].attributes,crossLayerExpanded:e.queryform.crossLayerExpanded,crossLayerFilterOptions:{layers:(0,Fe.GK)(e),crossLayerFilter:(0,Fe.qh)(e),...e.queryform.crossLayerFilterOptions||{}},searchUrl:e.query&&e.query.url,featureTypeName:e.query&&e.query.typeName})),(e=>({crossLayerFilterActions:(0,c.DE)({expandCrossLayerFilterPanel:h.EU,setCrossLayerFilterParameter:h.IV,addCrossLayerFilterField:h.N5,updateCrossLayerFilterField:h.bn,removeCrossLayerFilterField:h.Bm,resetCrossLayerFilter:h.F2,toggleMenu:(e,t)=>(0,h.js)(e,t,"crossLayer")},e)}))),(0,N.withProps)((e=>{let{crossLayerFilterOptions:t,crossLayerFilterActions:r}=e;return{...t,...r}})),be)((function(){let{crossLayerExpanded:e=!0,spatialOperations:t,expandCrossLayerFilterPanel:r=(()=>{}),layers:s=[],errorObj:a,loadingAttributes:o,loadingCapabilities:i,searchUrl:l,queryCollection:p={},attributes:u=[],operation:c,updateLogicCombo:d=(()=>{}),resetCrossLayerFilter:h=(()=>{}),setOperation:m=(()=>{}),setQueryCollectionParameter:g=(()=>{}),addCrossLayerFilterField:f=(()=>{}),updateCrossLayerFilterField:b=(()=>{}),removeCrossLayerFilterField:F=(()=>{}),toggleMenu:v=(()=>{})}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{typeName:w,geometryName:E,filterFields:P,groupFields:C=[{id:1,logic:"OR",index:0}]}=p,S=s.filter((e=>!Se(l,e)));return n().createElement(_.Z,{loading:i,expanded:e&&!i&&!a,error:a,errorMsgId:"queryPanel",buttons:[...w?[{glyph:"clear-filter",tooltipId:"queryform.crossLayerFilter.clear",onClick:()=>h()}]:[]],onSwitch:r,title:n().createElement(ve.Z,{msgId:"queryform.crossLayerFilter.title"})},n().createElement(x.Row,{className:"inline-form filter-field-fixed-row"},n().createElement(x.Col,{xs:6},n().createElement("div",null,n().createElement(ve.Z,{msgId:"queryform.crossLayerFilter.targetLayer"})," ",s.length&&S.length?n().createElement(Ce.Z,{bsStyle:"link",text:n().createElement(ve.Z,{msgId:"queryform.crossLayerFilter.errors.layersExcluded"})}):null)),n().createElement(x.Col,{xs:6},n().createElement(we.ZP,{clearable:!1,disabled:i||!!a,isLoading:o,options:s.filter((e=>Se(l,e))).map((e=>({label:e.title||e.name,value:e.name}))),placeholder:n().createElement(ve.Z,{msgId:"queryform.crossLayerFilter.placeholder"}),filter:"contains",value:w,onChange:e=>{g("typeName",e&&e.value)}}))),w&&E?n().createElement(x.Row,{className:"inline-form filter-field-fixed-row"},n().createElement(x.Col,{xs:6},n().createElement("div",null,n().createElement(ve.Z,{msgId:"queryform.crossLayerFilter.operation"}))),n().createElement(x.Col,{xs:6},n().createElement(xe,{value:c,onChange:function(){let{id:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return m(e)},spatialOperations:Oe(t)}))):null,w&&E&&c?n().createElement(x.Row,{className:"filter-field-fixed-row"},n().createElement(x.Col,{xs:12},n().createElement(y.Z,{dropUp:!0,autocompleteEnabled:!0,withContainer:!1,attributes:u,groupLevels:-1,filterFields:P,actions:{onUpdateLogicCombo:d,onAddFilterField:f,onUpdateFilterField:b,onRemoveFilterField:F,toggleMenu:v},groupFields:C,filterField:!0}))):null)})),cfg:{},position:1}],end:[]};var qe=r(16075),Ne=r(119008),Ie=r(564864),je=r(333101),Le=r(859518),De=r(612132),Me=r(893379),Ve=r.n(Me),Ze=r(768271);Ve()(Ze.Z,{insert:"head",singleton:!1}),Ze.Z.locals;var ke=r(472986),Ge=r.n(ke),Ae=r(756435),Re=r(697350),Be=r(23888),Ue=r(8204);function We(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class ze extends n().Component{constructor(e){super(e),We(this,"getCurrentFilter",(()=>({featureTypeName:this.props.featureTypeName,groupFields:this.props.groupFields,filterFields:this.props.sendFilters&&this.props.sendFilters.attributeFilter&&this.props.filterFields.filter((e=>(0,j.checkOperatorValidity)(e.value,e.operator)))||[],spatialField:this.props.sendFilters&&this.props.sendFilters.spatialFilter&&this.props.spatialField||{attribute:this.props.spatialField&&this.props.spatialField.attribute},pagination:this.props.pagination,filterType:this.props.filterType,ogcVersion:this.props.ogcVersion,sortOptions:this.props.sortOptions,crossLayerFilter:this.props.sendFilters&&this.props.sendFilters.crossLayerFilter&&(0,j.setupCrossLayerFilterDefaults)(this.props.crossLayerFilter)||null,hits:this.props.hits,filters:this.props.filters}))),We(this,"isCurrentFilterChanged",(()=>{const e=this.getCurrentFilter(),t={groupFields:e.groupFields,filterFields:e.filterFields,spatialField:e.spatialField,crossLayerFilter:e.crossLayerFilter,filters:e.filters},r=this.props.appliedFilter||{},s={groupFields:r.groupFields,filterFields:r.attributePanelExpanded&&r.filterFields||[],spatialField:r.spatialPanelExpanded&&r.spatialField||{attribute:this.props.spatialField&&this.props.spatialField.attribute},filters:r.filters,crossLayerFilter:r.crossLayerExpanded&&r.crossLayerFilter&&r.crossLayerFilter.operation?(0,j.setupCrossLayerFilterDefaults)(r.crossLayerFilter):null};return!a()(t,s)})),We(this,"search",(()=>{let e=this.getCurrentFilter();this.props.actions.onQuery(this.props.searchUrl,e,this.props.params),this.props.advancedToolbar&&this.props.actions.storeAppliedFilter()})),We(this,"reset",(()=>{if(this.props.actions.onChangeDrawingStatus("clean","","queryform",[]),this.props.actions.onReset(),this.props.advancedToolbar){let e={featureTypeName:this.props.featureTypeName,groupFields:[],filterFields:[],spatialField:{attribute:this.props.spatialField&&this.props.spatialField.attribute},pagination:this.props.pagination,filterType:this.props.filterType,ogcVersion:this.props.ogcVersion,sortOptions:this.props.sortOptions,crossLayerFilter:null,hits:this.props.hits};this.props.actions.onQuery(this.props.searchUrl,e,this.props.params),this.props.advancedToolbar&&this.props.actions.storeAppliedFilter()}})),We(this,"restorePersistedFilter",(()=>{this.props.actions.onRestoreFilter()}))}render(){let e=this.props.filterFields.filter((e=>e.exception)).length>0;const t=this.props.allowEmptyFilter&&!this.props.advancedToolbar;let r=this.props.filterFields.filter((e=>(0,j.checkOperatorValidity)(e.value,e.operator))).length>0;const s=(0,j.isFilterEmpty)(this.props),o=(0,j.isFilterEmpty)(this.props.appliedFilter),i=this.isCurrentFilterChanged(),l=r||this.props.spatialField.geometry||(0,j.isCrossLayerFilterValid)(this.props.crossLayerFilter)||this.props.filters&&this.props.filters.length>0&&this.props.filters.map((function(){let{invalid:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return!e})).reduce(((e,t)=>e&&t),!0),p=!a()(this.props.appliedFilter,this.props.storedFilter),u=t||s&&this.props.appliedFilter&&!o;let c=e||!this.props.toolbarEnabled||s&&!u||!s&&(!l||!i);const d=this.props.emptyFilterWarning&&s&&i,h=this.props.advancedToolbar?"queryform.apply":this.props.queryBtnMsgId;let m=[{tooltipId:d?"queryform.emptyfilter":h,disabled:c,noTooltipWhenDisabled:!0,glyph:this.props.advancedToolbar?"ok":this.props.queryBtnGlyph,className:d?"square-button-md showWarning":"square-button-md",id:"query-toolbar-query",onClick:this.search}];if(this.props.advancedToolbar){const e=!p||this.props.loadingError||i,t=!p||!this.props.storedFilter||!this.props.toolbarEnabled,r=!this.props.appliedFilter||this.props.appliedFilter&&o||!this.props.toolbarEnabled;m=m.concat([{tooltipId:"queryform.save",disabled:e,noTooltipWhenDisabled:!0,glyph:"floppy-disk",id:"query-toolbar-save",onClick:this.props.actions.onSaveFilter},{tooltipId:"queryform.discard",disabled:t,noTooltipWhenDisabled:!0,glyph:"undo",id:"query-toolbar-discard",onClick:this.restorePersistedFilter},{tooltipId:"queryform.reset",glyph:"clear-filter",noTooltipWhenDisabled:!0,id:"reset",disabled:r,onClick:this.reset}])}else m=[{tooltipId:"queryform.reset",glyph:"clear-filter",noTooltipWhenDisabled:!0,id:"reset",disabled:!this.props.toolbarEnabled,onClick:this.reset}].concat(m);return n().createElement("div",{className:"container-fluid query-toolbar"},n().createElement(Ue.Z,{btnDefaultProps:{bsStyle:"primary",className:"square-button-md",tooltipPosition:"bottom"},className:"queryFormToolbar row-fluid pull-right",buttons:m}),n().createElement(Re.Z,{show:!!this.props.showGeneratedFilter,bsSize:"large"},n().createElement(Re.Z.Header,null,n().createElement(Re.Z.Title,null,this.props.resultTitle)),n().createElement(Re.Z.Body,null,n().createElement("textarea",{style:{width:"862px",maxWidth:"862px",height:"236px",maxHeight:"236px"}},this.props.showGeneratedFilter)),n().createElement(Re.Z.Footer,null,n().createElement(Be.Z,{style:{float:"right"},onClick:()=>this.props.actions.onQuery(null,null)},"Close"))))}}We(ze,"propTypes",{filterType:i().string,params:i().object,filterFields:i().array,groupFields:i().array,spatialField:i().object,filters:i().array,sendFilters:i().object,crossLayerFilter:i().object,toolbarEnabled:i().bool,searchUrl:i().string,showGeneratedFilter:i().oneOfType([i().bool,i().string]),featureTypeName:i().string,actions:i().object,ogcVersion:i().string,titleMsgId:i().string,queryBtnMsgId:i().string,resultTitle:i().string,queryBtnGlyph:i().string,pagination:i().object,sortOptions:i().object,hits:i().bool,allowEmptyFilter:i().bool,emptyFilterWarning:i().bool,appliedFilter:i().object,storedFilter:i().object,advancedToolbar:i().bool,loadingError:i().bool}),We(ze,"defaultProps",{sendFilters:{attributeFilter:!0,spatialFilter:!0,crossLayerFilter:!0,filters:!0},filterType:"OGC",params:{},groupFields:[],filterFields:[],spatialField:{},toolbarEnabled:!0,searchUrl:null,showGeneratedFilter:!1,featureTypeName:null,titleMsgId:"queryform.title",queryBtnMsgId:"queryform.query",resultTitle:"Generated Filter",queryBtnGlyph:"search",pagination:null,sortOptions:null,hits:!1,allowEmptyFilter:!1,emptyFilterWarning:!1,advancedToolbar:!1,loadingError:!1,actions:{onQuery:()=>{},onReset:()=>{},onChangeDrawingStatus:()=>{},onSaveFilter:()=>{},onRestoreFilter:()=>{},storeAppliedFilter:()=>{}}});const _e=ze;function Qe(){return Qe=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},Qe.apply(this,arguments)}const He=(0,r(389073).Z)((e=>n().createElement("div",Qe({className:"square-button pull-right no-border",style:{display:"flex"}},e),n().createElement(x.Glyphicon,{glyph:"exclamation-mark",className:"text-danger"})))),$e=function(){let{loadingError:e,onToggleQuery:t=(()=>{}),buttonStyle:r="default"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n().createElement("div",{className:"mapstore-block-width"},n().createElement(Be.Z,{id:"toc-query-close-button",key:"menu-button",className:"square-button no-border",bsStyle:r,onClick:()=>t()},n().createElement(x.Glyphicon,{glyph:"arrow-left"})),e&&n().createElement(He,{popover:{text:n().createElement(ve.Z,{msgId:"queryform.loadingError"})}})||n().createElement("div",{className:"square-button pull-right no-border",style:{display:"flex"}},n().createElement(x.Glyphicon,{glyph:"filter",className:"text-primary"})))};var Xe=r(215248);function Ye(){return Ye=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},Ye.apply(this,arguments)}function Je(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const Ke=()=>null;function et(e){return e.plugin?e:{...e,plugin:Ke}}function tt(){let e=arguments.length>1?arguments[1]:void 0,t=arguments.length>2?arguments[2]:void 0;return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map((r=>function(e){let t,r=arguments.length>2?arguments[2]:void 0;return t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]).find((t=>t.target===e.id)),t?.layerNameRegex&&(new RegExp(t.layerNameRegex).test(r)||(t=null)),t??e}(r,e,t))).map(et)}class rt extends n().Component{constructor(){super(...arguments),Je(this,"getItems",(e=>{const t=this.props.selectedLayer,r=this.props.items.filter(this.filterItem(e,t));return[...tt(this.props.standardItems[e],this.props.items,t).map((t=>({...t,target:e}))),...r].sort(((e,t)=>(e.position??0)-(t.position??0)))})),Je(this,"renderItem",((e,t)=>{const{validations:r,...s}=t,a=e.component??e.plugin,{style:o,...i}=this.props,l=this.props[e.id+"Options"];return!0===s[`hide${(0,Xe.upperFirst)(e.id)}`]?null:n().createElement(a,Ye({role:"body"},i,e.cfg,s,l,{validation:r?.[e.id??e.name]}))})),Je(this,"renderItems",((e,t)=>this.getItems(e).map((e=>this.renderItem(e,t))))),Je(this,"filterItem",((e,t)=>r=>{if(r.layerNameRegex){const s=new RegExp(r.layerNameRegex);return(!e||r.target===e)&&s.test(t)}return!e||r.target===e}))}render(){if(""!==this.props.featureTypeError)return n().createElement("div",null,n().createElement($e,{onToggleQuery:this.props.controlActions.onToggleQuery}),n().createElement("div",{style:{margin:"0 auto","text-align":"center"}},this.props.featureTypeErrorText));const e=n().createElement("div",{className:"m-header"},this.props.header,n().createElement(_e,{sendFilters:{attributeFilter:this.props.attributePanelExpanded,spatialFilter:this.props.spatialPanelExpanded,crossLayerFilter:this.props.crossLayerExpanded},filters:this.props.filters,params:this.props.params,filterFields:this.props.filterFields,groupFields:this.props.groupFields,spatialField:this.props.spatialField,toolbarEnabled:this.props.toolbarEnabled,searchUrl:this.props.searchUrl,showGeneratedFilter:this.props.showGeneratedFilter,featureTypeName:this.props.featureTypeName,ogcVersion:this.props.ogcVersion,filterType:this.props.filterType,actions:this.props.queryToolbarActions,resultTitle:this.props.resultTitle,pagination:this.props.pagination,sortOptions:this.props.sortOptions,crossLayerFilter:this.props.crossLayerFilterOptions.crossLayerFilter,hits:this.props.hits,allowEmptyFilter:this.props.allowEmptyFilter,emptyFilterWarning:this.props.emptyFilterWarning,appliedFilter:this.props.appliedFilter,storedFilter:this.props.storedFilter,advancedToolbar:this.props.advancedToolbar,loadingError:this.props.loadingError})),{spatialMethodOptions:t,toolsOptions:r,spatialOperations:s}=this.props;return this.props.attributes.length>0?n().createElement(Ae.Z,{header:e,className:"mapstore-query-builder",id:"query-form-panel"},this.renderItems("start",{spatialOperations:s,spatialMethodOptions:t,...r}),this.renderItems("attributes",{spatialOperations:s,spatialMethodOptions:t,...r}),this.renderItems("afterAttributes",{spatialOperations:s,spatialMethodOptions:t,...r}),this.renderItems("spatial",{spatialOperations:s,spatialMethodOptions:t,...r}),this.renderItems("afterSpatial",{spatialOperations:s,spatialMethodOptions:t,...r}),this.renderItems("layers",{spatialOperations:s,spatialMethodOptions:t,...r}),this.renderItems("end",{spatialOperations:s,spatialMethodOptions:t,...r})):n().createElement("div",{style:{margin:"0 auto",width:"60px"}},n().createElement(Ge(),{spinnerName:"three-bounce",overrideSpinnerClassName:"spinner"}))}}Je(rt,"propTypes",{params:i().object,attributes:i().array,featureTypeError:i().string,featureTypeErrorText:i().node,filterFields:i().array,groupFields:i().array,spatialField:i().object,attributePanelExpanded:i().bool,spatialPanelExpanded:i().bool,crossLayerExpanded:i().bool,toolbarEnabled:i().bool,searchUrl:i().string,showGeneratedFilter:i().oneOfType([i().bool,i().string]),filters:i().array,filterType:i().string,featureTypeName:i().string,ogcVersion:i().string,queryToolbarActions:i().object,resultTitle:i().string,pagination:i().object,sortOptions:i().object,spatialOperations:i().array,spatialMethodOptions:i().array,crossLayerFilterOptions:i().object,hits:i().bool,buttonStyle:i().string,maxHeight:i().number,allowEmptyFilter:i().bool,emptyFilterWarning:i().bool,header:i().node,zoom:i().number,projection:i().string,toolsOptions:i().object,appliedFilter:i().object,storedFilter:i().object,advancedToolbar:i().bool,loadingError:i().bool,controlActions:i().object,standardItems:i().object,items:i().array,selectedLayer:i().oneOfType([i().string,i().bool]),style:i().object}),Je(rt,"defaultProps",{params:{},buttonStyle:"default",removeGroupButtonIcon:"trash",groupFields:[],filterFields:[],filters:[],attributes:[],spatialMethodOptions:[],spatialOperations:[],featureTypeError:"",spatialField:{},crossLayerFilter:null,attributePanelExpanded:!0,spatialPanelExpanded:!0,toolbarEnabled:!0,searchUrl:"",showGeneratedFilter:!1,featureTypeName:null,pagination:null,sortOptions:null,hits:!1,maxHeight:830,allowEmptyFilter:!1,emptyFilterWarning:!1,advancedToolbar:!1,loadingError:!1,crossLayerFilterOptions:{},queryToolbarActions:{onQuery:()=>{},onReset:()=>{},onChangeDrawingStatus:()=>{},onSaveFilter:()=>{},onRestoreFilter:()=>{}},toolsOptions:{},controlActions:{onToggleQuery:()=>{}},items:[],selectedLayer:!1,standardItems:{},style:{}});const st=rt;var at=r(466737),ot=r(283604),it=r(410240),lt=r.n(it),nt=r(470509),pt=r.n(nt),ut=r(504518),ct=r(69090),dt=r(234228),ht=r(254020),mt=r(134479);const yt={isAutoCompleteEnabled:(e,t)=>e.ofType(De.S0).switchMap((e=>{const r=(0,dt.y9)(e.url,{version:"1.0.0",REQUEST:"DescribeProcess",IDENTIFIER:"gs:PagedUnique"},(0,mt.kS)(t.getState()));return null===r?de().Observable.of((0,h.NV)(!1)):de().Observable.fromPromise(pt().post(r,null,{timeout:5e3,headers:{Accept:"application/json","Content-Type":"application/xml"}}).then((e=>e.data))).switchMap((e=>lt()(e,"<ows:ExceptionReport")?de().Observable.of((0,h.NV)(!1)):de().Observable.of((0,h.NV)(!0)))).catch((()=>de().Observable.of((0,h.NV)(!1))))})),fetchAutocompleteOptionsEpic:(e,t)=>e.ofType(h.l1,h.nh).debounce((e=>de().Observable.timer(e.fieldOptions.delayDebounce||0))).filter((e=>"value"===e.fieldName&&"string"===e.fieldType&&t.getState().queryform.autocompleteEnabled)).switchMap((e=>{const r=t.getState(),s=(0,Fe.Vx)(r);let a={};if(a=e.type===h.nh?r.queryform.crossLayerFilter?.collectGeometries?.queryCollection?.filterFields?.filter((t=>t.rowId===e.rowId))[0]||{}:r.queryform&&r.queryform.filterFields&&r.queryform.filterFields.filter((t=>t.rowId===e.rowId))[0],"selected"===e.fieldOptions.selected)return de().Observable.from([e.type===h.nh?(0,h.ln)(a,[],0):(0,h.$J)(a,[],0)]);const o=(0,ct.getWpsPayload)({attribute:a.attribute,layerName:e.type===h.nh?r.queryform.crossLayerFilter?.collectGeometries?.queryCollection.typeName:(0,ht.HY)(r),layerFilter:(0,Fe.Vc)(r)||(0,Fe.hI)(r),maxFeatures:s,startIndex:e.fieldOptions.currentPage?e.fieldOptions.currentPage-1:1*s,value:e.fieldValue}),i=(0,dt.y9)(r.query.url,{outputFormat:"json"},(0,mt.kS)(t.getState()));return null===i?de().Observable.of((0,h.NV)(!1)):de().Observable.fromPromise(pt().post(i,o,{timeout:6e4,headers:{Accept:"application/json","Content-Type":"application/xml"}}).then((e=>e.data))).switchMap((t=>{let r=q()(t.values)?t.values:[t.values],s=t.size;return de().Observable.from(e.type===h.nh?[(0,h.ln)(a,r,s),(0,h.js)(e.rowId,!0,"crossLayer")]:[(0,h.$J)(a,r,s),(0,h.js)(e.rowId,!0,"filterField")])})).startWith((0,h.jR)(!0,a,e.type===h.nh?"crossLayer":"filterField")).catch((()=>de().Observable.from([e.type===h.nh?(0,h.ln)(a,[],0):(0,h.$J)(a,[],0),(0,ut.vU)({title:"warning",message:"warning",action:{label:"warning"},autoDismiss:3,position:"tr"}),(0,h.js)(e.rowId,!0,e.type===h.nh?"crossLayer":"filterField")]))).concat([(0,h.jR)(!1,a,e.type===h.nh?"crossLayer":"filterField")])}))};var gt=r(275982),ft=r(612912);const bt={handleLayerFilterPanel:(e,t)=>{let{getState:r}=t;return e.ofType(Ie.Xs).switchMap((()=>{const t=(0,ft.Iz)(r()),{url:s,name:a,layerFilter:o}=t||{},i=t&&t.search&&t.search.url;return de().Observable.of((0,De.gT)(i||s,a),(0,h.F)(o),(0,Ie.HH)(o),(0,m.Xg)("queryPanel","enabled",!0)).merge(de().Observable.of((0,De.jG)()).filter((()=>!ue()(r(),"query.isLayerFilter"))),e.ofType(h.Wm).switchMap((e=>{let{filterObj:s}=e,a=function(){let{crossLayerFilter:e,spatialField:t,filterFields:r,filters:s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return!!(r&&M()(r)||t&&t.method&&t.operation&&t.geometry||e&&e.collectGeometries&&e.operation)||s&&s.length>0}(s)?{...ue()(r(),"queryform",{})}:void 0;return a&&(a.filterFields=a.attributePanelExpanded&&a.filterFields||[],a.spatialField=a.spatialPanelExpanded&&a.spatialField||null,a.crossLayerFilter=a.crossLayerExpanded&&(0,j.setupCrossLayerFilterDefaults)(a.crossLayerFilter)||null),de().Observable.of(((e,t)=>(0,je.He)(e,{layerFilter:t}))(t.id,a))}))).let((e=>t=>t.takeUntil(e.ofType(m.kM).filter((function(){let{control:e,property:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return"queryPanel"===e&&(!t||"enabled"===t)})).merge(e.ofType(gt.nk))))(e)).concat(de().Observable.from([(0,De.jG)(),(0,h.mc)(),(0,b.Yf)("clean","","queryform",[],{})]))}))},restoreSavedFilter:(e,t)=>{let{getState:r}=t;return e.ofType(Ie.H1).switchMap((()=>{const e={typeName:ue()(r(),"state.query.typeName")},t=ue()(r(),"state.query.url"),s=ue()(r(),"layerFilter.persisted");return de().Observable.of((0,b.Yf)("clean","","queryform",[]),(0,h.F)(s),(0,h.yC)(t,s,e),(0,De.Xc)())}))},onApplyFilter:(e,t)=>{let{getState:r}=t;return e.ofType(Ie.MY).map((()=>{const e={...ue()(r(),"queryform",{})};return(0,Ie.Xr)(e)}))}};var Ft=r(813292),vt=r.n(Ft);const wt={updateSpatialFilterValue:e=>e.ofType(h.Wi).switchMap((e=>{let{feature:t,srsName:r,style:s,options:a}=e;return ce.Observable.of((0,b.Yf)("drawOrEdit",t.geometry.type,"queryform",[t],{editEnabled:!1,stopAfterDrawing:!0,featureProjection:r},s)).concat(t&&a&&a.autoZoom?[(0,Le.Px)(vt()(t),r)]:[])}))};var Et=r(472500),xt=r(820709),Pt=r(833517);const Ct=e=>({geometry:e.featureTypes[0].properties.filter((e=>0===e.type.indexOf("gml:"))).map((e=>({label:e.name,attribute:e.name,type:"geometry",valueId:"id",valueLabel:"name",values:[]}))),original:e,attributes:ge(e)}),St={};var Ot=r(698183),Tt=r(13316),qt=r(641259),Nt=r(350126),It=r(399790),jt=r(488400);function Lt(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const Dt=h.mc.bind(null,"query"),Mt=(0,p.connect)((e=>({useMapProjection:e.queryform.useMapProjection,groupLevels:e.queryform.groupLevels,groupFields:e.queryform.groupFields,filterFields:e.queryform.filterFields,attributes:e.query&&e.query.typeName&&e.query.featureTypes&&e.query.featureTypes[e.query.typeName]&&e.query.featureTypes[e.query.typeName].attributes,featureTypeError:e.query&&e.query.typeName&&e.query.featureTypes&&e.query.featureTypes[e.query.typeName]&&e.query.featureTypes[e.query.typeName].error,spatialField:e.queryform.spatialField,filters:e.queryform.filters,showDetailsPanel:e.queryform.showDetailsPanel,toolbarEnabled:e.queryform.toolbarEnabled,attributePanelExpanded:e.queryform.attributePanelExpanded,autocompleteEnabled:e.queryform.autocompleteEnabled,crossLayerExpanded:e.queryform.crossLayerExpanded,crossLayerFilterOptions:{layers:(0,Fe.GK)(e),crossLayerFilter:(0,Fe.qh)(e),...e.queryform.crossLayerFilterOptions||{}},maxFeaturesWPS:e.queryform.maxFeaturesWPS,spatialPanelExpanded:e.queryform.spatialPanelExpanded,featureTypeConfigUrl:e.query&&e.query.url,searchUrl:e.query&&e.query.url,featureTypeName:e.query&&e.query.typeName,ogcVersion:"1.1.0",params:{typeName:e.query&&e.query.typeName},resultTitle:"Query Result",showGeneratedFilter:!1,allowEmptyFilter:!0,emptyFilterWarning:!0,maxHeight:e.map&&e.map.present&&e.map.present.size&&e.map.present.size.height,zoom:((0,f.Od)(e)||{}).zoom,projection:((0,f.Od)(e)||{}).projection})),(e=>({attributeFilterActions:(0,c.DE)({onAddGroupField:h.kQ,onAddFilterField:h.jW,onRemoveFilterField:h.JG,onUpdateFilterField:h.q$,onUpdateExceptionField:h.OZ,onUpdateLogicCombo:h.Nc,onRemoveGroupField:h.I5,onChangeCascadingValue:h.QL,toggleMenu:h.js,onExpandAttributeFilterPanel:h.I},e),spatialFilterActions:(0,c.DE)({onChangeSpatialFilterValue:h.uo,onExpandSpatialFilterPanel:h.ku,onSelectSpatialMethod:h.HT,onSelectViewportSpatialMethod:h.lg,onSelectSpatialOperation:h.VF,onChangeDrawingStatus:b.Yf,onRemoveSpatialSelection:h.Ry,onShowSpatialSelectionDetails:h.ZH,onChangeDwithinValue:h.AQ,zoneFilter:h.eJ,zoneSearch:h.uM,zoneChange:h.uP},e),queryToolbarActions:(0,c.DE)({onQuery:h.yC,onReset:Dt,onSaveFilter:Ie.no,onRestoreFilter:Ie.Nd,storeAppliedFilter:Ie.Rb,onChangeDrawingStatus:b.Yf},e),crossLayerFilterActions:(0,c.DE)({expandCrossLayerFilterPanel:h.EU,setCrossLayerFilterParameter:h.IV,addCrossLayerFilterField:h.N5,updateCrossLayerFilterField:h.bn,removeCrossLayerFilterField:h.Bm,resetCrossLayerFilter:h.F2,toggleMenu:(e,t)=>(0,h.js)(e,t,"crossLayer")},e),controlActions:(0,c.DE)({onToggleQuery:m.Xi.bind(null,"queryPanel",null)},e)})))(st),Vt=(0,d.P1)([e=>e.controls&&e.controls.toolbar&&"toc"===e.controls.toolbar.active,ft.Bt,e=>e.layers&&e.layers.settings,Ne._d,e=>(0,Nt.ic)(e,{height:!0}),qt.Wy,Fe.Vc,Fe.hI,e=>e&&e.query&&e.query.isLayerFilter,ft.P_,ht.HY],((e,t,r,s,a,o,i,l,n,p,u)=>({enabled:e,groups:t,settings:r,queryPanelEnabled:s,layout:o?{}:a,appliedFilter:i,storedFilter:l,advancedToolbar:n,loadingError:p,selectedLayer:u})));class Zt extends n().Component{constructor(e){super(e),Lt(this,"getNoBackgroundLayers",(e=>"background"!==e.name)),Lt(this,"renderSidebar",(()=>n().createElement(u.Z,{open:this.props.queryPanelEnabled,sidebar:this.renderQueryPanel(),sidebarClassName:"query-form-panel-container",touch:!1,styles:{sidebar:{...this.props.layout,zIndex:1024,width:600},overlay:{zIndex:1023,width:0},root:{right:this.props.queryPanelEnabled?0:"auto",width:"0",overflow:"visible"},content:{overflowY:"auto"}}},n().createElement("div",null)))),Lt(this,"onToggle",(()=>{this.props.advancedToolbar&&!a()(this.props.appliedFilter,this.props.storedFilter)?this.setState((()=>({showModal:!0}))):this.props.onToggleQuery()})),Lt(this,"restoreAndClose",(()=>{this.setState((()=>({showModal:!1}))),this.props.onRestoreFilter(),this.props.onToggleQuery()})),Lt(this,"storeAndClose",(()=>{this.setState((()=>({showModal:!1}))),this.props.onSaveFilter(),this.props.onToggleQuery()})),Lt(this,"renderQueryPanel",(()=>n().createElement("div",{className:"mapstore-query-builder"},n().createElement(Mt,{queryPanelEnabled:this.props.queryPanelEnabled,header:n().createElement($e,{loadingError:this.props.loadingError,onToggleQuery:this.onToggle}),spatialOperations:this.props.spatialOperations,spatialMethodOptions:this.props.spatialMethodOptions,toolsOptions:this.props.toolsOptions,featureTypeErrorText:n().createElement(jt.Z,{msgId:"layerProperties.featureTypeError"}),appliedFilter:this.props.appliedFilter,storedFilter:this.props.storedFilter,advancedToolbar:this.props.advancedToolbar,loadingError:this.props.loadingError,items:this.props.items,selectedLayer:this.props.selectedLayer,standardItems:Te}),n().createElement(at.Z,null,n().createElement(ot.Z,{fade:!0,show:this.state.showModal,title:n().createElement(jt.Z,{msgId:"queryform.changedFilter"}),size:"xs",onClose:()=>this.setState((()=>({showModal:!1}))),buttons:[{bsStyle:"primary",text:n().createElement(jt.Z,{msgId:"yes"}),onClick:this.storeAndClose},{bsStyle:"primary",text:n().createElement(jt.Z,{msgId:"no"}),onClick:this.restoreAndClose}]},n().createElement("div",{className:"ms-alert"},n().createElement("div",{className:"ms-alert-center"},n().createElement(jt.Z,{msgId:this.props.loadingError?"queryform.changedFilterWithErrorAlert":"queryform.changedFilterAlert"})))))))),this.state={showModal:!1}}UNSAFE_componentWillReceiveProps(e){!0===e.queryPanelEnabled&&!1===this.props.queryPanelEnabled&&this.props.onInit()}render(){return this.renderSidebar()}}Lt(Zt,"propTypes",{id:i().number,buttonContent:i().node,groups:i().array,settings:i().object,queryPanelEnabled:i().bool,groupStyle:i().object,groupPropertiesChangeHandler:i().func,layerPropertiesChangeHandler:i().func,onToggleGroup:i().func,onToggleLayer:i().func,onToggleQuery:i().func,onZoomToExtent:i().func,retrieveLayerData:i().func,onSort:i().func,onInit:i().func,onSettings:i().func,hideSettings:i().func,updateSettings:i().func,updateNode:i().func,removeNode:i().func,activateRemoveLayer:i().bool,activateLegendTool:i().bool,activateZoomTool:i().bool,activateSettingsTool:i().bool,visibilityCheckType:i().string,settingsOptions:i().object,layout:i().object,toolsOptions:i().object,appliedFilter:i().object,storedFilter:i().object,advancedToolbar:i().bool,onSaveFilter:i().func,onRestoreFilter:i().func,items:i().array,selectedLayer:i().oneOfType([i().string,i().bool])}),Lt(Zt,"defaultProps",{groupPropertiesChangeHandler:()=>{},layerPropertiesChangeHandler:()=>{},retrieveLayerData:()=>{},onToggleGroup:()=>{},onToggleLayer:()=>{},onToggleQuery:()=>{},onZoomToExtent:()=>{},onSettings:()=>{},onInit:()=>{},updateNode:()=>{},removeNode:()=>{},activateLegendTool:!0,activateZoomTool:!0,activateSettingsTool:!0,activateRemoveLayer:!0,visibilityCheckType:"checkbox",settingsOptions:{},queryPanelEnabled:!1,layout:{},toolsOptions:{},onSaveFilter:()=>{},onRestoreFilter:()=>{},items:[],selectedLayer:!1});const kt={QueryPanelPlugin:(0,p.connect)(Vt,{groupPropertiesChangeHandler:je.WO,layerPropertiesChangeHandler:je.He,retrieveLayerData:qe.k,onToggleGroup:(0,It.$0)("groups",je.bh),onToggleLayer:(0,It.$0)("layers",je.bh),onToggleQuery:m.Xi.bind(null,"queryPanel",null),onSort:(0,It.dD)(It.lD,je.MK),onSettings:je.RP,onInit:De.Xc,onZoomToExtent:Le.Px,hideSettings:je.sF,updateSettings:je.VP,updateNode:je.tV,removeNode:je.ZF,onSaveFilter:Ie.no,onRestoreFilter:Ie.Nd})(Zt),reducers:{queryform:Tt.Z,query:Ot.Z,layerFilter:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:St,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Ie.y6:return{...St,persisted:t.filter,applied:t.filter};case Ie.H1:return{...e,applied:e.persisted};case Ie.g$:return{...e,applied:t.filter};case Ie.Xk:return{...e,persisted:e.applied};case h.Eg:return{...e,applied:void 0};default:return e}}},epics:{featureTypeSelectedEpic:(e,t)=>e.ofType(De.S0).filter((e=>e.url&&e.typeName)).switchMap((e=>{const r=t.getState();if((0,ht.hk)(r,e.typeName)){const t=Ct((0,ht.qj)(r,e.typeName)),s=t.geometry[0]&&t.geometry[0].attribute?t.geometry[0].attribute:"the_geom";return de().Observable.of((0,De.rG)(e.typeName,t),(0,h.DD)(s),de().Scheduler.async)}const s=(0,xt.Li)(r);return s&&"vector"===s.type?de().Observable.defer((()=>pt().get(e.url))).map((t=>{var r={featureTypes:[t.data.featureTypes[0]]},s={geometry:r.featureTypes[0].properties.filter((e=>0===e.name.indexOf("geometry"))).map((e=>e)),original:r,attributes:ge(r)};const a=s.geometry[0]&&s.geometry[0].attribute?s.geometry[0].attribute:"the_geom";var o=new Promise((e=>{e((0,h.DD)(a))})).then((()=>new Promise((t=>{t((0,De.rG)(e.typeName,s))}))));return de().Observable.defer((()=>o))})).mergeAll():de().Observable.defer((()=>pt().get(dt.ZP.filterUrlParams(e.url,(0,mt.kS)(t.getState()))+"?service=WFS&version=1.1.0&request=DescribeFeatureType&typeName="+e.typeName+"&outputFormat=application/json"))).map((t=>{if("object"==typeof t.data&&t.data.featureTypes&&t.data.featureTypes[0]){const r=Ct(t.data),s=r.geometry[0]&&r.geometry[0].attribute?r.geometry[0].attribute:"the_geom";return de().Observable.from([(0,h.DD)(s),(0,De.rG)(e.typeName,r)])}try{JSON.parse(t.data)}catch(t){return de().Observable.from([(0,De.t3)(e.typeName,"Error from WFS: "+t.message),ut.vU({title:"warning",message:"layerProperties.featureTypeErrorInvalidJSON",autoDismiss:3,position:"tc"})])}return de().Observable.from([(0,De.t3)(e.typeName,"Error: feature types are empty")])})).mergeAll().catch((t=>de().Observable.of((0,De.t3)(e.typeName,t.message||t.statusText))))})),wfsQueryEpic:(e,t)=>e.ofType(De.Qq).switchMap((r=>{const s=(a=(o=t.getState()).query&&o.query.featureTypes&&o.query.featureTypes[o.query.typeName]&&o.query.featureTypes[o.query.typeName].attributes&&o.query.featureTypes[o.query.typeName].attributes[0]&&o.query.featureTypes[o.query.typeName].attributes[0].attribute||null)?{sortBy:a,sortOrder:"A"}:{};var a,o;const i=r?.filterObj?.sortOptions||s,l=ht.b0.totalFeatures(t.getState()),n=dt.ZP.filterUrlParams(r.searchUrl,(0,mt.kS)(t.getState())),p=(0,xt.Li)(t.getState()),u=(0,xt.lg)(t.getState()),{layerFilter:c,params:d={}}=p??{},h=d?.[v()(Object.keys(d||{}),(function(){return"cql_filter"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").toLowerCase()}))],m="vector"===p?.type?r.filterObj:(0,j.mergeFiltersToOGC)({ogcVersion:"1.1.0"},h,u?c:null,r.filterObj),{url:y,options:g}=((e,t,r)=>{const s=(0,xt.u$)(r),a=(0,Pt.jo)({id:s},"time")(r),o=(0,ft.CA)(r,s)||{},i=ue()(o,'params["time"]');if((0,xt.DK)(r)&&a&&i){const r=(0,Et.parse)(e)||{};return{url:(0,Et.format)({...r,query:{...r.query,time:i}}),options:t}}return{url:e,options:t}})(n,r.queryOptions||{},t.getState()),f={...r.filterObj.pagination,totalFeatures:l,sortOptions:i,...g,layer:p};return de().Observable.merge((0,he.Mc)({...p,name:r.filterObj.featureTypeName||p?.name,search:{...p?.search??{},url:y}},m,f).map((e=>(0,De.w_)(e,r.searchUrl,r.filterObj,r.queryOptions,r.reason))).catch((e=>de().Observable.of((0,De.Lm)(e)))).startWith((0,De.Fs)(!0)).concat(de().Observable.of((0,De.Fs)(!1)),de().Observable.of((0,je.kI)(p?.id)))).takeUntil(e.ofType(De.VN))})),viewportSelectedEpic:(e,t)=>e.ofType(h.On,Le.pP).switchMap((e=>{const r=e.type===Le.pP?e:(0,f.Od)(t.getState());if((e.type===h.On||e.type===Le.pP&&"Viewport"===(0,Fe.BU)(t.getState()))&&r.bbox&&r.bbox.bounds&&r.bbox.crs){const e=Object.keys(r.bbox.bounds).reduce(((e,t)=>X()({},e,{[t]:parseFloat(r.bbox.bounds[t])})),{});return de().Observable.of((0,h.ds)(Y.default.getViewportGeometry(e,r.bbox.crs)))}return de().Observable.empty()})),redrawSpatialFilterEpic:(e,t)=>e.ofType(De.R1).switchMap((()=>{const e=t.getState(),r=(0,Fe.vE)(e),s={type:"Feature",geometry:{type:(0,Fe.a8)(e),coordinates:(0,Fe.G$)(e)}};let a=(0,Fe.Nl)(e)?(0,b.Yf)("drawOrEdit",r.method||"","queryform",[s],{featureProjection:(0,Fe.IM)(e),drawEnabled:!1,editEnabled:!1}):(0,b.Yf)("clean",r.method||"","queryform",[],{drawEnabled:!1,editEnabled:!1});return de().Observable.of(a)})),...yt,...wt,...bt}}},69090:(e,t,r)=>{const{isFilterValid:s,toOGCFilterParts:a}=r(738839),o=r(883796),{and:i}=o({});e.exports={getWpsPayload:e=>{let{layerName:t,layerFilter:r,attribute:o,maxFeatures:l,startIndex:n,value:p}=e;const u=p?'<ogc:PropertyIsLike matchCase="false" wildCard="*" singleChar="." escapeChar="!">   <ogc:PropertyName>'+o+"</ogc:PropertyName>   <ogc:Literal>*"+p+"*</ogc:Literal></ogc:PropertyIsLike>":"",c=r&&!r.disabled&&s(r)?a(r,"1.1.0","ogc"):[];return'<wps:Execute xmlns:wps="http://www.opengis.net/wps/1.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" version="1.0.0" service="WPS" xsi:schemaLocation="http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd">  <ows:Identifier xmlns:ows="http://www.opengis.net/ows/1.1">gs:PagedUnique</ows:Identifier>  <wps:DataInputs>    <wps:Input>      <ows:Identifier xmlns:ows="http://www.opengis.net/ows/1.1">features</ows:Identifier>      <ows:Title xmlns:ows="http://www.opengis.net/ows/1.1">features</ows:Title>      <wps:Data />      <wps:Reference xmlns:xlink="http://www.w3.org/1999/xlink" mimeType="text/xml" xlink:href="http://geoserver/wfs" method="POST">        <wps:Body>         <wfs:GetFeature xmlns:wfs="http://www.opengis.net/wfs" service="WFS" version="1.0.0">           <wfs:Query typeName="'+t+'">'+(u.length>0||c.length>0?'<ogc:Filter xmlns:ogc="http://www.opengis.net/ogc" xmlns:gml="http://www.opengis.net/gml">'+i(...c,u)+"</ogc:Filter>":"")+'             <ogc:SortBy xmlns:ogc="http://www.opengis.net/ogc">               <ogc:SortProperty>                 <ogc:PropertyName>'+o+'</ogc:PropertyName>               </ogc:SortProperty>             </ogc:SortBy>           </wfs:Query>         </wfs:GetFeature>       </wps:Body>     </wps:Reference>   </wps:Input>   <wps:Input>     <ows:Identifier xmlns:ows="http://www.opengis.net/ows/1.1">fieldName</ows:Identifier>     <ows:Title xmlns:ows="http://www.opengis.net/ows/1.1">fieldName</ows:Title>     <wps:Data>       <wps:LiteralData>'+o+'</wps:LiteralData>     </wps:Data>   </wps:Input>   <wps:Input>     <ows:Identifier xmlns:ows="http://www.opengis.net/ows/1.1">maxFeatures</ows:Identifier>     <ows:Title xmlns:ows="http://www.opengis.net/ows/1.1">maxFeatures</ows:Title>     <wps:Data>       <wps:LiteralData>'+l+'</wps:LiteralData>     </wps:Data>   </wps:Input>   <wps:Input>     <ows:Identifier xmlns:ows="http://www.opengis.net/ows/1.1">startIndex</ows:Identifier>     <ows:Title xmlns:ows="http://www.opengis.net/ows/1.1">startIndex</ows:Title>     <wps:Data>       <wps:LiteralData>'+n+'</wps:LiteralData>     </wps:Data>   </wps:Input> </wps:DataInputs> <wps:ResponseForm>   <wps:RawDataOutput mimeType="application/json">     <ows:Identifier xmlns:ows="http://www.opengis.net/ows/1.1">result</ows:Identifier>   </wps:RawDataOutput> </wps:ResponseForm></wps:Execute>'}}},768271:(e,t,r)=>{"use strict";r.d(t,{Z:()=>o});var s=r(923645),a=r.n(s)()((function(e){return e[1]}));a.push([e.id,"",""]);const o=a}}]);