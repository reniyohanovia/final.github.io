(self.webpackChunkmapstore2=self.webpackChunkmapstore2||[]).push([[8678],{227556:(e,t,r)=>{"use strict";r.d(t,{Z:()=>n});var o=r(124852),s=r(843033);let i;const n=e=>{const{map:t,onBoxEnd:r,status:n}=e;return(0,o.useEffect)((()=>{"start"===n?(i=new s.Z({condition:function(e){return e.originalEvent.altKey}}),t.addInteraction(i)):"end"===n&&t.removeInteraction(i)}),[n]),(0,o.useEffect)((()=>{i&&i.on("boxend",(e=>{r({boxExtent:i.getGeometry().getExtent(),modifiers:{ctrl:e.mapBrowserEvent.pointerEvent.ctrlKey,metaKey:e.mapBrowserEvent.pointerEvent.metaKey}})}))}),[n]),null}},926202:(e,t,r)=>{"use strict";r.d(t,{Z:()=>Se});var o=r(124852),s=r.n(o),i=r(957043),n=r.n(i),a=r(91175),p=r.n(a),c=r(313311),l=r.n(c),d=r(512571),h=r.n(d),u=r(957557),g=r.n(u),y=r(701469),m=r.n(y),f=r(610928),w=r.n(f),C=r(763105),P=r.n(C),S=r(414293),G=r.n(S),I=r(984596),v=r.n(I),F=r(45697),b=r.n(F),E=r(727418),x=r.n(E),M=r(455877),T=r.n(M),L=r(470509),O=r.n(L),j=r(835516),k=r(351546),Z=r(119950),D=r(847529),A=r(363082),_=r(923715),W=r(169141),N=r(623068),R=r(973410),H=r(429902),J=r(372445);window.ol&&!ol.ext&&(ol.ext={});var V=function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e};window.ol&&(ol.inherits||(ol.inherits=V)),window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach),window.Element&&!Element.prototype.remove&&(Element.prototype.remove=function(){this.parentNode&&this.parentNode.removeChild(this)});const B=V;var K=r(15265),q=r(513987),U=r(562948),z=r(51273),X=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=this;let r;this._select=new z.Z({style:e.style}),this._select.setActive(!1);const o=e.geometryFunction;if(r=o?function(e,r){return o(e,t._geometryFn(e,r))}:function(e,r){return t._geometryFn(e,r)},e.type="Polygon",e.geometryFunction=r,J.ZP.call(this,e),e.layers&&("function"==typeof e.layers?this.layers_=e.layers:e.layers.indexOf&&(this.layers_=function(t){return e.layers.indexOf(t)>=0})),"function"==typeof e.featureFilter)this._features=e.featureFilter;else if(e.featureFilter){const t=e.featureFilter;this._features=function(e){return t.indexOf?!!t[t.indexOf(e)]:!!t.item(t.getArray().indexOf(e))}}else this._features=function(){return!0};this.on("drawstart",this._startDrawing.bind(this)),this.on("drawend",this._finishDrawing.bind(this))};B(X,J.ZP),X.prototype.setMap=function(e){this.getMap()&&this.getMap().removeInteraction(this._select),e&&e.addInteraction(this._select),J.ZP.prototype.setMap.call(this,e)},X.prototype.setActive=function(e){this._select.getFeatures().clear(),J.ZP.prototype.setActive.call(this,e)},X.prototype.removeLastPoint=function(){this._feature&&this._feature.getGeometry().getCoordinates()[0].length>2&&J.ZP.prototype.removeLastPoint.call(this)},X.prototype.getPolygon=function(){return this._polygon},X.prototype._startDrawing=function(e){const t=this.getMap();this._feature=e.feature;const r=e.feature.getGeometry().getCoordinates()[0][0];this._current=null,t.forEachFeatureAtPixel(t.getPixelFromCoordinate(r),function(e,t){if(!this._current&&this._features(e,t)){const t=e.getGeometry();if("Polygon"===t.getType()&&t.intersectsCoordinate(r))this._polygonIndex=!1,this._polygon=t,this._current=e;else if("MultiPolygon"===t.getType()&&t.intersectsCoordinate(r))for(let o,s=0;t.getPolygon(s);s++)if(o=t.getPolygon(s),o.intersectsCoordinate(r)){this._polygonIndex=s,this._polygon=o,this._current=e;break}}}.bind(this),{layerFilter:this.layers_}),this._select.getFeatures().clear(),this._current?this._select.getFeatures().push(this._current):(this.setActive(!1),this.setActive(!0))},X.prototype._finishDrawing=function(e){e.hole=e.feature,e.feature=this._select.getFeatures().item(0),this.dispatchEvent({type:"modifystart",features:[this._current]});const t=e.hole.getGeometry().getCoordinates()[0];if(t.length>=3)if(!1!==this._polygonIndex){const r=e.feature.getGeometry(),o=new q.Z([]);for(let e,s=0;r.getPolygon(s);s++)e=r.getPolygon(s),s===this._polygonIndex?(e.appendLinearRing(new U.Z(t)),o.appendPolygon(e)):o.appendPolygon(e);e.feature.setGeometry(o)}else this.getPolygon().appendLinearRing(new U.Z(t));this.dispatchEvent({type:"modifyend",features:[this._current]}),this._feature=null,this._select.getFeatures().clear()},X.prototype._geometryFn=function(e,t){const r=e[0].pop();return this.getPolygon()&&!this.getPolygon().intersectsCoordinate(r)||(this.lastOKCoord=[r[0],r[1]]),e[0].push([this.lastOKCoord[0],this.lastOKCoord[1]]),t&&t.setCoordinates([e[0].concat([e[0][0]])]),new K.ZP(e)};const $=X;var Q=r(552329),Y=r(752043),ee=r(944538),te=r(525642),re=r(869669),oe=r(798090),se=r(831219),ie=r(120767),ne=r(898185),ae=r(315565),pe=r(409371),ce=r(378426),le=r(436403),de=r(718369),he=r(829194),ue=r(701577),ge=r(756834),ye=r(421915),me=r(650141),fe=r(880161),we=r(487758);function Ce(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,"string");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const Pe=new W.Z;class Se extends s().Component{constructor(){var e;super(...arguments),e=this,Ce(this,"getNewFeature",((e,t,r,o)=>new N.Z({geometry:this.createOLGeometry({type:e,coordinates:t,radius:r,center:o})}))),Ce(this,"getMapCrs",(()=>this.props.map.getView().getProjection().getCode())),Ce(this,"getWMSSnapSource",((e,t)=>{const r=this.props.toggleSnappingIsLoading;if(this?.snapMetadata?.id!==e.id){const o=new R.Z({format:new W.Z,loader:function(s,i,n){const a=n.getCode(),p=(0,we.g7)(e.search.url,e.name,{version:"1.1.0",outputFormat:"application/json",srsname:a,bbox:s.join(",")+","+a,maxFeatures:t?.maxFeatures??5e5});r();const c=e=>{o.removeLoadedExtent(s),e&&console.warn(e)};O().get(p).then((e=>{r(),200===e.status?o.addFeatures(o.getFormat().readFeatures(e.data)):c()})).catch(c)},strategy:this.selectLoadingStrategy(t)});this.snapMetadata={id:e.id,source:o}}return this.snapMetadata.source})),Ce(this,"getLayerInstance",(e=>this.props.map.getLayers().getArray().find((t=>t.get("msId")===e)))),Ce(this,"updateFeatureStyles",(e=>{e&&e.length>0&&e.forEach((e=>{if(e.style){let t=this.toOlFeature(e);t&&t.setStyle(e.style?(0,_.C2)(e):this.toOlStyle(e.style,e.selected))}}))})),Ce(this,"updateOnlyFeatureStyles",(e=>{this.drawLayer&&this.drawLayer.getSource().getFeatures().forEach((t=>{let r=p()(e.features).features||e.features,o=l()(r,(e=>e.properties.id===t.getProperties().id));if(o){let e=(0,Z.createStylesAsync)(v()(o.style));O().all(e).then((e=>{t.setStyle((()=>(0,_.Cw)({...o,style:e})))}))}}))})),Ce(this,"addLayer",((e,t)=>{let r=null;const o=this.convertGeometryTypeToStyleType(e.drawMethod);r=t=>{let r=p()(e.features)&&l()(p()(e.features).features,(e=>e.properties.id===t.getProperties().id))||null;if(r){let e=(0,Z.createStylesAsync)(v()(r.style));return O().all(e).then((e=>{t.setStyle((()=>(0,_.Cw)({...r,style:e})))})),null}return(0,_.Cw)({style:_.jF[o]})},this.geojson=new W.Z,this.drawSource=new R.Z,this.drawLayer=new H.Z({source:this.drawSource,zIndex:1e8,style:r}),this.props.map.addLayer(this.drawLayer),t&&this.addInteractions(e);let s=p()(e.features);if(s&&s.features&&s.features.length){const t=s.features.filter((t=>!t.properties.isCircle||t.properties.isCircle&&!t.properties.canEdit||!e.options.drawEnabled));return this.addFeatures(x()({},e,{features:[{...s,features:t}]}))}return this.addFeatures(e)})),Ce(this,"addFeatures",(e=>{let{features:t,drawMethod:r,options:o}=e;const s=this.getMapCrs();let i;if(t.forEach((e=>{if("FeatureCollection"===e.type){let t=(new W.Z).readFeatures(e);o.geodesic||(t=t.map((e=>(0,D.aj)(e,s)))),this.drawSource=new R.Z({features:t}),this.drawLayer.setSource(this.drawSource)}else{let t=null,n=e;n.geometry&&"GeometryCollection"!==n.geometry.type&&(n=(0,k.reprojectGeoJson)(n,n.featureProjection,s).geometry),"GeometryCollection"!==n.type&&("Circle"===r&&n&&(n.properties&&n.properties.center||n.center)?(t=n.properties&&n.properties.center?(0,k.reproject)(n.properties.center,"EPSG:4326",s):n.center,t=[t.x,t.y],i=new N.Z({geometry:this.createOLGeometry({type:"Circle",center:t,projection:"EPSG:3857",radius:n.properties&&n.properties.radius||n.radius,options:o})})):i=new N.Z({geometry:this.createOLGeometry(n.geometry?n.geometry:{...n,radius:n.properties?.radius,center:t})}),i.setProperties(e.properties),this.drawSource.addFeature(i))}})),0===t.length&&(o.editEnabled||o.drawEnabled))o.transformToFeatureCollection?(this.drawSource=new R.Z({features:(new W.Z).readFeatures({type:"FeatureCollection",features:[]})}),this.drawLayer.setSource(this.drawSource)):(i=new N.Z({geometry:this.createOLGeometry({type:r,coordinates:null})}),this.drawSource.addFeature(i));else{if(t[0]&&"GeometryCollection"===t[0].type){this.drawSource=new R.Z({features:(new W.Z).readFeatures(t[0])});let e=this.replacePolygonsWithCircles(this.drawSource.getFeatures()[0]);this.drawSource.getFeatures()[0].getGeometry().setGeometries(e),this.drawLayer.setSource(this.drawSource)}t[0]&&t[0].geometry&&"GeometryCollection"===t[0].geometry.type&&(i=(0,k.reprojectGeoJson)(t[0],o.featureProjection,s).geometry,this.drawSource=new R.Z({features:(new W.Z).readFeatures(i)}),this.drawSource.getFeatures()[0].set("textGeometriesIndexes",t[0].properties&&t[0].properties.textGeometriesIndexes),this.drawSource.getFeatures()[0].set("textValues",t[0].properties&&t[0].properties.textValues),this.drawSource.getFeatures()[0].set("circles",t[0].properties&&t[0].properties.circles),this.drawLayer.setSource(this.drawSource))}return this.updateFeatureStyles(t),i})),Ce(this,"replaceFeatures",(e=>{let t;return this.drawLayer?(this.drawSource.clear(),t=this.addFeatures(e),e.style&&this.drawLayer.setStyle((t=>{let r=l()(p()(e.features).features,(e=>e.properties.id===t.getProperties().id));if(r){let e=(0,Z.createStylesAsync)(v()(r.style));return O().all(e).then((e=>{t.setStyle((()=>(0,_.Cw)({...r,style:e})))})),null}const o=this.convertGeometryTypeToStyleType(e.drawMethod);return(0,_.Cw)({style:_.jF[o]})}))):t=this.addLayer(e,e.options&&e.options.drawEnabled||!1),t})),Ce(this,"endDrawing",(e=>{const t=this.replaceFeatures(e);if(t){const r=this.fromOLFeature(t);"Circle"===e.drawMethod&&e&&e.features&&e.features.length&&e.features[0]&&e.features[0].radius>=0&&(r.radius=e.features[0].radius),this.props.onEndDrawing(r,e.drawOwner)}})),Ce(this,"addDrawInteraction",((e,t,r,o)=>{this.drawInteraction&&this.removeDrawInteraction(),this.drawInteraction=new J.ZP(this.drawPropertiesForGeometryType(e,r,this.drawSource,o)),this.props.map.disableEventListener("singleclick"),this.drawInteraction.on("drawstart",(()=>{this.selectInteraction&&(this.selectInteraction.getFeatures().clear(),this.selectInteraction.setActive(!1))})),this.drawInteraction.on("drawend",(e=>{const r=e.feature.clone();if(r.set("id",T().v1()),"Circle"===this.props.drawMethod&&"Circle"===r.getGeometry().getType()){const e=r.getGeometry().getRadius(),t=r.getGeometry().getCenter();r.setGeometry(this.polygonFromCircle(t,e))}const o=this.fromOLFeature(r,t);this.props.onEndDrawing(o,this.props.drawOwner),this.props.options.stopAfterDrawing&&this.props.onChangeDrawingStatus("stop",this.props.drawMethod,this.props.drawOwner,this.props.features.concat([o])),this.selectInteraction&&(this.addSelectInteraction(),this.selectInteraction.setActive(!0))})),this.props.map.addInteraction(this.drawInteraction),this.setDoubleClickZoomEnabled(!1)})),Ce(this,"selectLoadingStrategy",(e=>"all"===e?.strategy?fe.$6:fe.VW)),Ce(this,"addSnapInteraction",(e=>{let{snapping:t,snappingLayerInstance:r,snapConfig:o}=e;if(!t)return;const s=this.getLayerInstance(r.id),i=r.type;if(this.removeSnapInteraction(),s){switch(s?.type){case D.ox:this.snapInteraction=new me.Z({...o,source:s.getSource()});break;case D.dV:case D.k4:if("wms"===i){const e=this.getWMSSnapSource(r,o);this.snapLayer=new H.Z({source:e,style:new se.default({stroke:new ie.default({color:"rgba(255,255,0,0)"})})}),this.props.map.addLayer(this.snapLayer),this.snapInteraction=new me.Z({...o,source:e})}}this.snapInteraction&&this.props.map.addInteraction(this.snapInteraction)}})),Ce(this,"toMulti",(e=>"Point"===e.getType()?new Q.Z([e.getCoordinates()]):e)),Ce(this,"handleDrawAndEdit",((e,t,r,o)=>{this.drawInteraction&&this.removeDrawInteraction(),this.drawInteraction=new J.ZP(this.drawPropertiesForGeometryType((0,j.getSimpleGeomType)(e),r,(0,j.isSimpleGeomType)(e)?this.drawSource:null,o)),this.props.map.disableEventListener("singleclick"),this.drawInteraction.on("drawstart",(()=>{this.selectInteraction&&(this.selectInteraction.getFeatures().clear(),this.selectInteraction.setActive(!1))})),this.drawInteraction.on("drawend",(r=>{const s=r.feature.clone(),i=T().v1();s.set("id",i);let n,a,c,d=s.getGeometry(),h=this.drawLayer.getSource().getFeatures(),u=this.props.features;if(this.props.options.transformToFeatureCollection){let t;if("Circle"===e){let e,s,n;if(c="Polygon",this.props.options.geodesic){s=r.feature.getGeometry().geodesicCenter||(0,ye.qg)(d.getExtent());const t=this.props.map.getView().getProjection().getCode(),o=[[...s],[...d.getCoordinates()[0][0]]].map((e=>this.reprojectCoordinatesToWGS84(e,t)));e=(0,k.calculateDistance)(o,"haversine"),n=(0,K.iu)(o[0],e).clone().transform("EPSG:4326",t).getCoordinates()}else e=d.getRadius(),s=d.getCenter(),n=this.polygonCoordsFromCircle(s,e);t=this.getNewFeature(c,n),s=(0,k.reproject)(s,this.getMapCrs(),"EPSG:4326",!1);const a=o&&o.features&&o.features.length&&o.features[0]&&o.features[0].features&&o.features[0].features.length&&o.features[0].features.filter((e=>e.properties.isDrawing))[0].properties.id||i;t.setProperties({isCircle:!0,radius:e,center:[s.x,s.y],id:a,crs:this.getMapCrs(),isGeodesic:this.props.options.geodesic})}else if("Polygon"===e){c=this.props.drawMethod;let e=d.getCoordinates();e[0].push(e[0][0]),t=this.getNewFeature(c,e)}else{c="Text"===e?"Point":this.props.drawMethod;let r=d.getCoordinates();t=this.getNewFeature(c,r),"Text"===e&&t.setProperties({isText:!0,valueText:"."})}const s=h.length>=1?[...this.replaceCirclesWithPolygonsInFeatureColl(h)]:[];t.getProperties().id||t.setProperties({id:T().v1()});const n=[...s,t];let a=Pe.writeFeaturesObject(n);const p=new R.Z({features:(new W.Z).readFeatures(a)});this.drawLayer.setSource(p);let l=(0,k.reprojectGeoJson)(a,this.getMapCrs(),"EPSG:4326");this.props.onGeometryChanged([l],this.props.drawOwner,this.props.options&&this.props.options.stopAfterDrawing?"enterEditMode":"","Text"===e,"Circle"===e),this.props.onEndDrawing(l,this.props.drawOwner),this.props.onDrawingFeatures([w()(l.features)])}else{if("Circle"===e){c="Polygon";const e=d.getRadius(),t=d.getCenter(),r=this.polygonCoordsFromCircle(t,e),o=this.toMulti(this.createOLGeometry({type:c,coordinates:r}));if(1===u.length&&u[0]&&!u[0].geometry)n=[],a=new oe.default([o]);else if(n=this.toMulti(p()(h).getGeometry()),n.getGeometries){const e=this.replaceCirclesWithPolygons(p()(h));a=new oe.default([...e,o])}else a=new oe.default([n,o]);s.setGeometry(a)}else if("Text"===e||"MultiPoint"===e){let e=d.getCoordinates();c="MultiPoint";let t=this.toMulti(this.createOLGeometry({type:c,coordinates:[e]}));if(1!==u.length||u[0].geometry)if(n=this.toMulti(p()(h).getGeometry()),n.getGeometries){let e=this.replaceCirclesWithPolygons(p()(h));a=new oe.default([...e,t])}else a=n.clone(),a.appendPoint(t.getPoint(0));else n=[],a=t.clone();s.setGeometry(a)}else if(!(0,j.isSimpleGeomType)(e)){let t;a=null,n=1!==u.length||u[0].geometry?this.toMulti(p()(h).getGeometry()):this.toMulti(this.createOLGeometry({type:e,coordinates:null}));let r=h.map((e=>"GeometryCollection"===e.getGeometry().getType()?e.getGeometry().getGeometries():e.getGeometry()));"GeometryCollection"===h[0].getGeometry().getType()&&(r=r[0]);let o=l()(r,(t=>t.getType()===e));if(o?this.appendToMultiGeometry(e,o,d):t=this.toMulti(this.createOLGeometry({type:e,coordinates:d.getCoordinates()})),d.getType()!==(0,j.getSimpleGeomType)(n.getType())){let r=p()(h).getGeometry().getGeometries?this.replaceCirclesWithPolygons(p()(h)):[];if(o){let e=r.map((e=>e.getType()===o.getType()?o:e));a=new oe.default(e)}else a="GeometryCollection"===n.getType()?new oe.default([...r,t]):"Text"===e?new oe.default([t]):new oe.default([n,t]);s.setGeometry(a)}else s.setGeometry(o)}let r=this.props.features[0].properties;"Text"===e&&(r=x()({},this.props.features[0].properties,{textValues:(this.props.features[0].properties.textValues||[]).concat(["."]),textGeometriesIndexes:(this.props.features[0].properties.textGeometriesIndexes||[]).concat([s.getGeometry().getGeometries().length-1])})),"Circle"===e&&(r=x()({},r,{circles:(this.props.features[0].properties.circles||[]).concat([s.getGeometry().getGeometries().length-1])}));let o=this.fromOLFeature(s,t,r);const i=new R.Z({features:(new W.Z).readFeatures(o)});this.drawLayer.setSource(i);let g=(0,k.reprojectGeoJson)(Pe.writeFeatureObject(s.clone()),this.getMapCrs(),"EPSG:4326");"Polygon"===g.geometry.type&&g.geometry.coordinates[0].push(g.geometry.coordinates[0][0]),this.props.onGeometryChanged([g],this.props.drawOwner,this.props.options&&this.props.options.stopAfterDrawing?"enterEditMode":"","Text"===e,"Circle"===e),this.props.onEndDrawing(o,this.props.drawOwner),o=(0,k.reprojectGeoJson)(o,this.getMapCrs(),"EPSG:4326");const y=(0,j.isSimpleGeomType)(this.props.drawMethod)&&"GeometryCollection"!==this.props.features[0].geometry?.type?this.props.features.filter((e=>null!==e.geometry)).map((e=>({...e,featureProjection:this.getMapCrs()}))).concat([{...o,type:"Feature",geometry:{type:o.type,coordinates:o.coordinates},featureProjection:this.getMapCrs(),properties:r}]):[{...o,properties:r}];this.props.options.stopAfterDrawing?this.props.onChangeDrawingStatus("stop",this.props.drawMethod,this.props.drawOwner,y):this.props.onChangeDrawingStatus("replace",this.props.drawMethod,this.props.drawOwner,y.map((e=>(0,k.reprojectGeoJson)(e,"EPSG:4326",this.getMapCrs()))),x()({},this.props.options,{featureProjection:this.getMapCrs()})),this.selectInteraction&&(this.addSelectInteraction(),this.selectInteraction.setActive(!0))}})),this.props.map.addInteraction(this.drawInteraction),this.addDrawHoleInteraction(e,r,o),this.setDoubleClickZoomEnabled(!1)})),Ce(this,"addDrawHoleInteraction",((e,t,r)=>{this.drawHoleInteraction=new $(this.drawPropertiesForGeometryType(e,t,this.drawSource,r)),r?.options?.hole?(this.drawInteraction.setActive(!1),this.drawHoleInteraction.setActive(!0)):(this.drawInteraction.setActive(!0),this.drawHoleInteraction.setActive(!1)),this.drawHoleInteraction.on("modifyend",(t=>{this.drawInteraction&&this.drawInteraction.setActive(!0),this.drawHoleInteraction.setActive(!1);const r=new R.Z({features:t.features});this.drawLayer.setSource(r);let o=[];r.forEachFeature((e=>{o.push((new W.Z).writeFeatureObject(e))})),this.props.onGeometryChanged(o,this.props.drawOwner,this.props.options&&this.props.options.stopAfterDrawing?"enterEditMode":"","Text"===e,"Circle"===e),this.props.onEndDrawing(o,this.props.drawOwner),o=o.map((e=>(0,k.reprojectGeoJson)(e,this.getMapCrs(),"EPSG:4326"))),this.props.options.stopAfterDrawing?this.props.onChangeDrawingStatus("stop",this.props.drawMethod,this.props.drawOwner,o):this.props.onChangeDrawingStatus("replace",this.props.drawMethod,this.props.drawOwner,o.map((e=>(0,k.reprojectGeoJson)(e,"EPSG:4326",this.getMapCrs()))),x()({},this.props.options,{featureProjection:this.getMapCrs()})),this.selectInteraction&&(this.addSelectInteraction(),this.selectInteraction.setActive(!0))})),this.props.map.addInteraction(this.drawHoleInteraction)})),Ce(this,"drawPropertiesForGeometryType",(function(t,r,o){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i={source:e.drawSource||o,type:t,style:"Marker"===t?(0,_.Fc)(s.style):new se.default({fill:new ne.default({color:"rgba(255, 255, 255, 0.2)"}),stroke:new ie.default({color:"rgba(0, 0, 0, 0.5)",lineDash:[10,10],width:2}),image:new pe.default({radius:5,stroke:new ie.default({color:"rgba(0, 0, 0, 0.7)"}),fill:new ne.default({color:"rgba(255, 255, 255, 0.2)"})})}),features:new ce.Z,condition:le.Bx},n={};switch(t){case"BBOX":n.type="LineString",n.maxPoints=2,n.geometryFunction=function(e,t){let r=t;r||(r=new K.ZP([]));let o=e[0],s=e[1];return r.setCoordinates([[o,[o[0],s[1]],s,[s[0],o[1]],o]]),r};break;case"Circle":n.maxPoints=100,s.options&&s.options.geodesic?n.geometryFunction=(t,r)=>{let o=r;o||(o=new K.ZP([]),o.setProperties({geodesicCenter:[...t[0]]},!0));let s=e.props.map.getView().getProjection().getCode(),i=[...t].map((t=>e.reprojectCoordinatesToWGS84(t,s))),n=(0,k.calculateDistance)(i,"haversine"),a=(0,K.iu)(i[0],n).clone().transform("EPSG:4326",s).getCoordinates();return o.setCoordinates(a),o}:n.type=t;break;case"Marker":case"Point":case"Text":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":{"LineString"===t&&(n.maxPoints=r);let o="Text"===t||"Marker"===t?"Point":t;n.type=o,n.geometryFunction=(t,r)=>{let i=r;return i||(i=e.createOLGeometry({type:o,coordinates:null,options:s.options})),i.setCoordinates(t),i};break}default:return{}}return x()({},i,n)})),Ce(this,"setDoubleClickZoomEnabled",(e=>{let t=this.props.map.getInteractions();for(let r=0;r<t.getLength();r++){let o=t.item(r);if(o instanceof de.Z){o.setActive(e);break}}})),Ce(this,"updateFeatureExtent",(e=>{const t=e.features.getArray(),r=this.props.features.map((e=>{const r=p()(t.filter((t=>this.fromOLFeature(t).id===e.id)));return r?x()({},e,{geometry:r.geometry,center:r.center,extent:r.extent,coordinate:r.coordinates,radius:r.radius}):e}));this.props.onChangeDrawingStatus("replace",this.props.drawMethod,this.props.drawOwner,r)})),Ce(this,"addInteractions",(e=>{this.clean(),this.drawLayer||this.addLayer(e),this.addDrawInteraction(e.drawMethod,e.options.startingPoint,e.options.maxPoints,e),e.options&&e.options.editEnabled&&(this.addSelectInteraction(),this.translateInteraction&&this.props.map.removeInteraction(this.translateInteraction),this.translateInteraction=new he.Z({features:this.selectInteraction.getFeatures()}),this.translateInteraction.setActive(!1),this.translateInteraction.on("translateend",this.updateFeatureExtent),this.props.map.addInteraction(this.translateInteraction),this.addTranslateListener(),this.modifyInteraction&&this.props.map.removeInteraction(this.modifyInteraction),this.modifyInteraction=new ue.Z({features:this.selectInteraction.getFeatures(),condition:e=>(0,le.Xp)(e)&&!(0,le.Ko)(e)}),this.props.map.addInteraction(this.modifyInteraction)),this.drawSource.clear(),e.features.length>0&&this.addFeatures(e)})),Ce(this,"addSingleClickListener",((e,t)=>t.map.on("singleclick",e))),Ce(this,"addDrawOrEditInteractions",(e=>{this.state&&this.state.keySingleClickCallback&&(0,ge.B)(this.state.keySingleClickCallback);this.clean();let t,r=e.features.map((t=>(0,k.reprojectGeoJson)(t,e.options.featureProjection,this.getMapCrs())||{}));const o=r.every((e=>!!(e&&e.features&&e.features.length))),s=r.every((e=>!!(e&&e.properties&&e.properties.isCircle)));if(o)t=x()({},e,{features:r});else if(s)t=x()({},e,{features:[]});else{const o=r.reduce(((e,t)=>t.geometry?[...e,{...t.geometry,properties:t.properties}]:e),[]);t=x()({},e,{features:o})}this.drawLayer?(this.drawSource.clear(),this.addFeatures(t)):this.addLayer(t),e.options.editEnabled&&(e.options.geodesic||this.addModifyInteraction(e),!1!==e.options.translateEnabled&&this.addTranslateInteraction(),e.options.addClickCallback&&this.setState({keySingleClickCallback:this.addSingleClickListener((t=>{if(this.drawSource&&e.options){let r=this.drawSource.getFeatures(),o=0;const s=r&&r.length&&r.filter(((e,t)=>(e.getProperties().canEdit&&(o=t),e.getProperties().canEdit)))[0]||null,i=s&&s.getGeometry()&&s.getGeometry().getCoordinates&&s.getGeometry().getCoordinates()||[];let n,a=[],p=e.drawMethod;switch(p){case"Polygon":i.length?(0,A.F7)(i)?(a=h()(i[0],0,i[0].length-1),a=a.concat([t.coordinate]),a=[a.concat([i[0][0]])]):a=i[0].length>1?[[...i[0],t.coordinate,i[0][0]]]:[[...i[0],t.coordinate]]:a=[[t.coordinate]],n=this.getNewFeature(p,a),n.setProperties(g()(s&&s.getProperties()||{},"geometry"));break;case"LineString":case"MultiPoint":a=i.length?[...i,t.coordinate]:[t.coordinate],n=this.getNewFeature(p,a),n.setProperties(g()(s&&s.getProperties()||{},"geometry"));break;case"Circle":{p="Polygon";const r=s&&s.getProperties()&&s.getProperties().radius||1e4;let o=t.coordinate,i=this.polygonCoordsFromCircle(o,r);if(e.options.geodesic){const e=this.props.map.getView().getProjection().getCode(),t=[[...o]].map((t=>this.reprojectCoordinatesToWGS84(t,e)));i=(0,K.iu)(t[0],r).clone().transform("EPSG:4326",e).getCoordinates()}n=this.getNewFeature(p,i),o=(0,k.reproject)(o,this.getMapCrs(),"EPSG:4326",!1),n.setProperties(g()(s&&s.getProperties()||{},"geometry")),n.setProperties({isCircle:!0,radius:r,center:[o.x,o.y],isGeodesic:this.props.options.geodesic});break}case"Text":p="Point",n=this.getNewFeature(p,t.coordinate),n.setProperties(g()(s&&s.getProperties()||{},"geometry")),n.setProperties({isText:!0,valueText:s&&s.getProperties()&&s.getProperties().valueText||e.options.defaultTextAnnotation||"New"});break;default:a=t.coordinate,n=this.getNewFeature(p,a),n.setProperties(g()(s&&s.getProperties()||{},"geometry"))}let c={type:"Feature",geometry:{coordinates:[...(0,k.reprojectGeoJson)(Pe.writeFeaturesObject([n.clone()]),this.getMapCrs(),"EPSG:4326").features[0].geometry.coordinates],type:p},properties:{...g()(n.getProperties(),"geometry")}};this.props.onDrawingFeatures([c]),e.options.geodesic||(n=(0,D.aj)(n,this.getMapCrs())),r[o]=n,this.drawSource=new R.Z({features:r}),this.drawLayer.setSource(this.drawSource),this.addModifyInteraction(e)}}),e)})),e.options&&e.options.selectEnabled&&this.addSelectInteraction(e.options&&e.options.selected,e),e.options.drawEnabled&&this.handleDrawAndEdit(e.drawMethod,e.options.startingPoint,e.options.maxPoints,e)})),Ce(this,"addSelectInteraction",((e,t)=>{let r;if(this.selectInteraction&&this.props.map.removeInteraction(this.selectInteraction),e&&(r=l()(this.drawSource.getFeatures(),(t=>t.getProperties().id===e.properties.id)),r&&this.selectFeature(r)),this.selectInteraction=new z.Z({layers:[this.drawLayer],features:new ce.Z(e&&r?[r]:null)}),r){const e=this.convertGeometryTypeToStyleType(t.drawMethod);r.setStyle((0,_.C2)({...t,style:{...t.style,type:e,highlight:!0,useSelectedStyle:t.options.useSelectedStyle}},!1,t.features[0]&&t.features[0].properties&&t.features[0].properties.valueText&&[t.features[0].properties.valueText]||[]))}this.selectInteraction.on("select",(e=>{let t=this.selectInteraction.getFeatures().getArray(),r=[];return t.length&&(r=this.props.features.map((r=>{let o=!1;if("FeatureCollection"===r.type&&t.length>0){let e=p()(t);if(this.selectFeature(e),e.getGeometry&&"Circle"===e.getGeometry().getType()){let t=e.getGeometry().getRadius(),r=(0,k.reproject)(e.getGeometry().getCenter(),this.getMapCrs(),"EPSG:4326");e.setProperties({center:[r.x,r.y],radius:t}),e=this.replaceCircleWithPolygon(e.clone())}return this.drawSource.getFeatures().forEach((t=>{t.getProperties().id===e.getProperties().id?this.selectFeature(e):this.deselectFeature(t)})),(0,k.reprojectGeoJson)(Pe.writeFeatureObject(e.clone()),this.getMapCrs(),"EPSG:4326")}return o=t.reduce(((e,t)=>t.get("id")===r.id||e),!1),x()({},r,{selected:o,selectedFeature:e.selected})})),this.props.onSelectFeatures(r)),0===t.length?(this.props.onSelectFeatures([]),this.drawSource.getFeatures().map((e=>this.deselectFeature(e))),null):null})),this.props.map.addInteraction(this.selectInteraction)})),Ce(this,"selectFeature",(e=>{e.setProperties({selected:!0})})),Ce(this,"deselectFeature",(e=>{e.setProperties({selected:!1})})),Ce(this,"removeDrawInteraction",(()=>{this.drawInteraction&&(this.props.map.removeInteraction(this.drawInteraction),this.drawInteraction=null,setTimeout((()=>this.props.map.enableEventListener("singleclick")),500),setTimeout((()=>this.setDoubleClickZoomEnabled(!0)),250))})),Ce(this,"updateSnapInteraction",(e=>{const t=!!e.snappingLayerInstance?.id;if(!t&&this.snapInteraction&&this.removeSnapInteraction(),this.snapInteraction){const t=this.props.snapConfig!==e.snapConfig,r=this.props.snappingLayerInstance?.id!==e.snappingLayerInstance?.id,o=!e.snapping&&this.props.snapping,s=e.snapping&&!this.props.snapping;s&&this.activateSnapInteraction(),o&&this.deactivateSnapInteraction(),(s||r||t)&&this.addSnapInteraction(e)}else e.snapping&&t&&this.addSnapInteraction(e)})),Ce(this,"activateSnapInteraction",(()=>{this.snapInteraction?.setActive(!0)})),Ce(this,"deactivateSnapInteraction",(()=>{this.snapInteraction?.setActive(!1)})),Ce(this,"removeSnapInteraction",(()=>{this.snapInteraction&&(this.props.map.removeInteraction(this.snapInteraction),this.snapInteraction=null),this.snapLayer&&this.props.map.removeLayer(this.snapLayer)})),Ce(this,"removeInteractions",(()=>{this.removeDrawInteraction(),this.removeSnapInteraction(),this.selectInteraction&&(this.props.map.enableEventListener("singleclick"),this.props.map.removeInteraction(this.selectInteraction)),this.modifyInteraction&&(this.props.map.removeInteraction(this.modifyInteraction),this.props.map.un("singleclick")),this.translateInteraction&&this.props.map.removeInteraction(this.translateInteraction)})),Ce(this,"clean",(e=>{e||this.removeInteractions(),this.drawLayer&&(this.props.map.removeLayer(this.drawLayer),this.geojson=null,this.drawLayer=null,this.drawSource=null)})),Ce(this,"fromOLFeature",((e,t,r)=>{const o=e.getGeometry(),s=this.props.map.getView().getProjection().getCode(),i=o.getType();if(o.getCoordinates){const r=o.getExtent(),a=o.getProperties(),p=a&&a.geodesicCenter||(0,ye.qg)(r);let c,l=o.getCoordinates();if(t&&(l=n()(t,l),o.setCoordinates(l)),"Circle"===this.props.drawMethod)if(this.props.options.geodesic){const e=[[...p],[...l[0][0]]].map((e=>this.reprojectCoordinatesToWGS84(e,s)));c=(0,k.calculateDistance)(e,"haversine")}else c=this.calculateRadius(p,l);return x()({},{id:e.get("id"),type:i,extent:r,center:p,coordinates:l,radius:c,style:this.fromOlStyle(e.getStyle()),projection:this.getMapCrs()})}let a=o.getGeometries().map(((o,i)=>{const a=o.getExtent(),p=(0,ye.qg)(a);let c,l=o.getCoordinates();if(t&&(l=n()(t,l),o.setCoordinates(l)),r.circles&&-1!==r.circles.indexOf(i))if(this.props.options.geodesic){const e=[[...p],[...l[0][0]]].map((e=>this.reprojectCoordinatesToWGS84(e,s)));c=(0,k.calculateDistance)(e,"haversine")}else c=this.calculateRadius(p,l);else c=0;return x()({},{id:e.get("id"),type:o.getType(),extent:a,center:p,coordinates:l,radius:c,style:this.fromOlStyle(e.getStyle()),projection:this.getMapCrs()})}));return x()({},{type:"Feature",id:e.get("id"),style:this.fromOlStyle(e.getStyle()),geometry:{type:"GeometryCollection",geometries:a},projection:s})})),Ce(this,"reprojectCoordinatesToWGS84",((e,t)=>{let r=(0,k.reproject)(e,t,"EPSG:4326");return[r.x,r.y]})),Ce(this,"toOlFeature",(e=>p()(this.drawSource.getFeatures().filter((t=>t.get("id")===e.id))))),Ce(this,"fromOlStyle",(e=>e?{fillColor:this.rgbToHex(e.getFill().getColor()),fillTransparency:e.getFill().getColor()[3],strokeColor:e.getStroke().getColor(),strokeWidth:e.getStroke().getWidth(),text:e.getText().getText()}:{})),Ce(this,"toOlStyle",((e,t,r)=>{let o=e&&e.fillColor?e.fillColor:[255,255,255,.2];"string"==typeof o&&(o=this.hexToRgb(o).concat([e.fillOpacity>=0&&e.fillOpacity<=1?e.fillOpacity:1])),e&&e.fillTransparency&&(o[3]=e.fillTransparency);let s=e&&(e.strokeColor||e.color)?e.strokeColor||e.color:"#ffcc33";t&&(s="#4a90e2"),s=this.hexToRgb(s).concat([e&&e.opacity||1]);let i=new se.default({fill:new ne.default({color:o}),stroke:new ie.default({color:s,width:e&&(e.strokeWidth||e.weight)?e.strokeWidth||e.weight:2}),text:new ae.default({text:e&&e.text?e.text:"",fill:new ne.default({color:e&&(e.strokeColor||e.color)?e.strokeColor||e.color:"#000"}),stroke:new ie.default({color:"#fff",width:2}),font:e&&e.fontSize?e.fontSize+"px helvetica":""})});return"GeometryCollection"===r?[...(0,_.EC)({style:{iconGlyph:"comment",iconShape:"square",iconColor:"blue"}}),i]:e&&(e.iconUrl||e.iconGlyph)?(0,_.EC)({style:e}):i})),Ce(this,"hexToRgb",(e=>{const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(function(e,t,r,o){return t+t+r+r+o+o})));return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:null})),Ce(this,"componentToHex",(e=>{var t=e.toString(16);return 1===t.length?"0"+t:t})),Ce(this,"rgbToHex",(e=>"#"+this.componentToHex(e[0])+this.componentToHex(e[1])+this.componentToHex(e[2]))),Ce(this,"addModifyInteraction",(e=>{this.modifyInteraction&&this.props.map.removeInteraction(this.modifyInteraction);const t=e&&e.options&&e.options.editFilter;this.modifyFeatureColl=new ce.Z(P()(this.drawLayer.getSource().getFeatures(),t)),this.modifyInteraction=new ue.Z({features:this.modifyFeatureColl,condition:e=>(0,le.Xp)(e)&&!(0,le.Ko)(e)}),this.modifyInteraction.on("modifyend",(e=>{let t=e.features.getArray().map((e=>{let t=e.clone();if(t.getGeometry&&"GeometryCollection"===t.getGeometry().getType()&&t.getGeometry().setGeometries(this.replaceCirclesWithPolygons(t)),t.getGeometry&&t.getGeometry()&&"Circle"===t.getGeometry().getType()){let r=(0,k.reproject)(t.getGeometry().getCenter(),this.getMapCrs(),"EPSG:4326"),o=t.getGeometry().getRadius();t.setProperties({center:[r.x,r.y],radius:o}),e.setProperties({center:[r.x,r.y],radius:o}),t=this.replaceCircleWithPolygon(t.clone())}return(0,k.reprojectGeoJson)(Pe.writeFeatureObject(t),this.getMapCrs(),"EPSG:4326")}));this.props.options.transformToFeatureCollection?this.props.onDrawingFeatures(t):this.props.onGeometryChanged(t,this.props.drawOwner,!1,"editing","editing")})),this.props.map.addInteraction(this.modifyInteraction)})),Ce(this,"addTranslateInteraction",(()=>{this.translateInteraction&&this.props.map.removeInteraction(this.translateInteraction),this.translateInteraction=new he.Z({features:new ce.Z(this.drawLayer.getSource().getFeatures())}),this.translateInteraction.setActive(!1),this.translateInteraction.on("translateend",(e=>{let t=e.features.getArray().map((e=>{let t=e.clone();if(t.getGeometry&&"GeometryCollection"===t.getGeometry().getType()&&t.getGeometry().setGeometries(this.replaceCirclesWithPolygons(t)),t.getGeometry&&t.getGeometry()&&"Circle"===t.getGeometry().getType()){let e=(0,k.reproject)(t.getGeometry().getCenter(),this.getMapCrs(),"EPSG:4326"),r=t.getGeometry().getRadius();t.setProperties({center:[e.x,e.y],radius:r}),t=this.replaceCircleWithPolygon(t)}return e.getProperties()&&e.getProperties().selected&&this.props.onSelectFeatures([(0,k.reprojectGeoJson)(Pe.writeFeatureObject(t),this.getMapCrs(),"EPSG:4326")]),(0,k.reprojectGeoJson)(Pe.writeFeatureObject(t),this.getMapCrs(),"EPSG:4326")}));this.props.options.transformToFeatureCollection?this.props.onDrawingFeatures(t):this.props.onGeometryChanged(t,this.props.drawOwner,this.props.drawOwner,!1,"Text"===this.props.drawMethod,"Circle"===this.props.drawMethod)})),this.addTranslateListener(),this.props.map.addInteraction(this.translateInteraction)})),Ce(this,"createOLGeometry",(e=>{let{type:t,coordinates:r,radius:o,center:s,geometries:i,projection:n,options:a={}}=e;return"GeometryCollection"===t?i&&i.length?new oe.default(i.map((e=>this.olGeomFromType({type:e.type})))):new oe.default([]):this.olGeomFromType({type:t,coordinates:r,radius:o,center:s,projection:n,options:a})})),Ce(this,"olGeomFromType",(e=>{let t,{type:r,coordinates:o,radius:s,center:i,projection:n,options:a}=e;switch(r){case"Point":case"Marker":case"Text":t=new Y.Z(o||[]);break;case"LineString":t=new ee.Z(o||[]);break;case"MultiPoint":t=new Q.Z(o||[]);break;case"MultiLineString":t=new te.Z(o||[]);break;case"MultiPolygon":t=new q.Z(o||[]);break;default:{let e=m()(i)?{x:i[0],y:i[1]}:i;const r=n&&!isNaN(parseFloat(s))&&e&&!G()(e.x)&&!G()(e.y)&&!isNaN(parseFloat(e.x))&&!isNaN(parseFloat(e.y));t=r?a.geodesic?(0,K.iu)(this.reprojectCoordinatesToWGS84([e.x,e.y],n),s,100).clone().transform("EPSG:4326",n):(0,K.Bb)(new re.Z([e.x,e.y],s),100):new K.ZP(o&&m()(o[0])?o:[]),t&&r&&a.geodesic&&t.setProperties({geodesicCenter:[e.x,e.y]},!0)}}return t})),Ce(this,"convertGeometryTypeToStyleType",(e=>"BBOX"===e?"LineString":e)),Ce(this,"appendToMultiGeometry",((e,t,r)=>{switch(e){case"MultiPoint":t.appendPoint(r);break;case"MultiLineString":t.appendLineString(r);break;case"MultiPolygon":{let e=r.getCoordinates();e[0].push(e[0][0]),r.setCoordinates(e),t.appendPolygon(r);break}}})),Ce(this,"calculateRadius",((e,t)=>m()(t)&&m()(t[0])&&m()(t[0][0])?Math.sqrt(Math.pow(e[0]-t[0][0][0],2)+Math.pow(e[1]-t[0][0][1],2)):100)),Ce(this,"polygonFromCircle",(function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;return(0,K.Bb)(new re.Z(e,t),r)})),Ce(this,"polygonCoordsFromCircle",(function(t,r){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;return e.polygonFromCircle(t,r,o).getCoordinates()})),Ce(this,"replaceCirclesWithPolygonsInFeatureColl",(e=>e.map((e=>"Circle"!==e.getGeometry().getType()?e:this.replaceCircleWithPolygon(e))))),Ce(this,"replaceCircleWithPolygon",(e=>{if(e.getProperties().isCircle&&"Circle"===e.getGeometry().getType()){const t=e.getGeometry().getCenter(),r=e.getGeometry().getRadius();return e.setGeometry(this.polygonFromCircle(t,r)),e}return e})),Ce(this,"replaceCirclesWithPolygons",(e=>e.getGeometry&&!e.getGeometry().getGeometries?e:e.getGeometry().getGeometries().map(((t,r)=>{if("Circle"!==t.getType())return t;if(e.getProperties()&&e.getProperties().circles&&-1!==e.getProperties().circles.indexOf(r)){const e=t.getCenter(),r=t.getRadius();return this.polygonFromCircle(e,r)}return t})))),Ce(this,"replacePolygonsWithCircles",(e=>e.getGeometry().getGeometries().map(((t,r)=>{if("Polygon"!==t.getType())return t;if(e.getProperties()&&e.getProperties().circles&&-1!==e.getProperties().circles.indexOf(r)){const e=t.getExtent(),r=(0,ye.qg)(e),o=this.calculateRadius(r,t.getCoordinates());return new re.Z(r,o)}return t})))),Ce(this,"addTranslateListener",(()=>{document.addEventListener("keydown",(e=>{e.altKey&&"AltLeft"===e.code&&this.translateInteraction.setActive(!0)})),document.addEventListener("keyup",(e=>{"AltLeft"===e.code&&this.translateInteraction.setActive(!1)}))}))}UNSAFE_componentWillReceiveProps(e){if(this.drawLayer&&this.updateFeatureStyles(e.features),!e.drawStatus&&this.selectInteraction&&this.selectInteraction.getFeatures().clear(),this.props.drawStatus!==e.drawStatus||this.props.drawMethod!==e.drawMethod||this.props.features!==e.features)switch(e.drawStatus){case"create":this.addLayer(e);break;case"start":this.addInteractions(e);break;case"drawOrEdit":this.addDrawOrEditInteractions(e);break;case"stop":this.removeDrawInteraction();break;case"replace":this.replaceFeatures(e);break;case"updateStyle":this.updateOnlyFeatureStyles(e);break;case"clean":this.clean();break;case"cleanAndContinueDrawing":this.clean(!0);break;case"endDrawing":this.endDrawing(e)}this.updateSnapInteraction(e)}render(){return null}}Ce(Se,"propTypes",{map:b().object,drawOwner:b().string,drawStatus:b().string,drawMethod:b().string,options:b().object,features:b().array,onChangeDrawingStatus:b().func,onGeometryChanged:b().func,onDrawStopped:b().func,onDrawingFeatures:b().func,onSelectFeatures:b().func,onEndDrawing:b().func,style:b().object,snapping:b().bool,snappingLayer:b().object,snappingLayerInstance:b().object,isSnappingLoading:b().bool,snapConfig:b().object,onRefreshSnappingLayer:b().func,toggleSnappingIsLoading:b().func}),Ce(Se,"defaultProps",{map:null,drawOwner:null,drawStatus:null,drawMethod:null,features:null,options:{stopAfterDrawing:!0},onChangeDrawingStatus:()=>{},onGeometryChanged:()=>{},onDrawStopped:()=>{},onDrawingFeatures:()=>{},onSelectFeatures:()=>{},onEndDrawing:()=>{}})},993847:(e,t,r)=>{"use strict";r.d(t,{Z:()=>y});var o=r(124852),s=r.n(o),i=r(180307),n=r.n(i),a=r(45697),p=r.n(a),c=r(193409),l=r(747037),d=r.n(l),h=r(39600),u=r(492619);function g(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,"string");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class y extends s().Component{constructor(){super(...arguments),g(this,"onPopupClose",(e=>{this.props.onPopupClose(e)})),g(this,"renderPopups",(()=>this.preparePopups().map((e=>{let{popup:t,id:r,component:o,content:i,props:a,containerStyle:p}=e;const c=t.getElement(),l=d()(o)&&u.default[o]||o;let g;return l?g=s().isValidElement(l)&&l||s().createElement(l,a):i&&(g=h.FP(i)?s().createElement("div",{dangerouslySetInnerHTML:{__html:i}}):i),c&&n().createPortal(s().createElement("div",{className:"map-popup-ol",key:r,onMouseUp:this.convertToClick},s().createElement("div",{className:"ol-popup-content-wrapper"},s().createElement("div",{className:"ol-popup-content",style:p},g)),s().createElement("div",{className:"ol-popup-closer",onClick:()=>this.onPopupClose(r)},"x")),c)})))),g(this,"update",(()=>{(this._popups||[]).map((e=>{let{popup:t}=e;t.setElement(t.getElement())}))})),g(this,"convertToClick",(e=>{const t=new MouseEvent("click",{bubbles:!0});t.stopPropagation=()=>{},e.target.dispatchEvent(t)})),g(this,"preparePopups",(()=>{const{popups:e=[],map:t}=this.props,r=t.getSize();return(this._popups||[]).forEach((e=>{let{popup:r,observer:o}=e;o&&o.disconnect(),r&&t.removeOverlay(r)})),this._popups=e.map((e=>{const o=20,s=Math.round(.9*r[0])-2*o,i=Math.round(.9*r[1])-2*o,{id:n,position:{coordinates:a},className:p,maxWidth:l=s,maxHeight:d=i,autoPan:u=!1,autoPanMargin:g=o,offset:y=[0,0],autoPanAnimation:m={duration:200}}=e,f=l>s?s:l,w=d>i?i:d,C=h.fH(n,p),P=new c.Z({id:n,element:C,autoPan:u,offset:y,autoPanMargin:g,autoPanAnimation:m,positioning:"bottom-center",className:"ol-overlay-container ol-unselectable",position:a});t.addOverlay(P);const S=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=new MutationObserver((()=>{e.getMap().getSize()&&(e.setPosition(void 0),e.setPosition(r.coordinates))}));return o.observe(t,{attributes:!0,childList:!0,subtree:!0}),o}(P,C,{coordinates:a});return{popup:P,observer:S,containerStyle:{maxWidth:f,maxHeight:w},...e}})),this._popups})),g(this,"stopPropagationOnPointerMove",(e=>{e.stopPropagation()}))}UNSAFE_componentWillMount(){this.props.map&&this.props.map.getOverlayContainerStopEvent().addEventListener("pointermove",this.stopPropagationOnPointerMove)}shouldComponentUpdate(e){let{popups:t}=e;return t!==this.props.popups}componentWillUnmount(){this.props.map&&this.props.map.getOverlayContainerStopEvent().removeEventListener("pointermove",this.stopPropagationOnPointerMove)}render(){return s().createElement("div",null,this.renderPopups())}}g(y,"propTypes",{map:p().object,popups:p().arrayOf(p().object),onPopupClose:p().func}),g(y,"defaultProps",{popups:[],onPopupClose:()=>{}})},39600:(e,t,r)=>{"use strict";r.d(t,{fH:()=>i,FP:()=>n,R3:()=>a});var o=r(455877),s=r.n(o);const i=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s()(),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"ms-map-popup";const r=document.createElement("div");return r.setAttribute("id",e+"-map-popup"),r.setAttribute("class",t),r},n=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").startsWith("<")},a=(e,t)=>{if(!t)return e;if(t instanceof Node){const r=document.createDocumentFragment();r.appendChild(t),e.appendChild(r)}else n(t)?e.innerHTML=t:e.append(document.createTextNode(String(t)));return e}},847529:(e,t,r)=>{"use strict";r.d(t,{ox:()=>p,dV:()=>c,k4:()=>l,aj:()=>d});var o=r(701469),s=r.n(o),i=r(351546),n=r(421915),a=r(869669);const p="VECTOR",c="TILE",l="IMAGE",d=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t;if(!e.getGeometry()||"Polygon"!==e.getGeometry().getType()||e.getProperties().center&&0===e.getProperties().center.length)return e;if(e.getProperties()&&e.getProperties().isCircle&&e.getProperties().center&&e.getProperties().center[0]&&e.getProperties().center[1]){const o=e.getGeometry().getExtent();let p;e.getProperties().center?(p=(0,i.reproject)(e.getProperties().center,"EPSG:4326",t),p=[p.x,p.y]):p=(0,n.qg)(o);const c=e.getProperties().crs===t?e.getProperties().radius:((e,t,r,o)=>{if(s()(t)&&s()(t[0])&&s()(t[0][0])){const s=(0,i.reproject)(t[0][0],o,r);return Math.sqrt(Math.pow(e[0]-s.x,2)+Math.pow(e[1]-s.y,2))}return 100})(p,e.getGeometry().getCoordinates(),t,r);return e.setGeometry(new a.Z(p,c)),e}return e}}}]);