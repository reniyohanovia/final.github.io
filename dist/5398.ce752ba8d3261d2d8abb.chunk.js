(self.webpackChunkmapstore2=self.webpackChunkmapstore2||[]).push([[5398],{806783:(e,t,r)=>{"use strict";r.d(t,{F:()=>s});var i=r(470509),o=r.n(i),a=r(351546),n=r(835516);const s=e=>o().get(e).then((e=>{let{data:t}=e;return(i=t,Promise.all([r.e(6212),r.e(949)]).then(r.bind(r,288487)).then((e=>{const t=e,r=void 0!==i?.asset?.version?i.asset.version:"1.0",o=function(e,t){if(t?.root?.boundingVolume?.region){const[e,r,i,o]=t.root.boundingVolume.region;return{bounds:{minx:(0,a.convertRadianToDegrees)(e),miny:(0,a.convertRadianToDegrees)(r),maxx:(0,a.convertRadianToDegrees)(i),maxy:(0,a.convertRadianToDegrees)(o)},crs:"EPSG:4326"}}const r=e.Matrix4.fromArray(t.root.transform||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);if(t?.root?.boundingVolume?.box){const[i,o,s]=t.root.boundingVolume.box,l=e.Matrix4.multiplyByPoint(r,new e.Cartesian3(i,o,s),new e.Cartesian3),c=e.Matrix4.getMatrix3(r,new e.Matrix4),p=e.Matrix3.multiply(c,e.Matrix3.fromArray(t.root.boundingVolume.box,3,new e.Matrix3),new e.Matrix3),u=e.BoundingSphere.fromOrientedBoundingBox(new e.OrientedBoundingBox(l,p)),d=e.Cartographic.fromCartesian(u.center);if(!d)return null;const m=(0,a.convertRadianToDegrees)(d.longitude),f=(0,a.convertRadianToDegrees)(d.latitude),g=u.radius/n.METERS_PER_UNIT.degrees;return{bounds:{minx:m-g,miny:f-g,maxx:m+g,maxy:f+g},crs:"EPSG:4326"}}if(t?.root?.boundingVolume?.sphere){const[i,o,s,l]=t.root.boundingVolume.sphere,c=e.Matrix4.multiplyByPoint(r,new e.Cartesian3(i,o,s),new e.Cartesian3),p=e.Matrix4.getScale(r,new e.Matrix4),u=l*e.Cartesian3.maximumComponent(p)/n.METERS_PER_UNIT.degrees,d=e.Cartographic.fromCartesian(c);if(!d)return null;const m=(0,a.convertRadianToDegrees)(d.longitude),f=(0,a.convertRadianToDegrees)(d.latitude);return{bounds:{minx:m-u,miny:f-u,maxx:m+u,maxy:f+u},crs:"EPSG:4326"}}return null}(t,i),s=function(e){const t=e.split(/\./g);return t[t.length-1]}(i?.root?.content?.uri||""),l=i?.properties;return{version:r,...o&&{bbox:o},format:s,properties:l}}))).then((e=>({tileset:t,...e})));var i}))},964091:(e,t,r)=>{"use strict";r.d(t,{Z:()=>dt});var i={};r.r(i),r.d(i,{getCatalogRecords:()=>H,getLayerFromRecord:()=>X,preprocess:()=>_,testService:()=>z,textSearch:()=>J,validate:()=>Z});var o={};r.r(o),r.d(o,{getCatalogRecords:()=>ae,getLayerFromRecord:()=>ne,preprocess:()=>te,testService:()=>ie,textSearch:()=>oe,validate:()=>re});var a={};r.r(a),r.d(a,{getCatalogRecords:()=>ye,getLayerFromRecord:()=>xe,preprocess:()=>ge,testService:()=>ve,textSearch:()=>fe,validate:()=>be});var n={};r.r(n),r.d(n,{getCatalogRecords:()=>Ie,getLayerFromRecord:()=>Ve,getRecords:()=>Be,testService:()=>De,textSearch:()=>Ae,tileProviderToLayer:()=>ke,tmsToLayer:()=>$e,validate:()=>Ge});var s={};r.r(s),r.d(s,{getCatalogRecords:()=>Xe,getLayerFromRecord:()=>Ke,getRecords:()=>_e,preprocess:()=>Ze,testService:()=>Je,textSearch:()=>He,validate:()=>ze});var l={};r.r(l),r.d(l,{getCatalogRecords:()=>rt,getLayerFromRecord:()=>it,preprocess:()=>Qe,testService:()=>tt,textSearch:()=>Ye,validate:()=>et});var c={};r.r(c),r.d(c,{getCatalogRecords:()=>ct,getLayerFromRecord:()=>pt,preprocess:()=>nt,testService:()=>st,textSearch:()=>lt,validate:()=>ut});var p=r(91175),u=r.n(p),d=r(747037),m=r.n(d),f=r(264721),g=r.n(f),b=r(984596),v=r.n(b),y=r(189734),x=r.n(y),h=r(944908),S=r.n(h),w=r(701469),O=r.n(w),R=r(763105),T=r.n(R),M=r(441609),C=r.n(M),L=r(414293),U=r.n(L),F=r(727418),P=r.n(F),E=r(835516),W=r(49977),B=r.n(W),A=r(234228),G=r(399790),D=r(175063),I=r(467763),$=r(470509),k=r.n($);class V extends Error{constructor(e,t){super(e),this.name="ServiceValidationError",this.notification=t}}const N=e=>B().Observable.of(e),j=e=>""===e.title||""===e.url?B().Observable.throw(new V("Validation Error","catalog.notification.warningAddCatalogService")):B().Observable.of(e),q=e=>{let{parseUrl:t=(e=>e)}=e;return e=>{const r="catalog.notification.errorServiceUrl";return B().Observable.defer((()=>k().get(t(e.url)))).catch((()=>{throw new V("Service Test error",r)})).switchMap((t=>{if(t.error||""===t.data)throw new V("Service Test error",r);return B().Observable.of(e)}))}},_=e=>{let{domainAliases:t}=e;return e.domainAliases=T()(t),W.Observable.of(e)},Z=j,z=q({parseUrl:I.en}),J=I.tt,H=(e,t)=>e&&e.records?e.records.map((r=>{const i=[{type:"OGC:WMS",url:t&&t.url,SRS:r.SRS&&(O()(r.SRS)?r.SRS:[r.SRS])||[],params:{name:r.Name}}],{wms:o}=(0,D.tW)({references:i});return{serviceType:"wms",isValid:!!o,capabilities:r,credits:r.credits,boundingBox:(0,I.jY)(r),description:r.Abstract||r.Title||r.Name,identifier:r.Name,service:e.service,tags:"",layerOptions:{...t?.layerOptions||{},...e?.layerOptions||{}},title:(0,G.EM)(r)||r.Name,formats:v()(r.formats||[]),dimensions:(r.Dimension&&v()(r.Dimension)||[]).map((e=>P()({},{values:e._&&e._.split(",")||[]},e.$||{}))).filter((e=>e&&"time"!==e.name)),references:i,ogcReferences:o}})):null,X=(e,t,r)=>{const i=function(e){let{removeParams:t=[],format:r,catalogURL:i,url:o,formats:a={},map:n={},layerBaseConfig:s,localizedLayerStyles:l,allowUnsecureLayers:c,service:p}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e||!e.references)return null;const{wms:u}=(0,D.tW)(e),d=e=>(0,D.em)((0,A.$F)(e),["request","layer","layers","service","version"].concat(t));let m,f;const g=(0,D.qy)(u.url);if(g&&O()(g))m=g.map((e=>d(e))).map((e=>{let{url:t}=e;return t})),f=g.map((e=>d(e))).map((e=>{let{params:t}=e;return t})).reduce(((e,t)=>({...e,...t})),{});else{const{url:e,params:t}=d(g||i);m=e,f=t}const b=(v=o||m,O()(v)&&1===v.length?v[0]:v);var v;const y=(0,D.n0)(u.SRS),{MaxScaleDenominator:x,MinScaleDenominator:h}=e?.capabilities??{};let S={type:"wms",requestEncoding:e.requestEncoding,style:e.style,format:r,url:b,capabilitiesURL:e.capabilitiesURL,queryable:e.queryable,visibility:!0,dimensions:e.dimensions||[],name:u.params&&u.params.name,title:e.title||u.params&&u.params.name,description:e.description||"",credits:!(0,A.u8)("noCreditsFromCatalog")&&e.credits,bbox:{crs:e.boundingBox.crs,bounds:{minx:e.boundingBox.extent[0],miny:e.boundingBox.extent[1],maxx:e.boundingBox.extent[2],maxy:e.boundingBox.extent[3]}},links:(0,D.F8)(e),params:f,allowedSRS:y,catalogURL:i,...s,...p?.layerOptions,...e.layerOptions,localizedLayerStyles:U()(l)?void 0:l,...!C()(a)&&{imageFormats:a.imageFormats,infoFormats:a.infoFormats},...!U()(c)&&{forceProxy:c}};if(!C()(n)&&(x||h)){const{resolution:e}=!U()(h)&&(0,E.getResolutionObject)(h,"scale",n)||{},{resolution:t}=!U()(x)&&(0,E.getResolutionObject)(x,"scale",n)||{};S={...S,minResolution:e,maxResolution:t}}return S}(e,t);return r?Promise.resolve(i):i};var K=r(719648),Y=r(742178);const Q=(e,t,r)=>{let i=r.name;if(void 0===i){i=e.title?e.title.join(" "):(0,K.S$)(t,"catalog.notAvailable");const a=(o=r.protocol,r.value,u()([{protocol:"https://registry.geodati.gov.it/metadata-codelist/ProtocolValue/www-download",displayValue:"Download"},{protocol:"http://www.opengis.net/def/serviceType/ogc/wms",displayValue:"WMS"},{protocol:"http://www.opengis.net/def/serviceType/ogc/wfs",displayValue:"WFS"}].filter((e=>e.protocol===o)))?.displayValue??"Link");i=`${a?`${i} - ${a}`:i}`}var o;return`<li><a target="_blank" href="${r.value}">${i}</a></li>`};function ee(e,t){const r=e?.URI&&v()(e.URI);let i;if(r){const e=u()(r.filter((e=>"thumbnail"===e.name)))||u()(r.filter((e=>!e.name&&e.protocol?.indexOf("image/")>-1)));i=e?e.value:null}if(!i&&e&&e.references){const t=(e=>u()(v()(e.references).filter((t=>"WWW:LINK-1.0-http--image-thumbnail"===t.scheme||"thumbnail"===t.scheme||"WWW:DOWNLOAD-1.0-http--download"===t.scheme&&-1!==(t.value||"").indexOf(`${e.identifier||""}-thumb`)||"WWW:DOWNLOAD-REST_MAP"===t.scheme&&-1!==(t.value||"").indexOf(`${e.identifier||""}-thumb`)))))(e);t&&(i=t.value)}var o;return i&&(0===i.indexOf("http")||(i=((o=t&&t.url)&&o.replace(/\/csw$/,"/")||"")+i)),i}const te=N,re=j,ie=q({parseUrl:Y.ZP.parseUrl}),oe=Y.ZP.textSearch,ae=(e,t,r)=>{let i=e;return i&&i.records?i.records.map((e=>{const i=e.dc;let o=[];i&&i.references&&(Array.isArray(i.references)?i.references:[i.references]).filter((e=>e.scheme.indexOf("http-get-capabilities")>-1)).forEach((e=>{let r=0===e.value.indexOf("http")?e.value:(t&&t.catalogURL||"")+"/"+e.value;o.push({type:e.scheme,url:r})}));const a=(0,Y.kv)(i,t);a&&o.push(a);let n={boundingBox:e.boundingBox&&e.boundingBox.extent&&v()(e.boundingBox.extent.join(","))};if(i&&(n={...n,...x()(Object.keys(i)).reduce(((e,t)=>({...e,[t]:S()(v()(i[t]))})),{})}),i&&i.URI&&v()(i.URI)&&v()(i.URI).length&&(n={...n,uri:["<ul>"+v()(i.URI).map(Q.bind(void 0,n,r)).join("")+"</ul>"]}),i&&i.subject&&v()(i.subject)&&v()(i.subject).length&&(n={...n,subject:["<ul>"+v()(i.subject).map((e=>`<li>${e}</li>`)).join("")+"</ul>"]}),o&&v()(o).length?n={...n,references:["<ul>"+v()(o).map((e=>`<li><a target="_blank" href="${e.url}">${e.params&&e.params.name||e.url}</a></li>`)).join("")+"</ul>"]}:delete n.references,i&&i.temporal){let e=m()(i.temporal)?i.temporal.split("; "):[];if(e.length){let t=e.filter((e=>-1!==e.indexOf("scheme="))).map((e=>{const t=e.indexOf("=");return e.substr(t+1,e.length-1)}));t=t.length?t[0]:"W3C-DTF";let i=e.filter((e=>-1!==e.indexOf("start=")||-1!==e.indexOf("end="))).map((e=>{const i=e.indexOf("="),o=e.substr(0,i),a=e.substr(i+1,e.length-1),n=e.length-i-1<=10;return g()(["start","end"],o)&&"W3C-DTF"===t&&!n?(0,K.S$)(r,`catalog.${o}`)+new Date(a).toLocaleString():g()(["start","end"],o)?(0,K.S$)(r,`catalog.${o}`)+a:""}));n={...n,temporal:["<ul>"+i.map((e=>`<li>${e}</li>`)).join("")+"</ul>"]}}}const s={...(0,D.tW)({references:o}),...(0,D.FJ)({references:o})},l=Object.keys(s).find((e=>s[e])),c=l&&"esri"!==l?s[l]:void 0;return{serviceType:"csw",layerType:l,isValid:!!l,boundingBox:e.boundingBox,description:i&&m()(i.abstract)&&i.abstract||"",layerOptions:t&&t.layerOptions||{},identifier:i&&m()(i.identifier)&&i.identifier||"",references:o,thumbnail:ee(i,t),title:i&&m()(i.title)&&i.title||"",tags:i&&i.tags||"",metadata:n,capabilities:e.capabilities,ogcReferences:c}})):null},ne=(e,t,r)=>{const i=((e,t)=>{switch(e.layerType){case"wms":return X(e,t);case"esri":return function(e){let{layerBaseConfig:t={}}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e||!e.references)return null;const{esri:r}=(0,D.FJ)(e);return{type:r.type,url:r.url,visibility:!0,dimensions:e.dimensions||[],name:r.params&&r.params.name,bbox:{crs:e.boundingBox.crs,bounds:{minx:e.boundingBox.extent[0],miny:e.boundingBox.extent[1],maxx:e.boundingBox.extent[2],maxy:e.boundingBox.extent[3]}},...t}}(e,t);default:return null}})(e,t);return r?Promise.resolve(i):i};var se=r(513218),le=r.n(se),ce=r(351546),pe=r(276570),ue=r(797678);const de=e=>le()(e)&&e._||e,me=(e,t)=>e.filter((r=>(0,pe.C2)(t,r,e,t,null))),fe=ue.Z.textSearch,ge=N,be=j,ve=q({parseUrl:ue.Z.parseUrl}),ye=(e,t)=>e&&e.records?e.records.map((e=>{let r=v()((0,pe.f1)(e)||t&&t.url);1===r.length&&(r=r[0]);const i=(0,pe.dN)(e),o=v()(e?.TileMatrixSetLink||[]).reduce(((t,r)=>{const i=v()(e?.TileMatrixSet||[]).find((e=>e["ows:Identifier"]===r.TileMatrixSet)),o=i&&(0,ce.getEPSGCode)(i["ows:SupportedCRS"]),a=r?.TileMatrixSetLimits?v()(r?.TileMatrixSetLimits?.TileMatrixLimits||[]).map((e=>({identifier:e.TileMatrix,ranges:{cols:{min:e.MinTileCol,max:e.MaxTileCol},rows:{min:e.MinTileRow,max:e.MaxTileRow}}}))):null;return{...t,[i["ows:Identifier"]]:{crs:o,...a&&{limits:a},tileMatrixSet:i}}}),{}),{matrixIds:a}=(0,pe.nJ)({availableTileMatrixSets:o}),n=(e=>{let t=e["ows:WGS84BoundingBox"];return t||(t={"ows:LowerCorner":"-180.0 -90.0","ows:UpperCorner":"180.0 90.0"}),t})(e),s=[{type:"OGC:WMTS",url:r,SRS:me(e.SRS||[],a),params:{name:e["ows:Identifier"]}}],{wmts:l}=(0,D.tW)({references:s});return{serviceType:"wmts",isValid:!!l,title:de(e["ows:Title"]||e["ows:Identifier"]),description:de(e["ows:Abstract"]||e["ows:Title"]||e["ows:Identifier"]),identifier:de(e["ows:Identifier"]),tags:"",layerOptions:t&&t.layerOptions||{},style:e.style,capabilitiesURL:i,queryable:e.queryable,requestEncoding:e.requestEncoding,availableTileMatrixSets:o,format:e.format,TileMatrixSetLink:v()(e.TileMatrixSetLink),boundingBox:{extent:[n["ows:LowerCorner"].split(" ")[0],n["ows:LowerCorner"].split(" ")[1],n["ows:UpperCorner"].split(" ")[0],n["ows:UpperCorner"].split(" ")[1]],crs:"EPSG:4326"},references:s,ogcReferences:l}})):null,xe=(e,t,r)=>{const i=function(e){let{removeParams:t=[],format:r,catalogURL:i,url:o,layerBaseConfig:a,localizedLayerStyles:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e||!e.references)return null;const{wmts:s}=(0,D.tW)(e),l=e=>(0,D.em)((0,A.$F)(e),["request","layer","layers","service","version"].concat(t));let c,p;const u=(0,D.qy)(s.url);if(u&&O()(u))c=u.map((e=>l(e))).map((e=>{let{url:t}=e;return t})),p=u.map((e=>l(e))).map((e=>{let{params:t}=e;return t})).reduce(((e,t)=>({...e,...t})),{});else{const{url:e,params:t}=l(u||i);c=e,p=t}const d=(m=o||c,O()(m)&&1===m.length?m[0]:m);var m;const f=(0,D.n0)(s.SRS);return{type:"wmts",requestEncoding:e.requestEncoding,style:e.style,format:r,url:d,capabilitiesURL:e.capabilitiesURL,queryable:e.queryable,visibility:!0,dimensions:e.dimensions||[],name:s.params&&s.params.name,title:e.title||s.params&&s.params.name,description:e.description||"",availableTileMatrixSets:e.availableTileMatrixSets||[],credits:!(0,A.u8)("noCreditsFromCatalog")&&e.credits,bbox:{crs:e.boundingBox.crs,bounds:{minx:e.boundingBox.extent[0],miny:e.boundingBox.extent[1],maxx:e.boundingBox.extent[2],maxy:e.boundingBox.extent[3]}},links:(0,D.F8)(e),params:p,allowedSRS:f,catalogURL:i,...a,...e.layerOptions,localizedLayerStyles:U()(n)?void 0:n}}(e,t);return r?Promise.resolve(i):i};var he=r(227361),Se=r.n(he),we=r(505055),Oe=r.n(we),Re=r(555363),Te=r(531987);const Me={},Ce=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const a=v()(Se()(e,"TileMapService.TileMaps.TileMap",[])),{projection:n}=o,s=Se()(o,"options.service.allSRS"),l=a.map((t=>{let{$:r={}}=t;return{...r,href:(0,Re.cleanAuthParamsFromURL)(r.href),identifier:(0,Re.cleanAuthParamsFromURL)(r.href),format:(0,Te.A)(r.href),tmsUrl:(0,Re.cleanAuthParamsFromURL)(e.url)}})).filter((e=>{let{srs:t}=e;return!(n&&!s)||((e,t)=>e===t||"EPSG:3857"===e&&"EPSG:900913"===t||"EPSG:900913"===e&&"EPSG:3857"===t)(t,n)})).filter((function(){let{title:e="",srs:t=""}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return!i||-1!==e.toLowerCase().indexOf(i.toLowerCase())||-1!==t.toLowerCase().indexOf(i.toLowerCase())}));return{numberOfRecordsMatched:l.length,numberOfRecordsReturned:Math.min(r,l.length),nextRecord:t+Math.min(r,l.length)+1,records:l.filter(((e,i)=>i>=t-1&&i<t-1+r))}},Le=e=>e,Ue=(e,t,r,i,o)=>{const a=Me[e];return a&&(new Date).getTime()<a.timestamp+1e3*(A.ZP.getConfigProp("cacheExpire")||60)?new Promise((e=>{e(Ce(a.data,t,r,i,o))})):k().get(e).then((a=>{let n;return Oe().parseString(a.data,{explicitArray:!1},((t,r)=>{n={...r,url:e}})),Me[e]={timestamp:(new Date).getTime(),data:n},Ce(n,t,r,i,o)}))};var Fe=r(836727),Pe=r(959956);const Ee="custom",We=(e,t,r,i,o)=>{const a=Se()(o,"options.service");let n=[];if(a.provider&&a.provider!==Ee){const e=(s=a.provider,Object.keys(Fe.Z?.[s]?.variants??{}));0===e.length?n.push({provider:`${a.provider}`,title:`${a.provider}`}):n=e.map((e=>({provider:`${a.provider}.${e}`})))}else a.url&&(n=[{...a,title:a.title,type:"tileprovider",url:a.url,attribution:a.attribution,options:a.options||{},provider:Ee}]);var s;return new Promise((e=>{e(((e,t,r,i)=>{const o=e.filter((function(){let{title:e=""}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return!i||-1!==e.toLowerCase().indexOf(i.toLowerCase())})),a=o.filter(((e,i)=>i>=t-1&&i<t-1+r));return{numberOfRecordsMatched:o.length,numberOfRecordsReturned:a.length,nextRecord:t+Math.min(r,o.length)+1,records:a}})(n,t,r,i))}))},Be=function(e,t,r,i){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const{options:a}=o,{service:n={}}=a||{};return"tms"===n.provider&&Ue(e,t,r,i,o),We(0,t,r,i,o)},Ae=function(e,t,r,i){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const{options:a}=o,{service:n={}}=a||{};return"tms"===n.provider?Ue(e,t,r,i,o):We(0,t,r,i,o)},Ge=e=>"tms"===e.provider?j(e):(e=>{const t=e.provider&&"custom"!==e.provider?!!e.provider:(r=e.url,(0,Pe.Nw)(r));var r;if(e.title&&t)return W.Observable.of(e);throw new Error("catalog.config.notValidURLTemplate")})(e),De=e=>"tms"===e.provider?q({parseUrl:Le})(e):(e=>W.Observable.of(e))(e),Ie=(e,t)=>{if(e&&e.records){if(t.service&&"tms"===t.service.provider){const r=[{type:"OGC:TMS",version:"1.0.0",url:t.url}],{tms:i}=(0,D.tW)({references:r});return e.records.map((e=>({serviceType:"tms",layerType:"tms",isValid:!!i,title:e.title,tileMapUrl:e.href,description:`${e.srs}${e.format?", "+e.format:""}`,tmsUrl:t.tmsUrl,references:r,ogcReferences:i})))}return e.records.map((e=>({serviceType:"tms",layerType:"tileprovider",isValid:!!e.provider,title:e.title||e.provider,url:e.url,attribution:e.attribution,options:e.options,provider:e.provider,references:[]})))}return null},$e=(e,t)=>{let{tileMapUrl:r}=e,{tileMap:i,service:o}=t;const{TileMap:a={}}=i||{},{forceDefaultTileGrid:n}=o||{},{Title:s,Abstract:l,SRS:c,BoundingBox:p={},Origin:u,TileFormat:d={},TileSets:m}=a,{version:f,tilemapservice:g}=a.$,{minx:b,miny:y,maxx:x,maxy:h}=Se()(p,"$",{}),{x:S,y:w}=Se()(u,"$"),{width:O,height:R,"mime-type":T,extension:M}=Se()(d,"$",{}),C=[parseFloat(O),parseFloat(R,10)],L=v()(Se()(m,"TileSet",[]).map((e=>{let{$:t}=e;return t}))).map((e=>{let{href:t,order:r,"units-per-pixel":i}=e;return{href:(0,Re.cleanAuthParamsFromURL)(t),order:parseFloat(r),resolution:parseFloat(i)}})),U=Se()(m,"profile");return{title:s,visibility:!0,hideErrors:!0,name:s,allowedSRS:{[c]:!0},description:l,srs:c,version:f,tileMapService:g?(0,Re.cleanAuthParamsFromURL)(g):void 0,type:"tms",profile:U,tileMapUrl:r,forceDefaultTileGrid:n,bbox:p&&{crs:c,bounds:{minx:parseFloat(b),miny:parseFloat(y),maxx:parseFloat(x),maxy:parseFloat(h)}},tileSets:L,origin:{x:parseFloat(S),y:parseFloat(w)},format:T,tileSize:C,extension:M}},ke=e=>({type:"tileprovider",visibility:!0,url:e.url,title:e.title,attribution:e.attribution,options:e.options,provider:e.provider,name:e.provider}),Ve=(e,t,r)=>{return r?"tms"===e.layerType?(i=e.tileMapUrl,k().get(i).then((e=>new Promise((t=>{Oe().parseString(e.data,{explicitArray:!1},((e,r)=>t(r)))}))))).then((r=>$e(e,{...t,tileMap:r}))):Promise.resolve(ke(e)):((e,t)=>"tms"===e.layerType?$e(e,t):"tileprovider"===e.layerType?ke(e,t):null)(e,t);var i};var Ne=r(487758);const je={},qe=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;const o=v()(Se()(e,'["wfs:WFS_Capabilities"].FeatureTypeList.FeatureType',[])).map((t=>{const{Name:r,Title:i,Abstract:o,DefaultSRS:a,OtherSRS:n=[]}=t,s=t["ows:WGS84BoundingBox"],l=s["ows:LowerCorner"].split(" "),c=s["ows:UpperCorner"].split(" "),p={minx:parseFloat(l[0]),miny:parseFloat(l[1]),maxx:parseFloat(c[0]),maxy:parseFloat(c[1])};return{featureType:t,type:"wfs",url:(0,Re.cleanAuthParamsFromURL)(e.url),name:r,title:i,description:o,SRS:[a,...n],defaultSRS:a,boundingBox:{bounds:p,crs:"EPSG:4326"}}})).filter((function(){let{title:e="",name:t="",description:r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return!i||-1!==e.toLowerCase().indexOf(i.toLowerCase())||-1!==t.toLowerCase().indexOf(i.toLowerCase())||-1!==r.toLowerCase().indexOf(i.toLowerCase())})),a=o.filter(((e,i)=>i>=t-1&&i<t-1+r));return{numberOfRecordsMatched:o.length,numberOfRecordsReturned:Math.min(r,a.length),nextRecord:t+Math.min(r,o.length)+1,records:a}},_e=(e,t,r,i,o)=>{const a=je[e];return a&&(new Date).getTime()<a.timestamp+1e3*(A.ZP.getConfigProp("cacheExpire")||60)?new Promise((e=>{e(qe(a.data,t,r,i,o))})):(0,Ne.FU)(e).then((a=>{let n;return Oe().parseString(a.data,{explicitArray:!1,stripPrefix:!0},((t,r)=>{n={...r,url:e}})),je[e]={timestamp:(new Date).getTime(),data:n},qe(n,t,r,i,o)}))},Ze=N,ze=j,Je=q({parseUrl:Ne.dN}),He=(e,t,r,i,o)=>_e(e,t,r,i,o),Xe=function(){let{records:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e?e.map((e=>{const t=[{type:"OGC:WFS-1.1.0-http-get-capabilities",url:e.url},{type:"OGC:WFS-1.1.0-http-get-feature",url:e.url}],{wfs:r}=(0,D.tW)({references:t});return{...e,serviceType:"wfs",isValid:!!r,references:t,ogcReferences:r}})):null},Ke=(e,t,r)=>{const i=(e=>({type:e.type||"wfs",search:{url:e.url,type:"wfs"},url:e.url,queryable:e.queryable,visibility:!0,name:e.name,title:e.title||e.name,description:e.description||"",bbox:e.boundingBox,links:(0,D.F8)(e),style:{weight:1,color:"rgba(0, 0, 255, 1)",opacity:1,fillColor:"rgba(0, 0, 255, 0.1)",fillOpacity:.1,radius:10},...e.layerOptions}))(e);return r?Promise.resolve(i):i};const Ye=r(477862).Z.textSearch,Qe=N,et=j,tt=q({parseUrl:e=>e}),rt=e=>e&&e.records?e.records.map((e=>({serviceType:"backgrounds",isValid:!!e,description:e.title,title:e.title,identifier:e.name,thumbnail:e.thumbURL,references:[],background:e}))):null,it=(e,t,r)=>{const i=(e=>({...e?.background,id:e?.background.name,visibility:!1}))(e);return r?Promise.resolve(i):i};var ot=r(806783);function at(e){const t=e.split("/");return t[t.length-2]}const nt=N,st=e=>W.Observable.of(e),lt=(e,t,r,i,o)=>((e,t,r,i,o)=>(0,ot.F)(e).then((t=>{let{tileset:r,...i}=t;const a=[{title:o?.options?.service?.title||at(e),url:e,type:"3dtiles",tileset:r,...i}];return{numberOfRecordsMatched:a.length,numberOfRecordsReturned:a.length,records:a}})))(e,0,0,0,o),ct=e=>e?.records?e.records.map((e=>{const{version:t,bbox:r,format:i,properties:o}=e;return{serviceType:"3dtiles",isValid:!0,description:`v. ${t}`,title:e.title,identifier:e.url,url:e.url,thumbnail:null,...r&&{bbox:r},...i&&{format:i},...o&&{properties:o},references:[]}})):null,pt=(e,t,r)=>{const i=(e=>{if(!e)return null;const{bbox:t,format:r,properties:i}=e;return{type:"3dtiles",url:e.url,title:e.title,visibility:!0,...t&&{bbox:t},...r&&{format:r},...i&&{properties:i}}})(e);return r?Promise.resolve(i):i},ut=e=>{if(e.title&&function(e){if((0,Pe.Nw)(e)){const t=e.split(/\./g);return"json"===t[t.length-1]}return!1}(e.url))return W.Observable.of(e);throw new Error("catalog.config.notValidURLTemplate")},dt={csw:o,wfs:s,wms:i,tms:n,wmts:a,backgrounds:l,"3dtiles":c}},23939:(e,t,r)=>{"use strict";r.d(t,{Z:()=>Z});var i=r(49977),o=r(409669),a=r.n(o),n=r(737691),s=r.n(n),l=r(430647),c=r(91175),p=r.n(c),u=r(227361),d=r.n(u),m=r(313311),f=r.n(m),g=r(701469),b=r.n(g),v=r(747037),y=r.n(v),x=r(513218),h=r.n(x),S=r(3674),w=r.n(S),O=r(493220),R=r.n(O),T=r(682492),M=r.n(T),C=r(546952),L=r(333101),U=r(504518),F=r(687753),P=r(917450),E=r(757660),W=r(134479),B=r(4143),A=r(707366),G=r(612912),D=r(175063),I=r(467763),$=r(351546),k=r(234228),V=r(399790),N=r(426529),j=r(859518),q=r(742178);const _=(e,t)=>e?i.Observable.of((0,U.vU)({title:"notification.warning",message:"catalog.notification.errorServiceUrl",autoDismiss:6,position:"tc"}),(0,C.Rc)(!1)):i.Observable.of((0,C.m)(t)),Z=e=>({recordSearchEpic:(t,r)=>t.ofType(C.V3).switchMap((t=>{let{format:o,url:a,startPosition:n,maxRecords:s,text:l,options:c}=t;const p=d()(c,"service.filter")||d()(c,"filter"),u=d()(c,"isNewService",!1);return i.Observable.defer((()=>e[o].textSearch(a,n,s,l,{options:c,filter:p,...(0,W.HN)(r.getState())}))).switchMap((e=>{if(e.error)return _(u,e);let t=i.Observable.empty();return u&&(t=i.Observable.from([(0,C.zX)(!0),(0,C.N3)(c.service),(0,U.Vp)({title:"notification.success",message:"catalog.notification.addCatalogService",autoDismiss:6,position:"tc"}),(0,C.Rc)(!1)])),t.concat([(0,C.nX)({url:a,startPosition:n,maxRecords:s,text:l},e)])})).startWith(u?(0,C.Rc)(!0):(0,C.K4)(!0)).catch((e=>_(u,e)))})),addLayersFromCatalogsEpic:(t,r)=>t.ofType(C.WX).filter((e=>{let{layers:t,sources:r}=e;return b()(t)&&b()(r)&&t.length&&t.length===r.length})).mergeMap((t=>{let{layers:o,sources:a,options:n,startPosition:s=1,maxRecords:l=4}=t;const c=r.getState(),u=(0,W.PG)(c),m=o.filter(((e,t)=>!!u?.[a[t]]||"object"==typeof a[t])).map(((t,r)=>{const p=a[r],m="object"==typeof p?p:u[p],f=m.type.toLowerCase(),g=m.url,b=o[r],v=d()(n,r,(0,W.bA)(c)),y="3dtiles"===f?{...v,title:h()(v?.title)?{...v?.title,default:v?.title?.default||b}:v?.title||b}:v;return i.Observable.defer((()=>e[f].textSearch(g,s,l,b,{...y,...m,options:{service:m}}).catch((()=>({records:[]}))))).map((e=>({...e,format:f,url:g,text:b,layerOptions:y,service:m})))}));return i.Observable.forkJoin(m).switchMap((t=>b()(t)&&t.length?i.Observable.of(t.map((t=>{const{format:r,url:o,text:a,layerOptions:n,service:s,...l}=t,u=(0,A.Ps)(c),d=e[r].getCatalogRecords(l,n,u)||[],m=p()(d.filter((e=>e.identifier||e.name===a))),{wms:f,wmts:g}=(0,D.tW)(m),b=f||g;if(b){const e=(0,D.n0)(b.SRS);if(b.SRS.length>0&&!$.default.isAllowedSRS("EPSG:3857",e))return i.Observable.empty()}const v=(0,W.kS)(c),y=e[r].getLayerFromRecord(m,{service:s,removeParams:v,catalogURL:"csw"===r&&o?o+"?request=GetRecordById&service=CSW&version=2.0.2&elementSetName=full&id="+m.identifier:o,layerBaseConfig:{}});return m?[y,n]:[a]}))):i.Observable.empty()))})).mergeMap((e=>{if(e){const t=e.filter((e=>y()(e[0]))).join(" ");let r=[];t&&(r=[(0,C.E9)(t)]);const o=e.filter((e=>h()(e[0]))).map((e=>M()({},e[0],e[1])));return r=[...r,...o.map((e=>(0,C.A4)(e)))],i.Observable.from(r)}return i.Observable.empty()})).catch((()=>i.Observable.empty())),addLayerAndDescribeEpic:(e,t)=>e.ofType(C.r7).mergeMap((e=>{const{layer:r,zoomToLayer:o}=e,a=[],n=t.getState(),s=(0,V.R8)(r);return a.push((0,L.A4)({...r,id:s})),o&&r.bbox&&a.push((0,j.Px)(r.bbox.bounds,r.bbox.crs)),"wms"===r.type?i.Observable.defer((()=>(0,I.gs)((0,V.Hi)(r),r.name))).switchMap((e=>{if(e){let t=f()(e,(e=>e.name===r.name));if(t&&"WFS"===t.owsType){const e=k.ZP.filterUrlParams(k.ZP.cleanDuplicatedQuestionMarks(t.owsURL),(0,W.kS)(n));return i.Observable.of((0,L.He)(s,{search:{url:e,type:"wfs"}}))}}return i.Observable.empty()})).merge(i.Observable.from(a)).catch((e=>i.Observable.of((0,C.bu)(r,e)))):i.Observable.from(a)})).catch((()=>i.Observable.empty())),newCatalogServiceAdded:(t,r)=>t.ofType(C.mh).switchMap((()=>{const t=r.getState(),o=(0,W._S)(t),a=(0,W.y)(t);return i.Observable.of(o).switchMap((t=>e[t.type]?.preprocess?.(t)??i.Observable.of(t))).switchMap((t=>e[t.type]?.validate?.(t)??i.Observable.of(t))).switchMap((e=>i.Observable.of((0,C.tt)({format:e.type,url:e.url,startPosition:1,maxRecords:a,text:"",options:{service:e,isNewService:!0}})))).catch((e=>i.Observable.of((0,U.vU)({exception:e,title:"notification.warning",message:e.notification||"catalog.notification.warningAddCatalogService",autoDismiss:6,position:"tc"}))))})),deleteCatalogServiceEpic:(e,t)=>e.ofType(C.$Y).switchMap((()=>{const e=t.getState();let r=(0,W.Cb)(e);const o=(0,W.b6)(e);let a=o[r]?(0,U.Vp)({title:"notification.warning",message:"catalog.notification.serviceDeletedCorrectly",autoDismiss:6,position:"tc"}):(0,U.vU)({title:"notification.warning",message:"catalog.notification.impossibleDeleteService",autoDismiss:6,position:"tc"}),n=(0,C.SU)(r);return o[r]?i.Observable.of(a,n):i.Observable.of(a)})),openCatalogEpic:(e,t)=>e.ofType(F.At,F.kM).filter((e=>"metadataexplorer"===e.control&&(0,W.JF)(t.getState()))).switchMap((()=>i.Observable.of((0,P.g)(),(0,P.aN)()))),getMetadataRecordById:(e,t)=>e.ofType(C.UT).switchMap((e=>{let{metadataOptions:r={}}=e;const o=t.getState(),n=(0,G.Iz)(o);return i.Observable.defer((()=>(0,I.FU)((0,V.Fh)(n)))).switchMap((e=>{const t=(0,I.Xv)(e.capability),o=(1===t.length?t[0].metadataURL:f()(t,(e=>(0,V.H7)(e.name)===(0,V.H7)(n.name)))?.metadataURL)||[],c=d()(f()(o,(e=>y()(e.type)&&("iso19115:2003"===e.type.toLowerCase()||"tc211"===e.type.toLowerCase())&&("application/xml"===e.format||"text/xml"===e.format))),"onlineResource.href"),p=d()(f()(o,(e=>y()(e.type)&&("iso19115:2003"===e.type.toLowerCase()||"tc211"===e.type.toLowerCase())&&"text/html"===e.format)),"onlineResource.href"),u=f()(d()(r,"extractors",[]),(e=>{let{properties:t,layersRegex:r}=e;const i=r?new RegExp(r):null;return h()(t)&&(!r||i.test(n.name))})),m=p?{metadataUrl:p}:{},g=i.Observable.defer((()=>q.ZP.getRecordById(n.catalogURL))).switchMap((e=>e&&e.error?i.Observable.of((0,U.vU)({title:"notification.warning",message:"toc.layerMetadata.notification.warnigGetMetadataRecordById",autoDismiss:6,position:"tc"}),(0,L.c9)(m,!1)):e&&e.dc?i.Observable.of((0,L.c9)({...m,...e.dc},!1)):i.Observable.empty())),b=i.Observable.defer((()=>a().get(c,{headers:{Accept:"application/xml"}}))).pluck("data").map((e=>(new l.a).parseFromString(e))).map((e=>{const t=s().useNamespaces(r.xmlNamespaces||{}),i=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1?arguments[1]:void 0;return R()(e).reduce(((e,o)=>{let a,[n,s]=o;if(h()(s)&&y()(s.xpath)&&h()(s.properties)&&w()(s.properties).length>0)a=t(s.xpath,r).map((e=>i(s.properties,e))),0===a.length&&(a=null);else{const e=t(s,r);1===e.length?a=d()(e[0],"nodeValue")??d()(e[0],"childNodes[0].nodeValue"):e.length>1&&(a=e.map((e=>d()(e,"childNodes[0].nodeValue"))).filter((e=>!!e)))}return{...e,...a?{[n]:a}:{}}}),{})};return i(u.properties,e)})).switchMap((e=>i.Observable.of((0,L.c9)({...m,...e},!1))));return c&&u?b:n.catalogURL?g:i.Observable.of((0,L.c9)(m,!1))})).startWith((0,L.c9)({},!0)).catch((()=>i.Observable.of((0,U.vU)({title:"notification.warning",message:"toc.layerMetadata.notification.warnigGetMetadataRecordById",autoDismiss:6,position:"tc"}),(0,L.c9)({},!1))))})),autoSearchEpic:function(e){let{getState:t=(()=>{})}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.ofType(C.CO).debounce((()=>{const e=t(),r=(0,W.l2)(e);return i.Observable.timer(r)})).switchMap((e=>{let{text:r}=e;const o=t(),a=(0,W.y)(o),n=(0,W.R7)(o),{type:s,url:l,filter:c}=n;return i.Observable.of((0,C.tt)({format:s,url:l,startPosition:1,maxRecords:a,text:r,options:{service:n,filter:c}}))}))},catalogCloseEpic:(e,t)=>e.ofType(C.ur).switchMap((()=>{const e=t.getState(),r=(0,B.YL)(e),o=(0,W.b6)(e);return i.Observable.of(...[(0,F.pu)("metadataexplorer","enabled",!1,"group",null),(0,C.In)("view"),(0,C.ye)()].concat("backgroundSelector"===r?[(0,C.Dw)(p()(w()(o))),(0,E.vw)(!0)]:[]))})),getSupportedFormatsEpic:function(e){let{getState:t=(()=>{})}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.ofType(C.xM).filter((e=>(0,W.CK)(t())!==e?.url)).switchMap((function(){let{url:e=""}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i.Observable.defer((()=>(0,I.T6)(e,!0))).switchMap((t=>i.Observable.of((0,C.nx)(t,e)))).let((0,N.hP)((0,C.We)(!0),(0,C.We)(!1),(()=>i.Observable.of((0,U.vU)({title:"layerProperties.format.error.title",message:"layerProperties.format.error.message"}),(0,C.We)(!1)))))}))},updateGroupSelectedMetadataExplorerEpic:(e,t)=>e.ofType(L.c7).filter((()=>(0,W.JF)(t.getState()))).switchMap((e=>{let{nodeType:r,id:o}=e;const a=t.getState(),n=0===(0,G.NP)(a).length||"group"!==r?"Default":o;return i.Observable.of((0,F.Xg)("metadataexplorer","group",n))}))})},175063:(e,t,r)=>{"use strict";r.d(t,{n0:()=>p,em:()=>u,tW:()=>d,FJ:()=>m,F8:()=>f,p8:()=>g,qy:()=>b});var i=r(727418),o=r.n(i),a=r(91175),n=r.n(a),s=r(701469),l=r.n(s),c=r(351546);const p=e=>e.filter((e=>c.default.isSRSAllowed(e))).reduce(((e,t)=>o()(e,{[t]:!0})),{}),u=(e,t)=>{const r=e.split("?"),i={};return r.length>=2&&r[1]&&r[1].split(/[&;]/g).forEach((e=>{const r=e.split("=");-1===t.indexOf(r[0].toLowerCase())&&(i[r[0]]=r[1])})),{url:r[0],params:i}},d=function(){let{references:e=[]}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{wfs:n()(e.filter((e=>e.type&&("OGC:WFS"===e.type||e.type.indexOf("OGC:WFS")>-1&&e.type.indexOf("http-get-feature")>-1)))),wms:n()(e.filter((e=>e.type&&("OGC:WMS"===e.type||e.type.indexOf("OGC:WMS")>-1&&e.type.indexOf("http-get-map")>-1)))),wmts:n()(e.filter((e=>e.type&&("OGC:WMTS"===e.type||e.type.indexOf("OGC:WMTS")>-1&&e.type.indexOf("http-get-map")>-1)))),tms:n()(e.filter((e=>e.type&&("OGC:TMS"===e.type||e.type.indexOf("OGC:TMS")>-1))))}},m=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{references:[]};return{esri:n()(e.references.filter((e=>e.type&&("ESRI:SERVER"===e.type||"arcgis"===e.type))))}},f=function(){let{references:e=[]}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=n()(e.filter((e=>e.type&&e.type.indexOf("OGC:WMS")>-1&&e.type.indexOf("http-get-capabilities")>-1))),r=n()(e.filter((e=>e.type&&e.type.indexOf("OGC:WFS")>-1&&e.type.indexOf("http-get-capabilities")>-1))),i=n()(e.filter((e=>e.type&&e.type.indexOf("OGC:WMTS")>-1&&e.type.indexOf("http-get-capabilities")>-1))),o=[];return t&&o.push({type:"WMS_GET_CAPABILITIES",url:t.url,labelId:"catalog.wmsGetCapLink"}),i&&o.push({type:"WMTS_GET_CAPABILITIES",url:i.url,labelId:"catalog.wmtsGetCapLink"}),r&&o.push({type:"WFS_GET_CAPABILITIES",url:r.url,labelId:"catalog.wfsGetCapLink"}),o},g=e=>"wms"===e.type?[e.url,...e.domainAliases??[]].join(","):e.url,b=e=>e&&!l()(e)&&-1!==e.indexOf(",")?e.split(",").map((e=>e.trim())):e}}]);