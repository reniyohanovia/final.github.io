(self.webpackChunkmapstore2=self.webpackChunkmapstore2||[]).push([[2269],{331655:(e,t,i)=>{"use strict";i.d(t,{$:()=>s,b:()=>c});var o=i(234228),r=i(701469),n=i.n(r),l=i(513218),a=i.n(l);const s=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(n()(e))return e.reduce(((e,t)=>s(t)&&e),!0);let i=!1,r=!(0===e.indexOf("http")),l=!r&&e.match(/([^:]*:)\/\/([^:]*:?[^@]*@)?([^:\/\?]*):?([^\/\?]*)/);if(l){let e=window.location;r=l[1]===e.protocol&&l[3]===e.hostname;let t=l[4],i=e.port;(80!==t&&""!==t||"80"!==i&&""!==i)&&(r=r&&t===i)}if(!r){let r=o.ZP.getProxyUrl(t);if(r){let t=[];a()(r)&&(t=r.useCORS||[],r=r.url),t.reduce(((t,i)=>t||0===e.indexOf(i)),!1)||(i=!0)}}return i},c=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=o.ZP.getProxyUrl(e);return t&&a()(t)&&(t=t.url),t}},782269:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>R});var o=i(288487),r=i(65792),n=i.n(r),l=i(984596),a=i.n(l),s=i(281763),c=i.n(s),p=i(441609),m=i.n(p),d=i(618446),y=i.n(d),h=i(478718),f=i.n(h),u=i(396026),g=i.n(u),b=i(331655);function T(e){let{color:t,opacity:i}=e;const[r,l,a,s]=n()(t).gl();return void 0!==i?new o.Color(r,l,a,i):new o.Color(r,l,a,s)}function C(e){let{color:t,opacity:i,dasharray:r}=e;if(r?.length<=0)return T({color:t,opacity:i});const n=r.reduce(((e,t)=>e+t),0);return new o.PolylineDashMaterialProperty({color:T({color:t,opacity:i}),dashLength:n,dashPattern:parseInt(r.map((e=>Math.floor(e/n*16))).map(((e,t)=>g()(e).map((()=>t%2==0?"1":"0")).join(""))).join(""),2)})}const v=(e,t)=>(e._msGlobalOpacity??1)!==t,S={};function _(e){let{map:t,symbolizer:i,entity:r,globalOpacity:n,sampleTerrain:l}=e;const a=["msLeaderLineColor","msLeaderLineOpacity","msLeaderLineWidth","msHeight","msHeightReference","offset"];if(r._msSymbolizer&&!v(r,n)&&y()(f()(i,a),f()(r._msSymbolizer,a)))return Promise.resolve({polyline:r.polyline,billboard:r.billboard,updated:!1});if(!i.msLeaderLineWidth)return Promise.resolve({updated:void 0!==r.polyline});const s=o.Cartographic.fromCartesian(r.position.getValue(o.JulianDate.now())),c=i.msHeightReference;return(i?.msHeight===r._msSymbolizer?.msHeight&&i?.msHeightReference===r._msSymbolizer?.msHeightReference&&r.polyline?Promise.resolve(r.polyline):function(e){let{map:t,cartographic:i,heightReference:r,sampleTerrain:n}=e;return new Promise((e=>{const l=t=>{const n={none:i.height,relative:i.height+t,clamp:t};e(t===i.height?void 0:o.Cartesian3.fromRadiansArrayHeights([i.longitude,i.latitude,t,i.longitude,i.latitude,n[r??"none"]]))},a=t?.terrainProvider;a?(a.ready?Promise.resolve(!0):a.readyPromise).then((()=>{const e=a?.availability?o.sampleTerrainMostDetailed(a,[new o.Cartographic(i.longitude,i.latitude,0)]):n(a,a?.sampleTerrainZoomLevel??18,[new o.Cartographic(i.longitude,i.latitude,0)]);o.defined(e)?e.then((e=>l(e?.[0]?.height??0))).catch((()=>l(0))):l(0)})):l(0)}))}({map:t,cartographic:s,heightReference:c,sampleTerrain:l}).then((e=>new o.PolylineGraphics({positions:e})))).then((e=>{const t=T({color:i.msLeaderLineColor||"#000000",opacity:(i.msLeaderLineOpacity??1)*n});if(e&&(e.material=t,e.width=i.msLeaderLineWidth??1),i.offset&&(0!==i.offset[0]||0!==i.offset[1])){const r=function(e){let{offset:t=[],msLeaderLineWidth:i}=e;const o=i??1,r=Math.abs(t[0]||1),n=Math.abs(t[1]||1),l=Math.sign(t[0])===Math.sign(t[1]),a=[r,n,o,l].join(";");if(S[a])return S[a];const s=document.createElement("canvas");s.setAttribute("width",r),s.setAttribute("height",n);const c=s.getContext("2d");return c.strokeStyle="#ffffff",c.lineWidth=o,c.beginPath(),c.moveTo(...l?[0,0]:[r,0]),c.lineTo(...l?[r,n]:[0,n]),c.stroke(),S[a]=s,s}(i);return{billboard:new o.BillboardGraphics({image:r,scale:1,pixelOffset:new o.Cartesian2((i.offset[0]||0)/2,(i.offset[1]||0)/2),color:t}),polyline:e,updated:!0}}return{polyline:e,updated:!0}}))}function I(e){let{entity:t,symbolizer:i,properties:r}=e;t._msPosition||(t._msPosition=t.position.getValue(o.JulianDate.now()));const n=((e,t)=>{const i=parseFloat(e);if(!isNaN(i)&&c()(i))return i;const o="attribute"===e?.type&&parseFloat(t[e.name]);return!isNaN(o)&&c()(o)?o:null})(i.msHeight,r);if(null===n)return void t.position.setValue(t._msPosition);const l=o.Cartographic.fromCartesian(t._msPosition);l.height=n,t.position.setValue(o.Cartographic.toCartesian(l))}function w(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e.properties?Object.keys(e.properties).reduce(((t,i)=>{const o=new RegExp(`\\{\\{${i}\\}\\}`,"g");return t.replace(o,e.properties[i]??"")}),t):t}const P={none:"NONE",relative:"RELATIVE_TO_GROUND",clamp:"CLAMP_TO_GROUND"},O=["billboard","box","corridor","cylinder","ellipse","ellipsoid","label","model","tileset","path","plane","point","polygon","polyline","polylineVolume","rectangle","wall"];const R=class{constructor(){let{drawIcons:e,getImageIdFromSymbolizer:t,geoStylerStyleFilter:i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._drawIcons=e||(()=>Promise.resolve(null)),this._getImageIdFromSymbolizer=t||(e=>e.symbolizerId),this._geoStylerStyleFilter=i||(()=>!0)}readStyle(){return new Promise(((e,t)=>{try{e(null)}catch(e){t(e)}}))}writeStyle(e){var t=this;return new Promise(((i,r)=>{try{this._drawIcons(e).then((function(){const r=function(){let{rules:e=[]}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{images:t=[],getImageIdFromSymbolizer:i,geoStylerStyleFilter:r=(()=>!0)}=arguments.length>1?arguments[1]:void 0;return n=>{let{entities:l,map:s,opacity:c=1,sampleTerrain:p=o.sampleTerrain}=n;return Promise.all((l||[]).map((n=>new Promise((l=>{let d={};O.forEach((e=>{n._msStoredCoordinates||(d[e]=function(e,t){switch(e){case"polyline":return t[e]?.positions;case"polygon":return t[e]?.hierarchy;default:return null}}(e,n)||void 0)})),n._msStoredCoordinates||(n._msStoredCoordinates=d);const h=n?.properties?.getValue(o.JulianDate.now())||{},u=e?.filter((e=>!e.filter||r({properties:h||{}},e.filter)));if(u?.length>0){const e=u.reduce(((e,t)=>[...e,...t?.symbolizers]),[]),r=e.filter((e=>["Mark","Icon","Text","Model"].includes(e.kind)&&n.position)),d=e.filter((e=>"Line"===e.kind&&n._msStoredCoordinates.polyline)),g=e.filter((e=>"Fill"===e.kind&&n._msStoredCoordinates.polygon)),S=r[r.length-1]||d[d.length-1]||g[g.length-1];return!S||y()(S,n._msSymbolizer)&&!v(n,c)?(!S&&n._msSymbolizer&&(O.forEach((e=>{n[e]=void 0})),n._msSymbolizer=void 0,n._msGlobalOpacity=void 0),l(n)):(e=>{let{symbolizer:t,images:i,getImageIdFromSymbolizer:r,entity:n,globalOpacity:l,properties:s,map:c,sampleTerrain:p}=e;if("Mark"===t.kind){I({entity:n,symbolizer:t,properties:s});const{image:e,width:a,height:m}=i.find((e=>{let{id:i}=e;return i===r(t)}))||{};if(e){const i=a>m?a:m,r=2*t.radius/i;return _({map:c,symbolizer:t,entity:n,globalOpacity:l,sampleTerrain:p}).then((i=>{let{polyline:n}=i;return{polyline:n,billboard:new o.BillboardGraphics({image:e,scale:r,rotation:o.Math.toRadians(-1*t.rotate||0),disableDepthTestDistance:t.msBringToFront?Number.POSITIVE_INFINITY:0,heightReference:o.HeightReference[P[t.msHeightReference]||"NONE"],color:T({color:"#ffffff",opacity:1*l})})}}))}}if("Icon"===t.kind){I({entity:n,symbolizer:t,properties:s});const{image:e,width:a,height:m}=i.find((e=>{let{id:i}=e;return i===r(t)}))||{};if(e){const i=a>m?a:m,r=t.size/i;return _({map:c,symbolizer:t,entity:n,globalOpacity:l,sampleTerrain:p}).then((i=>{let{polyline:n}=i;return{polyline:n,billboard:new o.BillboardGraphics({image:e,scale:r,rotation:o.Math.toRadians(-1*t.rotate||0),disableDepthTestDistance:t.msBringToFront?Number.POSITIVE_INFINITY:0,heightReference:o.HeightReference[P[t.msHeightReference]||"NONE"],color:T({color:"#ffffff",opacity:t.opacity*l})})}}))}}if("Text"===t.kind)return I({entity:n,symbolizer:t,properties:s}),_({map:c,symbolizer:t,entity:n,globalOpacity:l,sampleTerrain:p}).then((e=>{let{polyline:i,billboard:r}=e;return{billboard:r,polyline:i,label:new o.LabelGraphics({text:w({properties:s},t.label),font:[t.fontStyle,t.fontWeight,`${t.size}px`,a()(t.font||["serif"]).join(", ")].filter((e=>e)).join(" "),fillColor:T({color:t.color,opacity:1*l}),disableDepthTestDistance:t.msBringToFront?Number.POSITIVE_INFINITY:0,heightReference:o.HeightReference[P[t.msHeightReference]||"NONE"],pixelOffset:new o.Cartesian2(t?.offset?.[0]??0,t?.offset?.[1]??0),...t.haloWidth>0&&{style:o.LabelStyle.FILL_AND_OUTLINE,outlineColor:T({color:t.haloColor,opacity:1*l}),outlineWidth:t.haloWidth}})}}));if("Model"===t.kind){if(!t?.model)return Promise.resolve({});const e=["model"],i=n.model&&n._msSymbolizer&&y()(f()(t,e),f()(n._msSymbolizer,e)),r=i?n.model:new o.ModelGraphics({uri:new o.Resource({proxy:(0,b.$)(t?.model)?new o.DefaultProxy((0,b.b)()):void 0,url:t?.model})});I({entity:n,symbolizer:t,properties:s});const a=n._msPosition,m=o.Math.toRadians(t?.heading??0),d=o.Math.toRadians(t?.pitch??0),h=o.Math.toRadians(t?.roll??0),u=new o.HeadingPitchRoll(m,d,h),g=o.Transforms.headingPitchRollQuaternion(a,u);return n.orientation=g,r.scale=t?.scale??1,r.color=T({color:t.color??"#ffffff",opacity:(t.opacity??1)*l}),r.heightReference=o.HeightReference[P[t.msHeightReference]||"NONE"],_({map:c,symbolizer:t,entity:n,globalOpacity:l,sampleTerrain:p}).then((e=>{let{polyline:t,updated:o}=e;return{...(!i||o)&&{model:r,polyline:t}}}))}if("Line"===t.kind)return Promise.resolve({polyline:new o.PolylineGraphics({material:t?.dasharray?C({color:t.color,opacity:t.opacity*l,dasharray:t.dasharray}):T({color:t.color,opacity:t.opacity*l}),width:t.width,positions:n._msStoredCoordinates.polyline,clampToGround:t.msClampToGround})});if("Fill"===t.kind){const e=new o.PolygonGraphics({material:T({color:t.color,opacity:t.fillOpacity*l}),hierarchy:n._msStoredCoordinates.polygon,perPositionHeight:!t.msClampToGround,...t.msClampToGround?{classificationType:"terrain"===t.msClassificationType?o.ClassificationType.TERRAIN:"3d"===t.msClassificationType?o.ClassificationType.CESIUM_3D_TILE:o.ClassificationType.BOTH}:void 0});let i;return t.outlineColor&&0!==t.outlineWidth&&(i=new o.PolylineGraphics({material:T({color:t.outlineColor,opacity:t.outlineOpacity*l}),width:t.outlineWidth,positions:n._msStoredCoordinates.polygon.getValue().positions,clampToGround:t.msClampToGround,...t.msClampToGround?{classificationType:"terrain"===t.msClassificationType?o.ClassificationType.TERRAIN:"3d"===t.msClassificationType?o.ClassificationType.CESIUM_3D_TILE:o.ClassificationType.BOTH}:void 0})),Promise.resolve({polygon:e,...i&&{polyline:i}})}return Promise.resolve({})})({symbolizer:S,images:t,getImageIdFromSymbolizer:i,entity:n,globalOpacity:c,properties:h,map:s,sampleTerrain:p}).then((e=>{m()(e)||(O.forEach((e=>{n[e]=void 0})),Object.keys(e).forEach((t=>{n[t]=e[t]}))),n._msSymbolizer=S,n._msGlobalOpacity=c,l(n)}))}return O.forEach((e=>{n[e]=void 0})),n._msSymbolizer=void 0,n._msGlobalOpacity=void 0,l(n)})))))}}(e,{images:arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],getImageIdFromSymbolizer:t._getImageIdFromSymbolizer,geoStylerStyleFilter:t._geoStylerStyleFilter});i(r)}))}catch(e){r(e)}}))}}},540098:e=>{var t=Math.ceil,i=Math.max;e.exports=function(e,o,r,n){for(var l=-1,a=i(t((o-e)/(r||1)),0),s=Array(a);a--;)s[n?a:++l]=e,e+=r;return s}},747445:(e,t,i)=>{var o=i(540098),r=i(816612),n=i(418601);e.exports=function(e){return function(t,i,l){return l&&"number"!=typeof l&&r(t,i,l)&&(i=l=void 0),t=n(t),void 0===i?(i=t,t=0):i=n(i),l=void 0===l?t<i?1:-1:n(l),o(t,i,l,e)}}},396026:(e,t,i)=>{var o=i(747445)();e.exports=o}}]);